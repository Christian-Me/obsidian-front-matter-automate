/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => FolderTagPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian6 = require("obsidian");

// src/settings.ts
var import_obsidian5 = require("obsidian");

// src/frontmatter-tools.ts
var import_obsidian = require("obsidian");
function getPropertiesFromMetadataManager(app) {
  try {
    const metadataManager = app.metadataTypeManager;
    console.log("get properties:", metadataManager);
    return Object.values(metadataManager.properties).map((value) => ({
      name: value.name,
      type: value.type,
      count: value.count,
      source: "registered"
    })).sort((a, b) => a.name.localeCompare(b.name));
  } catch (e) {
    console.error("Couldn't access properties from Metadata Manager", e);
    return [];
  }
}
function getTypesFromMetadataManager(app) {
  try {
    const metadataManager = app.metadataTypeManager;
    console.log("get types:", metadataManager);
    return Object.values(metadataManager.registeredTypeWidgets).map((value, index, array) => ({
      type: value.type,
      icon: value.icon,
      jsType: ""
    })).sort((a, b) => a.type.localeCompare(b.type));
  } catch (e) {
    console.error("Couldn't access properties from Metadata Manager", e);
    return [];
  }
}
var SelectProperty = class extends import_obsidian.SuggestModal {
  constructor(app, knownProperties, property, onSubmit) {
    super(app);
    this.onSubmit = onSubmit;
    this.property = property;
    this.typedText = "";
    this.newTextFlag = true;
    this.knownProperties = knownProperties;
  }
  // Returns all available suggestions.
  getSuggestions(query) {
    const result = this.knownProperties.filter((property) => property.name.toLowerCase().includes(query.toLowerCase()));
    this.newTextFlag = result.length === 0;
    this.typedText = query;
    return result;
  }
  onOpen() {
    if (this.property) {
      this.setPlaceholder(this.property.name);
    } else {
      this.setPlaceholder("no property selected!");
    }
    this.setTitle("Select or type a property name");
  }
  // Renders each suggestion item.
  renderSuggestion(property, el) {
    el.createEl("div", { text: property.name });
    el.createEl("small", { text: property.type });
  }
  onClose() {
    if (this.newTextFlag && this.property) {
      this.property.name = this.typedText;
      this.property.type = "text";
      this.onSubmit(this.property);
    }
  }
  // Perform action on the selected suggestion.
  onChooseSuggestion(property, evt) {
    if (evt instanceof KeyboardEvent) {
      console.log(`keyboard ${this.typedText} ${this.newTextFlag}`, property);
    }
    console.log("onChooseSuggestion", evt);
    this.onSubmit(property);
  }
};

// src/tools.ts
function parseJSCode(jsCode) {
  function parseFunction(jsCode2) {
    try {
      jsCode2 = cleanCodeString(jsCode2);
      var funcReg = /function *\(([^()]*)\)[ \n\t]*{(.*)}/gmi;
      var match = funcReg.exec(jsCode2.replace(/\n/g, " "));
      if (!match)
        return void 0;
      var args = match[1].split(",");
      args.push(match[2]);
      return new Function(...args);
    } catch (error) {
      console.error("error parsing JS function!", error);
      return error.message;
    }
  }
  ;
  return parseFunction(jsCode);
}
function cleanCodeString(codeString) {
  if (typeof codeString !== "string") {
    throw new TypeError("Input must be a string.");
  }
  let inMultiLineComment = false;
  let inSingleLineComment = false;
  let inString = null;
  let inRegExp = false;
  let cleanedCode = "";
  let i = 0;
  while (i < codeString.length) {
    const char = codeString[i];
    const nextChar = codeString[i + 1];
    if (inMultiLineComment) {
      if (char === "*" && nextChar === "/") {
        inMultiLineComment = false;
        i += 2;
        continue;
      } else {
        i++;
        continue;
      }
    }
    if (inSingleLineComment) {
      if (char === "\n" || char === "\r") {
        inSingleLineComment = false;
        cleanedCode += char;
        i++;
        continue;
      } else {
        i++;
        continue;
      }
    }
    if (inString) {
      if (char === inString) {
        inString = null;
      } else if (char === "\\") {
        cleanedCode += char;
        i++;
        if (i < codeString.length) {
          cleanedCode += codeString[i];
        }
        i++;
        continue;
      }
      cleanedCode += char;
      i++;
      continue;
    }
    if (inRegExp) {
      if (char === "/") {
        inRegExp = false;
      } else if (char === "\\") {
        cleanedCode += char;
        i++;
        if (i < codeString.length) {
          cleanedCode += codeString[i];
        }
        i++;
        continue;
      }
      cleanedCode += char;
      i++;
      continue;
    }
    if (char === "/" && nextChar === "*") {
      inMultiLineComment = true;
      i += 2;
      continue;
    }
    if (char === "/" && nextChar === "/") {
      inSingleLineComment = true;
      i += 2;
      continue;
    }
    if (char === '"' || char === "'") {
      inString = char;
      cleanedCode += char;
      i++;
      continue;
    }
    if (char === "/") {
      const prevMeaningfulChar = cleanedCode.trim().slice(-1);
      if (prevMeaningfulChar === "" || ["(", ",", "=", ":", "[", "!", "&", "|", "?", "{", ";", "\n", "\r"].includes(prevMeaningfulChar)) {
        inRegExp = true;
        cleanedCode += char;
        i++;
        continue;
      }
    }
    cleanedCode += char;
    i++;
  }
  return cleanedCode;
}
var ScriptingTools = class {
  constructor(settings) {
    this.settings = settings;
  }
  /**
   * Check if a string complies with ISO Standard
   * 
   * @param str Any string
   * @param options Options to look for
   * @returns 
   */
  isISOString(str, options = {}) {
    const {
      withMilliseconds = false,
      withTimezone = false,
      withTime = true,
      withDate = true
    } = options;
    let dateRegexStr = "^(?:\\d{4}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[12]\\d|3[01]))";
    let timeRegexStr = "(?:T(?:[01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";
    if (withMilliseconds) {
      timeRegexStr += "\\.\\d{3}";
    }
    if (withTimezone) {
      timeRegexStr += "(?:Z|[+-](?:[01]\\d|2[0-3]):[0-5]\\d)?)?";
    } else {
      timeRegexStr += ")?";
    }
    let regexStr = "";
    if (withDate && withTime) {
      regexStr = `${dateRegexStr}${timeRegexStr}$`;
    } else if (withDate) {
      regexStr = `${dateRegexStr}$`;
    } else if (withTime) {
      regexStr = `^${timeRegexStr.slice(4)}$`;
    } else {
      return false;
    }
    const regex = new RegExp(regexStr);
    return regex.test(str);
  }
  /**
   * Try to convert Any Types to a specific Type
   * @param input 
   * @param typeString 'string' | 'number' | 'boolean' | 'string[]'
   * @returns 
   */
  tryConvert(input, typeString) {
    switch (typeString) {
      case "string":
        if (typeof input === "string") {
          return input;
        }
        return void 0;
      case "number":
        const num = Number(input);
        if (!isNaN(num)) {
          return num;
        }
        return void 0;
      case "boolean":
        if (typeof input === "boolean") {
          return input;
        }
        if (typeof input === "string") {
          const lowerValue = input.toLowerCase();
          if (lowerValue === "true") {
            return true;
          }
          if (lowerValue === "false") {
            return false;
          }
        }
        if (typeof input === "number") {
          if (input === 1) {
            return true;
          }
          if (input === 0) {
            return false;
          }
        }
        return void 0;
      case "string[]":
        if (Array.isArray(input) && input.every((item) => typeof item === "string")) {
          return input;
        }
        return void 0;
      default:
        return void 0;
    }
  }
  formatToYAMLSaveString(text, replaceBy = void 0) {
    let replaceString = "-";
    if (!replaceBy && this.settings) {
      replaceString = this.settings.specialCharReplacement || "-";
    } else {
      if (replaceBy)
        replaceString = replaceBy;
    }
    return text.replace(/[^a-zA-Z0-9\-_\/äöüßÄÖÜáéíóúýÁÉÍÓÚÝàèìòùÀÈÌÒÙâêîôûÂÊÎÔÛãñõÃÑÕ]/g, replaceString);
  }
  /**
   * Converts a string to a YAML-safe format by adding quotes when necessary.
   * @param input The string, boolean, number or array to make YAML-safe
   * @returns The safely quoted string when needed, or the original string if safe
   */
  toYamlSafeString(input) {
    if (Array.isArray(input)) {
      input.forEach((item, index) => {
        input[index] = this.toYamlSafeString(item).toString();
      });
      return input;
    }
    switch (typeof input) {
      case "number":
        return input;
      case "boolean":
        return input ? "true" : "false";
      case "string":
        const trimmed = input.trim();
        if (trimmed === "")
          return '""';
        const needsQuotes = /[:{}\[\],&*#?|<>=!%@`"'\\]|^[-?\n]|[\s\n]|^[yYnN]|^[0-9]|^[+-]|^(true|false|yes|no|on|off)$/i.test(trimmed);
        const isAlreadyQuoted = trimmed.startsWith('"') && trimmed.endsWith('"') || trimmed.startsWith("'") && trimmed.endsWith("'");
        if (!needsQuotes && !isAlreadyQuoted) {
          return trimmed;
        }
        if (!isAlreadyQuoted) {
          return `"${trimmed.replace(/"/g, '\\"')}"`;
        }
        return trimmed;
      default:
        console.error(`toYamlSafeString(${input}) if of type '${typeof input}'`);
        return input;
    }
  }
  replaceSpaces(text, replaceBy = void 0) {
    let replaceString = "_";
    if (!replaceBy && this.settings) {
      replaceString = this.settings.spaceReplacement || "_";
    } else {
      if (replaceBy)
        replaceString = replaceBy;
    }
    return text.replace(/\s+/g, replaceString);
  }
  formatCamelCase(text) {
    let textParts = text.split(" ");
    let convertedTextParts = [];
    textParts.forEach((text2, index) => {
      let newTextPart = text2.toLowerCase();
      if (index > 0)
        newTextPart = newTextPart.charAt(0).toUpperCase() + newTextPart.slice(1);
      convertedTextParts.push(newTextPart);
    });
    return convertedTextParts.join("");
  }
  formatUpperCamelCase(text) {
    let textParts = text.split(" ");
    let convertedTextParts = [];
    textParts.forEach((text2, index) => {
      let newTextPart = text2.toLowerCase();
      newTextPart = newTextPart.charAt(0).toUpperCase() + newTextPart.slice(1);
      convertedTextParts.push(newTextPart);
    });
    return convertedTextParts.join("");
  }
  /**
   * get the path to a file from a string containing the full parh/name string
   * @param path string
   * @param separator string defaults to '/'
   * @returns string
   */
  getFoldersFromPath(path, separator = "/") {
    if (path === null)
      return null;
    if (path === void 0)
      return void 0;
    const currentPathParts = path.split("/");
    currentPathParts.pop();
    return currentPathParts.join(separator);
  }
  /**
   * removes duplicate strings in an array and deletes empty strings
   * @param stringArray 
   * @returns 
   */
  removeDuplicateStrings(stringArray) {
    if (!stringArray)
      return [];
    const uniqueStringsSet = new Set(stringArray);
    uniqueStringsSet.delete("");
    return [...uniqueStringsSet];
  }
};

// src/rules.ts
var ruleFunctions = [];
function getRuleFunctionById(id) {
  return ruleFunctions.find((rule) => rule.id === id);
}
function applyFormatOptions(value, rule) {
  if (rule.type === "date" || rule.type === "datetime")
    return value;
  switch (typeof value) {
    case "boolean":
    case "number":
      return value;
    case "string":
      if (rule.spaceReplacement && rule.spaceReplacement !== "")
        value = value.replace(/\s+/g, rule.spaceReplacement);
      if (rule.specialCharReplacement && rule.specialCharReplacement !== "")
        value = value.replace(/[^a-zA-Z0-9\-_\/äöüßÄÖÜáéíóúýÁÉÍÓÚÝàèìòùÀÈÌÒÙâêîôûÂÊÎÔÛãñõÃÑÕ]/g, rule.specialCharReplacement);
      if (rule.lowercaseTags)
        value = value.toLowerCase();
      if (rule.prefix && rule.prefix !== "")
        value = rule.prefix + value;
      if (rule.asLink)
        value = `[[${value}]]`;
      return value;
    case "object":
      if (Array.isArray(value)) {
        return value.map((value2) => applyFormatOptions(value2, rule));
      }
      return value;
  }
  return;
}
function executeRule(app, settings, currentFile, returnResult, rule, frontMatter, oldPath) {
  const tools = new ScriptingTools(settings);
  let fxResult;
  let oldResult;
  if (!rule.active)
    return returnResult;
  if (rule.content === "script") {
    const ruleFunction = parseJSCode(rule.jsCode);
    if (typeof ruleFunction !== "function")
      return;
    fxResult = ruleFunction(app, currentFile, tools);
  } else {
    const functionIndex = ruleFunctions.findIndex((fx) => fx.id === rule.content);
    if (functionIndex !== -1) {
      if (ruleFunctions[functionIndex].inputProperty) {
        fxResult = applyFormatOptions(ruleFunctions[functionIndex].fx(app, currentFile, tools, frontMatter[rule.inputProperty]), rule);
      } else {
        fxResult = applyFormatOptions(ruleFunctions[functionIndex].fx(app, currentFile, tools), rule);
      }
      if (oldPath) {
        let oldFileParts = oldPath.split("/");
        let oldFile = {
          path: oldPath,
          extension: oldFileParts[oldFileParts.length - 1].split(".")[1],
          name: oldFileParts[oldFileParts.length - 1].split(".")[0],
          stat: currentFile.stat,
          basename: currentFile.basename,
          vault: currentFile.vault,
          parent: currentFile.parent
        };
        if (ruleFunctions[functionIndex].inputProperty) {
          oldResult = applyFormatOptions(ruleFunctions[functionIndex].fx(app, oldFile, tools, frontMatter[rule.inputProperty]), rule);
        } else {
          oldResult = applyFormatOptions(ruleFunctions[functionIndex].fx(app, oldFile, tools), rule);
        }
      }
    }
  }
  if (rule.type === "number" || rule.type === "checkbox" || rule.type === "date" || rule.type === "datetime") {
    return fxResult;
  }
  switch (rule.addContent) {
    case "overwrite":
      returnResult = fxResult;
      break;
    case "end":
      if (rule.type === "multitext" || rule.type === "tags" || rule.type === "aliases") {
        if (typeof fxResult === "string")
          fxResult = [fxResult];
        if (!Array.isArray(returnResult))
          returnResult = [returnResult];
        if (!Array.isArray(oldResult))
          oldResult = [oldResult];
        let filtered = returnResult.filter((value) => !oldResult.includes(value));
        returnResult = tools.removeDuplicateStrings(filtered.concat(fxResult));
      } else {
        if (!returnResult)
          returnResult = "";
        returnResult = returnResult.replaceAll(returnResult, oldResult);
        returnResult = returnResult + fxResult;
      }
      break;
    case "start":
      if (rule.type === "multitext" || rule.type === "tags" || rule.type === "aliases") {
        if (typeof fxResult === "string")
          fxResult = [fxResult];
        if (!Array.isArray(returnResult))
          returnResult = [returnResult];
        if (!Array.isArray(oldResult))
          oldResult = [oldResult];
        let filtered = returnResult.filter((value) => !oldResult.includes(value));
        returnResult = tools.removeDuplicateStrings(fxResult.concat(filtered));
      } else {
        if (!returnResult)
          returnResult = "";
        returnResult = returnResult.replaceAll(returnResult, oldResult);
        returnResult = fxResult + returnResult;
      }
      break;
  }
  return returnResult;
}
function removeRule(app, settings, currentFile, returnResult, rule, frontMatter) {
  const tools = new ScriptingTools(settings);
  let fxResult;
  if (rule.content === "script") {
    const ruleFunction = parseJSCode(rule.jsCode);
    if (typeof ruleFunction !== "function")
      return;
    fxResult = ruleFunction(app, currentFile, tools);
  } else {
    const functionIndex = ruleFunctions.findIndex((fx) => fx.id === rule.content);
    if (functionIndex !== -1) {
      if (ruleFunctions[functionIndex].inputProperty) {
        fxResult = applyFormatOptions(ruleFunctions[functionIndex].fx(app, currentFile, tools, frontMatter[rule.inputProperty]), rule);
      } else {
        fxResult = applyFormatOptions(ruleFunctions[functionIndex].fx(app, currentFile, tools), rule);
      }
    }
  }
  switch (rule.addContent) {
    case "overwrite":
      returnResult = fxResult;
      break;
    case "end":
      if (rule.type === "multitext" || rule.type === "tags" || rule.type === "aliases") {
        if (typeof fxResult === "string")
          fxResult = [fxResult];
        if (!Array.isArray(returnResult))
          returnResult = [returnResult];
        if (!Array.isArray(fxResult))
          fxResult = [fxResult];
        let filtered = returnResult.filter((value) => !fxResult.includes(value));
        returnResult = tools.removeDuplicateStrings(filtered);
      } else {
        if (!returnResult)
          returnResult = "";
        returnResult = returnResult.replaceAll(returnResult, fxResult);
      }
      break;
    case "start":
      if (rule.type === "multitext" || rule.type === "tags" || rule.type === "aliases") {
        if (typeof fxResult === "string")
          fxResult = [fxResult];
        if (!Array.isArray(returnResult))
          returnResult = [returnResult];
        if (!Array.isArray(fxResult))
          fxResult = [fxResult];
        let filtered = returnResult.filter((value) => !fxResult.includes(value));
        returnResult = tools.removeDuplicateStrings(filtered);
      } else {
        if (!returnResult)
          returnResult = "";
        returnResult = returnResult.replaceAll(returnResult, fxResult);
      }
      break;
  }
  return returnResult;
}
ruleFunctions.push({
  id: "default",
  description: "Pass parameter",
  source: "function (app, file, tools) { // do not change this line!\n  let result = '';\n  return result;\n}",
  type: ["text"],
  fx: function(app, file, tools) {
    let result = "";
    return result;
  }
});
ruleFunctions.push({
  id: "fullPath",
  description: "Full path and filename",
  source: "function (app, file, tools) { // do not change this line!\n  // acquire file path\n  const result = file.path;\n  return result;\n}",
  type: ["text", "tags", "aliases"],
  fx: function(app, file, tools) {
    return `${file.path}`;
  }
});
ruleFunctions.push({
  id: "path",
  description: "Full Path",
  source: "function (app, file, tools) { // do not change this line!\n  // acquire file path\n  const path = file.path;\n  const parts = path.split('/');\n  let result = '';\n  if (parts.length > 1) {\n    parts.pop(); // remove file name\n    result = result + parts.join('/');\n  }\n  return result;\n}",
  type: ["text", "tags", "aliases"],
  fx: function(app, file, tools) {
    let parts = file.path.split("/");
    parts.pop();
    return parts.join("/");
  }
});
ruleFunctions.push({
  id: "isRoot",
  description: "File in Root folder",
  source: "function (app, file, tools) { // do not change this line!\n  let parts = file.path.split('/');\n  return parts.length === 1;\n}",
  type: ["checkbox"],
  fx: function(app, file, tools) {
    let parts = file.path.split("/");
    return parts.length === 1;
  }
});
ruleFunctions.push({
  id: "folder",
  description: "Parent Folder",
  source: "function (app, file, tools) { // do not change this line!\n  // acquire file path\n  const path = file.path;\n  const parts = path.split('/');\n  let result = '';\n  if (parts.length > 1) {\n    result = parts[parts.length-2];\n  }\n  return result;\n}",
  type: ["text", "tags"],
  fx: function(app, file, tools) {
    const path = file.path;
    const parts = path.split("/");
    let result = "";
    if (parts.length > 1) {
      result = parts[parts.length - 2];
    }
    return result;
  }
});
ruleFunctions.push({
  id: "folders",
  description: "All folders of the file as a list",
  source: "function (app, file, tools) { // do not change this line!\n  const path = file.path; // acquire file path\n  const result = path.split('/');\n  result.pop(); // remove file name\n  return result;\n}",
  type: ["multitext", "tags", "aliases"],
  fx: function(app, file, tools) {
    const path = file.path;
    const result = path.split("/");
    result.pop();
    return result;
  }
});
ruleFunctions.push({
  id: "rootFolder",
  description: "Root folder",
  source: "function (app, file, tools) { // do not change this line!\n  // acquire file path\n  const path = file.path;\n  const parts = path.split('/');\n  let result = '';\n  if (parts.length > 1) {\n    result = parts[0];\n  }\n  return result;\n}",
  type: ["text", "tags", "aliases"],
  fx: function(app, file, tools) {
    const path = file.path;
    const parts = path.split("/");
    let result = "";
    if (parts.length > 1) {
      result = parts[0];
    }
    return result;
  }
});
ruleFunctions.push({
  id: "name",
  description: "File name without extension",
  source: "function (app, file, tools) { // do not change this line!\n  // acquire file name\n  const result = file.name.split('.');\n  result.pop(); // remove extension\n  result.join('.'); // reconstruct the file name\n  return result;\n}",
  type: ["text", "tags", "aliases"],
  fx: function(app, file, tools) {
    const result = file.name.split(".");
    result.pop();
    result.join(".");
    return result;
  }
});
ruleFunctions.push({
  id: "nameExt",
  description: "File name with extension",
  source: "function (app, file, tools) { // do not change this line!\n  // acquire file name\n  const result = file.name;\n  return result;\n}",
  type: ["text", "tags", "aliases"],
  fx: function(app, file, tools) {
    const result = file.name;
    return result;
  }
});
ruleFunctions.push({
  id: "propertyValueAsLink",
  description: "Formats an Property as Link",
  inputProperty: true,
  source: "function (app, file, tools) { // do not change this line!\n  // acquire file name\n  const result = file.name;\n  return result;\n}",
  type: ["text", "multitext", "tags", "aliases"],
  fx: function(app, file, tools, input) {
    const result = input;
    return result;
  }
});
ruleFunctions.push({
  id: "dateTimeCreated",
  description: "Date (and Time) created",
  source: "function (app, file, tools) { // do not change this line!\n  const timeOffset = new Date(Date.now()).getTimezoneOffset()*60000; // get local time offset\n  const result = new Date(file.stat.ctime-timeOffset);\n  return result.toISOString().split('Z')[0]; // remove UTC symbol\n}",
  type: ["date", "datetime"],
  fx: function(app, file, tools) {
    const timeOffset = new Date(Date.now()).getTimezoneOffset() * 6e4;
    const result = new Date(file.stat.ctime - timeOffset);
    return result.toISOString().split("Z")[0];
  }
});
ruleFunctions.push({
  id: "dateTimeModified",
  description: "Date (and Time) modified",
  source: "function (app, file, tools) { // do not change this line!\n  const timeOffset = new Date(Date.now()).getTimezoneOffset()*60000;\n  const result = new Date(file.stat.mtime-timeOffset); // Apply offset to GMT Timestamp\n  return result.toISOString().split('Z')[0]; // remove UTC symbol\n}",
  type: ["date", "datetime"],
  fx: function(app, file, tools) {
    const timeOffset = new Date(Date.now()).getTimezoneOffset() * 6e4;
    const result = new Date(file.stat.mtime - timeOffset);
    return result.toISOString().split("Z")[0];
  }
});
ruleFunctions.push({
  id: "fileSizeBytes",
  description: "File size in bytes",
  source: "function (app, file, tools) { // do not change this line!\n  // acquire file size\n  const result = file.stat.size;\n  return result; // return you result.\n}",
  type: ["number"],
  fx: function(app, file, tools) {
    const result = file.stat.size;
    return result;
  }
});
ruleFunctions.push({
  id: "fileSizeString",
  description: "File size formatted as text",
  source: "function (app, file, tools) { // do not change this line!\n  // acquire file size\n  let size =file.stat.size;\n  const precision = 2; // number of decimal places\n  if (size > 1024) {\n    size = size / 1024;\n    if (size > 1024) {\n      size = size / 1024;\n      if (size > 1024) {\n        size = size / 1024;\n        return Number.parseFloat(size).toFixed(precision) + ' GB';\n      } \n      return Number.parseFloat(size).toFixed(precision) + ' MB';\n    }\n    return Number.parseFloat(size).toFixed(precision) + ' KB';\n  }   \n  return size + ' Bytes'; // return you result.\n}",
  type: ["text"],
  fx: function(app, file, tools) {
    let size = file.stat.size;
    const precision = 2;
    if (size > 1024) {
      size = size / 1024;
      if (size > 1024) {
        size = size / 1024;
        if (size > 1024) {
          size = size / 1024;
          return size.toFixed(precision) + " GB";
        }
        return size.toFixed(precision) + " MB";
      }
      return size.toFixed(precision) + " KB";
    }
    return size + " Bytes";
  }
});

// src/types.ts
var versionString = "0.0.10";
var DEFAULT_FILTER_FILES_AND_FOLDERS = {
  selectedFolders: [],
  selectedFiles: [],
  mode: "exclude",
  display: "folders"
};
var DEFAULT_SETTINGS = {
  tagPrefix: "",
  excludeRootFolder: false,
  tagsPropertyName: "tags",
  spaceReplacement: "_",
  specialCharReplacement: "_",
  lowercaseTags: false,
  knownProperties: [],
  rules: [],
  useTextArea: false,
  exclude: {
    selectedFolders: [],
    selectedFiles: [],
    mode: "exclude",
    display: "folders"
  },
  include: {
    selectedFolders: [],
    selectedFiles: [],
    mode: "include",
    display: "folders"
  },
  configuredProperties: []
};
var DEFAULT_RULE_DEFINITION = {
  id: "",
  active: true,
  asLink: false,
  addContent: "overwrite",
  property: "",
  value: "",
  customProperty: "",
  type: "text",
  typeProperty: { name: "", type: "", source: "registered" },
  content: "",
  buildInCode: "",
  jsCode: "",
  showContent: false,
  exclude: {
    selectedFolders: [],
    selectedFiles: [],
    mode: "exclude",
    display: "folders"
  },
  include: {
    selectedFolders: [],
    selectedFiles: [],
    mode: "include",
    display: "folders"
  },
  prefix: "",
  spaceReplacement: "",
  specialCharReplacement: "",
  lowercaseTags: false,
  inputProperty: ""
};

// src/alertBox.ts
var import_obsidian2 = require("obsidian");
var AlertModal = class extends import_obsidian2.Modal {
  constructor(app, title, description, btn1, btn2) {
    super(app);
    this.title = title;
    this.description = description;
    this.btn1Text = btn1;
    this.btn2Text = btn2;
    this.promise = new Promise((resolve) => {
      this.resolvePromise = resolve;
    });
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.createEl("h2", { text: this.title });
    contentEl.createEl("p", { text: this.description });
    new import_obsidian2.Setting(contentEl).addButton((btn) => {
      btn.setButtonText(this.btn1Text).setCta().onClick(() => {
        this.close();
        this.resolvePromise(true);
      });
    }).addButton((btn) => {
      btn.setButtonText(this.btn2Text).onClick(() => {
        this.close();
        this.resolvePromise(false);
      });
    });
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
  async openAndGetValue() {
    this.open();
    return this.promise;
  }
};

// src/directorySelectionModal.ts
var import_obsidian3 = require("obsidian");
var DirectorySelectionModal = class extends import_obsidian3.Modal {
  // Reference to update dropdown on reset
  /**
   * Creates an instance of the DirectorySelectionModal.
   * @param app - The Obsidian App instance.
   * @param initialFolders - Array of initially selected folder paths.
   * @param initialFiles - Array of initially selected file paths.
   * @param initialMode - The initial selection mode ('include' or 'exclude').
   * @param okCallback - Function to call when the user clicks "OK". Receives the selection result.
   */
  constructor(app, initialFolders, initialFiles, initialMode, initialDisplay, includeExcludeSelectable, okCallback) {
    super(app);
    this.showFiles = false;
    // Container for the tree view
    this.treeNodes = /* @__PURE__ */ new Map();
    // Map path to node info for quick access
    this.modeDropdown = null;
    this.initialFoldersSnapshot = new Set(initialFolders);
    this.initialFilesSnapshot = new Set(initialFiles);
    this.initialModeSnapshot = initialMode;
    this.initialDisplaySnapshot = initialDisplay;
    this.showFiles = initialDisplay === "files" || initialFiles.length > 0;
    this.includeExcludeSelectable = includeExcludeSelectable;
    this.okCallback = okCallback;
    this.resetSelectionToInitial();
  }
  /**
   * Resets the current selection state to the initial state provided at construction.
   */
  resetSelectionToInitial() {
    this.currentFolders = new Set(this.initialFoldersSnapshot);
    this.currentFiles = new Set(this.initialFilesSnapshot);
    this.currentMode = this.initialModeSnapshot;
  }
  /**
   * Resets the current selection state to empty.
   */
  resetSelectionToEmpty() {
    this.currentFolders = /* @__PURE__ */ new Set([]);
    this.currentFiles = /* @__PURE__ */ new Set([]);
    this.currentMode = this.initialModeSnapshot;
  }
  /**
   * Called when the modal is opened. Builds the UI.
   */
  onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("directory-selection-modal");
    if (this.includeExcludeSelectable) {
      contentEl.createEl("h2", { text: "Include or Exclude Folders and Files" });
    } else {
      contentEl.createEl("h2", { text: `${this.currentMode === "exclude" ? "Exclude" : "Include"} Folders and Files` });
    }
    const controlsEl = contentEl.createDiv({ cls: "modal-controls" });
    this.createModeSetting(controlsEl);
    this.createShowFilesSetting(controlsEl);
    this.treeRootElement = contentEl.createDiv({ cls: "tree-view-container" });
    this.treeRootElement.style.maxHeight = "600px";
    this.treeRootElement.style.overflowY = "auto";
    this.treeRootElement.style.border = "1px solid var(--background-modifier-border)";
    this.treeRootElement.style.padding = "10px";
    this.treeRootElement.style.marginTop = "10px";
    this.treeRootElement.style.marginBottom = "10px";
    this.buildAndRenderTree();
    this.createActionButtons(contentEl);
  }
  /**
   * Creates the dropdown setting for choosing the selection mode.
   * @param containerEl - The HTML element to append the setting to.
   */
  createModeSetting(containerEl) {
    if (this.includeExcludeSelectable) {
      this.modeDropdown = new import_obsidian3.Setting(containerEl).setName("Selection Mode").setDesc("Choose if the selected files and folders should be excluded or included.").addDropdown((dropdown) => {
        dropdown.addOption("exclude", "exclude").addOption("include", "include").setValue(this.currentMode).onChange((value) => {
          this.currentMode = value;
          this.updateTreeAppearance();
        });
      });
    }
  }
  /**
   * Updates the mode dropdown UI element to reflect the currentMode state.
   */
  updateModeDropdown() {
    var _a;
    const dropdownComponent = (_a = this.modeDropdown) == null ? void 0 : _a.components[0];
    if (dropdownComponent && typeof dropdownComponent.setValue === "function") {
      dropdownComponent.setValue(this.currentMode);
    }
  }
  /**
   * Creates the toggle setting for showing/hiding files in the tree.
   * @param containerEl - The HTML element to append the setting to.
   */
  createShowFilesSetting(containerEl) {
    new import_obsidian3.Setting(containerEl).setName("Show Files").setDesc("Show Files within the directory tree.").addToggle((toggle) => {
      toggle.setValue(this.showFiles).onChange((value) => {
        this.showFiles = value;
        this.buildAndRenderTree();
      });
    });
  }
  /**
   * Creates the "OK" and "Reset" buttons.
   * @param containerEl - The HTML element to append the buttons to.
   */
  createActionButtons(containerEl) {
    const buttonsEl = containerEl.createDiv({ cls: "modal-buttons" });
    buttonsEl.style.marginTop = "15px";
    buttonsEl.style.display = "flex";
    buttonsEl.style.justifyContent = "flex-end";
    buttonsEl.style.gap = "10px";
    const resetButton = buttonsEl.createEl("button");
    (0, import_obsidian3.setIcon)(resetButton, "reset");
    resetButton.ariaLabel = "Reset selection";
    resetButton.onclick = () => {
      this.resetSelectionToInitial();
      this.updateModeDropdown();
      this.buildAndRenderTree();
    };
    const emptyButton = buttonsEl.createEl("button");
    (0, import_obsidian3.setIcon)(emptyButton, "eraser");
    emptyButton.ariaLabel = "Clear selection";
    emptyButton.onclick = () => {
      this.resetSelectionToEmpty();
      this.updateModeDropdown();
      this.buildAndRenderTree();
    };
    const cancelButton = buttonsEl.createEl("button", { text: "Cancel" });
    cancelButton.ariaLabel = "close and discard changes";
    cancelButton.onclick = () => {
      console.log("Cancel Clicked - Returning");
      this.okCallback(null);
      this.close();
    };
    const okButton = buttonsEl.createEl("button", { text: "OK", cls: "mod-cta" });
    cancelButton.ariaLabel = "close and save changes";
    okButton.onclick = () => {
      this.close();
    };
  }
  /**
   * Builds the logical tree structure data from the vault's files and folders.
   * @returns The root node of the tree structure.
   */
  buildTreeData() {
    const vaultRootNode = {
      path: "/",
      name: this.app.vault.getName() || "Vault",
      // Use vault name or default
      type: "folder",
      children: [],
      // Placeholder elements, will be assigned during rendering if root is rendered
      element: null,
      checkbox: null,
      label: null,
      container: null
    };
    const folderNodes = /* @__PURE__ */ new Map();
    folderNodes.set("/", vaultRootNode);
    const allFiles = this.app.vault.getFiles();
    allFiles.forEach((file) => {
      const parentFolder = file.parent;
      if (!parentFolder)
        return;
      let currentPath = "";
      const pathParts = parentFolder.path.split("/").filter((p) => p.length > 0);
      let parentNode = vaultRootNode;
      pathParts.forEach((part) => {
        currentPath = currentPath === "/" ? part : `${currentPath}/${part}`;
        if (!folderNodes.has(currentPath)) {
          const newFolderNode = {
            path: currentPath,
            name: part,
            type: "folder",
            children: [],
            // Placeholders, assigned during rendering
            element: null,
            checkbox: null,
            label: null,
            container: null
          };
          folderNodes.set(currentPath, newFolderNode);
          if (!parentNode.children) {
            parentNode.children = [];
          }
          parentNode.children.push(newFolderNode);
          parentNode = newFolderNode;
        } else {
          parentNode = folderNodes.get(currentPath);
        }
      });
    });
    if (this.showFiles) {
      allFiles.forEach((file) => {
        const parentFolder = file.parent;
        if (!parentFolder) {
          return;
        }
        const parentPath = "/" + parentFolder.path;
        const parentNode = folderNodes.get(parentPath);
        const fileNode = {
          path: file.path,
          name: file.name,
          type: "file",
          // Files don't have children
          // Placeholders, assigned during rendering
          element: null,
          checkbox: null,
          label: null,
          container: null
        };
        if (parentNode) {
          if (!parentNode.children) {
            parentNode.children = [];
          }
          parentNode.children.push(fileNode);
        } else {
        }
      });
    }
    const sortNodes = (a, b) => {
      if (a.type === "folder" && b.type === "file")
        return -1;
      if (a.type === "file" && b.type === "folder")
        return 1;
      return a.name.localeCompare(b.name);
    };
    folderNodes.forEach((node) => {
      var _a;
      return (_a = node.children) == null ? void 0 : _a.sort(sortNodes);
    });
    return vaultRootNode;
  }
  /**
   * Renders the entire tree structure in the DOM based on the tree data.
   */
  renderTree() {
    var _a;
    this.treeRootElement.empty();
    this.treeNodes.clear();
    const treeData = this.buildTreeData();
    const rootUl = this.treeRootElement.createEl("ul");
    rootUl.addClass("tree-root-ul");
    rootUl.style.listStyle = "none";
    rootUl.style.paddingLeft = "0";
    (_a = treeData.children) == null ? void 0 : _a.forEach((childNode) => {
      this.renderTreeNode(childNode, rootUl, 0);
    });
  }
  /**
   * Recursively renders a single tree node and its children in the DOM.
   * @param node - The TreeNode data to render.
   * @param parentElement - The HTML `ul` element to append this node's `li` to.
   * @param level - The current indentation level.
   */
  renderTreeNode(node, parentElement, level) {
    const li = parentElement.createEl("li");
    li.style.marginLeft = `${level * 20}px`;
    li.addClass(`tree-node-${node.type}`);
    const container = li.createDiv({ cls: "tree-node-container" });
    container.style.display = "flex";
    container.style.alignItems = "center";
    container.style.padding = "2px 0";
    const checkbox = container.createEl("input", { type: "checkbox" });
    checkbox.id = `tree-cb-${node.path.replace(/[^a-zA-Z0-9]/g, "-")}`;
    checkbox.dataset.path = node.path;
    checkbox.dataset.type = node.type;
    const label = container.createEl("label");
    label.textContent = `${node.type === "folder" ? "\u{1F4C1}" : "\u{1F4C4}"} ${node.name}`;
    label.htmlFor = checkbox.id;
    label.style.marginLeft = "5px";
    label.style.cursor = "pointer";
    label.title = node.path;
    node.element = li;
    node.checkbox = checkbox;
    node.label = label;
    node.container = container;
    this.treeNodes.set(node.path, node);
    if (node.type === "folder") {
      checkbox.checked = this.currentFolders.has(node.path);
    } else {
      checkbox.checked = this.currentFiles.has(node.path);
    }
    checkbox.onchange = (event) => {
      const target = event.target;
      const path = target.dataset.path;
      const type = target.dataset.type;
      if (target.checked) {
        if (type === "folder")
          this.currentFolders.add(path);
        else
          this.currentFiles.add(path);
      } else {
        if (type === "folder")
          this.currentFolders.delete(path);
        else
          this.currentFiles.delete(path);
      }
      this.updateTreeAppearance();
    };
    if (node.type === "folder" && node.children && node.children.length > 0) {
      const childrenUl = li.createEl("ul");
      childrenUl.style.listStyle = "none";
      childrenUl.style.paddingLeft = "0";
      childrenUl.style.marginLeft = "0";
      node.children.forEach((child) => this.renderTreeNode(child, childrenUl, level + 1));
    }
  }
  /**
   * Updates the visual appearance (enabled/disabled/styling) of all nodes
   * in the tree based on the current mode and selections.
   */
  updateTreeAppearance() {
    this.treeNodes.forEach((node) => {
      let isDisabled = false;
      let isEffectivelyIncluded = false;
      let isEffectivelyExcluded = false;
      let ancestorFolderSelected = false;
      let currentPath = node.path;
      while (currentPath !== "/") {
        const parentPath = currentPath.substring(0, currentPath.lastIndexOf("/")) || "/";
        if (this.currentFolders.has(parentPath)) {
          ancestorFolderSelected = true;
          break;
        }
        if (parentPath === currentPath)
          break;
        currentPath = parentPath;
      }
      const nodeSelected = node.type === "folder" ? this.currentFolders.has(node.path) : this.currentFiles.has(node.path);
      if (this.currentMode === "exclude") {
        isEffectivelyExcluded = nodeSelected || ancestorFolderSelected;
        isDisabled = isEffectivelyExcluded;
      } else {
        if (node.type === "folder") {
          isEffectivelyIncluded = nodeSelected || ancestorFolderSelected;
        } else {
          const parentPath = node.path.substring(0, node.path.lastIndexOf("/")) || "/";
          const parentEffectivelyIncluded = this.isPathEffectivelyIncluded(parentPath);
          isEffectivelyIncluded = nodeSelected || parentEffectivelyIncluded;
        }
        isDisabled = !isEffectivelyIncluded;
      }
      node.checkbox.disabled = false;
      if (isDisabled) {
        node.container.style.opacity = "0.5";
        node.label.style.textDecoration = "line-through";
        node.element.addClass("is-disabled");
      } else {
        node.container.style.opacity = "1";
        node.label.style.textDecoration = "none";
        node.element.removeClass("is-disabled");
      }
      node.element.classList.remove("is-included", "is-excluded");
      if (this.currentMode === "include" && isEffectivelyIncluded) {
        node.element.addClass("is-included");
      } else if (this.currentMode === "exclude" && isEffectivelyExcluded) {
        node.element.addClass("is-excluded");
      }
    });
  }
  /**
   * Helper function to determine if a given path is effectively included
   * in the current selection under 'include' mode.
   * A path is included if it (file or folder) is selected, or if any of its ancestor FOLDERS are selected.
   * @param path - The folder or file path to check.
   * @returns True if the path should be considered included, false otherwise.
   */
  isPathEffectivelyIncluded(path) {
    if (this.currentMode !== "include") {
      return !this.isPathEffectivelyExcluded(path);
    }
    if (this.currentFiles.has(path) || this.currentFolders.has(path)) {
      return true;
    }
    let current = path;
    while (current !== "/") {
      const parentPath = current.substring(0, current.lastIndexOf("/")) || "/";
      if (this.currentFolders.has(parentPath)) {
        return true;
      }
      if (parentPath === current)
        break;
      current = parentPath;
    }
    return false;
  }
  /**
  * Helper function to determine if a given path is effectively excluded
  * in the current selection under 'exclude' mode.
  * A path is excluded if it (file or folder) is selected, or if any of its ancestor FOLDERS are selected.
  * @param path - The folder or file path to check.
  * @returns True if the path should be considered excluded, false otherwise.
  */
  isPathEffectivelyExcluded(path) {
    if (this.currentMode !== "exclude") {
      return false;
    }
    if (this.currentFiles.has(path) || this.currentFolders.has(path)) {
      return true;
    }
    let current = path;
    while (current !== "/") {
      const parentPath = current.substring(0, current.lastIndexOf("/")) || "/";
      if (this.currentFolders.has(parentPath)) {
        return true;
      }
      if (parentPath === current)
        break;
      current = parentPath;
    }
    return false;
  }
  /**
   * Combines building the tree data, rendering the DOM, and applying initial appearance.
   */
  buildAndRenderTree() {
    this.renderTree();
    this.updateTreeAppearance();
  }
  /**
   * Called when the modal is closed. Cleans up resources.
   */
  onClose() {
    const result = {
      folders: Array.from(this.currentFolders),
      files: Array.from(this.currentFiles),
      mode: this.currentMode,
      display: this.currentDisplay
    };
    console.log("OK Clicked - Returning Result:", result);
    this.okCallback(result);
    const { contentEl } = this;
    contentEl.empty();
    this.treeNodes.clear();
    this.modeDropdown = null;
  }
};
function openDirectorySelectionModal(app, initialFolders, initialFiles, initialMode, initialDisplay, includeExcludeSelectable, okCallback) {
  new DirectorySelectionModal(
    app,
    initialFolders,
    initialFiles,
    initialMode,
    initialDisplay,
    includeExcludeSelectable,
    okCallback
  ).open();
}

// src/settings.ts
var import_crypto2 = require("crypto");

// src/settings-properties.ts
var import_obsidian4 = require("obsidian");
var import_crypto = require("crypto");
var RulesTable = class extends import_obsidian4.PluginSettingTab {
  constructor(app, plugin, container, settingsParameter) {
    super(app, plugin);
    this.knownProperties = {};
    this.plugin = plugin;
    this.container = container;
    this.settingsParameter = settingsParameter;
  }
  // Funktion zum Abrufen und Speichern der bekannten Properties (async)
  async fetchKnownProperties() {
    this.knownProperties = await this.app.metadataCache.getAllPropertyInfos();
    this.knownProperties = Object.fromEntries(
      Object.entries(this.knownProperties).sort(([keyA], [keyB]) => keyA.localeCompare(keyB))
    );
    console.log(this.knownProperties);
  }
  // Helper zum Rendern EINER Eigenschaftszeile
  renderPropertyRow(containerEl, rule, index) {
    const activeFile = this.app.workspace.getActiveFile();
    const rowEl = containerEl.createDiv({ cls: "property-setting-row setting-item" });
    const controlEl = rowEl.createDiv({ cls: "setting-item-control" });
    controlEl.style.gap = "0px";
    const leftContainer = controlEl.createDiv({ cls: "property-left-container" });
    const iconEl = leftContainer.createSpan({ cls: "property-icon setting-item-icon" });
    (0, import_obsidian4.setIcon)(iconEl, "hash");
    const searchContainer = leftContainer.createDiv({ cls: "property-search-container" });
    const nameInput = new import_obsidian4.TextComponent(searchContainer).setPlaceholder("Select property...").setValue(rule.property || "").onChange(async (value) => {
      this.renderSearchResults(searchContainer, value, index);
    });
    nameInput.inputEl.addEventListener("focus", () => {
      this.renderSearchResults(searchContainer, nameInput.getValue(), index);
    });
    nameInput.inputEl.addEventListener("input", () => {
      this.renderSearchResults(searchContainer, nameInput.getValue(), index);
    });
    nameInput.inputEl.addEventListener("blur", (event) => {
      setTimeout(() => {
        const relatedTarget = event.relatedTarget;
        const resultsEl = searchContainer.querySelector(".property-search-results");
        if (!resultsEl || !resultsEl.contains(relatedTarget)) {
          this.clearSearchResults(searchContainer);
        }
      }, 100);
    });
    const currentPropertyInfo = this.knownProperties[rule.property];
    if (currentPropertyInfo) {
      this.updatePropertyIcon(iconEl, currentPropertyInfo.type);
    } else if (rule.property) {
      (0, import_obsidian4.setIcon)(iconEl, "alert-circle");
    }
    const middleContainer = controlEl.createDiv({ cls: "property-middle-container" });
    const valueContainer = middleContainer.createDiv({ cls: "property-value-container" });
    if (activeFile) {
      this.app.fileManager.processFrontMatter(activeFile, (frontmatter) => {
        rule.value = executeRule(this.app, this.plugin.settings, activeFile, "", rule, frontmatter);
      }, { "mtime": activeFile.stat.mtime });
    }
    let previewComponent = this.renderValueInput(valueContainer, currentPropertyInfo, rule.value, index);
    const propertyDevDropdown = new import_obsidian4.DropdownComponent(middleContainer);
    propertyDevDropdown.selectEl.setAttribute("style", "width:50%");
    propertyDevDropdown.addOption("", "Select a content");
    for (let ruleFunction of ruleFunctions) {
      console.log(rule.type);
      if (ruleFunction.type.contains(rule.type)) {
        propertyDevDropdown.addOption(ruleFunction.id, ruleFunction.description);
      }
    }
    propertyDevDropdown.addOption("script", "JavaScript script");
    propertyDevDropdown.setValue(rule.content);
    propertyDevDropdown.onChange(async (value) => {
      var _a, _b, _c;
      let jsCode = "";
      if (value !== "") {
        if (value !== "script") {
          let oldOriginalCode = ((_a = getRuleFunctionById(rule.content)) == null ? void 0 : _a.source) || ruleFunctions[0].source;
          if (rule.buildInCode !== "" && rule.buildInCode !== oldOriginalCode) {
            const shouldProceed = await new AlertModal(
              this.app,
              "Overwrite existing code?",
              "I sees like you have custom code for this rule! Should this be overwritten by default code for this parameter?",
              "Yes",
              "No"
            ).openAndGetValue();
            if (shouldProceed) {
              jsCode = rule.buildInCode = ((_b = getRuleFunctionById(value)) == null ? void 0 : _b.source) || ruleFunctions[0].source;
            } else {
              jsCode = rule.buildInCode;
            }
            await this.plugin.saveSettings();
          } else {
            jsCode = rule.buildInCode = ((_c = getRuleFunctionById(value)) == null ? void 0 : _c.source) || ruleFunctions[0].source;
            await this.plugin.saveSettings();
          }
        } else {
        }
        rule.content = value;
        await this.plugin.saveSettings();
        this.updatePreview(activeFile, rule, previewComponent.inputEl);
      }
    });
    new import_obsidian4.ButtonComponent(middleContainer).setIcon("gear").setTooltip("settings").setClass("property-icon-button").onClick(async () => {
      let settingsContainers = containerEl.getElementsByClassName("property-options-container");
      for (let container of settingsContainers) {
        if (container.getAttribute("id") !== rule.id)
          container.setAttribute("style", "display: none;");
      }
      optionEL.style.display = optionEL.style.display === "block" ? "none" : "block";
    });
    const deleteButtonContainer = controlEl.createDiv({ cls: "property-delete-button-container" });
    new import_obsidian4.ButtonComponent(deleteButtonContainer).setIcon("trash-2").setTooltip("remove this rule").setClass("mod-subtle").onClick(async () => {
      this.plugin.settings[this.settingsParameter].splice(index, 1);
      await this.plugin.saveSettings();
      this.display();
    });
    controlEl.style.display = "flex";
    controlEl.style.alignItems = "center";
    controlEl.style.justifyContent = "space-between";
    controlEl.style.width = "100%";
    leftContainer.style.display = "flex";
    leftContainer.style.alignItems = "center";
    leftContainer.style.minWidth = "200px";
    iconEl.style.marginRight = "8px";
    searchContainer.style.position = "relative";
    searchContainer.style.flexGrow = "1";
    valueContainer.style.flexGrow = "2";
    deleteButtonContainer.style.marginLeft = "auto";
    const optionEL = containerEl.createDiv({ cls: "property-options-container" });
    optionEL.id = rule.id;
    optionEL.style.display = "none";
    const removeContentButton = new import_obsidian4.Setting(optionEL).setName("Remove content").setDesc(`Before making changes you might consider to remove content generated by this rule`).addButton(
      (button) => {
        button.setWarning().setButtonText("Remove Content").setCta().onClick(() => {
          let count = this.plugin.removeFrontmatterParamsFromAllFiles(rule);
          button.removeCta();
          button.setDisabled(true);
          removeContentButton.setDesc(`Removed this rule from ${count.files} files.`);
        });
      }
    );
    new import_obsidian4.Setting(optionEL).setName("Rule active").setDesc("If enabled, the rule will be executed").addToggle(
      (toggle) => toggle.setValue(rule.active).onChange(async (value) => {
        rule.active = value;
        await this.plugin.saveSettings();
      })
    );
    if (rule.type === "text" || rule.type === "multitext" || rule.type === "tags" || rule.type === "aliases") {
      const ruleFunction = ruleFunctions.find((item) => item.id === rule.content);
      if (ruleFunction && ruleFunction.inputProperty !== void 0) {
        let inputPropertiesDropdown;
        new import_obsidian4.Setting(optionEL).setName("Input Property").setDesc("Select a property as input").addDropdown((dropdown) => {
          inputPropertiesDropdown = dropdown;
          dropdown.setValue(rule.addContent).onChange(async (value) => {
            if (value !== "") {
              rule.inputProperty = value;
              await this.plugin.saveSettings();
              this.updatePreview(activeFile, rule, previewComponent.inputEl);
            }
          });
        });
        Object.entries(this.knownProperties).forEach((item) => {
          inputPropertiesDropdown.addOption(item[1].name, item[1].name);
        });
        inputPropertiesDropdown.setValue(rule.inputProperty);
      }
      if (rule.type === "tags" || rule.type === "aliases") {
        new import_obsidian4.Setting(optionEL).setName("Prefix").setDesc("Optional prefix to add before the content").addText((text) => text.setPlaceholder("prefix/").setValue(rule.prefix).onChange(async (value) => {
          rule.prefix = value;
          await this.plugin.saveSettings();
          this.updatePreview(activeFile, rule, previewComponent.inputEl);
        }));
      }
      new import_obsidian4.Setting(optionEL).setName("Space replacement").setDesc('Character to replace spaces in folder names (suggested: "_")').addText((text) => text.setPlaceholder("_").setValue(rule.spaceReplacement).onChange(async (value) => {
        rule.spaceReplacement = value;
        await this.plugin.saveSettings();
        this.updatePreview(activeFile, rule, previewComponent.inputEl);
      }));
      new import_obsidian4.Setting(optionEL).setName("Special character replacement").setDesc('Character to replace special characters (suggested: "-") - preserves letters with diacritics').addText((text) => text.setPlaceholder("-").setValue(rule.specialCharReplacement).onChange(async (value) => {
        rule.specialCharReplacement = value;
        await this.plugin.saveSettings();
        this.updatePreview(activeFile, rule, previewComponent.inputEl);
      }));
      new import_obsidian4.Setting(optionEL).setName("Convert to lowercase").setDesc("Convert values to lowercase").addToggle((toggle) => toggle.setValue(rule.lowercaseTags).onChange(async (value) => {
        rule.lowercaseTags = value;
        await this.plugin.saveSettings();
        this.updatePreview(activeFile, rule, previewComponent.inputEl);
      }));
      new import_obsidian4.Setting(optionEL).setName("Result as Link").setDesc("Format Result as Link").addToggle(
        (toggle) => toggle.setValue(rule.asLink).onChange(async (value) => {
          rule.asLink = value;
          await this.plugin.saveSettings();
          this.updatePreview(activeFile, rule, previewComponent.inputEl);
        })
      );
    }
    if (rule.type === "text" || rule.type === "multitext" || rule.type === "tags" || rule.type === "aliases") {
      new import_obsidian4.Setting(optionEL).setName("Add content").setDesc("select how the content should be stored").addDropdown(
        (dropdown) => dropdown.addOption("overwrite", "replace content").addOption("start", "place on start").addOption("end", "place on end").setValue(rule.addContent).onChange(async (value) => {
          if (value !== "") {
            rule.addContent = value === "overwrite" ? "overwrite" : value === "start" ? "start" : "end";
            await this.plugin.saveSettings();
            this.updatePreview(activeFile, rule, previewComponent.inputEl);
          }
        })
      );
    }
    new import_obsidian4.Setting(optionEL).setName("Exclude Files and Folders from this rule").setDesc(`Currently ${this.plugin.settings.exclude.selectedFolders.length} folders and ${this.plugin.settings.exclude.selectedFiles.length} files will be ${this.plugin.settings.exclude.mode}d.`).addButton((button) => {
      button.setIcon("folder-x").setButtonText("Exclude").setCta().onClick(() => {
        var _a, _b, _c;
        openDirectorySelectionModal(
          this.app,
          ((_a = rule.exclude) == null ? void 0 : _a.selectedFolders) || [],
          ((_b = rule.exclude) == null ? void 0 : _b.selectedFiles) || [],
          "exclude",
          ((_c = rule.exclude) == null ? void 0 : _c.display) || "folders",
          false,
          // include, exclude option hidden
          (result) => {
            if (!result)
              return;
            if (!rule.exclude) {
              rule.exclude = Object.assign({}, DEFAULT_FILTER_FILES_AND_FOLDERS, {
                mode: "include"
              });
            }
            ;
            rule.exclude.selectedFolders = result.folders;
            rule.exclude.selectedFiles = result.files;
            rule.exclude.display = result.display;
            this.plugin.saveSettings();
          }
        );
      });
    });
    new import_obsidian4.Setting(optionEL).setName("Include Files and Folders for this rule ").setDesc(`Currently ${this.plugin.settings.include.selectedFolders.length} folders and ${this.plugin.settings.include.selectedFiles.length} files will be ${this.plugin.settings.include.mode}d even when in excluded Folders.`).addButton((button) => {
      button.setIcon("folder-check").setButtonText("Include").setCta().onClick(() => {
        var _a, _b, _c;
        openDirectorySelectionModal(
          this.app,
          ((_a = rule.include) == null ? void 0 : _a.selectedFolders) || [],
          ((_b = rule.include) == null ? void 0 : _b.selectedFiles) || [],
          "include",
          ((_c = rule.include) == null ? void 0 : _c.display) || "folders",
          false,
          // include, include option hidden
          (result) => {
            if (!result)
              return;
            if (!rule.include) {
              rule.include = Object.assign({}, DEFAULT_FILTER_FILES_AND_FOLDERS, {
                mode: "include"
              });
            }
            ;
            rule.include.selectedFolders = result.folders;
            rule.include.selectedFiles = result.files;
            rule.include.display = result.display;
            this.plugin.saveSettings();
          }
        );
      });
    });
    new import_obsidian4.Setting(optionEL).setName("Script").setDesc("edit the script for own modifications").addButton(
      (button) => button.setButtonText("JS Editor").onClick(() => {
      })
    );
  }
  renderSearchResults(searchContainerEl, searchTerm, rowIndex) {
    this.clearSearchResults(searchContainerEl);
    const filteredProperties = Object.entries(this.knownProperties).filter(([name]) => name.toLowerCase().includes(searchTerm.toLowerCase()));
    if (filteredProperties.length === 0 && searchTerm) {
      return;
    }
    if (filteredProperties.length === 0 && !searchTerm) {
      return;
    }
    const resultsEl = searchContainerEl.createDiv({ cls: "property-search-results menu" });
    resultsEl.style.position = "absolute";
    resultsEl.style.top = "100%";
    resultsEl.style.left = "0";
    resultsEl.style.width = "calc(100% + 20px)";
    resultsEl.style.zIndex = "10";
    resultsEl.style.maxHeight = "200px";
    resultsEl.style.overflowY = "auto";
    filteredProperties.forEach(([name, info]) => {
      const itemEl = resultsEl.createDiv({ cls: "menu-item" });
      const itemIcon = itemEl.createSpan({ cls: "menu-item-icon" });
      this.updatePropertyIcon(itemIcon, info.type);
      itemEl.createSpan({ text: name });
      itemEl.addEventListener("mousedown", async (e) => {
        e.preventDefault();
        this.plugin.settings[this.settingsParameter][rowIndex].property = name;
        this.plugin.settings[this.settingsParameter][rowIndex].type = info.type;
        this.plugin.settings[this.settingsParameter][rowIndex].value = void 0;
        await this.plugin.saveSettings();
        this.clearSearchResults(searchContainerEl);
        this.display();
      });
    });
  }
  clearSearchResults(searchContainerEl) {
    const resultsEl = searchContainerEl.querySelector(".property-search-results");
    if (resultsEl) {
      resultsEl.remove();
    }
  }
  renderValueInput(containerEl, propertyInfo, currentValue, index) {
    let returnComponent;
    containerEl.empty();
    if (!propertyInfo) {
      containerEl.setText("");
      containerEl.addClass("text-muted");
      return;
    }
    const type = propertyInfo.type;
    switch (type) {
      case "number":
        returnComponent = new import_obsidian4.TextComponent(containerEl).setPlaceholder("Zahlenwert").setValue(currentValue !== void 0 && currentValue !== null ? String(currentValue) : "").onChange(async (value) => {
          const numValue = value === "" ? void 0 : parseFloat(value);
          this.plugin.settings[this.settingsParameter][index].value = isNaN(numValue) ? void 0 : numValue;
          await this.plugin.saveSettings();
        });
        returnComponent.inputEl.type = "number";
        break;
      case "checkbox":
        const checkboxEl = containerEl.createDiv({ cls: "tri-state-checkbox clickable-icon" });
        returnComponent = checkboxEl;
        checkboxEl.setAttribute("aria-label", "Checkbox Status \xE4ndern");
        checkboxEl.setAttribute("role", "checkbox");
        const updateCheckboxVisual = (state) => {
          let iconName;
          let ariaState;
          if (state === true) {
            iconName = "check-square";
            ariaState = "true";
          } else if (state === false) {
            iconName = "square";
            ariaState = "false";
          } else {
            iconName = "minus-square";
            ariaState = "mixed";
          }
          (0, import_obsidian4.setIcon)(checkboxEl, iconName);
          checkboxEl.setAttribute("aria-checked", ariaState);
          checkboxEl.dataset.state = String(state);
        };
        updateCheckboxVisual(currentValue);
        checkboxEl.addEventListener("click", async () => {
          let currentState = checkboxEl.dataset.state;
          let nextState;
          if (currentState === "false") {
            nextState = true;
          } else if (currentState === "true") {
            nextState = void 0;
          } else {
            nextState = false;
          }
          this.plugin.settings[this.settingsParameter][index].value = nextState;
          await this.plugin.saveSettings();
          updateCheckboxVisual(nextState);
        });
        break;
      case "date":
        returnComponent = new import_obsidian4.TextComponent(containerEl).setPlaceholder("YYYY-MM-DD").setValue(currentValue || "").onChange(async (value) => {
          this.plugin.settings[this.settingsParameter][index].value = value || void 0;
          await this.plugin.saveSettings();
        });
        returnComponent.inputEl.type = "date";
        break;
      case "datetime":
        returnComponent = new import_obsidian4.TextComponent(containerEl).setPlaceholder("YYYY-MM-DDTHH:mm").setValue(currentValue || "").onChange(async (value) => {
          this.plugin.settings[this.settingsParameter][index].value = value || void 0;
          await this.plugin.saveSettings();
        });
        returnComponent.inputEl.type = "datetime-local";
        break;
      case "tags":
      case "multitext":
        returnComponent = new import_obsidian4.TextComponent(containerEl).setPlaceholder("Werte (kommagetrennt)").setValue(Array.isArray(currentValue) ? currentValue.join(", ") : currentValue || "").onChange(async (value) => {
          const arrayValue = value.split(",").map((s) => s.trim()).filter((s) => s);
          this.plugin.settings[this.settingsParameter][index].value = arrayValue.length > 0 ? arrayValue : void 0;
          await this.plugin.saveSettings();
        });
        break;
      case "text":
      default:
        returnComponent = new import_obsidian4.TextComponent(containerEl).setPlaceholder("Wert").setValue(currentValue || "").onChange(async (value) => {
          this.plugin.settings[this.settingsParameter][index].value = value || void 0;
          await this.plugin.saveSettings();
        });
        break;
    }
    return returnComponent;
  }
  updatePropertyIcon(iconEl, type) {
    let iconName = "hash";
    switch (type) {
      case "text":
        iconName = "align-left";
        break;
      case "number":
        iconName = "binary";
        break;
      case "multitext":
        iconName = "list";
        break;
      case "date":
        iconName = "calendar";
        break;
      case "datetime":
        iconName = "clock";
        break;
      case "checkbox":
        iconName = "check-square";
        break;
      case "tags":
        iconName = "tags";
        break;
      case "aliases":
        iconName = "forward";
        break;
      default:
        iconName = "help-circle";
    }
    (0, import_obsidian4.setIcon)(iconEl, iconName);
  }
  async updatePreview(activeFile, rule, componentEl) {
    if (activeFile) {
      let ruleResult;
      await this.app.fileManager.processFrontMatter(activeFile, (frontmatter) => {
        ruleResult = executeRule(this.app, this.plugin.settings, activeFile, "", rule, frontmatter);
      }, { "mtime": activeFile.stat.mtime });
      switch (typeof ruleResult) {
        case "object":
          if (Array.isArray(ruleResult))
            componentEl.value = ruleResult.toString();
          break;
        default:
          componentEl.value = ruleResult;
          break;
      }
    }
  }
  async display() {
    const containerEl = this.container;
    containerEl.empty();
    await this.fetchKnownProperties();
    const propertiesListEl = containerEl.createDiv("properties-list");
    this.plugin.settings.rules.forEach((propConfig, index) => {
      this.renderPropertyRow(propertiesListEl, propConfig, index);
    });
    const addBtnContainer = containerEl.createDiv({ cls: "setting-item-control" });
    addBtnContainer.style.justifyContent = "right";
    new import_obsidian4.ButtonComponent(addBtnContainer).setButtonText("Eigenschaft hinzuf\xFCgen").setIcon("plus-circle").setCta().onClick(async () => {
      const defaultName = "";
      this.plugin.settings[this.settingsParameter].push(Object.assign({}, DEFAULT_RULE_DEFINITION, {
        id: (0, import_crypto.randomUUID)().toString()
      }));
      await this.plugin.saveSettings();
      this.display();
    }).buttonEl.className = "property-plus-button";
  }
};

// src/settings.ts
var FolderTagSettingTab = class extends import_obsidian5.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
    this.scriptingTools = new ScriptingTools(this.plugin.settings);
  }
  display() {
    this.knownProperties = getPropertiesFromMetadataManager(this.app);
    this.knownTypes = getTypesFromMetadataManager(this.app);
    const { containerEl } = this;
    containerEl.empty();
    containerEl.createEl("h2", { text: `Front matter automate V${versionString}` });
    new import_obsidian5.Setting(containerEl).setName("Tags property name").setDesc('Frontmatter property name to store tags (default: "tags")').addText((text) => text.setPlaceholder("tags").setValue(this.plugin.settings.tagsPropertyName).onChange(async (value) => {
      this.plugin.settings.tagsPropertyName = value || "tags";
      await this.plugin.saveSettings();
    }));
    new import_obsidian5.Setting(containerEl).setName("Exclude Files and Folders").setDesc(`Currently ${this.plugin.settings.exclude.selectedFolders.length} folders and ${this.plugin.settings.exclude.selectedFiles.length} files will be ${this.plugin.settings.exclude.mode}d.`).addButton((button) => {
      button.setIcon("folder-x").setButtonText("Exclude").setCta().onClick(() => {
        openDirectorySelectionModal(
          this.app,
          this.plugin.settings.exclude.selectedFolders || [],
          this.plugin.settings.exclude.selectedFiles || [],
          this.plugin.settings.exclude.mode || "exclude",
          this.plugin.settings.exclude.display || "folders",
          false,
          // include, exclude option hidden
          (result) => {
            if (!result)
              return;
            this.plugin.settings.exclude.selectedFolders = result.folders;
            this.plugin.settings.exclude.selectedFiles = result.files;
            this.plugin.settings.exclude.mode = result.mode;
            this.plugin.settings.exclude.display = result.display;
            this.plugin.saveSettings();
            this.display();
          }
        );
      });
    });
    new import_obsidian5.Setting(containerEl).setName("Include Files and Folders").setDesc(`Currently ${this.plugin.settings.include.selectedFolders.length} folders and ${this.plugin.settings.include.selectedFiles.length} files will be ${this.plugin.settings.include.mode}d even when in excluded Folders.`).addButton((button) => {
      button.setIcon("folder-check").setButtonText("Include").setCta().onClick(() => {
        openDirectorySelectionModal(
          this.app,
          this.plugin.settings.include.selectedFolders || [],
          this.plugin.settings.include.selectedFiles || [],
          this.plugin.settings.include.mode || "include",
          this.plugin.settings.include.display || "folders",
          false,
          // include, include option hidden
          (result) => {
            if (!result)
              return;
            this.plugin.settings.include.selectedFolders = result.folders;
            this.plugin.settings.include.selectedFiles = result.files;
            this.plugin.settings.include.mode = result.mode;
            this.plugin.settings.include.display = result.display;
            this.plugin.saveSettings();
            this.display();
          }
        );
      });
    });
    new import_obsidian5.Setting(containerEl).setName("Rules").setDesc("add rules to update selected parameters");
    this.rulesContainer = containerEl.createDiv("properties-list");
    const rulesTable = new RulesTable(this.app, this.plugin, this.rulesContainer, "rules");
    rulesTable.display();
  }
  addRule(divEl, ruleUUID = "") {
    var _a;
    let cmEditor = null;
    if (ruleUUID === "") {
      ruleUUID = (0, import_crypto2.randomUUID)().toString();
      this.plugin.settings.rules.push(Object.assign({}, DEFAULT_RULE_DEFINITION, {
        id: ruleUUID
      }));
    }
    const rule = this.plugin.settings.rules.find((rule2) => rule2.id === ruleUUID);
    if (!rule)
      return;
    let propertyNameInput;
    let showFunctionButton;
    let propertyTypeDropdown;
    let propertyDevDropdown;
    let functionResultTextComponent;
    let functionTestButton;
    const rulesDiv = divEl.createDiv({ cls: "obsidian-f2t-ruleLine" });
    rulesDiv.setAttribute("id", ruleUUID);
    const ruleOptionsDiv = divEl.createDiv({ cls: "obsidian-f2t-ruleOptions" });
    ruleOptionsDiv.style.height = "350px;";
    ruleOptionsDiv.style.alignItems = "flex-end";
    if (this.plugin.settings.useTextArea) {
      const ruleOptionsSettings = new import_obsidian5.Setting(ruleOptionsDiv).addTextArea((textArea) => {
        textArea.setPlaceholder("ender valid JS Code");
        textArea.inputEl.setAttribute("style", `height:190px; width:80%;`);
        textArea.onChange(async (value) => {
          if (functionTestButton)
            functionTestButton.buttonEl.addClass("mod-warning");
          rule.jsCode = value;
          await this.plugin.saveSettings();
        });
      });
    } else {
      let jsCode = rule.jsCode;
      if (rule.content !== "script") {
        if (rule.buildInCode === "") {
          rule.buildInCode = ((_a = getRuleFunctionById(rule.content)) == null ? void 0 : _a.source) || ruleFunctions[0].source;
        }
        jsCode = rule.buildInCode;
      }
      cmEditor = window.CodeMirror(ruleOptionsDiv, {
        value: jsCode || "function (app, file, tools) { // do not change this line!\n\n  return result; // return you result.\n}",
        mode: "javascript",
        lineNumbers: true,
        // theme: "obsidian",
        indentUnit: 2,
        lineWrapping: false,
        readOnly: false
      });
      if (cmEditor) {
        cmEditor.on("change", (cmEditor2) => {
          if (functionTestButton)
            functionTestButton.buttonEl.addClass("mod-warning");
        });
        cmEditor.on("blur", (cmEditor2) => {
          if (rule.content === "script") {
            rule.jsCode = cmEditor2.getValue();
          } else {
            rule.buildInCode = cmEditor2.getValue();
          }
          this.plugin.saveSettings();
        });
      }
      ;
      new import_obsidian5.Setting(ruleOptionsDiv).addButton((button) => {
        functionTestButton = button;
        button.setWarning().setButtonText("Save & Test").onClick(async () => {
          if (cmEditor) {
            let jsCode2 = "";
            if (rule.content === "script") {
              rule.jsCode = cmEditor.getValue();
              jsCode2 = rule.jsCode;
            } else {
              rule.buildInCode = cmEditor.getValue();
              jsCode2 = rule.buildInCode;
            }
            await this.plugin.saveSettings();
            let userFunction = parseJSCode(jsCode2);
            if (typeof userFunction === "string") {
              let errorHint = "See console for details!";
              if (userFunction.contains("Unexpected token")) {
                errorHint = "Did you missed a semicolon (;)?";
              }
              if (functionResultTextComponent)
                functionResultTextComponent.setValue(`Syntax error: ${userFunction}! ${errorHint}`);
            } else {
              if (userFunction) {
                try {
                  const files = this.app.vault.getMarkdownFiles();
                  const result = userFunction(this.app, files[8], this.scriptingTools);
                  if (functionResultTextComponent)
                    functionResultTextComponent.setValue(result.toString());
                  button.buttonEl.removeClass("mod-warning");
                } catch (e) {
                  if (functionResultTextComponent) {
                    functionResultTextComponent.setValue(`Syntax error: ${e.message}! See console for details!`);
                  }
                  console.error("Syntax error. ", e, jsCode2, userFunction);
                }
              } else {
                console.error("syntax error");
              }
            }
          }
        });
      }).addText((text) => {
        functionResultTextComponent = text;
        text.setPlaceholder("function result").setDisabled(true);
        functionResultTextComponent.inputEl.style.width = "600px";
      });
    }
    function showJsFunctionButton(ruleId) {
      var _a2;
      const showCodeButton = ((_a2 = getRuleFunctionById(ruleId)) == null ? void 0 : _a2.source) !== "" || ruleId === "script";
      if (showCodeButton) {
        if (showFunctionButton)
          showFunctionButton.buttonEl.style.display = "block";
        if (propertyDevDropdown)
          propertyDevDropdown.selectEl.style.width = "360px";
      } else {
        if (showFunctionButton)
          showFunctionButton.buttonEl.style.display = "none";
        if (propertyDevDropdown)
          propertyDevDropdown.selectEl.style.width = "400px";
      }
    }
    const ruleSettings = new import_obsidian5.Setting(rulesDiv).addButton((button) => {
      button.buttonEl.setAttribute("style", "width:150px; justify-content: left; ");
      button.setButtonText(rule.property || "Select Parameter");
      button.onClick(() => {
        new SelectProperty(this.app, this.knownProperties, rule.typeProperty, (result) => {
          if (result.name !== "") {
            rule.typeProperty = result;
            rule.property = result.name;
            rule.type = result.type;
            if (this.knownProperties.filter((property) => property.name.toLowerCase().includes(rule.property.toLowerCase())).length === 0) {
            }
            ;
            button.setButtonText(result.name);
            this.plugin.saveSettings();
          }
          propertyTypeDropdown.setValue(result.type);
        }).open();
      });
    }).addDropdown((dropdown) => {
      propertyTypeDropdown = dropdown;
      dropdown.selectEl.setAttribute("style", "width:110px");
      dropdown.addOption("", "Select a type");
      dropdown.addOption("aliases", "Aliases");
      dropdown.addOption("checkbox", "Checkbox");
      dropdown.addOption("date", "Date");
      dropdown.addOption("datetime", "Date & Time");
      dropdown.addOption("multitext", "List");
      dropdown.addOption("number", "Number");
      dropdown.addOption("tags", "Tags");
      dropdown.addOption("text", "Text");
      if (rule.type)
        dropdown.setValue(rule.type);
      dropdown.onChange(async (value) => {
        if (value !== "") {
          rule.type = value;
          await this.plugin.saveSettings();
        }
      });
    }).addDropdown((dropdown) => {
      propertyDevDropdown = dropdown;
      dropdown.selectEl.setAttribute("style", "width:400px");
      dropdown.addOption("", "Select a content");
      for (let rule2 of ruleFunctions) {
        dropdown.addOption(rule2.id, rule2.description);
      }
      dropdown.addOption("script", "JavaScript script");
      dropdown.setValue(rule.content);
      dropdown.onChange(async (value) => {
        var _a2, _b, _c;
        let jsCode = "";
        if (value !== "") {
          if (value !== "script") {
            let oldOriginalCode = ((_a2 = getRuleFunctionById(rule.content)) == null ? void 0 : _a2.source) || ruleFunctions[0].source;
            if (rule.buildInCode !== "" && rule.buildInCode !== oldOriginalCode) {
              const shouldProceed = await new AlertModal(
                this.app,
                "Overwrite existing code?",
                "I sees like you have custom code for this rule! Should this be overwritten by default code for this parameter?",
                "Yes",
                "No"
              ).openAndGetValue();
              if (shouldProceed) {
                jsCode = rule.buildInCode = ((_b = getRuleFunctionById(value)) == null ? void 0 : _b.source) || ruleFunctions[0].source;
              } else {
                jsCode = rule.buildInCode;
              }
              cmEditor == null ? void 0 : cmEditor.setValue(jsCode);
            } else {
              jsCode = rule.buildInCode = ((_c = getRuleFunctionById(value)) == null ? void 0 : _c.source) || ruleFunctions[0].source;
              cmEditor == null ? void 0 : cmEditor.setValue(jsCode);
            }
          } else {
            cmEditor == null ? void 0 : cmEditor.setValue(rule.jsCode !== "" ? rule.jsCode : ruleFunctions[0].source);
          }
          rule.content = value;
          showJsFunctionButton(rule.content);
          await this.plugin.saveSettings();
        }
      });
      ruleOptionsDiv.style.display = `${rule.content === "script" && rule.showContent ? "flex" : "none"}`;
    }).addButton(async (button) => {
      showFunctionButton = button;
      button.buttonEl.setAttribute("style", "width:30px");
      button.setIcon("square-function");
      button.setClass("obsidian-f2t-smallButton");
      button.setTooltip("show & edit code");
      button.onClick(async () => {
        rule.showContent = !rule.showContent;
        ruleOptionsDiv.style.display = `${rule.showContent ? "flex" : "none"}`;
      });
      showFunctionButton.buttonEl.style.display = "none";
    }).addButton(async (button) => {
      button.buttonEl.setAttribute("style", "width:30px");
      button.setIcon("square-minus");
      button.setClass("obsidian-f2t-smallButton");
      button.setTooltip("remove this rule");
      button.onClick(async () => {
        this.plugin.settings.rules.splice(this.plugin.settings.rules.findIndex((value) => value.id === ruleUUID));
        this.removeRule(rulesDiv);
        await this.plugin.saveSettings();
      });
    });
    showJsFunctionButton(rule.content);
    divEl.style.removeProperty("border-top");
  }
  removeRule(rulesDiv) {
    rulesDiv.remove();
  }
};

// main.ts
var FolderTagPlugin = class extends import_obsidian6.Plugin {
  //private oldFolderPaths = new Map<string, string | null>();
  async onload() {
    await this.loadSettings();
    this.tools = new ScriptingTools(this.settings);
    let noticeMessage = `Front Matter Automate ${versionString}
 loading ...`;
    const loadingNotice = new import_obsidian6.Notice(noticeMessage, 0);
    noticeMessage = noticeMessage + "\n register events ...";
    loadingNotice.setMessage(noticeMessage);
    this.registerEvent(
      this.app.vault.on("create", (file) => {
        if (file instanceof import_obsidian6.TFile && file.extension === "md") {
          this.updateFrontmatterParameters("create", file, this.settings.rules);
        }
      })
    );
    this.registerEvent(
      this.app.vault.on("rename", (file, oldPath) => {
        if (file instanceof import_obsidian6.TFile && file.extension === "md") {
          this.updateFrontmatterParameters("rename", file, this.settings.rules, oldPath);
        }
      })
    );
    this.registerEvent(
      this.app.workspace.on("active-leaf-change", (leaf) => {
        if ((leaf == null ? void 0 : leaf.view) instanceof import_obsidian6.MarkdownView) {
          const activeFile = this.app.workspace.getActiveFile();
          console.log(`closing file: `, activeFile == null ? void 0 : activeFile.path);
          if (activeFile)
            this.updateFrontmatterParameters("active-leaf-change", activeFile, this.settings.rules);
        }
      })
    );
    noticeMessage = noticeMessage + "\n initial processing ...";
    loadingNotice.setMessage(noticeMessage);
    this.app.vault.getMarkdownFiles().forEach((file) => {
    });
    noticeMessage = noticeMessage + "\ndone!";
    loadingNotice.setMessage(noticeMessage);
    setTimeout(() => {
      loadingNotice.hide();
    }, 2e3);
    this.addSettingTab(new FolderTagSettingTab(this.app, this));
  }
  async loadSettings() {
    let data = await this.loadData();
    this.settings = Object.assign({}, DEFAULT_SETTINGS, data);
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
  formatTagName(name) {
    if (name === null)
      return null;
    if (name === void 0)
      return void 0;
    let formatted = name.replace(/\s+/g, this.settings.spaceReplacement);
    formatted = formatted.replace(/[^a-zA-Z0-9\-_\/äöüßÄÖÜáéíóúýÁÉÍÓÚÝàèìòùÀÈÌÒÙâêîôûÂÊÎÔÛãñõÃÑÕ]/g, this.settings.specialCharReplacement);
    if (this.settings.lowercaseTags) {
      formatted = formatted.toLowerCase();
    }
    return formatted;
  }
  async updateFileTag(file, oldTagPath) {
    const newTagPath = this.getFolderPathForTag(file);
    const formattedNewPath = newTagPath ? this.formatTagName(newTagPath) : null;
    const newTag = formattedNewPath ? this.settings.tagPrefix + formattedNewPath : null;
    let oldTagToRemove;
    if (oldTagPath) {
      const formattedOldPath = this.formatTagName(oldTagPath);
      if (formattedOldPath) {
        oldTagToRemove = this.settings.tagPrefix + formattedOldPath;
      }
    }
    await this.updateFrontmatterTags(file, newTag, oldTagToRemove);
  }
  getFolderPathForTag(file) {
    const folder = file.parent;
    if (!folder || folder === this.app.vault.getRoot()) {
      return null;
    }
    let pathParts = [];
    let currentFolder = folder;
    while (currentFolder && currentFolder !== this.app.vault.getRoot()) {
      pathParts.unshift(currentFolder.name);
      currentFolder = currentFolder.parent;
    }
    if (this.settings.excludeRootFolder && pathParts.length > 0) {
      pathParts = pathParts.slice(1);
    }
    return pathParts.length > 0 ? pathParts.join("/") : null;
  }
  /**
   * Filters a given file and returns true if it is included in a folder or file list
   * @param file 
   * @param filterMode 'exclude'|'include'
   * @param type 'folders'|'files'
   * @returns 
   */
  filterFile(file, filterMode, type) {
    let result = false;
    const filterArray = type === "folders" ? this.settings[filterMode].selectedFolders : this.settings[filterMode].selectedFiles;
    if (filterArray.length === 0)
      return filterMode === "include" ? false : true;
    const filePath = file.path;
    const fileFolder = this.tools.getFoldersFromPath(file.path);
    const fileName = file.basename + "." + file.extension;
    if (type === "files") {
      result = filterArray.includes(filePath);
    }
    if (type === "folders") {
      filterArray.forEach((path) => {
        result = (fileFolder == null ? void 0 : fileFolder.startsWith(path.slice(1))) || false;
        if (result === true)
          return;
      });
    }
    ;
    return filterMode === "exclude" ? !result : result;
  }
  checkIfFileAllowed(file) {
    let result = false;
    if (this.settings.include.selectedFiles.length > 0) {
      result = this.filterFile(file, "include", "files");
      if (result === true)
        return result;
    }
    if (this.settings.include.selectedFolders.length > 0) {
      result = this.filterFile(file, "include", "folders");
      if (result === true)
        return result;
    }
    result = true;
    if (this.settings.exclude.selectedFiles.length > 0) {
      result = this.filterFile(file, "exclude", "files");
      if (result === false)
        return result;
    }
    if (this.settings.exclude.selectedFolders.length > 0) {
      result = this.filterFile(file, "exclude", "folders");
      if (result === false)
        return result;
    }
    return result;
  }
  formatValue(value, type) {
    switch (type) {
      case "text":
      case "tags":
      case "aliases":
      case "multitext":
        return this.tools.toYamlSafeString(value);
      case "date":
      case "datetime":
        if (typeof value === "number") {
          return new Date(value).toISOString();
        }
        return value.toString();
      case "checkbox":
        return value ? "true" : "false";
      case "number":
        return Number(value);
      default:
        return this.tools.toYamlSafeString(value);
    }
  }
  async updateFrontmatterParameters(eventName, file, rules, oldPath) {
    if (!this.checkIfFileAllowed(file)) {
      console.log(`file ${file.path} rejected!`);
      return;
    }
    const currentPathTag = this.formatTagName(this.tools.getFoldersFromPath(file.path));
    const oldPathTag = this.formatTagName(this.tools.getFoldersFromPath(oldPath));
    if (oldPathTag)
      console.log(`update file: "${oldPathTag}" to "${currentPathTag}"`);
    let content = await this.app.vault.read(file);
    const cache = this.app.metadataCache.getFileCache(file);
    this.app.fileManager.processFrontMatter(file, (frontmatter) => {
      rules.forEach((rule) => {
        frontmatter[rule.property] = executeRule(this.app, this.settings, file, frontmatter[rule.property], rule, frontmatter, oldPath);
      });
    }, { "mtime": file.stat.mtime });
  }
  async removeFrontmatterParamsFromAllFiles(rule) {
    let count = { files: 0, items: 0 };
    this.app.vault.getMarkdownFiles().forEach((file) => {
      count.files++;
      this.removeFrontmatterParameter(file, rule, count);
    });
    return count;
  }
  async removeFrontmatterParameter(file, rule, count) {
    if (!this.checkIfFileAllowed(file))
      return;
    const currentPathTag = this.formatTagName(this.tools.getFoldersFromPath(file.path));
    let content = await this.app.vault.read(file);
    this.app.fileManager.processFrontMatter(file, (frontmatter) => {
      if (Array.isArray(frontmatter[rule.property]))
        count.items += frontmatter[rule.property].length;
      frontmatter[rule.property] = removeRule(this.app, this.settings, file, frontmatter[rule.property], rule, frontmatter);
      if (Array.isArray(frontmatter[rule.property]))
        count.items -= frontmatter[rule.property].length;
    }, { "mtime": file.stat.mtime });
    return count;
  }
  async updateFrontmatterTags(file, newTag, oldTagToRemove) {
    let content = await this.app.vault.read(file);
    const cache = this.app.metadataCache.getFileCache(file);
    const frontmatter = cache == null ? void 0 : cache.frontmatter;
    let existingTags = [];
    if (frontmatter && frontmatter[this.settings.tagsPropertyName]) {
      const tagsValue = frontmatter[this.settings.tagsPropertyName];
      if (Array.isArray(tagsValue)) {
        existingTags = tagsValue.filter((tag) => tag != null).map((tag) => String(tag));
      } else if (typeof tagsValue === "string") {
        existingTags = tagsValue.split(/,\s*/).map((tag) => tag.trim()).filter((tag) => tag.length > 0);
      }
    }
    existingTags = existingTags.filter((tag) => {
      if (tag == null)
        return false;
      if (!tag.startsWith(this.settings.tagPrefix))
        return true;
      const tagWithoutPrefix = tag.slice(this.settings.tagPrefix.length);
      return !tagWithoutPrefix.includes("/");
    });
    if (oldTagToRemove) {
      existingTags = existingTags.filter((tag) => tag !== oldTagToRemove);
    }
    if (newTag && !existingTags.includes(newTag)) {
      existingTags.push(newTag);
    }
    let newFrontmatter = {};
    if (frontmatter) {
      newFrontmatter = { ...frontmatter };
      delete newFrontmatter[this.settings.tagsPropertyName];
    }
    let newContent = "";
    if (content.startsWith("---")) {
      const frontmatterEnd = content.indexOf("---", 3) + 3;
      const bodyContent = content.slice(frontmatterEnd);
      let frontmatterContent = Object.entries(newFrontmatter).map(([key, value]) => `${key}: ${value}`).join("\n");
      if (existingTags.length > 0) {
        frontmatterContent += `
${this.settings.tagsPropertyName}:
` + existingTags.map((tag) => `  - ${tag}`).join("\n");
      }
      newContent = `---
${frontmatterContent}
---${bodyContent}`;
    } else {
      if (existingTags.length > 0) {
        newContent = `---
${this.settings.tagsPropertyName}:
` + existingTags.map((tag) => `  - ${tag}`).join("\n") + `
---

${content}`;
      } else {
        return;
      }
    }
    await this.app.vault.modify(file, newContent);
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyIsICJzcmMvc2V0dGluZ3MudHMiLCAic3JjL2Zyb250bWF0dGVyLXRvb2xzLnRzIiwgInNyYy90b29scy50cyIsICJzcmMvcnVsZXMudHMiLCAic3JjL3R5cGVzLnRzIiwgInNyYy9hbGVydEJveC50cyIsICJzcmMvZGlyZWN0b3J5U2VsZWN0aW9uTW9kYWwudHMiLCAic3JjL3NldHRpbmdzLXByb3BlcnRpZXMudHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbImltcG9ydCB7IEFwcCwgUGx1Z2luLCBNYXJrZG93blZpZXcsIFBsdWdpbk1hbmlmZXN0LCBURmlsZSwgVEZvbGRlciwgVmF1bHQsIHBhcnNlRnJvbnRNYXR0ZXJUYWdzLCBOb3RpY2V9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCAqIGFzIGZtVG9vbHMgZnJvbSAnLi9zcmMvZnJvbnRtYXR0ZXItdG9vbHMnO1xuaW1wb3J0IHsgRm9sZGVyVGFnU2V0dGluZ1RhYiB9IGZyb20gJy4vc3JjL3NldHRpbmdzJztcbi8vaW1wb3J0IHsgRm9sZGVyVGFnU2V0dGluZ1RhYiB9IGZyb20gJy4vc3JjL3NldHRpbmdzLXByb3BlcnRpZXMnO1xuaW1wb3J0IHsgZXhlY3V0ZVJ1bGUsIHJlbW92ZVJ1bGUsIHJ1bGVGdW5jdGlvbnMgfSBmcm9tICcuL3NyYy9ydWxlcyc7XG5pbXBvcnQgeyBwYXJzZUpTQ29kZSwgU2NyaXB0aW5nVG9vbHMgfSBmcm9tICcuL3NyYy90b29scyc7XG5pbXBvcnQgeyB2ZXJzaW9uU3RyaW5nLCBGb2xkZXJUYWdTZXR0aW5ncywgREVGQVVMVF9TRVRUSU5HUywgRm9sZGVyVGFnUnVsZURlZmluaXRpb24sIFByb3BlcnR5VHlwZUluZm99IGZyb20gJy4vc3JjL3R5cGVzJ1xuaW1wb3J0IHsgcnVuSW5Db250ZXh0IH0gZnJvbSAndm0nO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBGb2xkZXJUYWdQbHVnaW4gZXh0ZW5kcyBQbHVnaW4ge1xuICAgIHNldHRpbmdzOiBGb2xkZXJUYWdTZXR0aW5ncztcbiAgICBwcml2YXRlIHRvb2xzOiBTY3JpcHRpbmdUb29scztcbiAgICAvL3ByaXZhdGUgb2xkRm9sZGVyUGF0aHMgPSBuZXcgTWFwPHN0cmluZywgc3RyaW5nIHwgbnVsbD4oKTtcblxuICAgIGFzeW5jIG9ubG9hZCgpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5sb2FkU2V0dGluZ3MoKTtcbiAgICAgICAgdGhpcy50b29scyA9IG5ldyBTY3JpcHRpbmdUb29scyh0aGlzLnNldHRpbmdzKTtcbiAgICAgICAgbGV0IG5vdGljZU1lc3NhZ2UgPSBgRnJvbnQgTWF0dGVyIEF1dG9tYXRlICR7dmVyc2lvblN0cmluZ31cXG4gbG9hZGluZyAuLi5gO1xuICAgICAgICBjb25zdCBsb2FkaW5nTm90aWNlID0gbmV3IE5vdGljZShub3RpY2VNZXNzYWdlLDApXG4gICAgICAgIC8qXG4gICAgICAgIC8vIFN0b3JlIGluaXRpYWwgZm9sZGVyIHBhdGhzIGZvciBhbGwgZmlsZXNcbiAgICAgICAgdGhpcy5hcHAudmF1bHQuZ2V0TWFya2Rvd25GaWxlcygpLmZvckVhY2goZmlsZSA9PiB7XG4gICAgICAgICAgICB0aGlzLm9sZEZvbGRlclBhdGhzLnNldChmaWxlLnBhdGgsIHRoaXMuZ2V0Rm9sZGVyUGF0aEZvclRhZyhmaWxlKSk7XG4gICAgICAgIH0pO1xuICAgICAgICAqL1xuICAgICAgICBub3RpY2VNZXNzYWdlID0gbm90aWNlTWVzc2FnZSArICdcXG4gcmVnaXN0ZXIgZXZlbnRzIC4uLic7XG4gICAgICAgIGxvYWRpbmdOb3RpY2Uuc2V0TWVzc2FnZShub3RpY2VNZXNzYWdlKTtcbiAgICAgICAgLy8gRmlsZSBjcmVhdGlvbiBoYW5kbGVyXG4gICAgICAgIHRoaXMucmVnaXN0ZXJFdmVudChcbiAgICAgICAgICAgIHRoaXMuYXBwLnZhdWx0Lm9uKCdjcmVhdGUnLCAoZmlsZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChmaWxlIGluc3RhbmNlb2YgVEZpbGUgJiYgZmlsZS5leHRlbnNpb24gPT09ICdtZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgLy90aGlzLm9sZEZvbGRlclBhdGhzLnNldChmaWxlLnBhdGgsIHRoaXMuZ2V0Rm9sZGVyUGF0aEZvclRhZyhmaWxlKSk7XG4gICAgICAgICAgICAgICAgICAgIC8vdGhpcy51cGRhdGVGaWxlVGFnKGZpbGUpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUZyb250bWF0dGVyUGFyYW1ldGVycygnY3JlYXRlJywgZmlsZSwgdGhpcy5zZXR0aW5ncy5ydWxlcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBGaWxlIHJlbmFtZS9tb3ZlIGhhbmRsZXJcbiAgICAgICAgdGhpcy5yZWdpc3RlckV2ZW50KFxuICAgICAgICAgICAgdGhpcy5hcHAudmF1bHQub24oJ3JlbmFtZScsIChmaWxlLCBvbGRQYXRoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGZpbGUgaW5zdGFuY2VvZiBURmlsZSAmJiBmaWxlLmV4dGVuc2lvbiA9PT0gJ21kJykge1xuICAgICAgICAgICAgICAgICAgICAvL2NvbnN0IG9sZFRhZ1BhdGggPSB0aGlzLm9sZEZvbGRlclBhdGhzLmdldChvbGRQYXRoKSA/PyBudWxsO1xuICAgICAgICAgICAgICAgICAgICAvL2NvbnN0IG5ld1RhZ1BhdGggPSB0aGlzLmdldEZvbGRlclBhdGhGb3JUYWcoZmlsZSk7XG4gICAgICAgICAgICAgICAgICAgIC8vdGhpcy5vbGRGb2xkZXJQYXRocy5zZXQoZmlsZS5wYXRoLCBuZXdUYWdQYXRoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVGcm9udG1hdHRlclBhcmFtZXRlcnMoJ3JlbmFtZScsIGZpbGUsIHRoaXMuc2V0dGluZ3MucnVsZXMsIG9sZFBhdGgpO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICAgICAgLy8gQWx3YXlzIHVwZGF0ZSB3aGVuIG1vdmluZyB0by9mcm9tIHJvb3QgZm9sZGVyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvbGRUYWdQYXRoICE9PSBuZXdUYWdQYXRoIHx8IFxuICAgICAgICAgICAgICAgICAgICAgICAgKG9sZFRhZ1BhdGggIT09IG51bGwgJiYgbmV3VGFnUGF0aCA9PT0gbnVsbCkgfHwgXG4gICAgICAgICAgICAgICAgICAgICAgICAob2xkVGFnUGF0aCA9PT0gbnVsbCAmJiBuZXdUYWdQYXRoICE9PSBudWxsKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy90aGlzLnVwZGF0ZUZpbGVUYWcoZmlsZSwgb2xkVGFnUGF0aCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICApO1xuXG4gICAgICAgIC8vIEZpbGUgY2xvc2UgaGFuZGxlclxuICAgICAgICB0aGlzLnJlZ2lzdGVyRXZlbnQoXG4gICAgICAgICAgICB0aGlzLmFwcC53b3Jrc3BhY2Uub24oJ2FjdGl2ZS1sZWFmLWNoYW5nZScsIChsZWFmKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGxlYWY/LnZpZXcgaW5zdGFuY2VvZiBNYXJrZG93blZpZXcpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWN0aXZlRmlsZSA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVGaWxlKCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBjbG9zaW5nIGZpbGU6IGAsIGFjdGl2ZUZpbGU/LnBhdGgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aXZlRmlsZSkgdGhpcy51cGRhdGVGcm9udG1hdHRlclBhcmFtZXRlcnMoJ2FjdGl2ZS1sZWFmLWNoYW5nZScsIGFjdGl2ZUZpbGUsIHRoaXMuc2V0dGluZ3MucnVsZXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICk7XG5cbiAgICAgICAgbm90aWNlTWVzc2FnZSA9IG5vdGljZU1lc3NhZ2UgKyAnXFxuIGluaXRpYWwgcHJvY2Vzc2luZyAuLi4nO1xuICAgICAgICBsb2FkaW5nTm90aWNlLnNldE1lc3NhZ2Uobm90aWNlTWVzc2FnZSk7XG5cbiAgICAgICAgLy8gSW5pdGlhbCBwcm9jZXNzaW5nIG9mIGV4aXN0aW5nIGZpbGVzXG4gICAgICAgIHRoaXMuYXBwLnZhdWx0LmdldE1hcmtkb3duRmlsZXMoKS5mb3JFYWNoKGZpbGUgPT4ge1xuICAgICAgICAgICAgLy90aGlzLnVwZGF0ZUZpbGVUYWcoZmlsZSk7XG4gICAgICAgICAgICAvL3RoaXMudXBkYXRlRnJvbnRtYXR0ZXJQYXJhbWV0ZXJzKGZpbGUsIHRoaXMuc2V0dGluZ3MucnVsZXMpO1xuICAgICAgICB9KTtcblxuICAgICAgICBub3RpY2VNZXNzYWdlID0gbm90aWNlTWVzc2FnZSArICdcXG5kb25lISc7XG4gICAgICAgIGxvYWRpbmdOb3RpY2Uuc2V0TWVzc2FnZShub3RpY2VNZXNzYWdlKTtcbiAgICAgICAgc2V0VGltZW91dCgoKT0+e1xuICAgICAgICAgICAgbG9hZGluZ05vdGljZS5oaWRlKCk7XG4gICAgICAgIH0sMjAwMClcblxuICAgICAgICAvLyBBZGQgc2V0dGluZ3MgdGFiXG4gICAgICAgIHRoaXMuYWRkU2V0dGluZ1RhYihuZXcgRm9sZGVyVGFnU2V0dGluZ1RhYih0aGlzLmFwcCwgdGhpcykpO1xuICAgIH1cblxuICAgIGFzeW5jIGxvYWRTZXR0aW5ncygpIHtcbiAgICAgICAgbGV0IGRhdGEgPSBhd2FpdCB0aGlzLmxvYWREYXRhKCk7XG4gICAgICAgIHRoaXMuc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1NFVFRJTkdTLCBkYXRhKTtcbiAgICB9XG4gICAgXG4gICAgYXN5bmMgc2F2ZVNldHRpbmdzKCkge1xuICAgICAgICBhd2FpdCB0aGlzLnNhdmVEYXRhKHRoaXMuc2V0dGluZ3MpO1xuICAgIH1cblxuICAgIHByaXZhdGUgZm9ybWF0VGFnTmFtZShuYW1lOiBzdHJpbmcgfCBudWxsIHwgdW5kZWZpbmVkKTogc3RyaW5nIHwgbnVsbCB8IHVuZGVmaW5lZHtcbiAgICAgICAgaWYgKG5hbWUgPT09IG51bGwpIHJldHVybiBudWxsO1xuICAgICAgICBpZiAobmFtZSA9PT0gdW5kZWZpbmVkKSByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICBcbiAgICAgICAgLy8gRmlyc3QgcmVwbGFjZSBzcGFjZXMgYWNjb3JkaW5nIHRvIHNldHRpbmdzXG4gICAgICAgIGxldCBmb3JtYXR0ZWQgPSBuYW1lLnJlcGxhY2UoL1xccysvZywgdGhpcy5zZXR0aW5ncy5zcGFjZVJlcGxhY2VtZW50KTtcbiAgICAgICAgXG4gICAgICAgIC8vIFRoZW4gcmVwbGFjZSBzcGVjaWFsIGNoYXJhY3RlcnMgKHByZXNlcnZpbmcgbGV0dGVycyB3aXRoIGRpYWNyaXRpY3MpXG4gICAgICAgIGZvcm1hdHRlZCA9IGZvcm1hdHRlZC5yZXBsYWNlKC9bXmEtekEtWjAtOVxcLV9cXC9cdTAwRTRcdTAwRjZcdTAwRkNcdTAwREZcdTAwQzRcdTAwRDZcdTAwRENcdTAwRTFcdTAwRTlcdTAwRURcdTAwRjNcdTAwRkFcdTAwRkRcdTAwQzFcdTAwQzlcdTAwQ0RcdTAwRDNcdTAwREFcdTAwRERcdTAwRTBcdTAwRThcdTAwRUNcdTAwRjJcdTAwRjlcdTAwQzBcdTAwQzhcdTAwQ0NcdTAwRDJcdTAwRDlcdTAwRTJcdTAwRUFcdTAwRUVcdTAwRjRcdTAwRkJcdTAwQzJcdTAwQ0FcdTAwQ0VcdTAwRDRcdTAwREJcdTAwRTNcdTAwRjFcdTAwRjVcdTAwQzNcdTAwRDFcdTAwRDVdL2csIHRoaXMuc2V0dGluZ3Muc3BlY2lhbENoYXJSZXBsYWNlbWVudCk7XG4gICAgICAgIFxuICAgICAgICAvLyBDb252ZXJ0IHRvIGxvd2VyY2FzZSBpZiBjb25maWd1cmVkXG4gICAgICAgIGlmICh0aGlzLnNldHRpbmdzLmxvd2VyY2FzZVRhZ3MpIHtcbiAgICAgICAgICAgIGZvcm1hdHRlZCA9IGZvcm1hdHRlZC50b0xvd2VyQ2FzZSgpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gZm9ybWF0dGVkO1xuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgdXBkYXRlRmlsZVRhZyhmaWxlOiBURmlsZSwgb2xkVGFnUGF0aD86IHN0cmluZyB8IG51bGwpIHtcbiAgICAgICAgY29uc3QgbmV3VGFnUGF0aCA9IHRoaXMuZ2V0Rm9sZGVyUGF0aEZvclRhZyhmaWxlKTtcbiAgICAgICAgY29uc3QgZm9ybWF0dGVkTmV3UGF0aCA9IG5ld1RhZ1BhdGggPyB0aGlzLmZvcm1hdFRhZ05hbWUobmV3VGFnUGF0aCkgOiBudWxsO1xuICAgICAgICBcbiAgICAgICAgLy8gSWYgbW92aW5nIHRvIHJvb3QsIG5ld1RhZyB3aWxsIGJlIG51bGxcbiAgICAgICAgY29uc3QgbmV3VGFnID0gZm9ybWF0dGVkTmV3UGF0aCA/IHRoaXMuc2V0dGluZ3MudGFnUHJlZml4ICsgZm9ybWF0dGVkTmV3UGF0aCA6IG51bGw7XG4gICAgICAgIFxuICAgICAgICAvLyBGb3JtYXQgdGhlIG9sZCB0YWcgZm9yIHJlbW92YWxcbiAgICAgICAgbGV0IG9sZFRhZ1RvUmVtb3ZlOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gICAgICAgIGlmIChvbGRUYWdQYXRoKSB7XG4gICAgICAgICAgICBjb25zdCBmb3JtYXR0ZWRPbGRQYXRoID0gdGhpcy5mb3JtYXRUYWdOYW1lKG9sZFRhZ1BhdGgpO1xuICAgICAgICAgICAgaWYgKGZvcm1hdHRlZE9sZFBhdGgpIHtcbiAgICAgICAgICAgICAgICBvbGRUYWdUb1JlbW92ZSA9IHRoaXMuc2V0dGluZ3MudGFnUHJlZml4ICsgZm9ybWF0dGVkT2xkUGF0aDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGF3YWl0IHRoaXMudXBkYXRlRnJvbnRtYXR0ZXJUYWdzKGZpbGUsIG5ld1RhZywgb2xkVGFnVG9SZW1vdmUpO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0Rm9sZGVyUGF0aEZvclRhZyhmaWxlOiBURmlsZSk6IHN0cmluZyB8IG51bGwge1xuICAgICAgICBjb25zdCBmb2xkZXIgPSBmaWxlLnBhcmVudDtcbiAgICAgICAgaWYgKCFmb2xkZXIgfHwgZm9sZGVyID09PSB0aGlzLmFwcC52YXVsdC5nZXRSb290KCkpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHBhdGhQYXJ0czogc3RyaW5nW10gPSBbXTtcbiAgICAgICAgbGV0IGN1cnJlbnRGb2xkZXI6IFRGb2xkZXIgfCBudWxsID0gZm9sZGVyO1xuXG4gICAgICAgIHdoaWxlIChjdXJyZW50Rm9sZGVyICYmIGN1cnJlbnRGb2xkZXIgIT09IHRoaXMuYXBwLnZhdWx0LmdldFJvb3QoKSkge1xuICAgICAgICAgICAgcGF0aFBhcnRzLnVuc2hpZnQoY3VycmVudEZvbGRlci5uYW1lKTtcbiAgICAgICAgICAgIGN1cnJlbnRGb2xkZXIgPSBjdXJyZW50Rm9sZGVyLnBhcmVudDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnNldHRpbmdzLmV4Y2x1ZGVSb290Rm9sZGVyICYmIHBhdGhQYXJ0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBwYXRoUGFydHMgPSBwYXRoUGFydHMuc2xpY2UoMSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcGF0aFBhcnRzLmxlbmd0aCA+IDAgPyBwYXRoUGFydHMuam9pbignLycpIDogbnVsbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGaWx0ZXJzIGEgZ2l2ZW4gZmlsZSBhbmQgcmV0dXJucyB0cnVlIGlmIGl0IGlzIGluY2x1ZGVkIGluIGEgZm9sZGVyIG9yIGZpbGUgbGlzdFxuICAgICAqIEBwYXJhbSBmaWxlIFxuICAgICAqIEBwYXJhbSBmaWx0ZXJNb2RlICdleGNsdWRlJ3wnaW5jbHVkZSdcbiAgICAgKiBAcGFyYW0gdHlwZSAnZm9sZGVycyd8J2ZpbGVzJ1xuICAgICAqIEByZXR1cm5zIFxuICAgICAqL1xuICAgIGZpbHRlckZpbGUoZmlsZTogVEZpbGUsIGZpbHRlck1vZGU6IHN0cmluZywgdHlwZTpzdHJpbmcpOmJvb2xlYW4ge1xuICAgICAgICBsZXQgcmVzdWx0ID0gZmFsc2U7XG4gICAgICAgIGNvbnN0IGZpbHRlckFycmF5ID0gKHR5cGU9PT0nZm9sZGVycycpID8gdGhpcy5zZXR0aW5nc1tmaWx0ZXJNb2RlXS5zZWxlY3RlZEZvbGRlcnMgOiB0aGlzLnNldHRpbmdzW2ZpbHRlck1vZGVdLnNlbGVjdGVkRmlsZXM7XG4gICAgICAgIGlmIChmaWx0ZXJBcnJheS5sZW5ndGggPT09IDApIHJldHVybiAoZmlsdGVyTW9kZSA9PT0gJ2luY2x1ZGUnKT8gZmFsc2UgOiB0cnVlO1xuICAgICAgICBjb25zdCBmaWxlUGF0aCA9IGZpbGUucGF0aDtcbiAgICAgICAgY29uc3QgZmlsZUZvbGRlciA9IHRoaXMudG9vbHMuZ2V0Rm9sZGVyc0Zyb21QYXRoKGZpbGUucGF0aCk7XG4gICAgICAgIGNvbnN0IGZpbGVOYW1lID0gZmlsZS5iYXNlbmFtZSArICcuJyArIGZpbGUuZXh0ZW5zaW9uO1xuICAgICAgICBcbiAgICAgICAgaWYgKHR5cGUgPT09ICdmaWxlcycpIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IGZpbHRlckFycmF5LmluY2x1ZGVzKGZpbGVQYXRoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZSA9PT0gJ2ZvbGRlcnMnKSB7XG4gICAgICAgICAgICBmaWx0ZXJBcnJheS5mb3JFYWNoKHBhdGggPT4ge1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGZpbGVGb2xkZXI/LnN0YXJ0c1dpdGgocGF0aC5zbGljZSgxKSkgfHwgZmFsc2U7IC8vIHJlbW92ZSByb290ICcvJ1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IHRydWUpIHJldHVybjtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gKGZpbHRlck1vZGUgPT09ICdleGNsdWRlJyk/ICFyZXN1bHQgOiByZXN1bHQ7XG4gICAgfVxuXG4gICAgY2hlY2tJZkZpbGVBbGxvd2VkKGZpbGU6IFRGaWxlKSB7XG4gICAgICAgIGxldCByZXN1bHQgPSBmYWxzZTtcbiAgICAgICAgaWYgKHRoaXMuc2V0dGluZ3MuaW5jbHVkZS5zZWxlY3RlZEZpbGVzLmxlbmd0aD4wKSB7IC8vIHRoZXJlIGFyZSBmaWxlcyBpbiB0aGUgaW5jbHVkZSBmaWxlcyBsaXN0XG4gICAgICAgICAgICByZXN1bHQgPSB0aGlzLmZpbHRlckZpbGUoZmlsZSwgJ2luY2x1ZGUnLCAnZmlsZXMnKTtcbiAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IHRydWUpIHJldHVybiByZXN1bHQ7IC8vIGZpbGUgaXMgaW4gaW5jbHVkZS1saXN0XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuc2V0dGluZ3MuaW5jbHVkZS5zZWxlY3RlZEZvbGRlcnMubGVuZ3RoPjApIHsgLy8gdGhlcmUgYXJlIGZvbGRlcnMgaW4gdGhlIGluY2x1ZGUgZm9sZGVycyBsaXN0XG4gICAgICAgICAgICByZXN1bHQgPSB0aGlzLmZpbHRlckZpbGUoZmlsZSwgJ2luY2x1ZGUnLCAnZm9sZGVycycpO1xuICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gdHJ1ZSkgcmV0dXJuIHJlc3VsdDsgLy8gZmlsZSBpcyBpbiBhIGZvbGRlciBpbnNpZGUgdGhlIGluY2x1ZGUtbGlzdFxuICAgICAgICB9XG4gICAgICAgIHJlc3VsdCA9IHRydWU7XG4gICAgICAgIGlmICh0aGlzLnNldHRpbmdzLmV4Y2x1ZGUuc2VsZWN0ZWRGaWxlcy5sZW5ndGg+MCkgeyAvLyB0aGVyZSBhcmUgZmlsZXMgaW4gdGhlIGV4Y2x1ZGUgZmlsZXMgbGlzdC5cbiAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMuZmlsdGVyRmlsZShmaWxlLCAnZXhjbHVkZScsICdmaWxlcycpO1xuICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gZmFsc2UpIHJldHVybiByZXN1bHQ7IC8vIGZpbGUgaXMgaW4gZXhjbHVkZS1saXN0XG4gICAgICAgIH0gICAgICAgIFxuICAgICAgICBpZiAodGhpcy5zZXR0aW5ncy5leGNsdWRlLnNlbGVjdGVkRm9sZGVycy5sZW5ndGg+MCkgeyAvLyB0aGVyZSBhcmUgZm9sZGVycyBpbiB0aGUgaW5jbHVkZSBmb2xkZXJzIGxpc3QuXG4gICAgICAgICAgICByZXN1bHQgPSB0aGlzLmZpbHRlckZpbGUoZmlsZSwgJ2V4Y2x1ZGUnLCAnZm9sZGVycycpO1xuICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gZmFsc2UpIHJldHVybiByZXN1bHQ7IC8vIGZpbGUgaXMgaW4gYSBmb2xkZXIgaW5zaWRlIHRoZSBpbmNsdWRlLWxpc3RcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIGZvcm1hdFZhbHVlKHZhbHVlOmFueSwgdHlwZTpzdHJpbmcpIHtcbiAgICAgICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgICAgICBjYXNlICd0ZXh0JzpcbiAgICAgICAgICAgIGNhc2UgJ3RhZ3MnOlxuICAgICAgICAgICAgY2FzZSAnYWxpYXNlcyc6XG4gICAgICAgICAgICBjYXNlICdtdWx0aXRleHQnOlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnRvb2xzLnRvWWFtbFNhZmVTdHJpbmcodmFsdWUpO1xuICAgICAgICAgICAgY2FzZSAnZGF0ZSc6XG4gICAgICAgICAgICBjYXNlICdkYXRldGltZSc6XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKHZhbHVlKS50b0lTT1N0cmluZygpXG4gICAgICAgICAgICAgICAgfSBcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUudG9TdHJpbmcoKTtcbiAgICAgICAgICAgIGNhc2UgJ2NoZWNrYm94JzpcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUgPyAndHJ1ZScgOiAnZmFsc2UnO1xuICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gTnVtYmVyKHZhbHVlKTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudG9vbHMudG9ZYW1sU2FmZVN0cmluZyh2YWx1ZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyB1cGRhdGVGcm9udG1hdHRlclBhcmFtZXRlcnMoZXZlbnROYW1lOiAnY3JlYXRlJyB8ICdyZW5hbWUnIHwgJ2FjdGl2ZS1sZWFmLWNoYW5nZScsIGZpbGU6IFRGaWxlLCBydWxlczogRm9sZGVyVGFnUnVsZURlZmluaXRpb25bXSwgb2xkUGF0aD86IHN0cmluZykge1xuICAgICAgICBpZiAoIXRoaXMuY2hlY2tJZkZpbGVBbGxvd2VkKGZpbGUpKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgZmlsZSAke2ZpbGUucGF0aH0gcmVqZWN0ZWQhYClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjdXJyZW50UGF0aFRhZyA9IHRoaXMuZm9ybWF0VGFnTmFtZSh0aGlzLnRvb2xzLmdldEZvbGRlcnNGcm9tUGF0aChmaWxlLnBhdGgpKTtcbiAgICAgICAgY29uc3Qgb2xkUGF0aFRhZyA9IHRoaXMuZm9ybWF0VGFnTmFtZSh0aGlzLnRvb2xzLmdldEZvbGRlcnNGcm9tUGF0aChvbGRQYXRoKSlcbiAgICAgICAgaWYgKG9sZFBhdGhUYWcpIGNvbnNvbGUubG9nKGB1cGRhdGUgZmlsZTogXCIke29sZFBhdGhUYWd9XCIgdG8gXCIke2N1cnJlbnRQYXRoVGFnfVwiYCk7XG4gICAgICAgIGxldCBjb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChmaWxlKTtcbiAgICAgICAgY29uc3QgY2FjaGUgPSB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZShmaWxlKTtcbiAgICAgICAgLy9jb25zdCBmcm9udG1hdHRlciA9IGNhY2hlPy5mcm9udG1hdHRlciB8fCB7fTtcbiAgICAgICAgdGhpcy5hcHAuZmlsZU1hbmFnZXIucHJvY2Vzc0Zyb250TWF0dGVyKGZpbGUsIChmcm9udG1hdHRlcikgPT4ge1xuICAgICAgICAgICAvLyBhcHBseSBhbGwgcnVsZXMgdG8gZnJvbnRtYXR0ZXJcbiAgICAgICAgICAgIHJ1bGVzLmZvckVhY2gocnVsZSA9PiB7XG4gICAgICAgICAgICAgICAgZnJvbnRtYXR0ZXJbcnVsZS5wcm9wZXJ0eV0gPSBleGVjdXRlUnVsZSh0aGlzLmFwcCwgdGhpcy5zZXR0aW5ncywgZmlsZSwgZnJvbnRtYXR0ZXJbcnVsZS5wcm9wZXJ0eV0sIHJ1bGUsIGZyb250bWF0dGVyLCBvbGRQYXRoKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0seydtdGltZSc6ZmlsZS5zdGF0Lm10aW1lfSk7IC8vIGRvIG5vdCBjaGFuZ2UgdGhlIG1vZGlmeSB0aW1lLlxuICAgIH1cbiAgICBcbiAgICBhc3luYyByZW1vdmVGcm9udG1hdHRlclBhcmFtc0Zyb21BbGxGaWxlcyhydWxlOiBGb2xkZXJUYWdSdWxlRGVmaW5pdGlvbil7XG4gICAgICAgIGxldCBjb3VudCA9IHtmaWxlczowLCBpdGVtczogMH1cbiAgICAgICAgdGhpcy5hcHAudmF1bHQuZ2V0TWFya2Rvd25GaWxlcygpLmZvckVhY2goZmlsZSA9PiB7XG4gICAgICAgICAgICBjb3VudC5maWxlcysrO1xuICAgICAgICAgICAgdGhpcy5yZW1vdmVGcm9udG1hdHRlclBhcmFtZXRlcihmaWxlLCBydWxlLCBjb3VudCk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gY291bnQ7XG4gICAgfVxuXG4gICAgYXN5bmMgcmVtb3ZlRnJvbnRtYXR0ZXJQYXJhbWV0ZXIoZmlsZTogVEZpbGUsIHJ1bGU6IEZvbGRlclRhZ1J1bGVEZWZpbml0aW9uLCBjb3VudCkge1xuICAgICAgICBpZiAoIXRoaXMuY2hlY2tJZkZpbGVBbGxvd2VkKGZpbGUpKSByZXR1cm47XG4gICAgICAgIGNvbnN0IGN1cnJlbnRQYXRoVGFnID0gdGhpcy5mb3JtYXRUYWdOYW1lKHRoaXMudG9vbHMuZ2V0Rm9sZGVyc0Zyb21QYXRoKGZpbGUucGF0aCkpO1xuICAgICAgICBsZXQgY29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQoZmlsZSk7XG4gICAgICAgIHRoaXMuYXBwLmZpbGVNYW5hZ2VyLnByb2Nlc3NGcm9udE1hdHRlcihmaWxlLCAoZnJvbnRtYXR0ZXIpID0+IHtcbiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGZyb250bWF0dGVyW3J1bGUucHJvcGVydHldKSkgY291bnQuaXRlbXMgKz0gZnJvbnRtYXR0ZXJbcnVsZS5wcm9wZXJ0eV0ubGVuZ3RoO1xuICAgICAgICAgICAgZnJvbnRtYXR0ZXJbcnVsZS5wcm9wZXJ0eV0gPSByZW1vdmVSdWxlKHRoaXMuYXBwLCB0aGlzLnNldHRpbmdzLCBmaWxlLCBmcm9udG1hdHRlcltydWxlLnByb3BlcnR5XSwgcnVsZSwgZnJvbnRtYXR0ZXIpO1xuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZnJvbnRtYXR0ZXJbcnVsZS5wcm9wZXJ0eV0pKSBjb3VudC5pdGVtcyAtPSBmcm9udG1hdHRlcltydWxlLnByb3BlcnR5XS5sZW5ndGg7XG4gICAgICAgIH0seydtdGltZSc6ZmlsZS5zdGF0Lm10aW1lfSk7IC8vIGRvIG5vdCBjaGFuZ2UgdGhlIG1vZGlmeSB0aW1lLlxuICAgICAgICByZXR1cm4gY291bnQ7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyB1cGRhdGVGcm9udG1hdHRlclRhZ3MoZmlsZTogVEZpbGUsIG5ld1RhZzogc3RyaW5nIHwgbnVsbCwgb2xkVGFnVG9SZW1vdmU/OiBzdHJpbmcpIHtcbiAgICAgICAgbGV0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKGZpbGUpO1xuICAgICAgICBjb25zdCBjYWNoZSA9IHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0RmlsZUNhY2hlKGZpbGUpO1xuICAgICAgICBjb25zdCBmcm9udG1hdHRlciA9IGNhY2hlPy5mcm9udG1hdHRlcjtcbiAgICAgICAgXG4gICAgICAgIC8vIEdldCBleGlzdGluZyB0YWdzIChoYW5kbGluZyBib3RoIGFycmF5IGFuZCBzdHJpbmcgZm9ybWF0cylcbiAgICAgICAgbGV0IGV4aXN0aW5nVGFnczogc3RyaW5nW10gPSBbXTtcbiAgICAgICAgaWYgKGZyb250bWF0dGVyICYmIGZyb250bWF0dGVyW3RoaXMuc2V0dGluZ3MudGFnc1Byb3BlcnR5TmFtZV0pIHtcbiAgICAgICAgICAgIGNvbnN0IHRhZ3NWYWx1ZSA9IGZyb250bWF0dGVyW3RoaXMuc2V0dGluZ3MudGFnc1Byb3BlcnR5TmFtZV07XG4gICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh0YWdzVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgZXhpc3RpbmdUYWdzID0gdGFnc1ZhbHVlLmZpbHRlcih0YWcgPT4gdGFnICE9IG51bGwpLm1hcCh0YWcgPT4gU3RyaW5nKHRhZykpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdGFnc1ZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIGV4aXN0aW5nVGFncyA9IHRhZ3NWYWx1ZS5zcGxpdCgvLFxccyovKVxuICAgICAgICAgICAgICAgICAgICAubWFwKHRhZyA9PiB0YWcudHJpbSgpKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKHRhZyA9PiB0YWcubGVuZ3RoID4gMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBSZW1vdmUgYW55IGV4aXN0aW5nIGZvbGRlciBwYXRoIHRhZ3MgKHdpdGggY3VycmVudCBwcmVmaXgpXG4gICAgICAgIGV4aXN0aW5nVGFncyA9IGV4aXN0aW5nVGFncy5maWx0ZXIodGFnID0+IHtcbiAgICAgICAgICAgIGlmICh0YWcgPT0gbnVsbCkgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgaWYgKCF0YWcuc3RhcnRzV2l0aCh0aGlzLnNldHRpbmdzLnRhZ1ByZWZpeCkpIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgY29uc3QgdGFnV2l0aG91dFByZWZpeCA9IHRhZy5zbGljZSh0aGlzLnNldHRpbmdzLnRhZ1ByZWZpeC5sZW5ndGgpO1xuICAgICAgICAgICAgcmV0dXJuICF0YWdXaXRob3V0UHJlZml4LmluY2x1ZGVzKCcvJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFNwZWNpZmljYWxseSByZW1vdmUgdGhlIG9sZCB0YWcgaWYgcHJvdmlkZWRcbiAgICAgICAgaWYgKG9sZFRhZ1RvUmVtb3ZlKSB7XG4gICAgICAgICAgICBleGlzdGluZ1RhZ3MgPSBleGlzdGluZ1RhZ3MuZmlsdGVyKHRhZyA9PiB0YWcgIT09IG9sZFRhZ1RvUmVtb3ZlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEFkZCB0aGUgbmV3IHRhZyBpZiBwcm92aWRlZCBhbmQgbm90IGFscmVhZHkgcHJlc2VudFxuICAgICAgICBpZiAobmV3VGFnICYmICFleGlzdGluZ1RhZ3MuaW5jbHVkZXMobmV3VGFnKSkge1xuICAgICAgICAgICAgZXhpc3RpbmdUYWdzLnB1c2gobmV3VGFnKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gVXBkYXRlIG9yIGNyZWF0ZSBmcm9udG1hdHRlclxuICAgICAgICBsZXQgbmV3RnJvbnRtYXR0ZXI6IGFueSA9IHt9O1xuICAgICAgICBpZiAoZnJvbnRtYXR0ZXIpIHtcbiAgICAgICAgICAgIG5ld0Zyb250bWF0dGVyID0gey4uLmZyb250bWF0dGVyfTtcbiAgICAgICAgICAgIC8vIFJlbW92ZSB0aGUgb2xkIHRhZ3MgcHJvcGVydHkgdG8gZW5zdXJlIHByb3BlciBmb3JtYXR0aW5nXG4gICAgICAgICAgICBkZWxldGUgbmV3RnJvbnRtYXR0ZXJbdGhpcy5zZXR0aW5ncy50YWdzUHJvcGVydHlOYW1lXTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gUmVjb25zdHJ1Y3QgdGhlIGZyb250bWF0dGVyIHdpdGggcHJvcGVyIFlBTUwgZm9ybWF0XG4gICAgICAgIGxldCBuZXdDb250ZW50ID0gJyc7XG4gICAgICAgIGlmIChjb250ZW50LnN0YXJ0c1dpdGgoJy0tLScpKSB7XG4gICAgICAgICAgICAvLyBSZXBsYWNlIGV4aXN0aW5nIGZyb250bWF0dGVyXG4gICAgICAgICAgICBjb25zdCBmcm9udG1hdHRlckVuZCA9IGNvbnRlbnQuaW5kZXhPZignLS0tJywgMykgKyAzO1xuICAgICAgICAgICAgY29uc3QgYm9keUNvbnRlbnQgPSBjb250ZW50LnNsaWNlKGZyb250bWF0dGVyRW5kKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gQnVpbGQgbmV3IGZyb250bWF0dGVyIGNvbnRlbnRcbiAgICAgICAgICAgIGxldCBmcm9udG1hdHRlckNvbnRlbnQgPSBPYmplY3QuZW50cmllcyhuZXdGcm9udG1hdHRlcilcbiAgICAgICAgICAgICAgICAubWFwKChba2V5LCB2YWx1ZV0pID0+IGAke2tleX06ICR7dmFsdWV9YClcbiAgICAgICAgICAgICAgICAuam9pbignXFxuJyk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIEFkZCB0YWdzIGluIHByb3BlciBZQU1MIGFycmF5IGZvcm1hdCBpZiB3ZSBoYXZlIGFueVxuICAgICAgICAgICAgaWYgKGV4aXN0aW5nVGFncy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgZnJvbnRtYXR0ZXJDb250ZW50ICs9IGBcXG4ke3RoaXMuc2V0dGluZ3MudGFnc1Byb3BlcnR5TmFtZX06XFxuYCArXG4gICAgICAgICAgICAgICAgICAgIGV4aXN0aW5nVGFncy5tYXAodGFnID0+IGAgIC0gJHt0YWd9YCkuam9pbignXFxuJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIG5ld0NvbnRlbnQgPSBgLS0tXFxuJHtmcm9udG1hdHRlckNvbnRlbnR9XFxuLS0tJHtib2R5Q29udGVudH1gO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gT25seSBjcmVhdGUgZnJvbnRtYXR0ZXIgaWYgd2UgaGF2ZSB0YWdzIHRvIGFkZFxuICAgICAgICAgICAgaWYgKGV4aXN0aW5nVGFncy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgbmV3Q29udGVudCA9IGAtLS1cXG4ke3RoaXMuc2V0dGluZ3MudGFnc1Byb3BlcnR5TmFtZX06XFxuYCArXG4gICAgICAgICAgICAgICAgICAgIGV4aXN0aW5nVGFncy5tYXAodGFnID0+IGAgIC0gJHt0YWd9YCkuam9pbignXFxuJykgK1xuICAgICAgICAgICAgICAgICAgICBgXFxuLS0tXFxuXFxuJHtjb250ZW50fWA7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIE5vIHRhZ3MgdG8gYWRkLCByZXR1cm4gb3JpZ2luYWwgY29udGVudFxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQubW9kaWZ5KGZpbGUsIG5ld0NvbnRlbnQpO1xuICAgIH1cbn1cbiIsICJpbXBvcnQgeyBBcHAsIEJ1dHRvbkNvbXBvbmVudCwgRHJvcGRvd25Db21wb25lbnQsIFBsdWdpblNldHRpbmdUYWIsIFNldHRpbmcsIFRleHRDb21wb25lbnQgfSBmcm9tICdvYnNpZGlhbic7XHJcbmltcG9ydCAqIGFzIGZtVG9vbHMgZnJvbSAnLi9mcm9udG1hdHRlci10b29scyc7XHJcbmltcG9ydCB7IHBhcnNlSlNDb2RlLCBTY3JpcHRpbmdUb29scyB9IGZyb20gJy4vdG9vbHMnO1xyXG5pbXBvcnQgeyBnZXRSdWxlRnVuY3Rpb25CeUlkLCBydWxlRnVuY3Rpb25zLCBSdWxlRnVuY3Rpb24gfSBmcm9tICcuL3J1bGVzJztcclxuaW1wb3J0IHsgdmVyc2lvblN0cmluZywgRm9sZGVyVGFnUnVsZURlZmluaXRpb24sIERFRkFVTFRfUlVMRV9ERUZJTklUSU9OLCBQcm9wZXJ0eVR5cGVJbmZvfSBmcm9tICcuL3R5cGVzJztcclxuaW1wb3J0IHsgQWxlcnRNb2RhbCB9IGZyb20gJy4vYWxlcnRCb3gnO1xyXG5pbXBvcnQgeyBvcGVuRGlyZWN0b3J5U2VsZWN0aW9uTW9kYWwsIERpcmVjdG9yeVNlbGVjdGlvblJlc3VsdCB9IGZyb20gJy4vZGlyZWN0b3J5U2VsZWN0aW9uTW9kYWwnO1xyXG5pbXBvcnQgeyByYW5kb21VVUlEIH0gZnJvbSAnY3J5cHRvJztcclxuaW1wb3J0IHsgUnVsZXNUYWJsZSB9IGZyb20gJy4vc2V0dGluZ3MtcHJvcGVydGllcyc7XHJcblxyXG5leHBvcnQgY2xhc3MgRm9sZGVyVGFnU2V0dGluZ1RhYiBleHRlbmRzIFBsdWdpblNldHRpbmdUYWIge1xyXG4gICAgcGx1Z2luOiBhbnk7IC8vRm9sZGVyVGFnUGx1Z2luO1xyXG4gICAgcnVsZXNEaXY6IEhUTUxEaXZFbGVtZW50O1xyXG4gICAgcnVsZXNDb250YWluZXI6IEhUTUxEaXZFbGVtZW50O1xyXG4gICAgcnVsZXNDb250cm9sOiBIVE1MRGl2RWxlbWVudDtcclxuICAgIGtub3duUHJvcGVydGllczogUHJvcGVydHlUeXBlSW5mb1tdO1xyXG4gICAga25vd25UeXBlczogYW55O1xyXG4gICAgc2NyaXB0aW5nVG9vbHM6IFNjcmlwdGluZ1Rvb2xzO1xyXG4gICAgXHJcbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBhbnkgLypGb2xkZXJUYWdQbHVnaW4qLykge1xyXG4gICAgICAgIHN1cGVyKGFwcCwgcGx1Z2luKTtcclxuICAgICAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcclxuICAgICAgICB0aGlzLnNjcmlwdGluZ1Rvb2xzID0gbmV3IFNjcmlwdGluZ1Rvb2xzKHRoaXMucGx1Z2luLnNldHRpbmdzKTtcclxuICAgIH1cclxuXHJcbiAgICBkaXNwbGF5KCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMua25vd25Qcm9wZXJ0aWVzID0gZm1Ub29scy5nZXRQcm9wZXJ0aWVzRnJvbU1ldGFkYXRhTWFuYWdlcih0aGlzLmFwcCk7XHJcbiAgICAgICAgdGhpcy5rbm93blR5cGVzID0gZm1Ub29scy5nZXRUeXBlc0Zyb21NZXRhZGF0YU1hbmFnZXIodGhpcy5hcHApO1xyXG4gICAgICAgIGNvbnN0IHsgY29udGFpbmVyRWwgfSA9IHRoaXM7XHJcblxyXG4gICAgICAgIGNvbnRhaW5lckVsLmVtcHR5KCk7XHJcbiAgICAgICAgY29udGFpbmVyRWwuY3JlYXRlRWwoJ2gyJywgeyB0ZXh0OiBgRnJvbnQgbWF0dGVyIGF1dG9tYXRlIFYke3ZlcnNpb25TdHJpbmd9YCB9KTtcclxuXHJcblxyXG4gICAgICAgIC8qXHJcbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgICAgICAgIC5zZXROYW1lKCdFeGNsdWRlIHJvb3QgZm9sZGVyJylcclxuICAgICAgICAgICAgLnNldERlc2MoJ0lmIGVuYWJsZWQsIHRoZSByb290IGZvbGRlciBuYW1lIHdpbGwgYmUgZXhjbHVkZWQgZnJvbSB0aGUgdGFnJylcclxuICAgICAgICAgICAgLmFkZFRvZ2dsZSh0b2dnbGUgPT4gdG9nZ2xlXHJcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuZXhjbHVkZVJvb3RGb2xkZXIpXHJcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZXhjbHVkZVJvb3RGb2xkZXIgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgIH0pKTtcclxuICAgICAgICAqL1xyXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxyXG4gICAgICAgICAgICAuc2V0TmFtZSgnVGFncyBwcm9wZXJ0eSBuYW1lJylcclxuICAgICAgICAgICAgLnNldERlc2MoJ0Zyb250bWF0dGVyIHByb3BlcnR5IG5hbWUgdG8gc3RvcmUgdGFncyAoZGVmYXVsdDogXCJ0YWdzXCIpJylcclxuICAgICAgICAgICAgLmFkZFRleHQodGV4dCA9PiB0ZXh0XHJcbiAgICAgICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJ3RhZ3MnKVxyXG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnRhZ3NQcm9wZXJ0eU5hbWUpXHJcbiAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MudGFnc1Byb3BlcnR5TmFtZSA9IHZhbHVlIHx8ICd0YWdzJztcclxuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgIH0pKTtcclxuXHJcbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgICAgLnNldE5hbWUoJ0V4Y2x1ZGUgRmlsZXMgYW5kIEZvbGRlcnMnKVxyXG4gICAgICAgIC5zZXREZXNjKGBDdXJyZW50bHkgJHt0aGlzLnBsdWdpbi5zZXR0aW5ncy5leGNsdWRlLnNlbGVjdGVkRm9sZGVycy5sZW5ndGh9IGZvbGRlcnMgYW5kICR7dGhpcy5wbHVnaW4uc2V0dGluZ3MuZXhjbHVkZS5zZWxlY3RlZEZpbGVzLmxlbmd0aH0gZmlsZXMgd2lsbCBiZSAke3RoaXMucGx1Z2luLnNldHRpbmdzLmV4Y2x1ZGUubW9kZX1kLmApXHJcbiAgICAgICAgLmFkZEJ1dHRvbihidXR0b24gPT4ge1xyXG4gICAgICAgICAgICBidXR0b25cclxuICAgICAgICAgICAgICAgIC5zZXRJY29uKCdmb2xkZXIteCcpXHJcbiAgICAgICAgICAgICAgICAuc2V0QnV0dG9uVGV4dCgnRXhjbHVkZScpXHJcbiAgICAgICAgICAgICAgICAuc2V0Q3RhKCkgLy8gTWFrZXMgdGhlIGJ1dHRvbiBtb3JlIHByb21pbmVudFxyXG4gICAgICAgICAgICAgICAgLm9uQ2xpY2soKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIG9wZW5EaXJlY3RvcnlTZWxlY3Rpb25Nb2RhbChcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmV4Y2x1ZGUuc2VsZWN0ZWRGb2xkZXJzIHx8IFtdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5leGNsdWRlLnNlbGVjdGVkRmlsZXMgfHwgW10sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmV4Y2x1ZGUubW9kZSB8fCAnZXhjbHVkZScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmV4Y2x1ZGUuZGlzcGxheSB8fCAnZm9sZGVycycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlLCAvLyBpbmNsdWRlLCBleGNsdWRlIG9wdGlvbiBoaWRkZW5cclxuICAgICAgICAgICAgICAgICAgICAgICAgKHJlc3VsdDogRGlyZWN0b3J5U2VsZWN0aW9uUmVzdWx0IHwgbnVsbCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXN1bHQpIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmV4Y2x1ZGUuc2VsZWN0ZWRGb2xkZXJzID0gcmVzdWx0LmZvbGRlcnM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5leGNsdWRlLnNlbGVjdGVkRmlsZXMgPSByZXN1bHQuZmlsZXM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5leGNsdWRlLm1vZGUgPSByZXN1bHQubW9kZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmV4Y2x1ZGUuZGlzcGxheSA9IHJlc3VsdC5kaXNwbGF5O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXNwbGF5KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7ICAgICAgICAgIFxyXG5cclxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuICAgICAgICAuc2V0TmFtZSgnSW5jbHVkZSBGaWxlcyBhbmQgRm9sZGVycycpXHJcbiAgICAgICAgLnNldERlc2MoYEN1cnJlbnRseSAke3RoaXMucGx1Z2luLnNldHRpbmdzLmluY2x1ZGUuc2VsZWN0ZWRGb2xkZXJzLmxlbmd0aH0gZm9sZGVycyBhbmQgJHt0aGlzLnBsdWdpbi5zZXR0aW5ncy5pbmNsdWRlLnNlbGVjdGVkRmlsZXMubGVuZ3RofSBmaWxlcyB3aWxsIGJlICR7dGhpcy5wbHVnaW4uc2V0dGluZ3MuaW5jbHVkZS5tb2RlfWQgZXZlbiB3aGVuIGluIGV4Y2x1ZGVkIEZvbGRlcnMuYClcclxuICAgICAgICAuYWRkQnV0dG9uKGJ1dHRvbiA9PiB7XHJcbiAgICAgICAgICAgIGJ1dHRvblxyXG4gICAgICAgICAgICAgICAgLnNldEljb24oJ2ZvbGRlci1jaGVjaycpXHJcbiAgICAgICAgICAgICAgICAuc2V0QnV0dG9uVGV4dCgnSW5jbHVkZScpXHJcbiAgICAgICAgICAgICAgICAuc2V0Q3RhKCkgLy8gTWFrZXMgdGhlIGJ1dHRvbiBtb3JlIHByb21pbmVudFxyXG4gICAgICAgICAgICAgICAgLm9uQ2xpY2soKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIG9wZW5EaXJlY3RvcnlTZWxlY3Rpb25Nb2RhbChcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmluY2x1ZGUuc2VsZWN0ZWRGb2xkZXJzIHx8IFtdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5pbmNsdWRlLnNlbGVjdGVkRmlsZXMgfHwgW10sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmluY2x1ZGUubW9kZSB8fCAnaW5jbHVkZScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmluY2x1ZGUuZGlzcGxheSB8fCAnZm9sZGVycycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlLCAvLyBpbmNsdWRlLCBpbmNsdWRlIG9wdGlvbiBoaWRkZW5cclxuICAgICAgICAgICAgICAgICAgICAgICAgKHJlc3VsdDogRGlyZWN0b3J5U2VsZWN0aW9uUmVzdWx0IHwgbnVsbCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXN1bHQpIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmluY2x1ZGUuc2VsZWN0ZWRGb2xkZXJzID0gcmVzdWx0LmZvbGRlcnM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5pbmNsdWRlLnNlbGVjdGVkRmlsZXMgPSByZXN1bHQuZmlsZXM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5pbmNsdWRlLm1vZGUgPSByZXN1bHQubW9kZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmluY2x1ZGUuZGlzcGxheSA9IHJlc3VsdC5kaXNwbGF5O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXNwbGF5KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7ICAgICAgXHJcbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgICAgLnNldE5hbWUoJ1J1bGVzJylcclxuICAgICAgICAuc2V0RGVzYygnYWRkIHJ1bGVzIHRvIHVwZGF0ZSBzZWxlY3RlZCBwYXJhbWV0ZXJzJyk7XHJcbiAgICAgICAgLypcclxuXHJcbiAgICAgICAgdGhpcy5ydWxlc0RpdiA9IGNvbnRhaW5lckVsLmNyZWF0ZURpdih7IGNsczogXCJvYnNpZGlhbi1mMnQtcnVsZS1hcmVhXCIgfSlcclxuICAgICAgICB0aGlzLnJ1bGVzQ29udHJvbCA9IGNvbnRhaW5lckVsLmNyZWF0ZURpdih7IGNsczogXCJvYnNpZGlhbi1mMnQtcnVsZS1jb250cm9sc1wiIH0pXHJcbiAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MucnVsZXMuZm9yRWFjaChydWxlID0+IHtcclxuICAgICAgICAgICAgdGhpcy5hZGRSdWxlKHRoaXMucnVsZXNEaXYscnVsZS5pZCk7XHJcbiAgICAgICAgfSlcclxuXHJcbiAgICAgICAgbmV3IFNldHRpbmcodGhpcy5ydWxlc0NvbnRyb2wpXHJcbiAgICAgICAgICAgIC5hZGRCdXR0b24oYXN5bmMgKGJ1dHRvbikgPT4ge1xyXG4gICAgICAgICAgICAgICAgYnV0dG9uLnNldEljb24oJ3NxdWFyZS1wbHVzJyk7XHJcbiAgICAgICAgICAgICAgICBidXR0b24uc2V0Q2xhc3MoJ29ic2lkaWFuLWYydC1zbWFsbEJ1dHRvbicpO1xyXG4gICAgICAgICAgICAgICAgYnV0dG9uLnNldFRvb2x0aXAoJ2FkZCBhIHJ1bGUnKVxyXG4gICAgICAgICAgICAgICAgYnV0dG9uLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkUnVsZSh0aGlzLnJ1bGVzRGl2KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAvKiBUT0RPIGFkZCBjbGVhciBhbGwgcnVsZXMgZnVuY3Rpb25hbGl0eSBcclxuICAgICAgICAgICAgLmFkZEJ1dHRvbihhc3luYyAoYnV0dG9uKSA9PiB7IFxyXG4gICAgICAgICAgICAgICAgYnV0dG9uLnNldEljb24oJ3NxdWFyZS14Jyk7XHJcbiAgICAgICAgICAgICAgICBidXR0b24uc2V0Q2xhc3MoJ29ic2lkaWFuLWYydC1zbWFsbEJ1dHRvbicpO1xyXG4gICAgICAgICAgICAgICAgYnV0dG9uLnNldFRvb2x0aXAoJ3JlbW92ZSBhbGwgcnVsZXMnKVxyXG4gICAgICAgICAgICAgICAgYnV0dG9uLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyZW1vdmVBbGxSdWxlcycpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAqL1xyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMucnVsZXNDb250YWluZXIgPSBjb250YWluZXJFbC5jcmVhdGVEaXYoJ3Byb3BlcnRpZXMtbGlzdCcpO1xyXG4gICAgICAgIGNvbnN0IHJ1bGVzVGFibGUgPSBuZXcgUnVsZXNUYWJsZSh0aGlzLmFwcCwgdGhpcy5wbHVnaW4sdGhpcy5ydWxlc0NvbnRhaW5lciwncnVsZXMnKTtcclxuICAgICAgICBydWxlc1RhYmxlLmRpc3BsYXkoKTtcclxuICAgIH1cclxuXHJcbiAgICBhZGRSdWxlKGRpdkVsOiBIVE1MRGl2RWxlbWVudCwgcnVsZVVVSUQgPSAnJykge1xyXG4gICAgICAgIGxldCBjbUVkaXRvcjogQ29kZU1pcnJvci5FZGl0b3IgfCBudWxsID0gbnVsbDtcclxuICAgICAgICBpZiAocnVsZVVVSUQgPT09ICcnKXtcclxuICAgICAgICAgICAgcnVsZVVVSUQgPSByYW5kb21VVUlEKCkudG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MucnVsZXMucHVzaChPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1JVTEVfREVGSU5JVElPTiwge1xyXG4gICAgICAgICAgICAgICAgaWQ6IHJ1bGVVVUlELFxyXG4gICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHJ1bGU6Rm9sZGVyVGFnUnVsZURlZmluaXRpb24gPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5ydWxlcy5maW5kKHJ1bGUgPT4gcnVsZS5pZCA9PT0gcnVsZVVVSUQpO1xyXG4gICAgICAgIGlmKCFydWxlKSByZXR1cm47XHJcbiAgICAgICAgbGV0IHByb3BlcnR5TmFtZUlucHV0IDogVGV4dENvbXBvbmVudDtcclxuICAgICAgICBsZXQgc2hvd0Z1bmN0aW9uQnV0dG9uIDogQnV0dG9uQ29tcG9uZW50IHwgdW5kZWZpbmVkO1xyXG4gICAgICAgIGxldCBwcm9wZXJ0eVR5cGVEcm9wZG93biA6IERyb3Bkb3duQ29tcG9uZW50O1xyXG4gICAgICAgIGxldCBwcm9wZXJ0eURldkRyb3Bkb3duIDogRHJvcGRvd25Db21wb25lbnQgfCB1bmRlZmluZWQ7XHJcbiAgICAgICAgbGV0IGZ1bmN0aW9uUmVzdWx0VGV4dENvbXBvbmVudDogVGV4dENvbXBvbmVudCB8IHVuZGVmaW5lZDtcclxuICAgICAgICBsZXQgZnVuY3Rpb25UZXN0QnV0dG9uOiBCdXR0b25Db21wb25lbnQgfCB1bmRlZmluZWQ7XHJcbiAgICAgICAgY29uc3QgcnVsZXNEaXYgPSBkaXZFbC5jcmVhdGVEaXYoeyBjbHM6IFwib2JzaWRpYW4tZjJ0LXJ1bGVMaW5lXCIgfSk7XHJcbiAgICAgICAgcnVsZXNEaXYuc2V0QXR0cmlidXRlKCdpZCcscnVsZVVVSUQpXHJcbiAgICAgICAgY29uc3QgcnVsZU9wdGlvbnNEaXYgPSBkaXZFbC5jcmVhdGVEaXYoeyBjbHM6IFwib2JzaWRpYW4tZjJ0LXJ1bGVPcHRpb25zXCIgfSk7XHJcbiAgICAgICAgLy9ydWxlT3B0aW9uc0Rpdi5zdHlsZS5kaXNwbGF5PSAnbm9uZSc7XHJcbiAgICAgICAgLy9ydWxlT3B0aW9uc0Rpdi5zdHlsZS53aWR0aD0gJzcwMHB4J1xyXG4gICAgICAgIHJ1bGVPcHRpb25zRGl2LnN0eWxlLmhlaWdodD0gJzM1MHB4Oyc7XHJcbiAgICAgICAgcnVsZU9wdGlvbnNEaXYuc3R5bGUuYWxpZ25JdGVtcz0gJ2ZsZXgtZW5kJztcclxuICAgICAgICBpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3MudXNlVGV4dEFyZWEpIHtcclxuICAgICAgICAgICAgY29uc3QgcnVsZU9wdGlvbnNTZXR0aW5ncyA9IG5ldyBTZXR0aW5nKHJ1bGVPcHRpb25zRGl2KVxyXG4gICAgICAgICAgICAgICAgLmFkZFRleHRBcmVhKHRleHRBcmVhID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0QXJlYS5zZXRQbGFjZWhvbGRlcignZW5kZXIgdmFsaWQgSlMgQ29kZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRleHRBcmVhLmlucHV0RWwuc2V0QXR0cmlidXRlKCdzdHlsZScsIGBoZWlnaHQ6MTkwcHg7IHdpZHRoOjgwJTtgKTtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0QXJlYS5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZ1bmN0aW9uVGVzdEJ1dHRvbikgZnVuY3Rpb25UZXN0QnV0dG9uLmJ1dHRvbkVsLmFkZENsYXNzKCdtb2Qtd2FybmluZycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBydWxlLmpzQ29kZSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBJbml0aWFsaXplIENvZGVNaXJyb3IgNVxyXG4gICAgICAgICAgICBsZXQganNDb2RlID0gcnVsZS5qc0NvZGU7XHJcbiAgICAgICAgICAgIGlmIChydWxlLmNvbnRlbnQgIT09ICdzY3JpcHQnKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocnVsZS5idWlsZEluQ29kZSA9PT0gJycpIHtcclxuICAgICAgICAgICAgICAgICAgICBydWxlLmJ1aWxkSW5Db2RlID0gZ2V0UnVsZUZ1bmN0aW9uQnlJZChydWxlLmNvbnRlbnQpPy5zb3VyY2UgfHwgcnVsZUZ1bmN0aW9uc1swXS5zb3VyY2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBqc0NvZGUgPSBydWxlLmJ1aWxkSW5Db2RlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNtRWRpdG9yID0gKHdpbmRvdyBhcyBhbnkpLkNvZGVNaXJyb3IocnVsZU9wdGlvbnNEaXYsIHtcclxuICAgICAgICAgICAgICAgIHZhbHVlOiBqc0NvZGUgfHwgXCJmdW5jdGlvbiAoYXBwLCBmaWxlLCB0b29scykgeyAvLyBkbyBub3QgY2hhbmdlIHRoaXMgbGluZSFcXG5cXG4gIHJldHVybiByZXN1bHQ7IC8vIHJldHVybiB5b3UgcmVzdWx0Llxcbn1cIixcclxuICAgICAgICAgICAgICAgIG1vZGU6IFwiamF2YXNjcmlwdFwiLFxyXG4gICAgICAgICAgICAgICAgbGluZU51bWJlcnM6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAvLyB0aGVtZTogXCJvYnNpZGlhblwiLFxyXG4gICAgICAgICAgICAgICAgaW5kZW50VW5pdDogMiwgIFxyXG4gICAgICAgICAgICAgICAgbGluZVdyYXBwaW5nOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIHJlYWRPbmx5OiBmYWxzZSwgIFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgaWYgKGNtRWRpdG9yKSB7XHJcbiAgICAgICAgICAgICAgICBjbUVkaXRvci5vbignY2hhbmdlJywgKGNtRWRpdG9yOiBDb2RlTWlycm9yLkVkaXRvcikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmdW5jdGlvblRlc3RCdXR0b24pIGZ1bmN0aW9uVGVzdEJ1dHRvbi5idXR0b25FbC5hZGRDbGFzcygnbW9kLXdhcm5pbmcnKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgY21FZGl0b3Iub24oJ2JsdXInLCAoY21FZGl0b3I6IENvZGVNaXJyb3IuRWRpdG9yKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJ1bGUuY29udGVudCA9PT0gJ3NjcmlwdCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcnVsZS5qc0NvZGUgPSBjbUVkaXRvci5nZXRWYWx1ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJ1bGUuYnVpbGRJbkNvZGUgPSBjbUVkaXRvci5nZXRWYWx1ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgXHJcbiAgICAgICAgICAgIC8vIEFkZCBhIGJ1dHRvbiB0byBzYXZlIHRoZSBjb2RlXHJcbiAgICAgICAgICAgIG5ldyBTZXR0aW5nKHJ1bGVPcHRpb25zRGl2KVxyXG4gICAgICAgICAgICAgICAgLmFkZEJ1dHRvbigoYnV0dG9uKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb25UZXN0QnV0dG9uID0gYnV0dG9uO1xyXG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvblxyXG4gICAgICAgICAgICAgICAgICAgIC5zZXRXYXJuaW5nKClcclxuICAgICAgICAgICAgICAgICAgICAuc2V0QnV0dG9uVGV4dChcIlNhdmUgJiBUZXN0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY21FZGl0b3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBqc0NvZGUgPSAnJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChydWxlLmNvbnRlbnQgPT09ICdzY3JpcHQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcnVsZS5qc0NvZGUgPSBjbUVkaXRvci5nZXRWYWx1ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpzQ29kZSA9IHJ1bGUuanNDb2RlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBydWxlLmJ1aWxkSW5Db2RlID0gY21FZGl0b3IuZ2V0VmFsdWUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqc0NvZGUgPSBydWxlLmJ1aWxkSW5Db2RlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHVzZXJGdW5jdGlvbiA9ICBwYXJzZUpTQ29kZShqc0NvZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB1c2VyRnVuY3Rpb24gPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGVycm9ySGludCA9IFwiU2VlIGNvbnNvbGUgZm9yIGRldGFpbHMhXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJGdW5jdGlvbi5jb250YWlucygnVW5leHBlY3RlZCB0b2tlbicpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9ySGludCA9IFwiRGlkIHlvdSBtaXNzZWQgYSBzZW1pY29sb24gKDspP1wiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZnVuY3Rpb25SZXN1bHRUZXh0Q29tcG9uZW50KSBmdW5jdGlvblJlc3VsdFRleHRDb21wb25lbnQuc2V0VmFsdWUoYFN5bnRheCBlcnJvcjogJHt1c2VyRnVuY3Rpb259ISAke2Vycm9ySGludH1gKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJGdW5jdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmlsZXMgPSB0aGlzLmFwcC52YXVsdC5nZXRNYXJrZG93bkZpbGVzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSB1c2VyRnVuY3Rpb24odGhpcy5hcHAsIGZpbGVzWzhdLCB0aGlzLnNjcmlwdGluZ1Rvb2xzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmdW5jdGlvblJlc3VsdFRleHRDb21wb25lbnQpIGZ1bmN0aW9uUmVzdWx0VGV4dENvbXBvbmVudC5zZXRWYWx1ZShyZXN1bHQudG9TdHJpbmcoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBidXR0b24uYnV0dG9uRWwucmVtb3ZlQ2xhc3MoJ21vZC13YXJuaW5nJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmdW5jdGlvblJlc3VsdFRleHRDb21wb25lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvblJlc3VsdFRleHRDb21wb25lbnQuc2V0VmFsdWUoYFN5bnRheCBlcnJvcjogJHtlLm1lc3NhZ2V9ISBTZWUgY29uc29sZSBmb3IgZGV0YWlscyFgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJTeW50YXggZXJyb3IuIFwiLCBlLCBqc0NvZGUsIHVzZXJGdW5jdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwic3ludGF4IGVycm9yXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5hZGRUZXh0KCh0ZXh0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb25SZXN1bHRUZXh0Q29tcG9uZW50ID0gdGV4dDtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0XHJcbiAgICAgICAgICAgICAgICAgICAgLnNldFBsYWNlaG9sZGVyKCdmdW5jdGlvbiByZXN1bHQnKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zZXREaXNhYmxlZCh0cnVlKVxyXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uUmVzdWx0VGV4dENvbXBvbmVudC5pbnB1dEVsLnN0eWxlLndpZHRoID0gJzYwMHB4JztcclxuXHJcbiAgICAgICAgICAgICAgICB9KSBcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNob3dKc0Z1bmN0aW9uQnV0dG9uKHJ1bGVJZDpzdHJpbmcpIHtcclxuICAgICAgICAgICAgY29uc3Qgc2hvd0NvZGVCdXR0b246Ym9vbGVhbiA9IFxyXG4gICAgICAgICAgICAgICAgKGdldFJ1bGVGdW5jdGlvbkJ5SWQocnVsZUlkKT8uc291cmNlICE9PSAnJykgfHxcclxuICAgICAgICAgICAgICAgIChydWxlSWQgPT09ICdzY3JpcHQnKTtcclxuICAgICAgICAgICAgaWYgKCBzaG93Q29kZUJ1dHRvbiApIHtcclxuICAgICAgICAgICAgICAgIGlmIChzaG93RnVuY3Rpb25CdXR0b24pIHNob3dGdW5jdGlvbkJ1dHRvbi5idXR0b25FbC5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xyXG4gICAgICAgICAgICAgICAgaWYgKHByb3BlcnR5RGV2RHJvcGRvd24pIHByb3BlcnR5RGV2RHJvcGRvd24uc2VsZWN0RWwuc3R5bGUud2lkdGggPSBcIjM2MHB4XCI7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2hvd0Z1bmN0aW9uQnV0dG9uKSBzaG93RnVuY3Rpb25CdXR0b24uYnV0dG9uRWwuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gICAgICAgICAgICAgICAgaWYgKHByb3BlcnR5RGV2RHJvcGRvd24pIHByb3BlcnR5RGV2RHJvcGRvd24uc2VsZWN0RWwuc3R5bGUud2lkdGggPSBcIjQwMHB4XCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHJ1bGVTZXR0aW5ncyA9IG5ldyBTZXR0aW5nKHJ1bGVzRGl2KVxyXG4gICAgICAgICAgICAuYWRkQnV0dG9uKGJ1dHRvbiA9PiB7XHJcbiAgICAgICAgICAgICAgICBidXR0b24uYnV0dG9uRWwuc2V0QXR0cmlidXRlKCdzdHlsZScsJ3dpZHRoOjE1MHB4OyBqdXN0aWZ5LWNvbnRlbnQ6IGxlZnQ7ICcpO1xyXG4gICAgICAgICAgICAgICAgYnV0dG9uLnNldEJ1dHRvblRleHQocnVsZS5wcm9wZXJ0eSB8fCAnU2VsZWN0IFBhcmFtZXRlcicpXHJcbiAgICAgICAgICAgICAgICBidXR0b24ub25DbGljaygoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3IGZtVG9vbHMuU2VsZWN0UHJvcGVydHkodGhpcy5hcHAsIHRoaXMua25vd25Qcm9wZXJ0aWVzLCBydWxlLnR5cGVQcm9wZXJ0eSwgKHJlc3VsdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0Lm5hbWUgIT09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBydWxlLnR5cGVQcm9wZXJ0eSA9IHJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJ1bGUucHJvcGVydHkgPSByZXN1bHQubmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJ1bGUudHlwZSA9IHJlc3VsdC50eXBlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMua25vd25Qcm9wZXJ0aWVzLmZpbHRlcigocHJvcGVydHkpID0+IHByb3BlcnR5Lm5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhydWxlLnByb3BlcnR5LnRvTG93ZXJDYXNlKCkpKS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3Byb3BlcnR5VHlwZURyb3Bkb3duLnNldERpc2FibGVkKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBidXR0b24uc2V0QnV0dG9uVGV4dChyZXN1bHQubmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eVR5cGVEcm9wZG93bi5zZXRWYWx1ZShyZXN1bHQudHlwZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdGhpcy5kaXNwbGF5KCk7IC8vIFJlZnJlc2ggdGhlIHNldHRpbmdzIHRhYiB0byBzaG93IG5ldyB2YWx1ZVxyXG4gICAgICAgICAgICAgICAgICAgIH0pLm9wZW4oKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5hZGREcm9wZG93bigoZHJvcGRvd24pID0+IHtcclxuICAgICAgICAgICAgICAgIHByb3BlcnR5VHlwZURyb3Bkb3duID0gZHJvcGRvd247XHJcbiAgICAgICAgICAgICAgICBkcm9wZG93bi5zZWxlY3RFbC5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywnd2lkdGg6MTEwcHgnKTtcclxuICAgICAgICAgICAgICAgIGRyb3Bkb3duLmFkZE9wdGlvbihcIlwiLCBcIlNlbGVjdCBhIHR5cGVcIik7XHJcbiAgICAgICAgICAgICAgICBkcm9wZG93bi5hZGRPcHRpb24oXCJhbGlhc2VzXCIsIFwiQWxpYXNlc1wiKTtcclxuICAgICAgICAgICAgICAgIGRyb3Bkb3duLmFkZE9wdGlvbihcImNoZWNrYm94XCIsIFwiQ2hlY2tib3hcIik7XHJcbiAgICAgICAgICAgICAgICBkcm9wZG93bi5hZGRPcHRpb24oXCJkYXRlXCIsIFwiRGF0ZVwiKTtcclxuICAgICAgICAgICAgICAgIGRyb3Bkb3duLmFkZE9wdGlvbihcImRhdGV0aW1lXCIsIFwiRGF0ZSAmIFRpbWVcIik7XHJcbiAgICAgICAgICAgICAgICBkcm9wZG93bi5hZGRPcHRpb24oXCJtdWx0aXRleHRcIiwgXCJMaXN0XCIpO1xyXG4gICAgICAgICAgICAgICAgZHJvcGRvd24uYWRkT3B0aW9uKFwibnVtYmVyXCIsIFwiTnVtYmVyXCIpO1xyXG4gICAgICAgICAgICAgICAgZHJvcGRvd24uYWRkT3B0aW9uKFwidGFnc1wiLCBcIlRhZ3NcIik7XHJcbiAgICAgICAgICAgICAgICBkcm9wZG93bi5hZGRPcHRpb24oXCJ0ZXh0XCIsIFwiVGV4dFwiKTtcclxuICAgICAgICAgICAgICAgIGlmIChydWxlLnR5cGUpIGRyb3Bkb3duLnNldFZhbHVlKHJ1bGUudHlwZSk7XHJcbiAgICAgICAgICAgICAgICAvL2Ryb3Bkb3duLnNldERpc2FibGVkKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgZHJvcGRvd24ub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBydWxlLnR5cGUgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5hZGREcm9wZG93bigoZHJvcGRvd24pID0+IHtcclxuICAgICAgICAgICAgICAgIHByb3BlcnR5RGV2RHJvcGRvd24gPSBkcm9wZG93bjtcclxuICAgICAgICAgICAgICAgIGRyb3Bkb3duLnNlbGVjdEVsLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCd3aWR0aDo0MDBweCcpO1xyXG4gICAgICAgICAgICAgICAgZHJvcGRvd24uYWRkT3B0aW9uKFwiXCIsIFwiU2VsZWN0IGEgY29udGVudFwiKTtcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IHJ1bGUgb2YgcnVsZUZ1bmN0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgICAgIGRyb3Bkb3duLmFkZE9wdGlvbihydWxlLmlkLCBydWxlLmRlc2NyaXB0aW9uKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGRyb3Bkb3duLmFkZE9wdGlvbihcInNjcmlwdFwiLCBcIkphdmFTY3JpcHQgc2NyaXB0XCIpO1xyXG4gICAgICAgICAgICAgICAgZHJvcGRvd24uc2V0VmFsdWUocnVsZS5jb250ZW50KTtcclxuICAgICAgICAgICAgICAgIGRyb3Bkb3duLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBqc0NvZGUgPSAnJztcclxuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJ3NjcmlwdCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBvbGRPcmlnaW5hbENvZGUgPSBnZXRSdWxlRnVuY3Rpb25CeUlkKHJ1bGUuY29udGVudCk/LnNvdXJjZSB8fCBydWxlRnVuY3Rpb25zWzBdLnNvdXJjZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgocnVsZS5idWlsZEluQ29kZSAhPT0gJycpICYmIChydWxlLmJ1aWxkSW5Db2RlICE9PSBvbGRPcmlnaW5hbENvZGUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2hvdWxkUHJvY2VlZCA9IGF3YWl0IG5ldyBBbGVydE1vZGFsKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnT3ZlcndyaXRlIGV4aXN0aW5nIGNvZGU/JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdJIHNlZXMgbGlrZSB5b3UgaGF2ZSBjdXN0b20gY29kZSBmb3IgdGhpcyBydWxlISBTaG91bGQgdGhpcyBiZSBvdmVyd3JpdHRlbiBieSBkZWZhdWx0IGNvZGUgZm9yIHRoaXMgcGFyYW1ldGVyPycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnWWVzJywgJ05vJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLm9wZW5BbmRHZXRWYWx1ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzaG91bGRQcm9jZWVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpzQ29kZSA9IHJ1bGUuYnVpbGRJbkNvZGUgPSBnZXRSdWxlRnVuY3Rpb25CeUlkKHZhbHVlKT8uc291cmNlIHx8IHJ1bGVGdW5jdGlvbnNbMF0uc291cmNlOyAvLyBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqc0NvZGUgPSBydWxlLmJ1aWxkSW5Db2RlOyAvLyBrZWVwIHRoZSBleGlzdGluZyBjb2RlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNtRWRpdG9yPy5zZXRWYWx1ZShqc0NvZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpzQ29kZSA9IHJ1bGUuYnVpbGRJbkNvZGUgPSBnZXRSdWxlRnVuY3Rpb25CeUlkKHZhbHVlKT8uc291cmNlIHx8IHJ1bGVGdW5jdGlvbnNbMF0uc291cmNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNtRWRpdG9yPy5zZXRWYWx1ZShqc0NvZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbUVkaXRvcj8uc2V0VmFsdWUocnVsZS5qc0NvZGUhPT0nJyA/IHJ1bGUuanNDb2RlIDogcnVsZUZ1bmN0aW9uc1swXS5zb3VyY2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJ1bGUuY29udGVudCA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3J1bGVPcHRpb25zRGl2LnN0eWxlLmRpc3BsYXkgPSBgJHsocnVsZS5jb250ZW50ID09PSAnc2NyaXB0JykgPyAnZmxleCcgOiAnbm9uZSd9YDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2hvd0pzRnVuY3Rpb25CdXR0b24ocnVsZS5jb250ZW50KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBydWxlT3B0aW9uc0Rpdi5zdHlsZS5kaXNwbGF5ID0gYCR7KHJ1bGUuY29udGVudCA9PT0gJ3NjcmlwdCcpICYmIChydWxlLnNob3dDb250ZW50KSA/ICdmbGV4JyA6ICdub25lJ31gO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuYWRkQnV0dG9uKGFzeW5jIChidXR0b24pID0+IHtcclxuICAgICAgICAgICAgICAgIHNob3dGdW5jdGlvbkJ1dHRvbiA9IGJ1dHRvbjtcclxuICAgICAgICAgICAgICAgIGJ1dHRvbi5idXR0b25FbC5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywnd2lkdGg6MzBweCcpO1xyXG4gICAgICAgICAgICAgICAgYnV0dG9uLnNldEljb24oJ3NxdWFyZS1mdW5jdGlvbicpO1xyXG4gICAgICAgICAgICAgICAgYnV0dG9uLnNldENsYXNzKCdvYnNpZGlhbi1mMnQtc21hbGxCdXR0b24nKTtcclxuICAgICAgICAgICAgICAgIGJ1dHRvbi5zZXRUb29sdGlwKCdzaG93ICYgZWRpdCBjb2RlJylcclxuICAgICAgICAgICAgICAgIGJ1dHRvbi5vbkNsaWNrKGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBydWxlLnNob3dDb250ZW50ID0gIXJ1bGUuc2hvd0NvbnRlbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgcnVsZU9wdGlvbnNEaXYuc3R5bGUuZGlzcGxheSA9IGAkeyhydWxlLnNob3dDb250ZW50KSA/ICdmbGV4JyA6ICdub25lJ31gO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIHNob3dGdW5jdGlvbkJ1dHRvbi5idXR0b25FbC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5hZGRCdXR0b24oYXN5bmMgKGJ1dHRvbikgPT4ge1xyXG4gICAgICAgICAgICAgICAgYnV0dG9uLmJ1dHRvbkVsLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCd3aWR0aDozMHB4Jyk7XHJcbiAgICAgICAgICAgICAgICBidXR0b24uc2V0SWNvbignc3F1YXJlLW1pbnVzJyk7XHJcbiAgICAgICAgICAgICAgICBidXR0b24uc2V0Q2xhc3MoJ29ic2lkaWFuLWYydC1zbWFsbEJ1dHRvbicpO1xyXG4gICAgICAgICAgICAgICAgYnV0dG9uLnNldFRvb2x0aXAoJ3JlbW92ZSB0aGlzIHJ1bGUnKVxyXG4gICAgICAgICAgICAgICAgYnV0dG9uLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnJ1bGVzLnNwbGljZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5ydWxlcy5maW5kSW5kZXgodmFsdWUgPT4gdmFsdWUuaWQgPT09IHJ1bGVVVUlEKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVSdWxlKHJ1bGVzRGl2KTtcclxuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgc2hvd0pzRnVuY3Rpb25CdXR0b24ocnVsZS5jb250ZW50KTtcclxuICAgICAgICAgICAgZGl2RWwuc3R5bGUucmVtb3ZlUHJvcGVydHkoJ2JvcmRlci10b3AnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmVtb3ZlUnVsZShydWxlc0RpdjogSFRNTERpdkVsZW1lbnQpIHtcclxuICAgICAgICAgICAgcnVsZXNEaXYucmVtb3ZlKCk7XHJcbiAgICAgICAgfVxyXG5cclxufSIsICJpbXBvcnQgeyBBcHAsIE5vdGljZSwgU3VnZ2VzdE1vZGFsLCBURmlsZSB9IGZyb20gJ29ic2lkaWFuJztcclxuaW1wb3J0IHsgUHJvcGVydHlUeXBlSW5mbywgUHJvcGVydHlUeXBlfSBmcm9tICcuL3R5cGVzJztcclxuXHJcbmV4cG9ydCBjb25zdCBERUZBVUxUX1BST1BFUlRZX1RZUEVfSU5GTzogUHJvcGVydHlUeXBlSW5mbyA9IHtcclxuICAgIG5hbWUgOiBcIlwiLFxyXG4gICAgdHlwZSA6IFwiXCIsXHJcbiAgICBpc0FycmF5OiBmYWxzZSxcclxuICAgIHZhbHVlczogW10sXHJcbiAgICBzb3VyY2U6ICdyZWdpc3RlcmVkJyxcclxufTtcclxuXHJcbi8qKlxyXG4gKiBHZXRzIGFsbCBhdmFpbGFibGUgcHJvcGVydGllcyB3aXRoIHRoZWlyIHR5cGUgaW5mb3JtYXRpb25cclxuICogQHBhcmFtIGFwcCBUaGUgT2JzaWRpYW4gQXBwIGluc3RhbmNlXHJcbiAqIEByZXR1cm5zIFByb21pc2UgdGhhdCByZXNvbHZlcyB0byBhbiBhcnJheSBvZiBQcm9wZXJ0eVR5cGVJbmZvXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0QWxsUHJvcGVydGllc1dpdGhUeXBlcyhhcHA6IEFwcCk6IFByb21pc2U8UHJvcGVydHlUeXBlSW5mb1tdPiB7XHJcbiAgICAvLyBUcnkgdG8gZ2V0IHJlZ2lzdGVyZWQgcHJvcGVydGllcyAoZmFsbGJhY2sgdG8gZW1wdHkgYXJyYXkgaWYgQVBJIGNoYW5nZWQpXHJcbiAgICBjb25zdCByZWdpc3RlcmVkUHJvcHMgPSBhd2FpdCBnZXRSZWdpc3RlcmVkUHJvcGVydGllc1NhZmUoYXBwKTtcclxuICAgIFxyXG4gICAgLy8gR2V0IGFkZGl0aW9uYWwgcHJvcGVydGllcyBmb3VuZCBpbiBub3Rlc1xyXG4gICAgY29uc3QgZmlsZVByb3BzID0gYXdhaXQgZ2V0UHJvcGVydGllc0Zyb21GaWxlcyhhcHApO1xyXG4gICAgXHJcbiAgICAvLyBDb21iaW5lIHJlc3VsdHMgKGZhdm9yIHJlZ2lzdGVyZWQgcHJvcGVydGllcyB3aGVuIGR1cGxpY2F0ZXMgZXhpc3QpXHJcbiAgICBjb25zdCBjb21iaW5lZCA9IG5ldyBNYXA8c3RyaW5nLCBQcm9wZXJ0eVR5cGVJbmZvPigpO1xyXG4gICAgXHJcbiAgICAvLyBBZGQgcHJvcGVydGllcyBmb3VuZCBpbiBmaWxlcyBmaXJzdFxyXG4gICAgZmlsZVByb3BzLmZvckVhY2gocHJvcCA9PiB7XHJcbiAgICAgICAgY29tYmluZWQuc2V0KHByb3AubmFtZSwgcHJvcCk7XHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgLy8gVGhlbiBvdmVycmlkZSB3aXRoIHJlZ2lzdGVyZWQgcHJvcGVydGllcyAod2hpY2ggaGF2ZSBtb3JlIGNvbXBsZXRlIHR5cGUgaW5mbylcclxuICAgIHJlZ2lzdGVyZWRQcm9wcy5mb3JFYWNoKHByb3AgPT4ge1xyXG4gICAgICAgIGNvbWJpbmVkLnNldChwcm9wLm5hbWUsIHByb3ApO1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIHJldHVybiBBcnJheS5mcm9tKGNvbWJpbmVkLnZhbHVlcygpKS5zb3J0KChhLCBiKSA9PiBhLm5hbWUubG9jYWxlQ29tcGFyZShiLm5hbWUpKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEdldCBQcm9wZXJ0aWVzIGZyb20gTWV0YWRhdGFNYW5hZ2VyXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZ2V0UHJvcGVydGllc0Zyb21NZXRhZGF0YU1hbmFnZXIoYXBwOiBBcHApOiBQcm9wZXJ0eVR5cGVJbmZvW10ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBtZXRhZGF0YU1hbmFnZXIgPSAoYXBwIGFzIGFueSkubWV0YWRhdGFUeXBlTWFuYWdlcjtcclxuICAgICAgICBjb25zb2xlLmxvZyhcImdldCBwcm9wZXJ0aWVzOlwiLG1ldGFkYXRhTWFuYWdlcik7XHJcbiAgICAgICAgcmV0dXJuIE9iamVjdC52YWx1ZXMobWV0YWRhdGFNYW5hZ2VyLnByb3BlcnRpZXMpLm1hcCggKHZhbHVlOmFueSk6UHJvcGVydHlUeXBlSW5mbyA9PiAoe1xyXG4gICAgICAgICAgICBuYW1lOiB2YWx1ZS5uYW1lLFxyXG4gICAgICAgICAgICB0eXBlOiB2YWx1ZS50eXBlLFxyXG4gICAgICAgICAgICBjb3VudDogdmFsdWUuY291bnQsXHJcbiAgICAgICAgICAgIHNvdXJjZTogJ3JlZ2lzdGVyZWQnXHJcbiAgICAgICAgfSkpLnNvcnQoKGEsIGIpID0+IGEubmFtZS5sb2NhbGVDb21wYXJlKGIubmFtZSkpO1xyXG5cclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwiQ291bGRuJ3QgYWNjZXNzIHByb3BlcnRpZXMgZnJvbSBNZXRhZGF0YSBNYW5hZ2VyXCIsIGUpO1xyXG4gICAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxufVxyXG4vKipcclxuICogR2V0IFR5cGVzIGZyb20gTWV0YWRhdGFNYW5hZ2VyXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZ2V0VHlwZXNGcm9tTWV0YWRhdGFNYW5hZ2VyKGFwcDogQXBwKTogYW55IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgbWV0YWRhdGFNYW5hZ2VyID0gKGFwcCBhcyBhbnkpLm1ldGFkYXRhVHlwZU1hbmFnZXI7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJnZXQgdHlwZXM6XCIsbWV0YWRhdGFNYW5hZ2VyKTtcclxuICAgICAgICByZXR1cm4gT2JqZWN0LnZhbHVlcyhtZXRhZGF0YU1hbmFnZXIucmVnaXN0ZXJlZFR5cGVXaWRnZXRzKS5tYXAoICh2YWx1ZTphbnksIGluZGV4LCBhcnJheSk6UHJvcGVydHlUeXBlICA9PiAoe1xyXG4gICAgICAgICAgICB0eXBlOiB2YWx1ZS50eXBlLFxyXG4gICAgICAgICAgICBpY29uOiB2YWx1ZS5pY29uLFxyXG4gICAgICAgICAgICBqc1R5cGU6ICcnLFxyXG4gICAgICAgIH0pKS5zb3J0KChhLCBiKSA9PiBhLnR5cGUubG9jYWxlQ29tcGFyZShiLnR5cGUpKTtcclxuXHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkNvdWxkbid0IGFjY2VzcyBwcm9wZXJ0aWVzIGZyb20gTWV0YWRhdGEgTWFuYWdlclwiLCBlKTtcclxuICAgICAgICByZXR1cm4gW107XHJcbiAgICB9XHJcbn1cclxuLyoqXHJcbiAqIFNhZmUgbWV0aG9kIHRvIGdldCByZWdpc3RlcmVkIHByb3BlcnRpZXMgdGhhdCB3b24ndCB0aHJvdyBpZiBBUEkgY2hhbmdlc1xyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gZ2V0UmVnaXN0ZXJlZFByb3BlcnRpZXNTYWZlKGFwcDogQXBwKTogUHJvbWlzZTxQcm9wZXJ0eVR5cGVJbmZvW10+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgbWV0YWRhdGFNYW5hZ2VyID0gKGFwcCBhcyBhbnkpLm1ldGFkYXRhVHlwZU1hbmFnZXI7XHJcbiAgICAgICAgY29uc29sZS5sb2cobWV0YWRhdGFNYW5hZ2VyKTtcclxuICAgICAgICBpZiAoIW1ldGFkYXRhTWFuYWdlcikgcmV0dXJuIFtdO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIFRyeSBkaWZmZXJlbnQgd2F5cyB0byBnZXQgcHJvcGVydGllcyBiYXNlZCBvbiBPYnNpZGlhbiB2ZXJzaW9uXHJcbiAgICAgICAgaWYgKHR5cGVvZiBtZXRhZGF0YU1hbmFnZXIuZ2V0QWxsRnJvbnRtYXR0ZXJUeXBlcyA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAvLyBPbGRlciBPYnNpZGlhbiB2ZXJzaW9uc1xyXG4gICAgICAgICAgICBjb25zdCBmcm9udG1hdHRlclR5cGVzID0gbWV0YWRhdGFNYW5hZ2VyLmdldEFsbEZyb250bWF0dGVyVHlwZXMoKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZyb250bWF0dGVyVHlwZXMubWFwKChuYW1lOiBzdHJpbmcpID0+ICh7XHJcbiAgICAgICAgICAgICAgICBuYW1lLFxyXG4gICAgICAgICAgICAgICAgdHlwZTogJ3N0cmluZycsIC8vIERlZmF1bHQgdHlwZSBpZiB3ZSBjYW4ndCBnZXQgbW9yZSBpbmZvXHJcbiAgICAgICAgICAgICAgICBzb3VyY2U6ICdyZWdpc3RlcmVkJ1xyXG4gICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgbWV0YWRhdGFNYW5hZ2VyLmdldFByb3BlcnRpZXMgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgLy8gTmV3ZXIgT2JzaWRpYW4gdmVyc2lvbnMgbWlnaHQgdXNlIHRoaXNcclxuICAgICAgICAgICAgY29uc3QgcHJvcGVydGllcyA9IG1ldGFkYXRhTWFuYWdlci5nZXRQcm9wZXJ0aWVzKCk7XHJcbiAgICAgICAgICAgIHJldHVybiBPYmplY3QuZW50cmllcyhwcm9wZXJ0aWVzKS5tYXAoKFtuYW1lLCB0eXBlXTogW3N0cmluZywgYW55XSkgPT4gKHtcclxuICAgICAgICAgICAgICAgIG5hbWUsXHJcbiAgICAgICAgICAgICAgICB0eXBlOiB0eXBlb2YgdHlwZSA9PT0gJ3N0cmluZycgPyB0eXBlIDogJ3N0cmluZycsXHJcbiAgICAgICAgICAgICAgICBzb3VyY2U6ICdyZWdpc3RlcmVkJ1xyXG4gICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDb3VsZG4ndCBhY2Nlc3MgcmVnaXN0ZXJlZCBwcm9wZXJ0aWVzOlwiLCBlKTtcclxuICAgIH1cclxuICAgIHJldHVybiBbXTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFNjYW5zIGZpbGVzIGZvciBhZGRpdGlvbmFsIHByb3BlcnRpZXMgd2l0aCB0eXBlIGluZmVyZW5jZVxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gZ2V0UHJvcGVydGllc0Zyb21GaWxlcyhhcHA6IEFwcCk6IFByb21pc2U8UHJvcGVydHlUeXBlSW5mb1tdPiB7XHJcbiAgICBjb25zdCBmaWxlcyA9IGFwcC52YXVsdC5nZXRNYXJrZG93bkZpbGVzKCk7XHJcbiAgICBjb25zdCBwcm9wZXJ0eU1hcCA9IG5ldyBNYXA8c3RyaW5nLCB7IHZhbHVlczogU2V0PGFueT4sIHR5cGVzOiBTZXQ8c3RyaW5nPiB9PigpO1xyXG4gICAgXHJcbiAgICBmb3IgKGNvbnN0IGZpbGUgb2YgZmlsZXMuc2xpY2UoMCwgMTAwMCkpIHsgLy8gTGltaXQgdG8gMTAwMCBmaWxlcyBmb3IgcGVyZm9ybWFuY2VcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCBjYWNoZSA9IGFwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZShmaWxlKTtcclxuICAgICAgICAgICAgaWYgKGNhY2hlPy5mcm9udG1hdHRlcikge1xyXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoY2FjaGUuZnJvbnRtYXR0ZXIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ3Bvc2l0aW9uJykgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFwcm9wZXJ0eU1hcC5oYXMoa2V5KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eU1hcC5zZXQoa2V5LCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXM6IG5ldyBTZXQoKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVzOiBuZXcgU2V0KClcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb3BEYXRhID0gcHJvcGVydHlNYXAuZ2V0KGtleSkhO1xyXG4gICAgICAgICAgICAgICAgICAgIHByb3BEYXRhLnZhbHVlcy5hZGQodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHByb3BEYXRhLnR5cGVzLmFkZChpbmZlclR5cGVGcm9tVmFsdWUodmFsdWUpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIHByb2Nlc3NpbmcgZmlsZSAke2ZpbGUucGF0aH06YCwgZXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIEFycmF5LmZyb20ocHJvcGVydHlNYXAuZW50cmllcygpKS5tYXAoKFtuYW1lLCBkYXRhXSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHR5cGUgPSBkZXRlcm1pbmVQcmltYXJ5VHlwZShkYXRhLnR5cGVzKTtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBuYW1lLFxyXG4gICAgICAgICAgICB0eXBlLFxyXG4gICAgICAgICAgICBpc0FycmF5OiBkYXRhLnR5cGVzLmhhcygnYXJyYXknKSxcclxuICAgICAgICAgICAgdmFsdWVzOiBkYXRhLnZhbHVlcy5zaXplID4gMCA/IEFycmF5LmZyb20oZGF0YS52YWx1ZXMpLm1hcChTdHJpbmcpIDogdW5kZWZpbmVkLFxyXG4gICAgICAgICAgICBzb3VyY2U6ICdpbmZlcnJlZCdcclxuICAgICAgICB9O1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBEZXRlcm1pbmVzIHRoZSBwcmltYXJ5IHR5cGUgZnJvbSBhIFNldCBvZiBvYnNlcnZlZCB0eXBlc1xyXG4gKiBAcGFyYW0gdHlwZXMgU2V0IG9mIG9ic2VydmVkIHR5cGVzIGZvciBhIHByb3BlcnR5XHJcbiAqIEByZXR1cm5zIFRoZSBtb3N0IHNwZWNpZmljIHR5cGUgd2UgY2FuIGRldGVybWluZVxyXG4gKi9cclxuZnVuY3Rpb24gZGV0ZXJtaW5lUHJpbWFyeVR5cGUodHlwZXM6IFNldDxzdHJpbmc+KTogc3RyaW5nIHtcclxuICAgIC8vIEhhbmRsZSBlbXB0eSBjYXNlIChzaG91bGRuJ3QgaGFwcGVuIGJ1dCBUeXBlU2NyaXB0IHdhbnRzIHVzIHRvIGNoZWNrKVxyXG4gICAgaWYgKHR5cGVzLnNpemUgPT09IDApIHJldHVybiAnc3RyaW5nJztcclxuICAgIFxyXG4gICAgLy8gSWYgb25seSBvbmUgdHlwZSBvYnNlcnZlZCwgdXNlIHRoYXRcclxuICAgIGlmICh0eXBlcy5zaXplID09PSAxKSByZXR1cm4gdHlwZXMudmFsdWVzKCkubmV4dCgpLnZhbHVlO1xyXG4gICAgXHJcbiAgICAvLyBQcmlvcml0eSBvcmRlciBmb3IgdHlwZSByZXNvbHV0aW9uXHJcbiAgICBjb25zdCB0eXBlUHJpb3JpdHkgPSBbXHJcbiAgICAgICAgJ2RhdGUnLFxyXG4gICAgICAgICdkYXRldGltZScsXHJcbiAgICAgICAgJ2Jvb2xlYW4nLFxyXG4gICAgICAgICdudW1iZXInLFxyXG4gICAgICAgICdhcnJheScsXHJcbiAgICAgICAgJ211bHRpdGV4dCcsXHJcbiAgICAgICAgJ3N0cmluZycgLy8gZmFsbGJhY2tcclxuICAgIF07XHJcbiAgICBcclxuICAgIC8vIFJldHVybiB0aGUgaGlnaGVzdCBwcmlvcml0eSB0eXBlIHdlIGZpbmRcclxuICAgIGZvciAoY29uc3QgdHlwZSBvZiB0eXBlUHJpb3JpdHkpIHtcclxuICAgICAgICBpZiAodHlwZXMuaGFzKHR5cGUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0eXBlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gRmluYWwgZmFsbGJhY2tcclxuICAgIHJldHVybiAnc3RyaW5nJztcclxufVxyXG5cclxuLyoqXHJcbiAqIEVuaGFuY2VkIHR5cGUgaW5mZXJlbmNlIHdpdGggYmV0dGVyIGRhdGUgZGV0ZWN0aW9uXHJcbiAqL1xyXG5mdW5jdGlvbiBpbmZlclR5cGVGcm9tVmFsdWUodmFsdWU6IGFueSk6IHN0cmluZyB7XHJcbiAgICBpZiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIHJldHVybiAnbnVsbCc7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIENoZWNrIGFycmF5IGZpcnN0XHJcbiAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcclxuICAgICAgICBpZiAodmFsdWUubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAvLyBDaGVjayBhcnJheSBlbGVtZW50IHR5cGVzXHJcbiAgICAgICAgICAgIGNvbnN0IGVsZW1lbnRUeXBlcyA9IG5ldyBTZXQodmFsdWUubWFwKGluZmVyVHlwZUZyb21WYWx1ZSkpO1xyXG4gICAgICAgICAgICBpZiAoZWxlbWVudFR5cGVzLnNpemUgPT09IDEpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBgYXJyYXk8JHtlbGVtZW50VHlwZXMudmFsdWVzKCkubmV4dCgpLnZhbHVlfT5gO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAnYXJyYXknO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBDaGVjayBiYXNpYyB0eXBlc1xyXG4gICAgc3dpdGNoICh0eXBlb2YgdmFsdWUpIHtcclxuICAgICAgICBjYXNlICdib29sZWFuJzogcmV0dXJuICdib29sZWFuJztcclxuICAgICAgICBjYXNlICdudW1iZXInOiByZXR1cm4gJ251bWJlcic7XHJcbiAgICAgICAgY2FzZSAnb2JqZWN0JzogcmV0dXJuICdvYmplY3QnOyAvLyBmb3IgZnV0dXJlIGV4cGFuc2lvblxyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBNdXN0IGJlIHN0cmluZyBhdCB0aGlzIHBvaW50IC0gY2hlY2sgZm9yIHNwZWNpYWwgc3RyaW5nIGZvcm1hdHNcclxuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgLy8gSVNPIERhdGUgKFlZWVktTU0tREQpXHJcbiAgICAgICAgaWYgKC9eXFxkezR9LVxcZHsyfS1cXGR7Mn0kLy50ZXN0KHZhbHVlKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJ2RhdGUnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICAvLyBJU08gRGF0ZVRpbWVcclxuICAgICAgICBpZiAoL15cXGR7NH0tXFxkezJ9LVxcZHsyfVtUIF1cXGR7Mn06XFxkezJ9OlxcZHsyfS8udGVzdCh2YWx1ZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuICdkYXRldGltZSc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIE9ic2lkaWFuIHRhZ1xyXG4gICAgICAgIGlmICh2YWx1ZS5zdGFydHNXaXRoKCcjJykpIHtcclxuICAgICAgICAgICAgcmV0dXJuICd0YWcnO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gRGVmYXVsdCB0byBzdHJpbmdcclxuICAgIHJldHVybiAnc3RyaW5nJztcclxufVxyXG5cclxuZnVuY3Rpb24gdmFsdWUodmFsdWU6IHVua25vd24sIGluZGV4OiBudW1iZXIsIGFycmF5OiB1bmtub3duW10pOiB1bmtub3duIHtcclxuICAgIHRocm93IG5ldyBFcnJvcignRnVuY3Rpb24gbm90IGltcGxlbWVudGVkLicpO1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgU2VsZWN0UHJvcGVydHkgZXh0ZW5kcyBTdWdnZXN0TW9kYWw8UHJvcGVydHlUeXBlSW5mbz4ge1xyXG4gICAgcHJpdmF0ZSBvblN1Ym1pdDogKHJlc3VsdDogUHJvcGVydHlUeXBlSW5mbykgPT4gdm9pZDtcclxuICAgIHByb3BlcnR5OiBQcm9wZXJ0eVR5cGVJbmZvIHwgdW5kZWZpbmVkO1xyXG4gICAga25vd25Qcm9wZXJ0aWVzOlByb3BlcnR5VHlwZUluZm9bXTtcclxuICAgIHR5cGVkVGV4dDogc3RyaW5nO1xyXG4gICAgbmV3VGV4dEZsYWc6IEJvb2xlYW47XHJcblxyXG4gICAgY29uc3RydWN0b3IgKGFwcDpBcHAsIGtub3duUHJvcGVydGllczpQcm9wZXJ0eVR5cGVJbmZvW10sIHByb3BlcnR5OiBQcm9wZXJ0eVR5cGVJbmZvIHwgdW5kZWZpbmVkLCBvblN1Ym1pdDogKHJlc3VsdDogUHJvcGVydHlUeXBlSW5mbykgPT4gdm9pZCkge1xyXG4gICAgICAgIHN1cGVyKGFwcCk7XHJcbiAgICAgICAgdGhpcy5vblN1Ym1pdCA9IG9uU3VibWl0O1xyXG4gICAgICAgIHRoaXMucHJvcGVydHkgPSBwcm9wZXJ0eTtcclxuICAgICAgICB0aGlzLnR5cGVkVGV4dCA9ICcnO1xyXG4gICAgICAgIHRoaXMubmV3VGV4dEZsYWcgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMua25vd25Qcm9wZXJ0aWVzID0ga25vd25Qcm9wZXJ0aWVzO1xyXG4gICAgfVxyXG4gICAgLy8gUmV0dXJucyBhbGwgYXZhaWxhYmxlIHN1Z2dlc3Rpb25zLlxyXG4gICAgZ2V0U3VnZ2VzdGlvbnMocXVlcnk6IHN0cmluZyk6IFByb3BlcnR5VHlwZUluZm9bXSB7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5rbm93blByb3BlcnRpZXMuZmlsdGVyKChwcm9wZXJ0eSkgPT4gcHJvcGVydHkubmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHF1ZXJ5LnRvTG93ZXJDYXNlKCkpKTtcclxuICAgICAgICB0aGlzLm5ld1RleHRGbGFnID0gKHJlc3VsdC5sZW5ndGggPT09IDApO1xyXG4gICAgICAgIHRoaXMudHlwZWRUZXh0ID0gcXVlcnk7XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuICAgIG9uT3BlbigpOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy5wcm9wZXJ0eSkge1xyXG4gICAgICAgICAgICB0aGlzLnNldFBsYWNlaG9sZGVyKHRoaXMucHJvcGVydHkubmFtZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5zZXRQbGFjZWhvbGRlcignbm8gcHJvcGVydHkgc2VsZWN0ZWQhJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2V0VGl0bGUoJ1NlbGVjdCBvciB0eXBlIGEgcHJvcGVydHkgbmFtZScpO1xyXG4gICAgfVxyXG4gICAgLy8gUmVuZGVycyBlYWNoIHN1Z2dlc3Rpb24gaXRlbS5cclxuICAgIHJlbmRlclN1Z2dlc3Rpb24ocHJvcGVydHk6IFByb3BlcnR5VHlwZUluZm8sIGVsOiBIVE1MRWxlbWVudCkge1xyXG4gICAgICBlbC5jcmVhdGVFbCgnZGl2JywgeyB0ZXh0OiBwcm9wZXJ0eS5uYW1lIH0pO1xyXG4gICAgICBlbC5jcmVhdGVFbCgnc21hbGwnLCB7IHRleHQ6IHByb3BlcnR5LnR5cGUgfSk7XHJcbiAgICB9XHJcbiAgICBvbkNsb3NlKCk6IHZvaWQge1xyXG4gICAgICAgIGlmICh0aGlzLm5ld1RleHRGbGFnICYmIHRoaXMucHJvcGVydHkpIHtcclxuICAgICAgICAgICAgdGhpcy5wcm9wZXJ0eS5uYW1lID0gdGhpcy50eXBlZFRleHQ7XHJcbiAgICAgICAgICAgIHRoaXMucHJvcGVydHkudHlwZSA9ICd0ZXh0JztcclxuICAgICAgICAgICAgdGhpcy5vblN1Ym1pdCh0aGlzLnByb3BlcnR5KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUGVyZm9ybSBhY3Rpb24gb24gdGhlIHNlbGVjdGVkIHN1Z2dlc3Rpb24uXHJcbiAgICBvbkNob29zZVN1Z2dlc3Rpb24ocHJvcGVydHk6IFByb3BlcnR5VHlwZUluZm8sIGV2dDogTW91c2VFdmVudCB8IEtleWJvYXJkRXZlbnQpIHtcclxuICAgICAgICBpZiAoZXZ0IGluc3RhbmNlb2YgS2V5Ym9hcmRFdmVudCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhga2V5Ym9hcmQgJHt0aGlzLnR5cGVkVGV4dH0gJHt0aGlzLm5ld1RleHRGbGFnfWAsIHByb3BlcnR5KVxyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zb2xlLmxvZygnb25DaG9vc2VTdWdnZXN0aW9uJywgZXZ0KVxyXG4gICAgICAgIHRoaXMub25TdWJtaXQocHJvcGVydHkpO1xyXG4gICAgfVxyXG4gIH1cclxuIiwgImltcG9ydCB7IEZvbGRlclRhZ1NldHRpbmdzIH0gZnJvbSAnLi90eXBlcydcclxuLyoqXHJcbiAqIFBhcnNlIGEgSmF2YVNjcmlwdCBmdW5jdGlvbiwgY2xlYW4gY29tbWVudHMgYW5kIGRlZmluZSB0aGUgZnVuY3Rpb24gXHJcbiAqXHJcbiAqIEBleHBvcnRcclxuICogQHBhcmFtIHtzdHJpbmd9IGpzQ29kZVxyXG4gKiBAcmV0dXJuIHsqfSAgeyhGdW5jdGlvbiB8IHN0cmluZyB8IHVuZGVmaW5lZCl9XHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VKU0NvZGUoanNDb2RlOnN0cmluZyk6IEZ1bmN0aW9uIHwgc3RyaW5nIHwgdW5kZWZpbmVkIHtcclxuICAgIGZ1bmN0aW9uIHBhcnNlRnVuY3Rpb24gKGpzQ29kZTogc3RyaW5nKTogRnVuY3Rpb24gfCBzdHJpbmcgfCB1bmRlZmluZWQge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAganNDb2RlID0gY2xlYW5Db2RlU3RyaW5nKGpzQ29kZSk7XHJcbiAgICAgICAgdmFyIGZ1bmNSZWcgPSAvZnVuY3Rpb24gKlxcKChbXigpXSopXFwpWyBcXG5cXHRdKnsoLiopfS9nbWk7XHJcbiAgICAgICAgdmFyIG1hdGNoID0gZnVuY1JlZy5leGVjKGpzQ29kZS5yZXBsYWNlKC9cXG4vZywgJyAnKSk7XHJcbiAgICAgICAgaWYgKCFtYXRjaCkgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgICB2YXIgYXJncyA9IG1hdGNoWzFdLnNwbGl0KCcsJyk7XHJcbiAgICAgICAgYXJncy5wdXNoKG1hdGNoWzJdKTtcclxuICAgICAgICByZXR1cm4gbmV3IEZ1bmN0aW9uKC4uLmFyZ3MpO1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ2Vycm9yIHBhcnNpbmcgSlMgZnVuY3Rpb24hJywgZXJyb3IpO1xyXG4gICAgICAgICAgICByZXR1cm4gZXJyb3IubWVzc2FnZTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIHBhcnNlRnVuY3Rpb24oanNDb2RlKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIENsZWFucyBhIEphdmFTY3JpcHQvVHlwZVNjcmlwdCBjb2RlIHN0cmluZyBieSByZW1vdmluZyBjb21tZW50cy5cclxuICogVGhpcyBmdW5jdGlvbiBoYW5kbGVzIGJvdGggc2luZ2xlLWxpbmUgY29tbWVudHMgKGAvLyAuLi5gKSBhbmRcclxuICogbXVsdGktbGluZSBjb21tZW50cyAoYC8qIC4uLiAqXFwvYCkuIEl0IGFsc28gY29ycmVjdGx5IGhhbmRsZXNcclxuICogY29tbWVudHMgd2l0aGluIHN0cmluZ3MgYW5kIHJlZ3VsYXIgZXhwcmVzc2lvbnMuXHJcbiAqXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBjb2RlU3RyaW5nIFRoZSBjb2RlIHN0cmluZyB0byBjbGVhbi5cclxuICogQHJldHVybnMge3N0cmluZ30gVGhlIGNsZWFuZWQgY29kZSBzdHJpbmcgd2l0aCBjb21tZW50cyByZW1vdmVkLlxyXG4gKiBAdGhyb3dzIHtUeXBlRXJyb3J9IElmIHRoZSBpbnB1dCBpcyBub3QgYSBzdHJpbmcuXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gY2xlYW5Db2RlU3RyaW5nKGNvZGVTdHJpbmc6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICAvLyBFbnN1cmUgdGhlIGlucHV0IGlzIGEgc3RyaW5nXHJcbiAgICBpZiAodHlwZW9mIGNvZGVTdHJpbmcgIT09ICdzdHJpbmcnKSB7XHJcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0lucHV0IG11c3QgYmUgYSBzdHJpbmcuJyk7XHJcbiAgICB9XHJcbiAgXHJcbiAgICAvLyBGbGFncyB0byB0cmFjayB0aGUgY3VycmVudCBwYXJzaW5nIGNvbnRleHRcclxuICAgIGxldCBpbk11bHRpTGluZUNvbW1lbnQ6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIGxldCBpblNpbmdsZUxpbmVDb21tZW50OiBib29sZWFuID0gZmFsc2U7XHJcbiAgICBsZXQgaW5TdHJpbmc6ICdcIicgfCBcIidcIiB8IG51bGwgPSBudWxsOyAvLyBUcmFja3MgaWYgaW5zaWRlIHNpbmdsZSBvciBkb3VibGUgcXVvdGVzXHJcbiAgICBsZXQgaW5SZWdFeHA6IGJvb2xlYW4gPSBmYWxzZTsgLy8gVHJhY2tzIGlmIGluc2lkZSBhIHJlZ3VsYXIgZXhwcmVzc2lvbiBsaXRlcmFsXHJcbiAgXHJcbiAgICAvLyBUaGUgcmVzdWx0aW5nIHN0cmluZyB3aXRob3V0IGNvbW1lbnRzXHJcbiAgICBsZXQgY2xlYW5lZENvZGU6IHN0cmluZyA9ICcnO1xyXG4gICAgLy8gQ3VycmVudCBpbmRleCBpbiB0aGUgaW5wdXQgc3RyaW5nXHJcbiAgICBsZXQgaTogbnVtYmVyID0gMDtcclxuICBcclxuICAgIC8vIEl0ZXJhdGUgdGhyb3VnaCB0aGUgaW5wdXQgc3RyaW5nIGNoYXJhY3RlciBieSBjaGFyYWN0ZXJcclxuICAgIHdoaWxlIChpIDwgY29kZVN0cmluZy5sZW5ndGgpIHtcclxuICAgICAgY29uc3QgY2hhcjogc3RyaW5nID0gY29kZVN0cmluZ1tpXTtcclxuICAgICAgY29uc3QgbmV4dENoYXI6IHN0cmluZyB8IHVuZGVmaW5lZCA9IGNvZGVTdHJpbmdbaSArIDFdOyAvLyBVc2UgdW5kZWZpbmVkIGZvciBwb3RlbnRpYWwgZW5kIG9mIHN0cmluZ1xyXG4gIFxyXG4gICAgICAvLyAtLS0gU3RhdGU6IEluc2lkZSBhIG11bHRpLWxpbmUgY29tbWVudCAtLS1cclxuICAgICAgaWYgKGluTXVsdGlMaW5lQ29tbWVudCkge1xyXG4gICAgICAgIC8vIENoZWNrIGZvciB0aGUgZW5kIG9mIHRoZSBtdWx0aS1saW5lIGNvbW1lbnQgJyovJ1xyXG4gICAgICAgIGlmIChjaGFyID09PSAnKicgJiYgbmV4dENoYXIgPT09ICcvJykge1xyXG4gICAgICAgICAgaW5NdWx0aUxpbmVDb21tZW50ID0gZmFsc2U7XHJcbiAgICAgICAgICBpICs9IDI7IC8vIFNraXAgdGhlICcqLydcclxuICAgICAgICAgIGNvbnRpbnVlOyAvLyBNb3ZlIHRvIHRoZSBuZXh0IGl0ZXJhdGlvblxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBpKys7IC8vIFNraXAgdGhlIGNoYXJhY3RlciBpbnNpZGUgdGhlIGNvbW1lbnRcclxuICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gIFxyXG4gICAgICAvLyAtLS0gU3RhdGU6IEluc2lkZSBhIHNpbmdsZS1saW5lIGNvbW1lbnQgLS0tXHJcbiAgICAgIGlmIChpblNpbmdsZUxpbmVDb21tZW50KSB7XHJcbiAgICAgICAgLy8gQ2hlY2sgZm9yIHRoZSBlbmQgb2YgdGhlIGxpbmUgKG5ld2xpbmUgb3IgY2FycmlhZ2UgcmV0dXJuKVxyXG4gICAgICAgIGlmIChjaGFyID09PSAnXFxuJyB8fCBjaGFyID09PSAnXFxyJykge1xyXG4gICAgICAgICAgaW5TaW5nbGVMaW5lQ29tbWVudCA9IGZhbHNlO1xyXG4gICAgICAgICAgY2xlYW5lZENvZGUgKz0gY2hhcjsgLy8gS2VlcCB0aGUgbmV3bGluZSBjaGFyYWN0ZXJcclxuICAgICAgICAgIGkrKztcclxuICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBpKys7IC8vIFNraXAgdGhlIGNoYXJhY3RlciBpbnNpZGUgdGhlIGNvbW1lbnRcclxuICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gIFxyXG4gICAgICAvLyAtLS0gU3RhdGU6IEluc2lkZSBhIHN0cmluZyBsaXRlcmFsIC0tLVxyXG4gICAgICBpZiAoaW5TdHJpbmcpIHtcclxuICAgICAgICAvLyBDaGVjayBpZiB0aGUgY3VycmVudCBjaGFyYWN0ZXIgY2xvc2VzIHRoZSBzdHJpbmdcclxuICAgICAgICBpZiAoY2hhciA9PT0gaW5TdHJpbmcpIHtcclxuICAgICAgICAgIGluU3RyaW5nID0gbnVsbDsgLy8gRXhpdCBzdHJpbmcgc3RhdGVcclxuICAgICAgICB9IGVsc2UgaWYgKGNoYXIgPT09ICdcXFxcJykge1xyXG4gICAgICAgICAgLy8gSGFuZGxlIGVzY2FwZWQgY2hhcmFjdGVycyB3aXRoaW4gc3RyaW5ncyAoZS5nLiwgXCJpdFxcJ3NcIilcclxuICAgICAgICAgIGNsZWFuZWRDb2RlICs9IGNoYXI7IC8vIEFkZCB0aGUgYmFja3NsYXNoXHJcbiAgICAgICAgICBpKys7IC8vIE1vdmUgdG8gdGhlIG5leHQgY2hhcmFjdGVyICh0aGUgZXNjYXBlZCBvbmUpXHJcbiAgICAgICAgICBpZiAoaSA8IGNvZGVTdHJpbmcubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICBjbGVhbmVkQ29kZSArPSBjb2RlU3RyaW5nW2ldOyAvLyBBZGQgdGhlIGVzY2FwZWQgY2hhcmFjdGVyXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBpKys7XHJcbiAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gQWRkIHRoZSBjaGFyYWN0ZXIgdG8gdGhlIHJlc3VsdCBpZiBpdCdzIHBhcnQgb2YgdGhlIHN0cmluZ1xyXG4gICAgICAgIGNsZWFuZWRDb2RlICs9IGNoYXI7XHJcbiAgICAgICAgaSsrO1xyXG4gICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICB9XHJcbiAgXHJcbiAgICAgICAvLyAtLS0gU3RhdGU6IEluc2lkZSBhIHJlZ3VsYXIgZXhwcmVzc2lvbiBsaXRlcmFsIC0tLVxyXG4gICAgICAgaWYgKGluUmVnRXhwKSB7XHJcbiAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgY3VycmVudCBjaGFyYWN0ZXIgY2xvc2VzIHRoZSByZWdleCBsaXRlcmFsXHJcbiAgICAgICAgICAvLyBOb3RlOiBUaGlzIGRvZXNuJ3QgaGFuZGxlIHJlZ2V4IGZsYWdzIHBlcmZlY3RseSBidXQgY292ZXJzIGJhc2ljIGNhc2VzLlxyXG4gICAgICAgICAgaWYgKGNoYXIgPT09ICcvJykge1xyXG4gICAgICAgICAgICAgIGluUmVnRXhwID0gZmFsc2U7IC8vIEV4aXQgcmVnZXggc3RhdGVcclxuICAgICAgICAgIH0gZWxzZSBpZiAoY2hhciA9PT0gJ1xcXFwnKSB7XHJcbiAgICAgICAgICAgICAgLy8gSGFuZGxlIGVzY2FwZWQgY2hhcmFjdGVycyB3aXRoaW4gcmVnZXggKGUuZy4sIC9cXC8vKVxyXG4gICAgICAgICAgICAgIGNsZWFuZWRDb2RlICs9IGNoYXI7IC8vIEFkZCB0aGUgYmFja3NsYXNoXHJcbiAgICAgICAgICAgICAgaSsrOyAvLyBNb3ZlIHRvIHRoZSBuZXh0IGNoYXJhY3RlclxyXG4gICAgICAgICAgICAgIGlmIChpIDwgY29kZVN0cmluZy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICBjbGVhbmVkQ29kZSArPSBjb2RlU3RyaW5nW2ldOyAvLyBBZGQgdGhlIGVzY2FwZWQgY2hhcmFjdGVyXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIC8vIEFkZCB0aGUgY2hhcmFjdGVyIHRvIHRoZSByZXN1bHQgaWYgaXQncyBwYXJ0IG9mIHRoZSByZWdleFxyXG4gICAgICAgICAgY2xlYW5lZENvZGUgKz0gY2hhcjtcclxuICAgICAgICAgIGkrKztcclxuICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgfVxyXG4gIFxyXG4gICAgICAvLyAtLS0gRGVmYXVsdCBTdGF0ZTogQ2hlY2sgZm9yIGNvbW1lbnQvc3RyaW5nL3JlZ2V4IHN0YXJ0cyAtLS1cclxuICBcclxuICAgICAgLy8gQ2hlY2sgZm9yIHRoZSBzdGFydCBvZiBhIG11bHRpLWxpbmUgY29tbWVudCAnLyonXHJcbiAgICAgIGlmIChjaGFyID09PSAnLycgJiYgbmV4dENoYXIgPT09ICcqJykge1xyXG4gICAgICAgIGluTXVsdGlMaW5lQ29tbWVudCA9IHRydWU7XHJcbiAgICAgICAgaSArPSAyOyAvLyBTa2lwIHRoZSAnLyonXHJcbiAgICAgICAgY29udGludWU7XHJcbiAgICAgIH1cclxuICBcclxuICAgICAgLy8gQ2hlY2sgZm9yIHRoZSBzdGFydCBvZiBhIHNpbmdsZS1saW5lIGNvbW1lbnQgJy8vJ1xyXG4gICAgICBpZiAoY2hhciA9PT0gJy8nICYmIG5leHRDaGFyID09PSAnLycpIHtcclxuICAgICAgICBpblNpbmdsZUxpbmVDb21tZW50ID0gdHJ1ZTtcclxuICAgICAgICBpICs9IDI7IC8vIFNraXAgdGhlICcvLydcclxuICAgICAgICBjb250aW51ZTtcclxuICAgICAgfVxyXG4gIFxyXG4gICAgICAvLyBDaGVjayBmb3IgdGhlIHN0YXJ0IG9mIGEgc3RyaW5nIGxpdGVyYWwgKCcgb3IgXCIpXHJcbiAgICAgIGlmIChjaGFyID09PSAnXCInIHx8IGNoYXIgPT09IFwiJ1wiKSB7XHJcbiAgICAgICAgaW5TdHJpbmcgPSBjaGFyOyAvLyBFbnRlciBzdHJpbmcgc3RhdGUsIHJlbWVtYmVyaW5nIHRoZSBxdW90ZSB0eXBlXHJcbiAgICAgICAgY2xlYW5lZENvZGUgKz0gY2hhcjsgLy8gQWRkIHRoZSBvcGVuaW5nIHF1b3RlXHJcbiAgICAgICAgaSsrO1xyXG4gICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICB9XHJcbiAgXHJcbiAgICAgIC8vIENoZWNrIGZvciB0aGUgc3RhcnQgb2YgYSByZWd1bGFyIGV4cHJlc3Npb24gbGl0ZXJhbCAnLydcclxuICAgICAgLy8gQmFzaWMgY2hlY2s6IGFzc3VtZXMgJy8nIGluZGljYXRlcyBhIHJlZ2V4IHN0YXJ0IGlmIG5vdCBwcmVjZWRlZCBieSBvcGVyYXRvcnMva2V5d29yZHNcclxuICAgICAgLy8gQSBtb3JlIHJvYnVzdCBzb2x1dGlvbiB3b3VsZCByZXF1aXJlIG1vcmUgY29tcGxleCBwYXJzaW5nLlxyXG4gICAgICBpZiAoY2hhciA9PT0gJy8nKSB7XHJcbiAgICAgICAgICAvLyBWZXJ5IGJhc2ljIGNoZWNrIHRvIGRpZmZlcmVudGlhdGUgZGl2aXNpb24gZnJvbSByZWdleCBzdGFydC5cclxuICAgICAgICAgIC8vIFRoaXMgbWlnaHQgbmVlZCByZWZpbmVtZW50IGZvciBjb21wbGV4IGNhc2VzLlxyXG4gICAgICAgICAgY29uc3QgcHJldk1lYW5pbmdmdWxDaGFyID0gY2xlYW5lZENvZGUudHJpbSgpLnNsaWNlKC0xKTtcclxuICAgICAgICAgIGlmIChwcmV2TWVhbmluZ2Z1bENoYXIgPT09ICcnIHx8IFsnKCcsICcsJywgJz0nLCAnOicsICdbJywgJyEnLCAnJicsICd8JywgJz8nLCAneycsICc7JywgJ1xcbicsICdcXHInXS5pbmNsdWRlcyhwcmV2TWVhbmluZ2Z1bENoYXIpKSB7XHJcbiAgICAgICAgICAgICAgaW5SZWdFeHAgPSB0cnVlO1xyXG4gICAgICAgICAgICAgIGNsZWFuZWRDb2RlICs9IGNoYXI7XHJcbiAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgXHJcbiAgICAgIC8vIElmIG5vbmUgb2YgdGhlIGFib3ZlLCBpdCdzIHJlZ3VsYXIgY29kZTsgYWRkIGl0IHRvIHRoZSByZXN1bHRcclxuICAgICAgY2xlYW5lZENvZGUgKz0gY2hhcjtcclxuICAgICAgaSsrO1xyXG4gICAgfVxyXG4gIFxyXG4gICAgLy8gUmV0dXJuIHRoZSBhY2N1bXVsYXRlZCBjbGVhbmVkIGNvZGUgc3RyaW5nXHJcbiAgICByZXR1cm4gY2xlYW5lZENvZGU7XHJcbiAgfVxyXG5cclxuXHJcbiAgZXhwb3J0IGNsYXNzIFNjcmlwdGluZ1Rvb2xzIHtcclxuICAgIHNldHRpbmdzOiBGb2xkZXJUYWdTZXR0aW5ncyB8IHVuZGVmaW5lZDtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihzZXR0aW5ncz86IEZvbGRlclRhZ1NldHRpbmdzIHwgdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgdGhpcy5zZXR0aW5ncyA9IHNldHRpbmdzO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBDaGVjayBpZiBhIHN0cmluZyBjb21wbGllcyB3aXRoIElTTyBTdGFuZGFyZFxyXG4gICAgICogXHJcbiAgICAgKiBAcGFyYW0gc3RyIEFueSBzdHJpbmdcclxuICAgICAqIEBwYXJhbSBvcHRpb25zIE9wdGlvbnMgdG8gbG9vayBmb3JcclxuICAgICAqIEByZXR1cm5zIFxyXG4gICAgICovXHJcbiAgICBpc0lTT1N0cmluZyhcclxuICAgICAgc3RyOiBzdHJpbmcsXHJcbiAgICAgIG9wdGlvbnM6IHtcclxuICAgICAgICB3aXRoTWlsbGlzZWNvbmRzPzogYm9vbGVhbjtcclxuICAgICAgICB3aXRoVGltZXpvbmU/OiBib29sZWFuO1xyXG4gICAgICAgIHdpdGhUaW1lPzogYm9vbGVhbjtcclxuICAgICAgICB3aXRoRGF0ZT86IGJvb2xlYW47IFxyXG4gICAgICB9ID0ge31cclxuICAgICk6IGJvb2xlYW4ge1xyXG4gICAgICBjb25zdCB7XHJcbiAgICAgICAgd2l0aE1pbGxpc2Vjb25kcyA9IGZhbHNlLFxyXG4gICAgICAgIHdpdGhUaW1lem9uZSA9IGZhbHNlLFxyXG4gICAgICAgIHdpdGhUaW1lID0gdHJ1ZSxcclxuICAgICAgICB3aXRoRGF0ZSA9IHRydWUsIFxyXG4gICAgICB9ID0gb3B0aW9ucztcclxuICAgIFxyXG4gICAgICBsZXQgZGF0ZVJlZ2V4U3RyID0gXCJeKD86XFxcXGR7NH0tKD86MFsxLTldfDFbMC0yXSktKD86MFsxLTldfFsxMl1cXFxcZHwzWzAxXSkpXCI7XHJcbiAgICAgIGxldCB0aW1lUmVnZXhTdHIgPSBcIig/OlQoPzpbMDFdXFxcXGR8MlswLTNdKTpbMC01XVxcXFxkOlswLTVdXFxcXGRcIjtcclxuICAgIFxyXG4gICAgICBpZiAod2l0aE1pbGxpc2Vjb25kcykge1xyXG4gICAgICAgIHRpbWVSZWdleFN0ciArPSBcIlxcXFwuXFxcXGR7M31cIjtcclxuICAgICAgfVxyXG4gICAgXHJcbiAgICAgIGlmICh3aXRoVGltZXpvbmUpIHtcclxuICAgICAgICB0aW1lUmVnZXhTdHIgKz0gXCIoPzpafFsrLV0oPzpbMDFdXFxcXGR8MlswLTNdKTpbMC01XVxcXFxkKT8pP1wiO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRpbWVSZWdleFN0ciArPSBcIik/XCI7XHJcbiAgICAgIH1cclxuICAgIFxyXG4gICAgICBsZXQgcmVnZXhTdHIgPSBcIlwiO1xyXG4gICAgICBpZiAod2l0aERhdGUgJiYgd2l0aFRpbWUpIHtcclxuICAgICAgICByZWdleFN0ciA9IGAke2RhdGVSZWdleFN0cn0ke3RpbWVSZWdleFN0cn0kYDtcclxuICAgICAgfSBlbHNlIGlmICh3aXRoRGF0ZSkge1xyXG4gICAgICAgIHJlZ2V4U3RyID0gYCR7ZGF0ZVJlZ2V4U3RyfSRgO1xyXG4gICAgICB9IGVsc2UgaWYgKHdpdGhUaW1lKSB7XHJcbiAgICAgICAgcmVnZXhTdHIgPSBgXiR7dGltZVJlZ2V4U3RyLnNsaWNlKDQpfSRgOyBcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7IFxyXG4gICAgICB9XHJcbiAgICBcclxuICAgICAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKHJlZ2V4U3RyKTtcclxuICAgICAgcmV0dXJuIHJlZ2V4LnRlc3Qoc3RyKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogVHJ5IHRvIGNvbnZlcnQgQW55IFR5cGVzIHRvIGEgc3BlY2lmaWMgVHlwZVxyXG4gICAgICogQHBhcmFtIGlucHV0IFxyXG4gICAgICogQHBhcmFtIHR5cGVTdHJpbmcgJ3N0cmluZycgfCAnbnVtYmVyJyB8ICdib29sZWFuJyB8ICdzdHJpbmdbXSdcclxuICAgICAqIEByZXR1cm5zIFxyXG4gICAgICovXHJcbiAgICB0cnlDb252ZXJ0KGlucHV0OiBhbnksIHR5cGVTdHJpbmc6ICdzdHJpbmcnIHwgJ251bWJlcicgfCAnYm9vbGVhbicgfCAnc3RyaW5nW10nKTogc3RyaW5nIHwgbnVtYmVyIHwgYm9vbGVhbiB8IHN0cmluZ1tdIHwgdW5kZWZpbmVkIHtcclxuICAgICAgc3dpdGNoICh0eXBlU3RyaW5nKSB7XHJcbiAgICAgICAgY2FzZSAnc3RyaW5nJzpcclxuICAgICAgICAgIGlmICh0eXBlb2YgaW5wdXQgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBpbnB1dDtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICAgICAgY2FzZSAnbnVtYmVyJzpcclxuICAgICAgICAgIGNvbnN0IG51bSA9IE51bWJlcihpbnB1dCk7XHJcbiAgICAgICAgICBpZiAoIWlzTmFOKG51bSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICAgICAgY2FzZSAnYm9vbGVhbic6XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgaW5wdXQgPT09ICdib29sZWFuJykge1xyXG4gICAgICAgICAgICAgIHJldHVybiBpbnB1dDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodHlwZW9mIGlucHV0ID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgIGNvbnN0IGxvd2VyVmFsdWUgPSBpbnB1dC50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgICAgICAgIGlmIChsb3dlclZhbHVlID09PSAndHJ1ZScpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBpZiAobG93ZXJWYWx1ZSA9PT0gJ2ZhbHNlJykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodHlwZW9mIGlucHV0ID09PSAnbnVtYmVyJykge1xyXG4gICAgICAgICAgICAgIGlmIChpbnB1dCA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIGlmIChpbnB1dCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICAgIGNhc2UgJ3N0cmluZ1tdJzpcclxuICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGlucHV0KSAmJiBpbnB1dC5ldmVyeShpdGVtID0+IHR5cGVvZiBpdGVtID09PSAnc3RyaW5nJykpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGlucHV0O1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBmb3JtYXRUb1lBTUxTYXZlU3RyaW5nKHRleHQ6c3RyaW5nLCByZXBsYWNlQnk6c3RyaW5nIHwgdW5kZWZpbmVkID0gdW5kZWZpbmVkKTpzdHJpbmcge1xyXG4gICAgICBsZXQgcmVwbGFjZVN0cmluZyA9ICctJztcclxuICAgICAgaWYgKCFyZXBsYWNlQnkgJiYgdGhpcy5zZXR0aW5ncykge1xyXG4gICAgICAgIHJlcGxhY2VTdHJpbmcgPSB0aGlzLnNldHRpbmdzLnNwZWNpYWxDaGFyUmVwbGFjZW1lbnQgfHwgJy0nO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGlmIChyZXBsYWNlQnkpIHJlcGxhY2VTdHJpbmcgPSByZXBsYWNlQnk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHRleHQucmVwbGFjZSgvW15hLXpBLVowLTlcXC1fXFwvXHUwMEU0XHUwMEY2XHUwMEZDXHUwMERGXHUwMEM0XHUwMEQ2XHUwMERDXHUwMEUxXHUwMEU5XHUwMEVEXHUwMEYzXHUwMEZBXHUwMEZEXHUwMEMxXHUwMEM5XHUwMENEXHUwMEQzXHUwMERBXHUwMEREXHUwMEUwXHUwMEU4XHUwMEVDXHUwMEYyXHUwMEY5XHUwMEMwXHUwMEM4XHUwMENDXHUwMEQyXHUwMEQ5XHUwMEUyXHUwMEVBXHUwMEVFXHUwMEY0XHUwMEZCXHUwMEMyXHUwMENBXHUwMENFXHUwMEQ0XHUwMERCXHUwMEUzXHUwMEYxXHUwMEY1XHUwMEMzXHUwMEQxXHUwMEQ1XS9nLCByZXBsYWNlU3RyaW5nKTtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDb252ZXJ0cyBhIHN0cmluZyB0byBhIFlBTUwtc2FmZSBmb3JtYXQgYnkgYWRkaW5nIHF1b3RlcyB3aGVuIG5lY2Vzc2FyeS5cclxuICAgICAqIEBwYXJhbSBpbnB1dCBUaGUgc3RyaW5nLCBib29sZWFuLCBudW1iZXIgb3IgYXJyYXkgdG8gbWFrZSBZQU1MLXNhZmVcclxuICAgICAqIEByZXR1cm5zIFRoZSBzYWZlbHkgcXVvdGVkIHN0cmluZyB3aGVuIG5lZWRlZCwgb3IgdGhlIG9yaWdpbmFsIHN0cmluZyBpZiBzYWZlXHJcbiAgICAgKi9cclxuICAgIHRvWWFtbFNhZmVTdHJpbmcoaW5wdXQ6IHN0cmluZ3xudW1iZXJ8Ym9vbGVhbnxzdHJpbmdbXSk6IHN0cmluZ3xudW1iZXJ8c3RyaW5nW10ge1xyXG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShpbnB1dCkpIHtcclxuICAgICAgICBpbnB1dC5mb3JFYWNoKChpdGVtLCBpbmRleCkgPT4ge1xyXG4gICAgICAgICAgaW5wdXRbaW5kZXhdID0gdGhpcy50b1lhbWxTYWZlU3RyaW5nKGl0ZW0pLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICByZXR1cm4gaW5wdXQ7XHJcbiAgICAgIH1cclxuICAgICAgc3dpdGNoICh0eXBlb2YgaW5wdXQpIHtcclxuICAgICAgICBjYXNlICdudW1iZXInOiByZXR1cm4gaW5wdXQ7XHJcbiAgICAgICAgY2FzZSAnYm9vbGVhbic6IHJldHVybiBpbnB1dCA/ICd0cnVlJyA6ICdmYWxzZSc7XHJcbiAgICAgICAgY2FzZSAnc3RyaW5nJzpcclxuICAgICAgICAgIC8vIFRyaW0gd2hpdGVzcGFjZSBmaXJzdFxyXG4gICAgICAgICAgY29uc3QgdHJpbW1lZCA9IGlucHV0LnRyaW0oKTtcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgLy8gRW1wdHkgc3RyaW5ncyBuZWVkIHF1b3Rlc1xyXG4gICAgICAgICAgaWYgKHRyaW1tZWQgPT09ICcnKSByZXR1cm4gJ1wiXCInO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICAvLyBDaGVjayBmb3Igc3BlY2lhbCBjaGFyYWN0ZXJzL3BhdHRlcm5zIHRoYXQgcmVxdWlyZSBxdW90aW5nXHJcbiAgICAgICAgICBjb25zdCBuZWVkc1F1b3RlcyA9IC9bOnt9XFxbXFxdLCYqIz98PD49ISVAYFwiJ1xcXFxdfF5bLT9cXG5dfFtcXHNcXG5dfF5beVluTl18XlswLTldfF5bKy1dfF4odHJ1ZXxmYWxzZXx5ZXN8bm98b258b2ZmKSQvaS50ZXN0KHRyaW1tZWQpO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgc3RyaW5nIGlzIGFscmVhZHkgcHJvcGVybHkgcXVvdGVkXHJcbiAgICAgICAgICBjb25zdCBpc0FscmVhZHlRdW90ZWQgPSAodHJpbW1lZC5zdGFydHNXaXRoKCdcIicpICYmIHRyaW1tZWQuZW5kc1dpdGgoJ1wiJykpIHx8IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0cmltbWVkLnN0YXJ0c1dpdGgoXCInXCIpICYmIHRyaW1tZWQuZW5kc1dpdGgoXCInXCIpKTtcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgaWYgKCFuZWVkc1F1b3RlcyAmJiAhaXNBbHJlYWR5UXVvdGVkKSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIHRyaW1tZWQ7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIC8vIElmIHdlIGdldCBoZXJlLCB3ZSBuZWVkIHF1b3Rlc1xyXG4gICAgICAgICAgLy8gVXNlIGRvdWJsZSBxdW90ZXMgYW5kIGVzY2FwZSBhbnkgZXhpc3RpbmcgZG91YmxlIHF1b3Rlc1xyXG4gICAgICAgICAgaWYgKCFpc0FscmVhZHlRdW90ZWQpIHtcclxuICAgICAgICAgICAgICByZXR1cm4gYFwiJHt0cmltbWVkLnJlcGxhY2UoL1wiL2csICdcXFxcXCInKX1cImA7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIC8vIElmIGFscmVhZHkgcXVvdGVkLCByZXR1cm4gYXMtaXNcclxuICAgICAgICAgIHJldHVybiB0cmltbWVkO1xyXG4gICAgICAgIGRlZmF1bHQ6IFxyXG4gICAgICAgICAgY29uc29sZS5lcnJvcihgdG9ZYW1sU2FmZVN0cmluZygke2lucHV0fSkgaWYgb2YgdHlwZSAnJHt0eXBlb2YgaW5wdXR9J2ApO1xyXG4gICAgICAgICAgcmV0dXJuIGlucHV0O1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmVwbGFjZVNwYWNlcyh0ZXh0OnN0cmluZywgcmVwbGFjZUJ5OnN0cmluZyB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZCk6c3RyaW5nIHtcclxuICAgICAgbGV0IHJlcGxhY2VTdHJpbmcgPSAnXyc7XHJcbiAgICAgIGlmICghcmVwbGFjZUJ5ICYmIHRoaXMuc2V0dGluZ3MpIHtcclxuICAgICAgICByZXBsYWNlU3RyaW5nID0gdGhpcy5zZXR0aW5ncy5zcGFjZVJlcGxhY2VtZW50IHx8ICdfJztcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBpZiAocmVwbGFjZUJ5KSByZXBsYWNlU3RyaW5nID0gcmVwbGFjZUJ5O1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiB0ZXh0LnJlcGxhY2UoL1xccysvZywgcmVwbGFjZVN0cmluZyk7XHJcbiAgICB9XHJcblxyXG4gICAgZm9ybWF0Q2FtZWxDYXNlKHRleHQ6c3RyaW5nKTpzdHJpbmcge1xyXG4gICAgICBsZXQgdGV4dFBhcnRzID0gdGV4dC5zcGxpdCgnICcpO1xyXG4gICAgICBsZXQgY29udmVydGVkVGV4dFBhcnRzOnN0cmluZ1tdID0gW107XHJcbiAgICAgIHRleHRQYXJ0cy5mb3JFYWNoKCh0ZXh0LGluZGV4KSA9PiB7XHJcbiAgICAgICAgbGV0IG5ld1RleHRQYXJ0ID0gdGV4dC50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIGlmIChpbmRleD4wKSBuZXdUZXh0UGFydCA9IG5ld1RleHRQYXJ0LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgbmV3VGV4dFBhcnQuc2xpY2UoMSk7XHJcbiAgICAgICAgY29udmVydGVkVGV4dFBhcnRzLnB1c2gobmV3VGV4dFBhcnQpO1xyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIGNvbnZlcnRlZFRleHRQYXJ0cy5qb2luKCcnKTtcclxuICAgIH1cclxuXHJcbiAgICBmb3JtYXRVcHBlckNhbWVsQ2FzZSh0ZXh0OnN0cmluZyk6c3RyaW5nIHtcclxuICAgICAgbGV0IHRleHRQYXJ0cyA9IHRleHQuc3BsaXQoJyAnKTtcclxuICAgICAgbGV0IGNvbnZlcnRlZFRleHRQYXJ0czpzdHJpbmdbXSA9IFtdO1xyXG4gICAgICB0ZXh0UGFydHMuZm9yRWFjaCgodGV4dCxpbmRleCkgPT4ge1xyXG4gICAgICAgIGxldCBuZXdUZXh0UGFydCA9IHRleHQudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICBuZXdUZXh0UGFydCA9IG5ld1RleHRQYXJ0LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgbmV3VGV4dFBhcnQuc2xpY2UoMSk7XHJcbiAgICAgICAgY29udmVydGVkVGV4dFBhcnRzLnB1c2gobmV3VGV4dFBhcnQpO1xyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIGNvbnZlcnRlZFRleHRQYXJ0cy5qb2luKCcnKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogZ2V0IHRoZSBwYXRoIHRvIGEgZmlsZSBmcm9tIGEgc3RyaW5nIGNvbnRhaW5pbmcgdGhlIGZ1bGwgcGFyaC9uYW1lIHN0cmluZ1xyXG4gICAgICogQHBhcmFtIHBhdGggc3RyaW5nXHJcbiAgICAgKiBAcGFyYW0gc2VwYXJhdG9yIHN0cmluZyBkZWZhdWx0cyB0byAnLydcclxuICAgICAqIEByZXR1cm5zIHN0cmluZ1xyXG4gICAgICovXHJcbiAgICBnZXRGb2xkZXJzRnJvbVBhdGggKHBhdGg6c3RyaW5nfG51bGx8dW5kZWZpbmVkLCBzZXBhcmF0b3IgPSAnLycpIHtcclxuICAgICAgICBpZiAocGF0aCA9PT0gbnVsbCkgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgaWYgKHBhdGggPT09IHVuZGVmaW5lZCkgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgICBjb25zdCBjdXJyZW50UGF0aFBhcnRzID0gcGF0aC5zcGxpdCgnLycpO1xyXG4gICAgICAgIGN1cnJlbnRQYXRoUGFydHMucG9wKCk7IC8vIHJlbW92ZSBGaWxlIG5hbWU7XHJcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRQYXRoUGFydHMuam9pbihzZXBhcmF0b3IpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvKipcclxuICAgICAqIHJlbW92ZXMgZHVwbGljYXRlIHN0cmluZ3MgaW4gYW4gYXJyYXkgYW5kIGRlbGV0ZXMgZW1wdHkgc3RyaW5nc1xyXG4gICAgICogQHBhcmFtIHN0cmluZ0FycmF5IFxyXG4gICAgICogQHJldHVybnMgXHJcbiAgICAgKi9cclxuICAgIHJlbW92ZUR1cGxpY2F0ZVN0cmluZ3Moc3RyaW5nQXJyYXk6IHN0cmluZ1tdKTogc3RyaW5nW10ge1xyXG4gICAgICBpZiAoIXN0cmluZ0FycmF5KSByZXR1cm4gW107XHJcbiAgICAgIGNvbnN0IHVuaXF1ZVN0cmluZ3NTZXQgPSBuZXcgU2V0PHN0cmluZz4oc3RyaW5nQXJyYXkpO1xyXG4gICAgICB1bmlxdWVTdHJpbmdzU2V0LmRlbGV0ZSgnJyk7IC8vIHJlbW92ZSBlbXB0eSBzdHJpbmdzXHJcbiAgICAgIHJldHVybiBbLi4udW5pcXVlU3RyaW5nc1NldF07XHJcbiAgICB9XHJcbiAgfSIsICJpbXBvcnQgeyBBcHAsIHJlbmRlclJlc3VsdHMsIFRGaWxlIH0gZnJvbSAnb2JzaWRpYW4nO1xyXG5pbXBvcnQgeyBwYXJzZUpTQ29kZSwgU2NyaXB0aW5nVG9vbHMgfSBmcm9tICcuL3Rvb2xzJztcclxuaW1wb3J0IHsgT2JzaWRpYW5Qcm9wZXJ0eVR5cGVzLCBGb2xkZXJUYWdSdWxlRGVmaW5pdGlvbiB9IGZyb20gJy4vdHlwZXMnO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBSdWxlRnVuY3Rpb24ge1xyXG4gICAgaWQ6c3RyaW5nO1xyXG4gICAgZGVzY3JpcHRpb246c3RyaW5nO1xyXG4gICAgdG9vbHRpcD86IHN0cmluZztcclxuICAgIGlucHV0UHJvcGVydHk/OiBib29sZWFuO1xyXG4gICAgc291cmNlOnN0cmluZztcclxuICAgIHR5cGU6T2JzaWRpYW5Qcm9wZXJ0eVR5cGVzW107XHJcbiAgICBmeDpGdW5jdGlvbjtcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IHJ1bGVGdW5jdGlvbnM6UnVsZUZ1bmN0aW9uW109W107XHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRSdWxlRnVuY3Rpb25CeUlkIChpZCA6IHN0cmluZyk6UnVsZUZ1bmN0aW9uIHwgdW5kZWZpbmVkIHtcclxuICAgIHJldHVybiBydWxlRnVuY3Rpb25zLmZpbmQocnVsZSA9PiBydWxlLmlkID09PSBpZCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGFwcGx5Rm9ybWF0T3B0aW9ucyh2YWx1ZTphbnksIHJ1bGU6Rm9sZGVyVGFnUnVsZURlZmluaXRpb24pOmFueSB7XHJcbiAgaWYgKHJ1bGUudHlwZSA9PT0gJ2RhdGUnIHx8IHJ1bGUudHlwZSA9PT0gJ2RhdGV0aW1lJykgcmV0dXJuIHZhbHVlOyAvLyBsZWF2ZSBkYXRlIGFuZCBkYXRlVGltZSB1bnRvdWNoZWRcclxuICBzd2l0Y2ggKHR5cGVvZiB2YWx1ZSkge1xyXG4gICAgY2FzZSAnYm9vbGVhbic6XHJcbiAgICBjYXNlICdudW1iZXInOlxyXG4gICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICBjYXNlICdzdHJpbmcnOlxyXG4gICAgICBpZiAocnVsZS5zcGFjZVJlcGxhY2VtZW50ICYmIHJ1bGUuc3BhY2VSZXBsYWNlbWVudCAhPT0gJycpIHZhbHVlID0gdmFsdWUucmVwbGFjZSgvXFxzKy9nLCBydWxlLnNwYWNlUmVwbGFjZW1lbnQpO1xyXG4gICAgICBpZiAocnVsZS5zcGVjaWFsQ2hhclJlcGxhY2VtZW50ICYmIHJ1bGUuc3BlY2lhbENoYXJSZXBsYWNlbWVudCAhPT0nJykgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKC9bXmEtekEtWjAtOVxcLV9cXC9cdTAwRTRcdTAwRjZcdTAwRkNcdTAwREZcdTAwQzRcdTAwRDZcdTAwRENcdTAwRTFcdTAwRTlcdTAwRURcdTAwRjNcdTAwRkFcdTAwRkRcdTAwQzFcdTAwQzlcdTAwQ0RcdTAwRDNcdTAwREFcdTAwRERcdTAwRTBcdTAwRThcdTAwRUNcdTAwRjJcdTAwRjlcdTAwQzBcdTAwQzhcdTAwQ0NcdTAwRDJcdTAwRDlcdTAwRTJcdTAwRUFcdTAwRUVcdTAwRjRcdTAwRkJcdTAwQzJcdTAwQ0FcdTAwQ0VcdTAwRDRcdTAwREJcdTAwRTNcdTAwRjFcdTAwRjVcdTAwQzNcdTAwRDFcdTAwRDVdL2csIHJ1bGUuc3BlY2lhbENoYXJSZXBsYWNlbWVudCk7XHJcbiAgICAgIGlmIChydWxlLmxvd2VyY2FzZVRhZ3MpIHZhbHVlID0gdmFsdWUudG9Mb3dlckNhc2UoKTtcclxuICAgICAgaWYgKHJ1bGUucHJlZml4ICYmIHJ1bGUucHJlZml4ICE9PSAnJykgdmFsdWUgPSBydWxlLnByZWZpeCArIHZhbHVlO1xyXG4gICAgICBpZiAocnVsZS5hc0xpbmspIHZhbHVlID0gYFtbJHt2YWx1ZX1dXWA7XHJcbiAgICAgIHJldHVybiB2YWx1ZVxyXG4gICAgY2FzZSAnb2JqZWN0JzpcclxuICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlLm1hcCh2YWx1ZSA9PiBhcHBseUZvcm1hdE9wdGlvbnModmFsdWUsIHJ1bGUpKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gdmFsdWU7XHJcbiAgfVxyXG4gIHJldHVyblxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZXhlY3V0ZVJ1bGUgKGFwcCwgc2V0dGluZ3MsIGN1cnJlbnRGaWxlOiBURmlsZSwgcmV0dXJuUmVzdWx0OiBhbnksIHJ1bGU6Rm9sZGVyVGFnUnVsZURlZmluaXRpb24sIGZyb250TWF0dGVyLCBvbGRQYXRoPzpzdHJpbmcpIHtcclxuICBjb25zdCB0b29scyA9IG5ldyBTY3JpcHRpbmdUb29scyhzZXR0aW5ncyk7XHJcbiAgbGV0IGZ4UmVzdWx0OmFueTtcclxuICBsZXQgb2xkUmVzdWx0OmFueTtcclxuICBpZiAoIXJ1bGUuYWN0aXZlKSByZXR1cm4gcmV0dXJuUmVzdWx0O1xyXG4gIGlmIChydWxlLmNvbnRlbnQgPT09ICdzY3JpcHQnKSB7XHJcbiAgICAgIGNvbnN0IHJ1bGVGdW5jdGlvbiA9IHBhcnNlSlNDb2RlKHJ1bGUuanNDb2RlKTtcclxuICAgICAgaWYgKHR5cGVvZiBydWxlRnVuY3Rpb24gIT09ICdmdW5jdGlvbicpIHJldHVybjtcclxuICAgICAgZnhSZXN1bHQgPSBydWxlRnVuY3Rpb24oYXBwLCBjdXJyZW50RmlsZSwgdG9vbHMpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IGZ1bmN0aW9uSW5kZXggPSBydWxlRnVuY3Rpb25zLmZpbmRJbmRleChmeCA9PiBmeC5pZCA9PT0gcnVsZS5jb250ZW50KTtcclxuICAgICAgaWYgKGZ1bmN0aW9uSW5kZXghPT0tMSl7XHJcbiAgICAgICAgICAvL2NvbnNvbGUubG9nKGBleGVjdXRlIHJ1bGUgZm9yICR7cnVsZS5wcm9wZXJ0eX0gJHtydWxlLmNvbnRlbnR9IGZvciBmaWxlICR7ZmlsZS5wYXRofWApO1xyXG4gICAgICAgICAgaWYgKHJ1bGVGdW5jdGlvbnNbZnVuY3Rpb25JbmRleF0uaW5wdXRQcm9wZXJ0eSkge1xyXG4gICAgICAgICAgICBmeFJlc3VsdCA9IGFwcGx5Rm9ybWF0T3B0aW9ucyhydWxlRnVuY3Rpb25zW2Z1bmN0aW9uSW5kZXhdLmZ4KGFwcCwgY3VycmVudEZpbGUsIHRvb2xzLCBmcm9udE1hdHRlcltydWxlLmlucHV0UHJvcGVydHldKSwgcnVsZSk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBmeFJlc3VsdCA9IGFwcGx5Rm9ybWF0T3B0aW9ucyhydWxlRnVuY3Rpb25zW2Z1bmN0aW9uSW5kZXhdLmZ4KGFwcCwgY3VycmVudEZpbGUsIHRvb2xzKSwgcnVsZSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICAvL2NvbnNvbGUubG9nKHJ1bGUuY29udGVudCwgcnVsZUZ1bmN0aW9uc1tmdW5jdGlvbkluZGV4XSA/IGZ4UmVzdWx0IDogJycpO1xyXG4gICAgICAgICAgaWYgKG9sZFBhdGgpIHtcclxuICAgICAgICAgICAgICBsZXQgb2xkRmlsZVBhcnRzID0gb2xkUGF0aC5zcGxpdCgnLycpO1xyXG4gICAgICAgICAgICAgIGxldCBvbGRGaWxlOlRGaWxlID0ge1xyXG4gICAgICAgICAgICAgICAgICBwYXRoOiBvbGRQYXRoLFxyXG4gICAgICAgICAgICAgICAgICBleHRlbnNpb246IG9sZEZpbGVQYXJ0c1tvbGRGaWxlUGFydHMubGVuZ3RoLTFdLnNwbGl0KCcuJylbMV0sXHJcbiAgICAgICAgICAgICAgICAgIG5hbWU6IG9sZEZpbGVQYXJ0c1tvbGRGaWxlUGFydHMubGVuZ3RoLTFdLnNwbGl0KCcuJylbMF0sXHJcbiAgICAgICAgICAgICAgICAgIHN0YXQ6IGN1cnJlbnRGaWxlLnN0YXQsXHJcbiAgICAgICAgICAgICAgICAgIGJhc2VuYW1lOiBjdXJyZW50RmlsZS5iYXNlbmFtZSxcclxuICAgICAgICAgICAgICAgICAgdmF1bHQ6IGN1cnJlbnRGaWxlLnZhdWx0LFxyXG4gICAgICAgICAgICAgICAgICBwYXJlbnQ6IGN1cnJlbnRGaWxlLnBhcmVudFxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBpZiAocnVsZUZ1bmN0aW9uc1tmdW5jdGlvbkluZGV4XS5pbnB1dFByb3BlcnR5KSB7XHJcbiAgICAgICAgICAgICAgICBvbGRSZXN1bHQgPSBhcHBseUZvcm1hdE9wdGlvbnMocnVsZUZ1bmN0aW9uc1tmdW5jdGlvbkluZGV4XS5meChhcHAsIG9sZEZpbGUsIHRvb2xzLCBmcm9udE1hdHRlcltydWxlLmlucHV0UHJvcGVydHldKSwgcnVsZSk7XHJcbiAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIG9sZFJlc3VsdCA9IGFwcGx5Rm9ybWF0T3B0aW9ucyhydWxlRnVuY3Rpb25zW2Z1bmN0aW9uSW5kZXhdLmZ4KGFwcCwgb2xkRmlsZSwgdG9vbHMpLCBydWxlKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgIH1cclxuICB9XHJcbiAgaWYgKHJ1bGUudHlwZSA9PT0gJ251bWJlcicgfHwgcnVsZS50eXBlID09PSAnY2hlY2tib3gnIHx8IHJ1bGUudHlwZSA9PT0gJ2RhdGUnIHx8IHJ1bGUudHlwZSA9PT0gJ2RhdGV0aW1lJykge1xyXG4gICAgICByZXR1cm4gZnhSZXN1bHQ7XHJcbiAgfVxyXG4gIHN3aXRjaCAocnVsZS5hZGRDb250ZW50KSB7XHJcbiAgICAgIGNhc2UgJ292ZXJ3cml0ZSc6XHJcbiAgICAgICAgICByZXR1cm5SZXN1bHQgPSBmeFJlc3VsdDsgLy8gdXBkYXRlIG9yIGFkZCB0aGUgbmV3IHZhbHVlXHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnZW5kJzpcclxuICAgICAgICAgIGlmIChydWxlLnR5cGUgPT09ICdtdWx0aXRleHQnIHx8IHJ1bGUudHlwZSA9PT0gJ3RhZ3MnIHx8IHJ1bGUudHlwZSA9PT0gJ2FsaWFzZXMnKSB7XHJcbiAgICAgICAgICAgICAgaWYgKHR5cGVvZiBmeFJlc3VsdCA9PT0gJ3N0cmluZycpIGZ4UmVzdWx0ID0gW2Z4UmVzdWx0XTsgLy8gY29udmVydCBzdHJpbmcgdG8gYXJyYXkgXHJcbiAgICAgICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHJldHVyblJlc3VsdCkpIHJldHVyblJlc3VsdCA9IFtyZXR1cm5SZXN1bHRdO1xyXG4gICAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShvbGRSZXN1bHQpKSBvbGRSZXN1bHQgPSBbb2xkUmVzdWx0XTtcclxuICAgICAgICAgICAgICBsZXQgZmlsdGVyZWQgPSByZXR1cm5SZXN1bHQuZmlsdGVyKCh2YWx1ZSkgPT4gIW9sZFJlc3VsdC5pbmNsdWRlcyh2YWx1ZSkpXHJcbiAgICAgICAgICAgICAgcmV0dXJuUmVzdWx0ID0gdG9vbHMucmVtb3ZlRHVwbGljYXRlU3RyaW5ncyhmaWx0ZXJlZC5jb25jYXQoZnhSZXN1bHQpKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgaWYgKCFyZXR1cm5SZXN1bHQpIHJldHVyblJlc3VsdCA9ICcnO1xyXG4gICAgICAgICAgICAgIHJldHVyblJlc3VsdCA9IHJldHVyblJlc3VsdC5yZXBsYWNlQWxsKHJldHVyblJlc3VsdCxvbGRSZXN1bHQpO1xyXG4gICAgICAgICAgICAgIHJldHVyblJlc3VsdCA9IHJldHVyblJlc3VsdCArIGZ4UmVzdWx0O1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ3N0YXJ0JzpcclxuICAgICAgICAgIGlmIChydWxlLnR5cGUgPT09ICdtdWx0aXRleHQnIHx8IHJ1bGUudHlwZSA9PT0gJ3RhZ3MnIHx8IHJ1bGUudHlwZSA9PT0gJ2FsaWFzZXMnKSB7XHJcbiAgICAgICAgICAgICAgaWYgKHR5cGVvZiBmeFJlc3VsdCA9PT0gJ3N0cmluZycpIGZ4UmVzdWx0ID0gW2Z4UmVzdWx0XTsgLy8gY29udmVydCBzdHJpbmcgdG8gYXJyYXkgXHJcbiAgICAgICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHJldHVyblJlc3VsdCkpIHJldHVyblJlc3VsdCA9IFtyZXR1cm5SZXN1bHRdO1xyXG4gICAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShvbGRSZXN1bHQpKSBvbGRSZXN1bHQgPSBbb2xkUmVzdWx0XTtcclxuICAgICAgICAgICAgICBsZXQgZmlsdGVyZWQgPSByZXR1cm5SZXN1bHQuZmlsdGVyKCh2YWx1ZSkgPT4gIW9sZFJlc3VsdC5pbmNsdWRlcyh2YWx1ZSkpXHJcbiAgICAgICAgICAgICAgcmV0dXJuUmVzdWx0ID0gdG9vbHMucmVtb3ZlRHVwbGljYXRlU3RyaW5ncyhmeFJlc3VsdC5jb25jYXQoZmlsdGVyZWQpKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgaWYgKCFyZXR1cm5SZXN1bHQpIHJldHVyblJlc3VsdCA9ICcnO1xyXG4gICAgICAgICAgICAgIHJldHVyblJlc3VsdCA9IHJldHVyblJlc3VsdC5yZXBsYWNlQWxsKHJldHVyblJlc3VsdCxvbGRSZXN1bHQpO1xyXG4gICAgICAgICAgICAgIHJldHVyblJlc3VsdCA9IGZ4UmVzdWx0ICsgcmV0dXJuUmVzdWx0O1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgfVxyXG4gIHJldHVybiByZXR1cm5SZXN1bHQ7XHJcblxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcmVtb3ZlUnVsZSAoYXBwLCBzZXR0aW5ncywgY3VycmVudEZpbGU6IFRGaWxlLCByZXR1cm5SZXN1bHQ6IGFueSwgcnVsZTpGb2xkZXJUYWdSdWxlRGVmaW5pdGlvbiwgZnJvbnRNYXR0ZXIpIHtcclxuICBjb25zdCB0b29scyA9IG5ldyBTY3JpcHRpbmdUb29scyhzZXR0aW5ncyk7XHJcbiAgbGV0IGZ4UmVzdWx0OmFueTtcclxuICBpZiAocnVsZS5jb250ZW50ID09PSAnc2NyaXB0Jykge1xyXG4gICAgICBjb25zdCBydWxlRnVuY3Rpb24gPSBwYXJzZUpTQ29kZShydWxlLmpzQ29kZSk7XHJcbiAgICAgIGlmICh0eXBlb2YgcnVsZUZ1bmN0aW9uICE9PSAnZnVuY3Rpb24nKSByZXR1cm47XHJcbiAgICAgIGZ4UmVzdWx0ID0gcnVsZUZ1bmN0aW9uKGFwcCwgY3VycmVudEZpbGUsIHRvb2xzKTtcclxuICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBmdW5jdGlvbkluZGV4ID0gcnVsZUZ1bmN0aW9ucy5maW5kSW5kZXgoZnggPT4gZnguaWQgPT09IHJ1bGUuY29udGVudCk7XHJcbiAgICAgIGlmIChmdW5jdGlvbkluZGV4IT09LTEpe1xyXG4gICAgICAgICAgaWYgKHJ1bGVGdW5jdGlvbnNbZnVuY3Rpb25JbmRleF0uaW5wdXRQcm9wZXJ0eSkge1xyXG4gICAgICAgICAgICBmeFJlc3VsdCA9IGFwcGx5Rm9ybWF0T3B0aW9ucyhydWxlRnVuY3Rpb25zW2Z1bmN0aW9uSW5kZXhdLmZ4KGFwcCwgY3VycmVudEZpbGUsIHRvb2xzLCBmcm9udE1hdHRlcltydWxlLmlucHV0UHJvcGVydHldKSwgcnVsZSk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBmeFJlc3VsdCA9IGFwcGx5Rm9ybWF0T3B0aW9ucyhydWxlRnVuY3Rpb25zW2Z1bmN0aW9uSW5kZXhdLmZ4KGFwcCwgY3VycmVudEZpbGUsIHRvb2xzKSwgcnVsZSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgIH1cclxuICB9XHJcbiAgc3dpdGNoIChydWxlLmFkZENvbnRlbnQpIHtcclxuICAgICAgY2FzZSAnb3ZlcndyaXRlJzpcclxuICAgICAgICAgIHJldHVyblJlc3VsdCA9IGZ4UmVzdWx0OyAvLyB1cGRhdGUgb3IgYWRkIHRoZSBuZXcgdmFsdWVcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdlbmQnOlxyXG4gICAgICAgICAgaWYgKHJ1bGUudHlwZSA9PT0gJ211bHRpdGV4dCcgfHwgcnVsZS50eXBlID09PSAndGFncycgfHwgcnVsZS50eXBlID09PSAnYWxpYXNlcycpIHtcclxuICAgICAgICAgICAgICBpZiAodHlwZW9mIGZ4UmVzdWx0ID09PSAnc3RyaW5nJykgZnhSZXN1bHQgPSBbZnhSZXN1bHRdOyAvLyBjb252ZXJ0IHN0cmluZyB0byBhcnJheSBcclxuICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkocmV0dXJuUmVzdWx0KSkgcmV0dXJuUmVzdWx0ID0gW3JldHVyblJlc3VsdF07XHJcbiAgICAgICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGZ4UmVzdWx0KSkgZnhSZXN1bHQgPSBbZnhSZXN1bHRdO1xyXG4gICAgICAgICAgICAgIGxldCBmaWx0ZXJlZCA9IHJldHVyblJlc3VsdC5maWx0ZXIoKHZhbHVlKSA9PiAhZnhSZXN1bHQuaW5jbHVkZXModmFsdWUpKVxyXG4gICAgICAgICAgICAgIHJldHVyblJlc3VsdCA9IHRvb2xzLnJlbW92ZUR1cGxpY2F0ZVN0cmluZ3MoZmlsdGVyZWQpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICBpZiAoIXJldHVyblJlc3VsdCkgcmV0dXJuUmVzdWx0ID0gJyc7XHJcbiAgICAgICAgICAgICAgcmV0dXJuUmVzdWx0ID0gcmV0dXJuUmVzdWx0LnJlcGxhY2VBbGwocmV0dXJuUmVzdWx0LGZ4UmVzdWx0KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdzdGFydCc6XHJcbiAgICAgICAgICBpZiAocnVsZS50eXBlID09PSAnbXVsdGl0ZXh0JyB8fCBydWxlLnR5cGUgPT09ICd0YWdzJyB8fCBydWxlLnR5cGUgPT09ICdhbGlhc2VzJykge1xyXG4gICAgICAgICAgICAgIGlmICh0eXBlb2YgZnhSZXN1bHQgPT09ICdzdHJpbmcnKSBmeFJlc3VsdCA9IFtmeFJlc3VsdF07IC8vIGNvbnZlcnQgc3RyaW5nIHRvIGFycmF5IFxyXG4gICAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShyZXR1cm5SZXN1bHQpKSByZXR1cm5SZXN1bHQgPSBbcmV0dXJuUmVzdWx0XTtcclxuICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoZnhSZXN1bHQpKSBmeFJlc3VsdCA9IFtmeFJlc3VsdF07XHJcbiAgICAgICAgICAgICAgbGV0IGZpbHRlcmVkID0gcmV0dXJuUmVzdWx0LmZpbHRlcigodmFsdWUpID0+ICFmeFJlc3VsdC5pbmNsdWRlcyh2YWx1ZSkpXHJcbiAgICAgICAgICAgICAgcmV0dXJuUmVzdWx0ID0gdG9vbHMucmVtb3ZlRHVwbGljYXRlU3RyaW5ncyhmaWx0ZXJlZCk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIGlmICghcmV0dXJuUmVzdWx0KSByZXR1cm5SZXN1bHQgPSAnJztcclxuICAgICAgICAgICAgICByZXR1cm5SZXN1bHQgPSByZXR1cm5SZXN1bHQucmVwbGFjZUFsbChyZXR1cm5SZXN1bHQsZnhSZXN1bHQpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgfVxyXG4gIHJldHVybiByZXR1cm5SZXN1bHQ7XHJcblxyXG59XHJcblxyXG5ydWxlRnVuY3Rpb25zLnB1c2goe1xyXG4gICAgaWQ6J2RlZmF1bHQnLFxyXG4gICAgZGVzY3JpcHRpb246ICdQYXNzIHBhcmFtZXRlcicsXHJcbiAgICBzb3VyY2U6IFwiZnVuY3Rpb24gKGFwcCwgZmlsZSwgdG9vbHMpIHsgLy8gZG8gbm90IGNoYW5nZSB0aGlzIGxpbmUhXFxuICBsZXQgcmVzdWx0ID0gJyc7XFxuICByZXR1cm4gcmVzdWx0O1xcbn1cIixcclxuICAgIHR5cGU6IFsndGV4dCddLFxyXG4gICAgZng6IGZ1bmN0aW9uIChhcHAsIGZpbGUsIHRvb2xzOlNjcmlwdGluZ1Rvb2xzKSB7IC8vIGRvIG5vdCBjaGFuZ2UgdGhpcyBsaW5lIVxyXG4gICAgICAgIGxldCByZXN1bHQgPSAnJztcclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICB9XHJcbn0pO1xyXG5cclxucnVsZUZ1bmN0aW9ucy5wdXNoKHtcclxuICAgIGlkOidmdWxsUGF0aCcsXHJcbiAgICBkZXNjcmlwdGlvbjogJ0Z1bGwgcGF0aCBhbmQgZmlsZW5hbWUnLFxyXG4gICAgc291cmNlOiBcImZ1bmN0aW9uIChhcHAsIGZpbGUsIHRvb2xzKSB7IC8vIGRvIG5vdCBjaGFuZ2UgdGhpcyBsaW5lIVxcbiAgLy8gYWNxdWlyZSBmaWxlIHBhdGhcXG4gIGNvbnN0IHJlc3VsdCA9IGZpbGUucGF0aDtcXG4gIHJldHVybiByZXN1bHQ7XFxufVwiLFxyXG4gICAgdHlwZTogWyd0ZXh0JywgJ3RhZ3MnLCAnYWxpYXNlcyddLFxyXG4gICAgZng6IGZ1bmN0aW9uIChhcHA6IEFwcCwgZmlsZTpURmlsZSwgdG9vbHM6U2NyaXB0aW5nVG9vbHMpe1xyXG4gICAgICAgICAgICByZXR1cm4gYCR7ZmlsZS5wYXRofWA7XHJcbiAgICAgICAgfVxyXG59KTtcclxuLypcclxucnVsZUZ1bmN0aW9ucy5wdXNoKHtcclxuICAgIGlkOidhbGlhc0Zyb21QYXRoJyxcclxuICAgIGRlc2NyaXB0aW9uOiAnQW4gQWxpYXMgZnJvbSBldmVyeSBmb2xkZXIgb2YgdGhlIGZpbGUgUGF0aCcsXHJcbiAgICBzb3VyY2U6IFwiZnVuY3Rpb24gKGFwcCwgZmlsZSwgdG9vbHMpIHsgLy8gZG8gbm90IGNoYW5nZSB0aGlzIGxpbmUhXFxuICAvLyBhY3F1aXJlIGZpbGUgcGF0aFxcbiAgbGV0IHBhdGhBcnJheSA9IGZpbGUucGF0aC5zcGxpdCgnLycpO1xcbiAgcGF0aEFycmF5LnBvcCgpOyAvLyByZW1vdmUgRmlsZSBuYW1lIHdpdGggZXh0ZW5zaW9uXFxuICBwYXRoQXJyYXkgPSBwYXRoQXJyYXkubWFwKChkaXIpID0+IHRvb2xzLmZvcm1hdFVwcGVyQ2FtZWxDYXNlKGRpcikpOyAvLyBjb252ZXJ0IHRvIFVwcGVyQ2FtZWxDYXNlXFxuICBjb25zdCBmaWxlTmFtZVBhcnRzID0gZmlsZS5uYW1lLnNwbGl0KCcuJyk7XFxuICBpZiAoZmlsZU5hbWVQYXJ0cy5sZW5ndGggPiAxKSB7XFxuICAgIGZpbGVOYW1lUGFydHMucG9wKCk7IC8vIHJlbW92ZSBFeHRlbnNpb25cXG4gIH1cXG4gIGNvbnN0IGZpbGVOYW1lID0gZmlsZU5hbWVQYXJ0cy5qb2luKCcuJyk7IC8vIHJlYnVpbGQgZmlsZSBOYW1lXFxuICBwYXRoQXJyYXkucHVzaCh0b29scy5mb3JtYXRVcHBlckNhbWVsQ2FzZShmaWxlTmFtZSkpOyAvLyBhZGQgZmlsZSBuYW1lIHdpdGhvdXQgZXh0ZW5zaW9uIGFuZCBpbiBVcHBlckNhbWVsQ2FzZVxcbiAgY29uc3QgcmVzdWx0ID0gcGF0aEFycmF5LmpvaW4oJy4nKSB8fCAnJztcXG4gIHJldHVybiByZXN1bHQ7XFxufVwiLFxyXG4gICAgdHlwZTogWydhbGlhc2VzJ10sXHJcbiAgICBmeDogZnVuY3Rpb24gKGFwcCwgZmlsZSwgdG9vbHM6U2NyaXB0aW5nVG9vbHMpIHsgLy8gZG8gbm90IGNoYW5nZSB0aGlzIGxpbmUhXHJcbiAgICAgICAgICAgIC8vIGFjcXVpcmUgZmlsZSBwYXRoXHJcbiAgICAgICAgICAgIGxldCBwYXRoQXJyYXkgPSBmaWxlLnBhdGguc3BsaXQoJy8nKTtcclxuICAgICAgICAgICAgcGF0aEFycmF5LnBvcCgpOyAvLyByZW1vdmUgRmlsZSBuYW1lIHdpdGggZXh0ZW5zaW9uXHJcbiAgICAgICAgICAgIHBhdGhBcnJheSA9IHBhdGhBcnJheS5tYXAoKGRpcikgPT4gdG9vbHMuZm9ybWF0VXBwZXJDYW1lbENhc2UoZGlyKSk7IC8vIGNvbnZlcnQgdG8gdXBwZXIgY2FtZWxDYXNlXHJcbiAgICAgICAgICAgIGNvbnN0IGZpbGVOYW1lUGFydHMgPSBmaWxlLm5hbWUuc3BsaXQoJy4nKTtcclxuICAgICAgICAgICAgaWYgKGZpbGVOYW1lUGFydHMubGVuZ3RoID4gMSkge1xyXG4gICAgICAgICAgICBmaWxlTmFtZVBhcnRzLnBvcCgpOyAvLyByZW1vdmUgRXh0ZW5zaW9uXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3QgZmlsZU5hbWUgPSBmaWxlTmFtZVBhcnRzLmpvaW4oJy4nKTsgLy8gcmVidWlsZCBmaWxlIE5hbWVcclxuICAgICAgICAgICAgcGF0aEFycmF5LnB1c2godG9vbHMuZm9ybWF0VXBwZXJDYW1lbENhc2UoZmlsZU5hbWUpKTsgLy8gYWRkIGZpbGUgbmFtZSB3aXRob3V0IGV4dGVuc2lvbiBhbmQgaW4gdXBwZXJDYW1lbENhc2VcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gcGF0aEFycmF5LmpvaW4oJy4nKSB8fCAnJztcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9XHJcbn0pO1xyXG4qL1xyXG5ydWxlRnVuY3Rpb25zLnB1c2goe1xyXG4gICAgaWQ6J3BhdGgnLFxyXG4gICAgZGVzY3JpcHRpb246ICdGdWxsIFBhdGgnLFxyXG4gICAgc291cmNlOiBcImZ1bmN0aW9uIChhcHAsIGZpbGUsIHRvb2xzKSB7IC8vIGRvIG5vdCBjaGFuZ2UgdGhpcyBsaW5lIVxcbiAgLy8gYWNxdWlyZSBmaWxlIHBhdGhcXG4gIGNvbnN0IHBhdGggPSBmaWxlLnBhdGg7XFxuICBjb25zdCBwYXJ0cyA9IHBhdGguc3BsaXQoJy8nKTtcXG4gIGxldCByZXN1bHQgPSAnJztcXG4gIGlmIChwYXJ0cy5sZW5ndGggPiAxKSB7XFxuICAgIHBhcnRzLnBvcCgpOyAvLyByZW1vdmUgZmlsZSBuYW1lXFxuICAgIHJlc3VsdCA9IHJlc3VsdCArIHBhcnRzLmpvaW4oJy8nKTtcXG4gIH1cXG4gIHJldHVybiByZXN1bHQ7XFxufVwiLFxyXG4gICAgdHlwZTogWyd0ZXh0JywgJ3RhZ3MnLCAnYWxpYXNlcyddLFxyXG4gICAgZng6ZnVuY3Rpb24gKGFwcDogQXBwLCBmaWxlOlRGaWxlLCB0b29sczpTY3JpcHRpbmdUb29scyl7XHJcbiAgICAgICAgbGV0IHBhcnRzID0gZmlsZS5wYXRoLnNwbGl0KCcvJyk7XHJcbiAgICAgICAgcGFydHMucG9wKCk7XHJcbiAgICAgICAgcmV0dXJuIHBhcnRzLmpvaW4oJy8nKTtcclxuICAgIH1cclxufSk7XHJcblxyXG5ydWxlRnVuY3Rpb25zLnB1c2goe1xyXG4gICAgaWQ6J2lzUm9vdCcsXHJcbiAgICBkZXNjcmlwdGlvbjogJ0ZpbGUgaW4gUm9vdCBmb2xkZXInLFxyXG4gICAgc291cmNlOiBcImZ1bmN0aW9uIChhcHAsIGZpbGUsIHRvb2xzKSB7IC8vIGRvIG5vdCBjaGFuZ2UgdGhpcyBsaW5lIVxcbiAgbGV0IHBhcnRzID0gZmlsZS5wYXRoLnNwbGl0KCcvJyk7XFxuICByZXR1cm4gcGFydHMubGVuZ3RoID09PSAxO1xcbn1cIixcclxuICAgIHR5cGU6IFsnY2hlY2tib3gnXSxcclxuICAgIGZ4OmZ1bmN0aW9uIChhcHA6IEFwcCwgZmlsZTpURmlsZSwgdG9vbHM6U2NyaXB0aW5nVG9vbHMpe1xyXG4gICAgICAgIGxldCBwYXJ0cyA9IGZpbGUucGF0aC5zcGxpdCgnLycpO1xyXG4gICAgICAgIHJldHVybiBwYXJ0cy5sZW5ndGggPT09IDE7XHJcbiAgICB9XHJcbn0pO1xyXG5cclxucnVsZUZ1bmN0aW9ucy5wdXNoKHtcclxuICAgIGlkOidmb2xkZXInLFxyXG4gICAgZGVzY3JpcHRpb246ICdQYXJlbnQgRm9sZGVyJyxcclxuICAgIHNvdXJjZTogXCJmdW5jdGlvbiAoYXBwLCBmaWxlLCB0b29scykgeyAvLyBkbyBub3QgY2hhbmdlIHRoaXMgbGluZSFcXG4gIC8vIGFjcXVpcmUgZmlsZSBwYXRoXFxuICBjb25zdCBwYXRoID0gZmlsZS5wYXRoO1xcbiAgY29uc3QgcGFydHMgPSBwYXRoLnNwbGl0KCcvJyk7XFxuICBsZXQgcmVzdWx0ID0gJyc7XFxuICBpZiAocGFydHMubGVuZ3RoID4gMSkge1xcbiAgICByZXN1bHQgPSBwYXJ0c1twYXJ0cy5sZW5ndGgtMl07XFxuICB9XFxuICByZXR1cm4gcmVzdWx0O1xcbn1cIixcclxuICAgIHR5cGU6IFsndGV4dCcsICd0YWdzJ10sXHJcbiAgICBmeDpmdW5jdGlvbiAoYXBwLCBmaWxlLCB0b29sczpTY3JpcHRpbmdUb29scykgeyAvLyBkbyBub3QgY2hhbmdlIHRoaXMgbGluZSFcclxuICAgICAgICAvLyBhY3F1aXJlIGZpbGUgcGF0aFxyXG4gICAgICAgIGNvbnN0IHBhdGggPSBmaWxlLnBhdGg7XHJcbiAgICAgICAgY29uc3QgcGFydHMgPSBwYXRoLnNwbGl0KCcvJyk7XHJcbiAgICAgICAgbGV0IHJlc3VsdCA9ICcnO1xyXG4gICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPiAxKSB7XHJcbiAgICAgICAgICByZXN1bHQgPSBwYXJ0c1twYXJ0cy5sZW5ndGgtMl07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgIH1cclxufSk7XHJcblxyXG5ydWxlRnVuY3Rpb25zLnB1c2goe1xyXG4gICAgaWQ6J2ZvbGRlcnMnLFxyXG4gICAgZGVzY3JpcHRpb246ICdBbGwgZm9sZGVycyBvZiB0aGUgZmlsZSBhcyBhIGxpc3QnLFxyXG4gICAgc291cmNlOiBcImZ1bmN0aW9uIChhcHAsIGZpbGUsIHRvb2xzKSB7IC8vIGRvIG5vdCBjaGFuZ2UgdGhpcyBsaW5lIVxcbiAgY29uc3QgcGF0aCA9IGZpbGUucGF0aDsgLy8gYWNxdWlyZSBmaWxlIHBhdGhcXG4gIGNvbnN0IHJlc3VsdCA9IHBhdGguc3BsaXQoJy8nKTtcXG4gIHJlc3VsdC5wb3AoKTsgLy8gcmVtb3ZlIGZpbGUgbmFtZVxcbiAgcmV0dXJuIHJlc3VsdDtcXG59XCIsXHJcbiAgICB0eXBlOiBbJ211bHRpdGV4dCcsJ3RhZ3MnLCdhbGlhc2VzJ10sXHJcbiAgICBmeDpmdW5jdGlvbiAoYXBwLCBmaWxlLCB0b29sczpTY3JpcHRpbmdUb29scykgeyAvLyBkbyBub3QgY2hhbmdlIHRoaXMgbGluZSFcclxuICAgICAgICAvLyBhY3F1aXJlIGZpbGUgcGF0aFxyXG4gICAgICAgIGNvbnN0IHBhdGggPSBmaWxlLnBhdGg7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gcGF0aC5zcGxpdCgnLycpO1xyXG4gICAgICAgIHJlc3VsdC5wb3AoKTtcclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICB9XHJcbn0pO1xyXG5cclxucnVsZUZ1bmN0aW9ucy5wdXNoKHtcclxuICAgIGlkOidyb290Rm9sZGVyJyxcclxuICAgIGRlc2NyaXB0aW9uOiAnUm9vdCBmb2xkZXInLFxyXG4gICAgc291cmNlOiBcImZ1bmN0aW9uIChhcHAsIGZpbGUsIHRvb2xzKSB7IC8vIGRvIG5vdCBjaGFuZ2UgdGhpcyBsaW5lIVxcbiAgLy8gYWNxdWlyZSBmaWxlIHBhdGhcXG4gIGNvbnN0IHBhdGggPSBmaWxlLnBhdGg7XFxuICBjb25zdCBwYXJ0cyA9IHBhdGguc3BsaXQoJy8nKTtcXG4gIGxldCByZXN1bHQgPSAnJztcXG4gIGlmIChwYXJ0cy5sZW5ndGggPiAxKSB7XFxuICAgIHJlc3VsdCA9IHBhcnRzWzBdO1xcbiAgfVxcbiAgcmV0dXJuIHJlc3VsdDtcXG59XCIsXHJcbiAgICB0eXBlOiBbJ3RleHQnLCAndGFncycsICdhbGlhc2VzJ10sXHJcbiAgICBmeDpmdW5jdGlvbiAoYXBwLCBmaWxlLCB0b29sczpTY3JpcHRpbmdUb29scykgeyAvLyBkbyBub3QgY2hhbmdlIHRoaXMgbGluZSFcclxuICAgICAgICAvLyBhY3F1aXJlIGZpbGUgcGF0aFxyXG4gICAgICAgIGNvbnN0IHBhdGggPSBmaWxlLnBhdGg7XHJcbiAgICAgICAgY29uc3QgcGFydHMgPSBwYXRoLnNwbGl0KCcvJyk7XHJcbiAgICAgICAgbGV0IHJlc3VsdCA9ICcnO1xyXG4gICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPiAxKSB7XHJcbiAgICAgICAgICByZXN1bHQgPSBwYXJ0c1swXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgfVxyXG59KTtcclxuXHJcbnJ1bGVGdW5jdGlvbnMucHVzaCh7XHJcbiAgICBpZDonbmFtZScsXHJcbiAgICBkZXNjcmlwdGlvbjogJ0ZpbGUgbmFtZSB3aXRob3V0IGV4dGVuc2lvbicsXHJcbiAgICBzb3VyY2U6IFwiZnVuY3Rpb24gKGFwcCwgZmlsZSwgdG9vbHMpIHsgLy8gZG8gbm90IGNoYW5nZSB0aGlzIGxpbmUhXFxuICAvLyBhY3F1aXJlIGZpbGUgbmFtZVxcbiAgY29uc3QgcmVzdWx0ID0gZmlsZS5uYW1lLnNwbGl0KCcuJyk7XFxuICByZXN1bHQucG9wKCk7IC8vIHJlbW92ZSBleHRlbnNpb25cXG4gIHJlc3VsdC5qb2luKCcuJyk7IC8vIHJlY29uc3RydWN0IHRoZSBmaWxlIG5hbWVcXG4gIHJldHVybiByZXN1bHQ7XFxufVwiLFxyXG4gICAgdHlwZTogWyd0ZXh0JywgJ3RhZ3MnLCAnYWxpYXNlcyddLFxyXG4gICAgZng6ZnVuY3Rpb24gKGFwcCwgZmlsZSwgdG9vbHM6U2NyaXB0aW5nVG9vbHMpIHsgLy8gZG8gbm90IGNoYW5nZSB0aGlzIGxpbmUhXHJcbiAgICAgICAgLy8gYWNxdWlyZSBmaWxlIG5hbWVcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBmaWxlLm5hbWUuc3BsaXQoJy4nKTtcclxuICAgICAgICByZXN1bHQucG9wKCk7IC8vIHJlbW92ZSBleHRlbnNpb25cclxuICAgICAgICByZXN1bHQuam9pbignLicpOyAvLyByZWNvbnN0cnVjdCB0aGUgZmlsZSBuYW1lXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgfVxyXG59KTtcclxuXHJcbnJ1bGVGdW5jdGlvbnMucHVzaCh7XHJcbiAgICBpZDonbmFtZUV4dCcsXHJcbiAgICBkZXNjcmlwdGlvbjogJ0ZpbGUgbmFtZSB3aXRoIGV4dGVuc2lvbicsXHJcbiAgICBzb3VyY2U6IFwiZnVuY3Rpb24gKGFwcCwgZmlsZSwgdG9vbHMpIHsgLy8gZG8gbm90IGNoYW5nZSB0aGlzIGxpbmUhXFxuICAvLyBhY3F1aXJlIGZpbGUgbmFtZVxcbiAgY29uc3QgcmVzdWx0ID0gZmlsZS5uYW1lO1xcbiAgcmV0dXJuIHJlc3VsdDtcXG59XCIsXHJcbiAgICB0eXBlOiBbJ3RleHQnLCAndGFncycsICdhbGlhc2VzJ10sXHJcbiAgICBmeDpmdW5jdGlvbiAoYXBwLCBmaWxlLCB0b29sczpTY3JpcHRpbmdUb29scykgeyAvLyBkbyBub3QgY2hhbmdlIHRoaXMgbGluZSFcclxuICAgICAgICAvLyBhY3F1aXJlIGZpbGUgbmFtZVxyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGZpbGUubmFtZTtcclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICB9XHJcbn0pO1xyXG5cclxucnVsZUZ1bmN0aW9ucy5wdXNoKHtcclxuICAgIGlkOidwcm9wZXJ0eVZhbHVlQXNMaW5rJyxcclxuICAgIGRlc2NyaXB0aW9uOiAnRm9ybWF0cyBhbiBQcm9wZXJ0eSBhcyBMaW5rJyxcclxuICAgIGlucHV0UHJvcGVydHk6IHRydWUsXHJcbiAgICBzb3VyY2U6IFwiZnVuY3Rpb24gKGFwcCwgZmlsZSwgdG9vbHMpIHsgLy8gZG8gbm90IGNoYW5nZSB0aGlzIGxpbmUhXFxuICAvLyBhY3F1aXJlIGZpbGUgbmFtZVxcbiAgY29uc3QgcmVzdWx0ID0gZmlsZS5uYW1lO1xcbiAgcmV0dXJuIHJlc3VsdDtcXG59XCIsXHJcbiAgICB0eXBlOiBbJ3RleHQnLCAnbXVsdGl0ZXh0JywgJ3RhZ3MnLCAnYWxpYXNlcyddLFxyXG4gICAgZng6ZnVuY3Rpb24gKGFwcCwgZmlsZSwgdG9vbHM6U2NyaXB0aW5nVG9vbHMsIGlucHV0PykgeyAvLyBkbyBub3QgY2hhbmdlIHRoaXMgbGluZSFcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBpbnB1dDtcclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICB9XHJcbn0pO1xyXG5cclxucnVsZUZ1bmN0aW9ucy5wdXNoKHtcclxuICAgIGlkOidkYXRlVGltZUNyZWF0ZWQnLFxyXG4gICAgZGVzY3JpcHRpb246ICdEYXRlIChhbmQgVGltZSkgY3JlYXRlZCcsXHJcbiAgICBzb3VyY2U6IFwiZnVuY3Rpb24gKGFwcCwgZmlsZSwgdG9vbHMpIHsgLy8gZG8gbm90IGNoYW5nZSB0aGlzIGxpbmUhXFxuICBjb25zdCB0aW1lT2Zmc2V0ID0gbmV3IERhdGUoRGF0ZS5ub3coKSkuZ2V0VGltZXpvbmVPZmZzZXQoKSo2MDAwMDsgLy8gZ2V0IGxvY2FsIHRpbWUgb2Zmc2V0XFxuICBjb25zdCByZXN1bHQgPSBuZXcgRGF0ZShmaWxlLnN0YXQuY3RpbWUtdGltZU9mZnNldCk7XFxuICByZXR1cm4gcmVzdWx0LnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1onKVswXTsgLy8gcmVtb3ZlIFVUQyBzeW1ib2xcXG59XCIsXHJcbiAgICB0eXBlOiBbJ2RhdGUnLCAnZGF0ZXRpbWUnXSxcclxuICAgIGZ4OmZ1bmN0aW9uIChhcHA6IEFwcCwgZmlsZTpURmlsZSwgdG9vbHM6U2NyaXB0aW5nVG9vbHMpIHsgXHJcbiAgICAgICAgY29uc3QgdGltZU9mZnNldCA9IG5ldyBEYXRlKERhdGUubm93KCkpLmdldFRpbWV6b25lT2Zmc2V0KCkqNjAwMDA7IC8vIGdldCBsb2NhbCB0aW1lIG9mZnNldFxyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IG5ldyBEYXRlKGZpbGUuc3RhdC5jdGltZS10aW1lT2Zmc2V0KTtcclxuICAgICAgICByZXR1cm4gcmVzdWx0LnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1onKVswXTsgLy8gcmVtb3ZlIFVUQyBzeW1ib2xcclxuICAgICAgfVxyXG59KTtcclxuXHJcbnJ1bGVGdW5jdGlvbnMucHVzaCh7XHJcbiAgICBpZDonZGF0ZVRpbWVNb2RpZmllZCcsXHJcbiAgICBkZXNjcmlwdGlvbjogJ0RhdGUgKGFuZCBUaW1lKSBtb2RpZmllZCcsXHJcbiAgICBzb3VyY2U6IFwiZnVuY3Rpb24gKGFwcCwgZmlsZSwgdG9vbHMpIHsgLy8gZG8gbm90IGNoYW5nZSB0aGlzIGxpbmUhXFxuICBjb25zdCB0aW1lT2Zmc2V0ID0gbmV3IERhdGUoRGF0ZS5ub3coKSkuZ2V0VGltZXpvbmVPZmZzZXQoKSo2MDAwMDtcXG4gIGNvbnN0IHJlc3VsdCA9IG5ldyBEYXRlKGZpbGUuc3RhdC5tdGltZS10aW1lT2Zmc2V0KTsgLy8gQXBwbHkgb2Zmc2V0IHRvIEdNVCBUaW1lc3RhbXBcXG4gIHJldHVybiByZXN1bHQudG9JU09TdHJpbmcoKS5zcGxpdCgnWicpWzBdOyAvLyByZW1vdmUgVVRDIHN5bWJvbFxcbn1cIixcclxuICAgIHR5cGU6IFsnZGF0ZScsICdkYXRldGltZSddLFxyXG4gICAgZng6ZnVuY3Rpb24gKGFwcDogQXBwLCBmaWxlOlRGaWxlLCB0b29sczpTY3JpcHRpbmdUb29scykgeyBcclxuICAgICAgICBjb25zdCB0aW1lT2Zmc2V0ID0gbmV3IERhdGUoRGF0ZS5ub3coKSkuZ2V0VGltZXpvbmVPZmZzZXQoKSo2MDAwMDtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBuZXcgRGF0ZShmaWxlLnN0YXQubXRpbWUtdGltZU9mZnNldCk7IC8vIEFwcGx5IG9mZnNldCB0byBHTVQgVGltZXN0YW1wXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdC50b0lTT1N0cmluZygpLnNwbGl0KCdaJylbMF07IC8vIHJlbW92ZSBVVEMgc3ltYm9sXHJcbiAgICAgIH1cclxufSk7XHJcblxyXG5ydWxlRnVuY3Rpb25zLnB1c2goe1xyXG4gICAgaWQ6J2ZpbGVTaXplQnl0ZXMnLFxyXG4gICAgZGVzY3JpcHRpb246ICdGaWxlIHNpemUgaW4gYnl0ZXMnLFxyXG4gICAgc291cmNlOiBcImZ1bmN0aW9uIChhcHAsIGZpbGUsIHRvb2xzKSB7IC8vIGRvIG5vdCBjaGFuZ2UgdGhpcyBsaW5lIVxcbiAgLy8gYWNxdWlyZSBmaWxlIHNpemVcXG4gIGNvbnN0IHJlc3VsdCA9IGZpbGUuc3RhdC5zaXplO1xcbiAgcmV0dXJuIHJlc3VsdDsgLy8gcmV0dXJuIHlvdSByZXN1bHQuXFxufVwiLFxyXG4gICAgdHlwZTogWydudW1iZXInXSxcclxuICAgIGZ4OmZ1bmN0aW9uIChhcHA6IEFwcCwgZmlsZTpURmlsZSwgdG9vbHM6U2NyaXB0aW5nVG9vbHMpIHsgLy8gZG8gbm90IGNoYW5nZSB0aGlzIGxpbmUhXHJcbiAgICAgICAgLy8gYWNxdWlyZSBmaWxlIHNpemVcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBmaWxlLnN0YXQuc2l6ZTtcclxuICAgICAgICByZXR1cm4gcmVzdWx0OyAvLyByZXR1cm4geW91IHJlc3VsdC5cclxuICAgICAgfVxyXG59KTtcclxuXHJcbnJ1bGVGdW5jdGlvbnMucHVzaCh7XHJcbiAgICBpZDonZmlsZVNpemVTdHJpbmcnLFxyXG4gICAgZGVzY3JpcHRpb246ICdGaWxlIHNpemUgZm9ybWF0dGVkIGFzIHRleHQnLFxyXG4gICAgc291cmNlOiBcImZ1bmN0aW9uIChhcHAsIGZpbGUsIHRvb2xzKSB7IC8vIGRvIG5vdCBjaGFuZ2UgdGhpcyBsaW5lIVxcbiAgLy8gYWNxdWlyZSBmaWxlIHNpemVcXG4gIGxldCBzaXplID1maWxlLnN0YXQuc2l6ZTtcXG4gIGNvbnN0IHByZWNpc2lvbiA9IDI7IC8vIG51bWJlciBvZiBkZWNpbWFsIHBsYWNlc1xcbiAgaWYgKHNpemUgPiAxMDI0KSB7XFxuICAgIHNpemUgPSBzaXplIC8gMTAyNDtcXG4gICAgaWYgKHNpemUgPiAxMDI0KSB7XFxuICAgICAgc2l6ZSA9IHNpemUgLyAxMDI0O1xcbiAgICAgIGlmIChzaXplID4gMTAyNCkge1xcbiAgICAgICAgc2l6ZSA9IHNpemUgLyAxMDI0O1xcbiAgICAgICAgcmV0dXJuIE51bWJlci5wYXJzZUZsb2F0KHNpemUpLnRvRml4ZWQocHJlY2lzaW9uKSArICcgR0InO1xcbiAgICAgIH0gXFxuICAgICAgcmV0dXJuIE51bWJlci5wYXJzZUZsb2F0KHNpemUpLnRvRml4ZWQocHJlY2lzaW9uKSArICcgTUInO1xcbiAgICB9XFxuICAgIHJldHVybiBOdW1iZXIucGFyc2VGbG9hdChzaXplKS50b0ZpeGVkKHByZWNpc2lvbikgKyAnIEtCJztcXG4gIH0gICBcXG4gIHJldHVybiBzaXplICsgJyBCeXRlcyc7IC8vIHJldHVybiB5b3UgcmVzdWx0Llxcbn1cIixcclxuICAgIHR5cGU6IFsndGV4dCddLFxyXG4gICAgZng6ZnVuY3Rpb24gKGFwcDogQXBwLCBmaWxlOlRGaWxlLCB0b29sczpTY3JpcHRpbmdUb29scykgeyAvLyBkbyBub3QgY2hhbmdlIHRoaXMgbGluZSFcclxuICAgICAgICAvLyBhY3F1aXJlIGZpbGUgc2l6ZVxyXG4gICAgICAgIGxldCBzaXplID1maWxlLnN0YXQuc2l6ZTtcclxuICAgICAgICBjb25zdCBwcmVjaXNpb24gPSAyOyAvLyBudW1iZXIgb2YgZGVjaW1hbCBwbGFjZXNcclxuICAgICAgICBpZiAoc2l6ZSA+IDEwMjQpIHtcclxuICAgICAgICAgIHNpemUgPSBzaXplIC8gMTAyNDtcclxuICAgICAgICAgIGlmIChzaXplID4gMTAyNCkge1xyXG4gICAgICAgICAgICBzaXplID0gc2l6ZSAvIDEwMjQ7XHJcbiAgICAgICAgICAgIGlmIChzaXplID4gMTAyNCkge1xyXG4gICAgICAgICAgICAgIHNpemUgPSBzaXplIC8gMTAyNDtcclxuICAgICAgICAgICAgICByZXR1cm4gc2l6ZS50b0ZpeGVkKHByZWNpc2lvbikgKyAnIEdCJztcclxuICAgICAgICAgICAgfSBcclxuICAgICAgICAgICAgcmV0dXJuIHNpemUudG9GaXhlZChwcmVjaXNpb24pICsgJyBNQic7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICByZXR1cm4gc2l6ZS50b0ZpeGVkKHByZWNpc2lvbikgKyAnIEtCJztcclxuICAgICAgICB9ICAgXHJcbiAgICAgICAgcmV0dXJuIHNpemUgKyAnIEJ5dGVzJzsgLy8gcmV0dXJuIHlvdSByZXN1bHQuXHJcbiAgICAgIH1cclxufSk7IiwgImltcG9ydCAqIGFzIGZtVG9vbHMgZnJvbSAnLi9mcm9udG1hdHRlci10b29scyc7XHJcblxyXG5leHBvcnQgY29uc3QgdmVyc2lvblN0cmluZyA9IFwiMC4wLjEwXCI7XHJcblxyXG5leHBvcnQgdHlwZSBPYnNpZGlhblByb3BlcnR5VHlwZXMgPSBcImFsaWFzZXNcInxcImNoZWNrYm94XCJ8XCJkYXRlXCJ8XCJkYXRldGltZVwifFwibXVsdGl0ZXh0XCJ8XCJudW1iZXJcInxcInRhZ3NcInxcInRleHRcIjtcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgRmlsdGVyRmlsZXNBbmRGb2xkZXJzIHtcclxuICAgIHNlbGVjdGVkRm9sZGVyczogc3RyaW5nW10sXHJcbiAgICBzZWxlY3RlZEZpbGVzOiBzdHJpbmdbXSxcclxuICAgIG1vZGU6ICdpbmNsdWRlJyB8ICdleGNsdWRlJyxcclxuICAgIGRpc3BsYXk6ICdmb2xkZXJzJyB8ICdmaWxlcydcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IERFRkFVTFRfRklMVEVSX0ZJTEVTX0FORF9GT0xERVJTID0ge1xyXG4gICAgc2VsZWN0ZWRGb2xkZXJzOiBbXSxcclxuICAgIHNlbGVjdGVkRmlsZXM6IFtdLFxyXG4gICAgbW9kZTogJ2V4Y2x1ZGUnLFxyXG4gICAgZGlzcGxheTogJ2ZvbGRlcnMnLFxyXG59XHJcbmV4cG9ydCBpbnRlcmZhY2UgRm9sZGVyVGFnU2V0dGluZ3Mge1xyXG4gICAgdGFnUHJlZml4OiBzdHJpbmc7XHJcbiAgICBleGNsdWRlUm9vdEZvbGRlcjogYm9vbGVhbjtcclxuICAgIHRhZ3NQcm9wZXJ0eU5hbWU6IHN0cmluZztcclxuICAgIHNwYWNlUmVwbGFjZW1lbnQ6IHN0cmluZztcclxuICAgIHNwZWNpYWxDaGFyUmVwbGFjZW1lbnQ6IHN0cmluZztcclxuICAgIGxvd2VyY2FzZVRhZ3M6IGJvb2xlYW47XHJcbiAgICBrbm93blByb3BlcnRpZXM6IFByb3BlcnR5VHlwZUluZm9bXTtcclxuICAgIHJ1bGVzOiBGb2xkZXJUYWdSdWxlRGVmaW5pdGlvbltdO1xyXG4gICAgdXNlVGV4dEFyZWE6IGJvb2xlYW47XHJcbiAgICBleGNsdWRlOiBGaWx0ZXJGaWxlc0FuZEZvbGRlcnM7XHJcbiAgICBpbmNsdWRlOiBGaWx0ZXJGaWxlc0FuZEZvbGRlcnM7XHJcbiAgICBjb25maWd1cmVkUHJvcGVydGllczogQXJyYXk8eyBuYW1lOiBzdHJpbmc7IHZhbHVlOiBhbnkgfT47XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBERUZBVUxUX1NFVFRJTkdTOiBGb2xkZXJUYWdTZXR0aW5ncyA9IHtcclxuICAgIHRhZ1ByZWZpeDogJycsXHJcbiAgICBleGNsdWRlUm9vdEZvbGRlcjogZmFsc2UsXHJcbiAgICB0YWdzUHJvcGVydHlOYW1lOiAndGFncycsXHJcbiAgICBzcGFjZVJlcGxhY2VtZW50OiAnXycsXHJcbiAgICBzcGVjaWFsQ2hhclJlcGxhY2VtZW50OiAnXycsXHJcbiAgICBsb3dlcmNhc2VUYWdzOiBmYWxzZSxcclxuICAgIGtub3duUHJvcGVydGllczogW10sXHJcbiAgICBydWxlczogW10sXHJcbiAgICB1c2VUZXh0QXJlYTogZmFsc2UsXHJcbiAgICBleGNsdWRlOiB7XHJcbiAgICAgICAgc2VsZWN0ZWRGb2xkZXJzOiBbXSxcclxuICAgICAgICBzZWxlY3RlZEZpbGVzOiBbXSxcclxuICAgICAgICBtb2RlOiAnZXhjbHVkZScsXHJcbiAgICAgICAgZGlzcGxheTogJ2ZvbGRlcnMnLFxyXG4gICAgfSxcclxuICAgIGluY2x1ZGU6IHtcclxuICAgICAgICBzZWxlY3RlZEZvbGRlcnM6IFtdLFxyXG4gICAgICAgIHNlbGVjdGVkRmlsZXM6IFtdLFxyXG4gICAgICAgIG1vZGU6ICdpbmNsdWRlJyxcclxuICAgICAgICBkaXNwbGF5OiAnZm9sZGVycycsXHJcbiAgICB9LFxyXG4gICAgY29uZmlndXJlZFByb3BlcnRpZXM6IFtdLFxyXG4gICAgXHJcbn07XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEZvbGRlclRhZ1J1bGVEZWZpbml0aW9uIHtcclxuICAgIGlkOiBzdHJpbmc7XHJcbiAgICBhY3RpdmU6IGJvb2xlYW47XHJcbiAgICBhZGRDb250ZW50OiAnb3ZlcndyaXRlJyB8ICdzdGFydCcgfCAnZW5kJztcclxuICAgIGFzTGluazogYm9vbGVhbjtcclxuICAgIHByb3BlcnR5OiBzdHJpbmc7XHJcbiAgICB2YWx1ZTogc3RyaW5nIHwgbnVtYmVyIHwgYm9vbGVhbjtcclxuICAgIGN1c3RvbVByb3BlcnR5OiBzdHJpbmc7XHJcbiAgICB0eXBlOiBPYnNpZGlhblByb3BlcnR5VHlwZXM7XHJcbiAgICB0eXBlUHJvcGVydHk6IFByb3BlcnR5VHlwZUluZm8gfCB1bmRlZmluZWQ7XHJcbiAgICBjb250ZW50OiBzdHJpbmc7XHJcbiAgICBidWlsZEluQ29kZTogc3RyaW5nO1xyXG4gICAganNDb2RlOiBzdHJpbmc7XHJcbiAgICBzaG93Q29udGVudDogYm9vbGVhbjtcclxuICAgIGV4Y2x1ZGU6IEZpbHRlckZpbGVzQW5kRm9sZGVycztcclxuICAgIGluY2x1ZGU6IEZpbHRlckZpbGVzQW5kRm9sZGVycztcclxuICAgIHByZWZpeDogc3RyaW5nO1xyXG4gICAgc3BhY2VSZXBsYWNlbWVudDogc3RyaW5nO1xyXG4gICAgc3BlY2lhbENoYXJSZXBsYWNlbWVudDogc3RyaW5nO1xyXG4gICAgbG93ZXJjYXNlVGFnczogYm9vbGVhbjtcclxuICAgIGlucHV0UHJvcGVydHk6IHN0cmluZztcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IERFRkFVTFRfUlVMRV9ERUZJTklUSU9OIDogRm9sZGVyVGFnUnVsZURlZmluaXRpb24gPSB7XHJcbiAgICBpZDogJycsXHJcbiAgICBhY3RpdmUgOiB0cnVlLFxyXG4gICAgYXNMaW5rOiBmYWxzZSxcclxuICAgIGFkZENvbnRlbnQ6ICdvdmVyd3JpdGUnLFxyXG4gICAgcHJvcGVydHkgOiAnJyxcclxuICAgIHZhbHVlOiAnJyxcclxuICAgIGN1c3RvbVByb3BlcnR5IDogJycsXHJcbiAgICB0eXBlOiAndGV4dCcsXHJcbiAgICB0eXBlUHJvcGVydHk6IHtuYW1lOicnLHR5cGU6JycsIHNvdXJjZToncmVnaXN0ZXJlZCd9LFxyXG4gICAgY29udGVudDogJycsXHJcbiAgICBidWlsZEluQ29kZTogJycsXHJcbiAgICBqc0NvZGU6ICcnLFxyXG4gICAgc2hvd0NvbnRlbnQ6IGZhbHNlLFxyXG4gICAgZXhjbHVkZToge1xyXG4gICAgICAgIHNlbGVjdGVkRm9sZGVyczogW10sXHJcbiAgICAgICAgc2VsZWN0ZWRGaWxlczogW10sXHJcbiAgICAgICAgbW9kZTogJ2V4Y2x1ZGUnLFxyXG4gICAgICAgIGRpc3BsYXk6ICdmb2xkZXJzJyxcclxuICAgIH0sXHJcbiAgICBpbmNsdWRlOiB7XHJcbiAgICAgICAgc2VsZWN0ZWRGb2xkZXJzOiBbXSxcclxuICAgICAgICBzZWxlY3RlZEZpbGVzOiBbXSxcclxuICAgICAgICBtb2RlOiAnaW5jbHVkZScsXHJcbiAgICAgICAgZGlzcGxheTogJ2ZvbGRlcnMnLFxyXG4gICAgfSxcclxuICAgIHByZWZpeDogJycsXHJcbiAgICBzcGFjZVJlcGxhY2VtZW50OiAnJyxcclxuICAgIHNwZWNpYWxDaGFyUmVwbGFjZW1lbnQ6ICcnLFxyXG4gICAgbG93ZXJjYXNlVGFnczogZmFsc2UsXHJcbiAgICBpbnB1dFByb3BlcnR5OiAnJyxcclxufVxyXG5cclxuZXhwb3J0IHR5cGUgUHJvcGVydHlUeXBlSW5mbyA9IHtcclxuICAgIG5hbWU6IHN0cmluZztcclxuICAgIHR5cGU6IHN0cmluZztcclxuICAgIGNvdW50PzogbnVtYmVyO1xyXG4gICAgaXNBcnJheT86IGJvb2xlYW47XHJcbiAgICB2YWx1ZXM/OiBzdHJpbmdbXTtcclxuICAgIHNvdXJjZTogJ3JlZ2lzdGVyZWQnIHwgJ2luZmVycmVkJztcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIFByb3BlcnR5VHlwZSA9IHtcclxuICAgIHR5cGU6IHN0cmluZztcclxuICAgIGljb246IHN0cmluZztcclxuICAgIGpzVHlwZTogc3RyaW5nO1xyXG59OyIsICJpbXBvcnQgeyBNb2RhbCwgQXBwLCBTZXR0aW5nIH0gZnJvbSAnb2JzaWRpYW4nO1xyXG4vKipcclxuICogRGlzcGxheSBhIEFsZXJ0IE1vZGFsIGFzeW5jaHJvbm91c2x5IFxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIEFzeW5jQWxlcnRNb2RhbCBleHRlbmRzIE1vZGFsIHtcclxuICBwcml2YXRlIHRpdGxlOiBzdHJpbmc7XHJcbiAgcHJpdmF0ZSBkZXNjcmlwdGlvbjogc3RyaW5nO1xyXG4gIHByaXZhdGUgYnRuMVRleHQ6IHN0cmluZztcclxuICBwcml2YXRlIGJ0bjJUZXh0OiBzdHJpbmc7XHJcbiAgcHJpdmF0ZSBvblllczogKCkgPT4gdm9pZDtcclxuICBwcml2YXRlIG9uTm86ICgpID0+IHZvaWQ7XHJcblxyXG4gIGNvbnN0cnVjdG9yKGFwcDogQXBwLCB0aXRsZTogc3RyaW5nLCBkZXNjcmlwdGlvbjogc3RyaW5nLCBidG4xOiBzdHJpbmcsIGJ0bjI6c3RyaW5nLCBvblllczogKCkgPT4gdm9pZCwgb25ObzogKCkgPT4gdm9pZCkge1xyXG4gICAgc3VwZXIoYXBwKTtcclxuICAgIHRoaXMudGl0bGUgPSB0aXRsZTtcclxuICAgIHRoaXMuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjtcclxuICAgIHRoaXMuYnRuMVRleHQgPSBidG4xO1xyXG4gICAgdGhpcy5idG4yVGV4dCA9IGJ0bjI7XHJcbiAgICB0aGlzLm9uWWVzID0gb25ZZXM7XHJcbiAgICB0aGlzLm9uTm8gPSBvbk5vO1xyXG4gIH1cclxuXHJcbiAgb25PcGVuKCkge1xyXG4gICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XHJcblxyXG4gICAgY29udGVudEVsLmNyZWF0ZUVsKCdoMicsIHsgdGV4dDogdGhpcy50aXRsZSB9KTtcclxuICAgIGNvbnRlbnRFbC5jcmVhdGVFbCgncCcsIHsgdGV4dDogdGhpcy5kZXNjcmlwdGlvbiB9KTtcclxuXHJcbiAgICBuZXcgU2V0dGluZyhjb250ZW50RWwpXHJcbiAgICAgIC5hZGRCdXR0b24oKGJ0bikgPT4ge1xyXG4gICAgICAgIGJ0bi5zZXRCdXR0b25UZXh0KHRoaXMuYnRuMVRleHQpXHJcbiAgICAgICAgICAuc2V0Q3RhKClcclxuICAgICAgICAgIC5vbkNsaWNrKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMub25ZZXMoKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICB9KVxyXG4gICAgICAuYWRkQnV0dG9uKChidG4pID0+IHtcclxuICAgICAgICBidG4uc2V0QnV0dG9uVGV4dCh0aGlzLmJ0bjJUZXh0KVxyXG4gICAgICAgICAgICAub25DbGljaygoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9uTm8oKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgb25DbG9zZSgpIHtcclxuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xyXG4gICAgY29udGVudEVsLmVtcHR5KCk7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogZGlzcGxheSBhbiBBbGVydCBNb2RhbFxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIEFsZXJ0TW9kYWwgZXh0ZW5kcyBNb2RhbCB7XHJcbiAgICBwcml2YXRlIHRpdGxlOiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIGRlc2NyaXB0aW9uOiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIHJlc29sdmVQcm9taXNlOiAodmFsdWU6IGJvb2xlYW4pID0+IHZvaWQ7XHJcbiAgICBwcml2YXRlIHByb21pc2U6IFByb21pc2U8Ym9vbGVhbj47XHJcbiAgICBwcml2YXRlIGJ0bjFUZXh0OiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIGJ0bjJUZXh0OiBzdHJpbmc7XHJcbiAgXHJcbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgdGl0bGU6IHN0cmluZywgZGVzY3JpcHRpb246IHN0cmluZywgYnRuMTogc3RyaW5nLCBidG4yOnN0cmluZykge1xyXG4gICAgICBzdXBlcihhcHApO1xyXG4gICAgICB0aGlzLnRpdGxlID0gdGl0bGU7XHJcbiAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjtcclxuICAgICAgdGhpcy5idG4xVGV4dCA9IGJ0bjE7XHJcbiAgICAgIHRoaXMuYnRuMlRleHQgPSBidG4yO1xyXG4gICAgICB0aGlzLnByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xyXG4gICAgICAgIHRoaXMucmVzb2x2ZVByb21pc2UgPSByZXNvbHZlO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICBcclxuICAgIG9uT3BlbigpIHtcclxuICAgICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XHJcbiAgXHJcbiAgICAgIGNvbnRlbnRFbC5jcmVhdGVFbCgnaDInLCB7IHRleHQ6IHRoaXMudGl0bGUgfSk7XHJcbiAgICAgIGNvbnRlbnRFbC5jcmVhdGVFbCgncCcsIHsgdGV4dDogdGhpcy5kZXNjcmlwdGlvbiB9KTtcclxuICBcclxuICAgICAgbmV3IFNldHRpbmcoY29udGVudEVsKVxyXG4gICAgICAgIC5hZGRCdXR0b24oKGJ0bikgPT4ge1xyXG4gICAgICAgICAgYnRuLnNldEJ1dHRvblRleHQodGhpcy5idG4xVGV4dClcclxuICAgICAgICAgICAgLnNldEN0YSgpXHJcbiAgICAgICAgICAgIC5vbkNsaWNrKCgpID0+IHtcclxuICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgdGhpcy5yZXNvbHZlUHJvbWlzZSh0cnVlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuYWRkQnV0dG9uKChidG4pID0+IHtcclxuICAgICAgICAgIGJ0bi5zZXRCdXR0b25UZXh0KHRoaXMuYnRuMlRleHQpXHJcbiAgICAgICAgICAgIC5vbkNsaWNrKCgpID0+IHtcclxuICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgdGhpcy5yZXNvbHZlUHJvbWlzZShmYWxzZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gIFxyXG4gICAgb25DbG9zZSgpIHtcclxuICAgICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XHJcbiAgICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xyXG4gICAgfVxyXG4gIFxyXG4gICAgYXN5bmMgb3BlbkFuZEdldFZhbHVlKCk6IFByb21pc2U8Ym9vbGVhbj4ge1xyXG4gICAgICB0aGlzLm9wZW4oKTtcclxuICAgICAgcmV0dXJuIHRoaXMucHJvbWlzZTtcclxuICAgIH1cclxuICB9IiwgImltcG9ydCB7IEFwcCwgTW9kYWwsIFNldHRpbmcsIFRBYnN0cmFjdEZpbGUsIFRGaWxlLCBURm9sZGVyLCBWYXVsdCwgc2V0SWNvbiB9IGZyb20gJ29ic2lkaWFuJzsgLy8gQWRkZWQgc2V0SWNvblxyXG5cclxuLy8gRGVmaW5lIHRoZSBzdHJ1Y3R1cmUgZm9yIHRyZWUgbm9kZXNcclxuaW50ZXJmYWNlIFRyZWVOb2RlIHtcclxuICAgIHBhdGg6IHN0cmluZztcclxuICAgIG5hbWU6IHN0cmluZztcclxuICAgIHR5cGU6ICdmb2xkZXInIHwgJ2ZpbGUnO1xyXG4gICAgY2hpbGRyZW4/OiBUcmVlTm9kZVtdO1xyXG4gICAgZWxlbWVudDogSFRNTEVsZW1lbnQ7IC8vIFJlZmVyZW5jZSB0byB0aGUgbGlzdCBpdGVtIGVsZW1lbnQgKGxpKVxyXG4gICAgY2hlY2tib3g6IEhUTUxJbnB1dEVsZW1lbnQ7XHJcbiAgICBsYWJlbDogSFRNTExhYmVsRWxlbWVudDtcclxuICAgIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQ7IC8vIFJlZmVyZW5jZSB0byB0aGUgY29udGFpbmVyIGRpdiBob2xkaW5nIGNoZWNrYm94IGFuZCBsYWJlbFxyXG59XHJcblxyXG4vLyBEZWZpbmUgdGhlIHJlc3VsdCBzdHJ1Y3R1cmUgcmV0dXJuZWQgYnkgdGhlIG1vZGFsXHJcbmV4cG9ydCBpbnRlcmZhY2UgRGlyZWN0b3J5U2VsZWN0aW9uUmVzdWx0IHtcclxuICAgIGZvbGRlcnM6IHN0cmluZ1tdO1xyXG4gICAgZmlsZXM6IHN0cmluZ1tdO1xyXG4gICAgbW9kZTogJ2luY2x1ZGUnIHwgJ2V4Y2x1ZGUnO1xyXG4gICAgZGlzcGxheTogJ2ZvbGRlcnMnIHwgJ2ZpbGVzJztcclxufVxyXG5cclxuLyoqXHJcbiAqIE9ic2lkaWFuIE1vZGFsIGZvciBzZWxlY3RpbmcgZGlyZWN0b3JpZXMgYW5kIGZpbGVzIGZyb20gdGhlIHZhdWx0IHN0cnVjdHVyZS5cclxuICovXHJcbmV4cG9ydCBjbGFzcyBEaXJlY3RvcnlTZWxlY3Rpb25Nb2RhbCBleHRlbmRzIE1vZGFsIHtcclxuICAgIC8vIEluaXRpYWwgc3RhdGUgcGFzc2VkIHRvIHRoZSBtb2RhbCAoc3RvcmVkIGZvciByZXNldCBmdW5jdGlvbmFsaXR5KVxyXG4gICAgcHJpdmF0ZSByZWFkb25seSBpbml0aWFsRm9sZGVyc1NuYXBzaG90OiBSZWFkb25seVNldDxzdHJpbmc+O1xyXG4gICAgcHJpdmF0ZSByZWFkb25seSBpbml0aWFsRmlsZXNTbmFwc2hvdDogUmVhZG9ubHlTZXQ8c3RyaW5nPjtcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgaW5pdGlhbE1vZGVTbmFwc2hvdDogJ2luY2x1ZGUnIHwgJ2V4Y2x1ZGUnO1xyXG4gICAgcHJpdmF0ZSByZWFkb25seSBpbml0aWFsRGlzcGxheVNuYXBzaG90OiAnZm9sZGVycycgfCAnZmlsZXMnO1xyXG4gICAgcHJpdmF0ZSByZWFkb25seSBva0NhbGxiYWNrOiAocmVzdWx0OiBEaXJlY3RvcnlTZWxlY3Rpb25SZXN1bHQgfCBudWxsKSA9PiB2b2lkO1xyXG5cclxuICAgIC8vIEN1cnJlbnQgc3RhdGUgYmVpbmcgbW9kaWZpZWQgd2l0aGluIHRoZSBtb2RhbFxyXG4gICAgcHJpdmF0ZSBjdXJyZW50Rm9sZGVyczogU2V0PHN0cmluZz47XHJcbiAgICBwcml2YXRlIGN1cnJlbnRGaWxlczogU2V0PHN0cmluZz47XHJcbiAgICBwcml2YXRlIGN1cnJlbnRNb2RlOiAnaW5jbHVkZScgfCAnZXhjbHVkZSc7XHJcbiAgICBwcml2YXRlIGN1cnJlbnREaXNwbGF5OiAnZm9sZGVycycgfCAnZmlsZXMnO1xyXG4gICAgcHJpdmF0ZSBpbmNsdWRlRXhjbHVkZVNlbGVjdGFibGU6IGJvb2xlYW47XHJcbiAgICBwcml2YXRlIHNob3dGaWxlczogYm9vbGVhbiA9IGZhbHNlOyAvLyBTdGF0ZSBmb3Igc2hvd2luZyBmaWxlcyBpbiB0aGUgdHJlZVxyXG5cclxuICAgIC8vIFVJIEVsZW1lbnRzXHJcbiAgICBwcml2YXRlIHRyZWVSb290RWxlbWVudDogSFRNTEVsZW1lbnQ7IC8vIENvbnRhaW5lciBmb3IgdGhlIHRyZWUgdmlld1xyXG4gICAgcHJpdmF0ZSB0cmVlTm9kZXM6IE1hcDxzdHJpbmcsIFRyZWVOb2RlPiA9IG5ldyBNYXAoKTsgLy8gTWFwIHBhdGggdG8gbm9kZSBpbmZvIGZvciBxdWljayBhY2Nlc3NcclxuICAgIHByaXZhdGUgbW9kZURyb3Bkb3duOiBTZXR0aW5nIHwgbnVsbCA9IG51bGw7IC8vIFJlZmVyZW5jZSB0byB1cGRhdGUgZHJvcGRvd24gb24gcmVzZXRcclxuXHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgdGhlIERpcmVjdG9yeVNlbGVjdGlvbk1vZGFsLlxyXG4gICAgICogQHBhcmFtIGFwcCAtIFRoZSBPYnNpZGlhbiBBcHAgaW5zdGFuY2UuXHJcbiAgICAgKiBAcGFyYW0gaW5pdGlhbEZvbGRlcnMgLSBBcnJheSBvZiBpbml0aWFsbHkgc2VsZWN0ZWQgZm9sZGVyIHBhdGhzLlxyXG4gICAgICogQHBhcmFtIGluaXRpYWxGaWxlcyAtIEFycmF5IG9mIGluaXRpYWxseSBzZWxlY3RlZCBmaWxlIHBhdGhzLlxyXG4gICAgICogQHBhcmFtIGluaXRpYWxNb2RlIC0gVGhlIGluaXRpYWwgc2VsZWN0aW9uIG1vZGUgKCdpbmNsdWRlJyBvciAnZXhjbHVkZScpLlxyXG4gICAgICogQHBhcmFtIG9rQ2FsbGJhY2sgLSBGdW5jdGlvbiB0byBjYWxsIHdoZW4gdGhlIHVzZXIgY2xpY2tzIFwiT0tcIi4gUmVjZWl2ZXMgdGhlIHNlbGVjdGlvbiByZXN1bHQuXHJcbiAgICAgKi9cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIGFwcDogQXBwLFxyXG4gICAgICAgIGluaXRpYWxGb2xkZXJzOiBzdHJpbmdbXSxcclxuICAgICAgICBpbml0aWFsRmlsZXM6IHN0cmluZ1tdLFxyXG4gICAgICAgIGluaXRpYWxNb2RlOiAnaW5jbHVkZScgfCAnZXhjbHVkZScsXHJcbiAgICAgICAgaW5pdGlhbERpc3BsYXk6ICdmb2xkZXJzJyB8ICdmaWxlcycsXHJcbiAgICAgICAgaW5jbHVkZUV4Y2x1ZGVTZWxlY3RhYmxlOiBib29sZWFuLFxyXG4gICAgICAgIG9rQ2FsbGJhY2s6IChyZXN1bHQ6IERpcmVjdG9yeVNlbGVjdGlvblJlc3VsdCB8IG51bGwpID0+IHZvaWRcclxuICAgICkge1xyXG4gICAgICAgIHN1cGVyKGFwcCk7XHJcbiAgICAgICAgLy8gU3RvcmUgaW5pdGlhbCBzdGF0ZSBmb3IgcmVzZXRcclxuICAgICAgICB0aGlzLmluaXRpYWxGb2xkZXJzU25hcHNob3QgPSBuZXcgU2V0KGluaXRpYWxGb2xkZXJzKTtcclxuICAgICAgICB0aGlzLmluaXRpYWxGaWxlc1NuYXBzaG90ID0gbmV3IFNldChpbml0aWFsRmlsZXMpO1xyXG4gICAgICAgIHRoaXMuaW5pdGlhbE1vZGVTbmFwc2hvdCA9IGluaXRpYWxNb2RlO1xyXG4gICAgICAgIHRoaXMuaW5pdGlhbERpc3BsYXlTbmFwc2hvdCA9IGluaXRpYWxEaXNwbGF5O1xyXG4gICAgICAgIHRoaXMuc2hvd0ZpbGVzID0gaW5pdGlhbERpc3BsYXk9PT0nZmlsZXMnIHx8IGluaXRpYWxGaWxlcy5sZW5ndGg+MDtcclxuICAgICAgICB0aGlzLmluY2x1ZGVFeGNsdWRlU2VsZWN0YWJsZSA9IGluY2x1ZGVFeGNsdWRlU2VsZWN0YWJsZTtcclxuICAgICAgICB0aGlzLm9rQ2FsbGJhY2sgPSBva0NhbGxiYWNrO1xyXG5cclxuICAgICAgICAvLyBJbml0aWFsaXplIGN1cnJlbnQgc3RhdGUgZnJvbSBpbml0aWFsIHN0YXRlIGZvciBlZGl0aW5nXHJcbiAgICAgICAgdGhpcy5yZXNldFNlbGVjdGlvblRvSW5pdGlhbCgpOyAvLyBVc2UgYSBtZXRob2QgZm9yIGluaXRpYWxpemF0aW9uIGFuZCByZXNldFxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmVzZXRzIHRoZSBjdXJyZW50IHNlbGVjdGlvbiBzdGF0ZSB0byB0aGUgaW5pdGlhbCBzdGF0ZSBwcm92aWRlZCBhdCBjb25zdHJ1Y3Rpb24uXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgcmVzZXRTZWxlY3Rpb25Ub0luaXRpYWwoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5jdXJyZW50Rm9sZGVycyA9IG5ldyBTZXQodGhpcy5pbml0aWFsRm9sZGVyc1NuYXBzaG90KTtcclxuICAgICAgICB0aGlzLmN1cnJlbnRGaWxlcyA9IG5ldyBTZXQodGhpcy5pbml0aWFsRmlsZXNTbmFwc2hvdCk7XHJcbiAgICAgICAgdGhpcy5jdXJyZW50TW9kZSA9IHRoaXMuaW5pdGlhbE1vZGVTbmFwc2hvdDtcclxuICAgICAgICAvLyBOb3RlOiBzaG93RmlsZXMgaXMgbm90IHJlc2V0IGJ5IHRoaXMgYWN0aW9uLCB1c2VyIGNhbiB0b2dnbGUgaXQgaW5kZXBlbmRlbnRseVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmVzZXRzIHRoZSBjdXJyZW50IHNlbGVjdGlvbiBzdGF0ZSB0byBlbXB0eS5cclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSByZXNldFNlbGVjdGlvblRvRW1wdHkoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5jdXJyZW50Rm9sZGVycyA9IG5ldyBTZXQoW10pO1xyXG4gICAgICAgIHRoaXMuY3VycmVudEZpbGVzID0gbmV3IFNldChbXSk7XHJcbiAgICAgICAgdGhpcy5jdXJyZW50TW9kZSA9IHRoaXMuaW5pdGlhbE1vZGVTbmFwc2hvdDtcclxuICAgICAgICAvLyBOb3RlOiBzaG93RmlsZXMgaXMgbm90IHJlc2V0IGJ5IHRoaXMgYWN0aW9uLCB1c2VyIGNhbiB0b2dnbGUgaXQgaW5kZXBlbmRlbnRseVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ2FsbGVkIHdoZW4gdGhlIG1vZGFsIGlzIG9wZW5lZC4gQnVpbGRzIHRoZSBVSS5cclxuICAgICAqL1xyXG4gICAgb25PcGVuKCkge1xyXG4gICAgICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xyXG4gICAgICAgIGNvbnRlbnRFbC5lbXB0eSgpOyAvLyBDbGVhciBwcmV2aW91cyBjb250ZW50XHJcbiAgICAgICAgY29udGVudEVsLmFkZENsYXNzKCdkaXJlY3Rvcnktc2VsZWN0aW9uLW1vZGFsJyk7IFxyXG5cclxuICAgICAgICAvLyAtLS0gTW9kYWwgVGl0bGUgLS0tXHJcbiAgICAgICAgaWYgKHRoaXMuaW5jbHVkZUV4Y2x1ZGVTZWxlY3RhYmxlKSB7XHJcbiAgICAgICAgICAgIGNvbnRlbnRFbC5jcmVhdGVFbCgnaDInLCB7IHRleHQ6ICdJbmNsdWRlIG9yIEV4Y2x1ZGUgRm9sZGVycyBhbmQgRmlsZXMnIH0pOyBcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb250ZW50RWwuY3JlYXRlRWwoJ2gyJywgeyB0ZXh0OiBgJHt0aGlzLmN1cnJlbnRNb2RlID09PSAnZXhjbHVkZScgPyAnRXhjbHVkZScgOiAnSW5jbHVkZSd9IEZvbGRlcnMgYW5kIEZpbGVzYCB9KTsgXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyAtLS0gU2V0dGluZ3MgQ29udHJvbHMgLS0tXHJcbiAgICAgICAgY29uc3QgY29udHJvbHNFbCA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoeyBjbHM6ICdtb2RhbC1jb250cm9scycgfSk7XHJcbiAgICAgICAgdGhpcy5jcmVhdGVNb2RlU2V0dGluZyhjb250cm9sc0VsKTsgLy8gQ3JlYXRlIG1vZGUgZHJvcGRvd25cclxuICAgICAgICB0aGlzLmNyZWF0ZVNob3dGaWxlc1NldHRpbmcoY29udHJvbHNFbCk7IC8vIENyZWF0ZSBmaWxlIHRvZ2dsZVxyXG5cclxuICAgICAgICAvLyAtLS0gVHJlZSBDb250YWluZXIgLS0tXHJcbiAgICAgICAgdGhpcy50cmVlUm9vdEVsZW1lbnQgPSBjb250ZW50RWwuY3JlYXRlRGl2KHsgY2xzOiAndHJlZS12aWV3LWNvbnRhaW5lcicgfSk7XHJcbiAgICAgICAgLy8gQmFzaWMgc3R5bGluZyBmb3IgdGhlIHNjcm9sbGFibGUgdHJlZSBhcmVhXHJcbiAgICAgICAgdGhpcy50cmVlUm9vdEVsZW1lbnQuc3R5bGUubWF4SGVpZ2h0ID0gJzYwMHB4JztcclxuICAgICAgICB0aGlzLnRyZWVSb290RWxlbWVudC5zdHlsZS5vdmVyZmxvd1kgPSAnYXV0byc7XHJcbiAgICAgICAgdGhpcy50cmVlUm9vdEVsZW1lbnQuc3R5bGUuYm9yZGVyID0gJzFweCBzb2xpZCB2YXIoLS1iYWNrZ3JvdW5kLW1vZGlmaWVyLWJvcmRlciknO1xyXG4gICAgICAgIHRoaXMudHJlZVJvb3RFbGVtZW50LnN0eWxlLnBhZGRpbmcgPSAnMTBweCc7XHJcbiAgICAgICAgdGhpcy50cmVlUm9vdEVsZW1lbnQuc3R5bGUubWFyZ2luVG9wID0gJzEwcHgnO1xyXG4gICAgICAgIHRoaXMudHJlZVJvb3RFbGVtZW50LnN0eWxlLm1hcmdpbkJvdHRvbSA9ICcxMHB4JztcclxuXHJcbiAgICAgICAgLy8gLS0tIEJ1aWxkIGFuZCBSZW5kZXIgVHJlZSAtLS1cclxuICAgICAgICB0aGlzLmJ1aWxkQW5kUmVuZGVyVHJlZSgpOyAvLyBJbml0aWFsIHJlbmRlcmluZyBiYXNlZCBvbiBjdXJyZW50IHN0YXRlXHJcblxyXG4gICAgICAgIC8vIC0tLSBBY3Rpb24gQnV0dG9ucyAtLS1cclxuICAgICAgICB0aGlzLmNyZWF0ZUFjdGlvbkJ1dHRvbnMoY29udGVudEVsKTsgLy8gQ3JlYXRlIE9LIGFuZCBSZXNldCBidXR0b25zXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIHRoZSBkcm9wZG93biBzZXR0aW5nIGZvciBjaG9vc2luZyB0aGUgc2VsZWN0aW9uIG1vZGUuXHJcbiAgICAgKiBAcGFyYW0gY29udGFpbmVyRWwgLSBUaGUgSFRNTCBlbGVtZW50IHRvIGFwcGVuZCB0aGUgc2V0dGluZyB0by5cclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBjcmVhdGVNb2RlU2V0dGluZyhjb250YWluZXJFbDogSFRNTEVsZW1lbnQpOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy5pbmNsdWRlRXhjbHVkZVNlbGVjdGFibGUpIHtcclxuICAgICAgICAgICAgdGhpcy5tb2RlRHJvcGRvd24gPSBuZXcgU2V0dGluZyhjb250YWluZXJFbCkgLy8gU3RvcmUgcmVmZXJlbmNlXHJcbiAgICAgICAgICAgICAgICAuc2V0TmFtZSgnU2VsZWN0aW9uIE1vZGUnKSAvLyBTZXR0aW5nIE5hbWUgaW4gR2VybWFuXHJcbiAgICAgICAgICAgICAgICAuc2V0RGVzYygnQ2hvb3NlIGlmIHRoZSBzZWxlY3RlZCBmaWxlcyBhbmQgZm9sZGVycyBzaG91bGQgYmUgZXhjbHVkZWQgb3IgaW5jbHVkZWQuJykgXHJcbiAgICAgICAgICAgICAgICAuYWRkRHJvcGRvd24oZHJvcGRvd24gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGRyb3Bkb3duXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRPcHRpb24oJ2V4Y2x1ZGUnLCAnZXhjbHVkZScpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRPcHRpb24oJ2luY2x1ZGUnLCAnaW5jbHVkZScpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLmN1cnJlbnRNb2RlKSAvLyBTZXQgaW5pdGlhbCB2YWx1ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAub25DaGFuZ2UodmFsdWUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50TW9kZSA9IHZhbHVlIGFzICdpbmNsdWRlJyB8ICdleGNsdWRlJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlVHJlZUFwcGVhcmFuY2UoKTsgLy8gVXBkYXRlIHRyZWUgdmlzdWFscyBiYXNlZCBvbiBuZXcgbW9kZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFVwZGF0ZXMgdGhlIG1vZGUgZHJvcGRvd24gVUkgZWxlbWVudCB0byByZWZsZWN0IHRoZSBjdXJyZW50TW9kZSBzdGF0ZS5cclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSB1cGRhdGVNb2RlRHJvcGRvd24oKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgZHJvcGRvd25Db21wb25lbnQgPSB0aGlzLm1vZGVEcm9wZG93bj8uY29tcG9uZW50c1swXSBhcyBhbnk7IC8vIEFjY2VzcyBkcm9wZG93biBjb21wb25lbnRcclxuICAgICAgICBpZiAoZHJvcGRvd25Db21wb25lbnQgJiYgdHlwZW9mIGRyb3Bkb3duQ29tcG9uZW50LnNldFZhbHVlID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICBkcm9wZG93bkNvbXBvbmVudC5zZXRWYWx1ZSh0aGlzLmN1cnJlbnRNb2RlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlcyB0aGUgdG9nZ2xlIHNldHRpbmcgZm9yIHNob3dpbmcvaGlkaW5nIGZpbGVzIGluIHRoZSB0cmVlLlxyXG4gICAgICogQHBhcmFtIGNvbnRhaW5lckVsIC0gVGhlIEhUTUwgZWxlbWVudCB0byBhcHBlbmQgdGhlIHNldHRpbmcgdG8uXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgY3JlYXRlU2hvd0ZpbGVzU2V0dGluZyhjb250YWluZXJFbDogSFRNTEVsZW1lbnQpOiB2b2lkIHtcclxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuICAgICAgICAgICAgLnNldE5hbWUoJ1Nob3cgRmlsZXMnKVxyXG4gICAgICAgICAgICAuc2V0RGVzYygnU2hvdyBGaWxlcyB3aXRoaW4gdGhlIGRpcmVjdG9yeSB0cmVlLicpXHJcbiAgICAgICAgICAgIC5hZGRUb2dnbGUodG9nZ2xlID0+IHtcclxuICAgICAgICAgICAgICAgIHRvZ2dsZVxyXG4gICAgICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnNob3dGaWxlcylcclxuICAgICAgICAgICAgICAgICAgICAub25DaGFuZ2UodmFsdWUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dGaWxlcyA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1aWxkQW5kUmVuZGVyVHJlZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgdGhlIFwiT0tcIiBhbmQgXCJSZXNldFwiIGJ1dHRvbnMuXHJcbiAgICAgKiBAcGFyYW0gY29udGFpbmVyRWwgLSBUaGUgSFRNTCBlbGVtZW50IHRvIGFwcGVuZCB0aGUgYnV0dG9ucyB0by5cclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBjcmVhdGVBY3Rpb25CdXR0b25zKGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudCk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IGJ1dHRvbnNFbCA9IGNvbnRhaW5lckVsLmNyZWF0ZURpdih7IGNsczogJ21vZGFsLWJ1dHRvbnMnIH0pO1xyXG4gICAgICAgIGJ1dHRvbnNFbC5zdHlsZS5tYXJnaW5Ub3AgPSAnMTVweCc7XHJcbiAgICAgICAgYnV0dG9uc0VsLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7IC8vIFVzZSBmbGV4IGZvciBhbGlnbm1lbnRcclxuICAgICAgICBidXR0b25zRWwuc3R5bGUuanVzdGlmeUNvbnRlbnQgPSAnZmxleC1lbmQnOyAvLyBBbGlnbiBidXR0b25zIHRvIHRoZSByaWdodFxyXG4gICAgICAgIGJ1dHRvbnNFbC5zdHlsZS5nYXAgPSAnMTBweCc7IC8vIFNwYWNlIGJldHdlZW4gYnV0dG9uc1xyXG5cclxuICAgICAgICAvLyBSZXNldCBCdXR0b24gKFVuZG8gXHUyMUFBXHVGRTBGKVxyXG4gICAgICAgIGNvbnN0IHJlc2V0QnV0dG9uID0gYnV0dG9uc0VsLmNyZWF0ZUVsKCdidXR0b24nKTtcclxuICAgICAgICAvLyBVc2UgT2JzaWRpYW4ncyBzZXRJY29uIGZvciBjb25zaXN0ZW5jeSwgb3IgdXNlIHRleHRcclxuICAgICAgICBzZXRJY29uKHJlc2V0QnV0dG9uLCAncmVzZXQnKTsgLy8gVXNlIGEgc3VpdGFibGUgaWNvbiBsaWtlICdyZXNldCcgb3IgJ3VuZG8nXHJcbiAgICAgICAgcmVzZXRCdXR0b24uYXJpYUxhYmVsID0gJ1Jlc2V0IHNlbGVjdGlvbic7IC8vIEFjY2Vzc2liaWxpdHlcclxuICAgICAgICByZXNldEJ1dHRvbi5vbmNsaWNrID0gKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnJlc2V0U2VsZWN0aW9uVG9Jbml0aWFsKCk7IC8vIFJlc2V0IGludGVybmFsIHN0YXRlXHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlTW9kZURyb3Bkb3duKCk7IC8vIFVwZGF0ZSBkcm9wZG93biBVSVxyXG4gICAgICAgICAgICB0aGlzLmJ1aWxkQW5kUmVuZGVyVHJlZSgpOyAvLyBSZS1yZW5kZXIgdHJlZSB3aXRoIHJlc2V0IHN0YXRlXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy8gQ2xlYXIgQnV0dG9uIChDbGVhciBcdUQ4M0RcdURFQUUpXHJcbiAgICAgICAgY29uc3QgZW1wdHlCdXR0b24gPSBidXR0b25zRWwuY3JlYXRlRWwoJ2J1dHRvbicpO1xyXG4gICAgICAgIC8vIFVzZSBPYnNpZGlhbidzIHNldEljb24gZm9yIGNvbnNpc3RlbmN5LCBvciB1c2UgdGV4dFxyXG4gICAgICAgIHNldEljb24oZW1wdHlCdXR0b24sICdlcmFzZXInKTsgLy8gVXNlIGEgc3VpdGFibGUgaWNvbiBsaWtlICdyZXNldCcgb3IgJ3VuZG8nXHJcbiAgICAgICAgZW1wdHlCdXR0b24uYXJpYUxhYmVsID0gJ0NsZWFyIHNlbGVjdGlvbic7IC8vIEFjY2Vzc2liaWxpdHlcclxuICAgICAgICBlbXB0eUJ1dHRvbi5vbmNsaWNrID0gKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnJlc2V0U2VsZWN0aW9uVG9FbXB0eSgpOyAvLyBDbGVhciBzdGF0ZVxyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZU1vZGVEcm9wZG93bigpOyAvLyBVcGRhdGUgZHJvcGRvd24gVUlcclxuICAgICAgICAgICAgdGhpcy5idWlsZEFuZFJlbmRlclRyZWUoKTsgLy8gUmUtcmVuZGVyIHRyZWUgd2l0aCByZXNldCBzdGF0ZVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIGNhbmNlbCBCdXR0b25cclxuICAgICAgICBjb25zdCBjYW5jZWxCdXR0b24gPSBidXR0b25zRWwuY3JlYXRlRWwoJ2J1dHRvbicsIHsgdGV4dDogJ0NhbmNlbCcgfSk7XHJcbiAgICAgICAgY2FuY2VsQnV0dG9uLmFyaWFMYWJlbCA9ICdjbG9zZSBhbmQgZGlzY2FyZCBjaGFuZ2VzJzsgLy8gQWNjZXNzaWJpbGl0eVxyXG4gICAgICAgIGNhbmNlbEJ1dHRvbi5vbmNsaWNrID0gKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkNhbmNlbCBDbGlja2VkIC0gUmV0dXJuaW5nXCIpOyAvLyBEZWJ1ZyBsb2dcclxuICAgICAgICAgICAgdGhpcy5va0NhbGxiYWNrKCBudWxsICk7IC8vIFBhc3MgdGhlIGZpbmFsIHNlbGVjdGlvbiBiYWNrXHJcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBPSyBCdXR0b25cclxuICAgICAgICBjb25zdCBva0J1dHRvbiA9IGJ1dHRvbnNFbC5jcmVhdGVFbCgnYnV0dG9uJywgeyB0ZXh0OiAnT0snLCBjbHM6ICdtb2QtY3RhJyB9KTtcclxuICAgICAgICBjYW5jZWxCdXR0b24uYXJpYUxhYmVsID0gJ2Nsb3NlIGFuZCBzYXZlIGNoYW5nZXMnOyAvLyBBY2Nlc3NpYmlsaXR5XHJcbiAgICAgICAgb2tCdXR0b24ub25jbGljayA9ICgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvKipcclxuICAgICAqIEJ1aWxkcyB0aGUgbG9naWNhbCB0cmVlIHN0cnVjdHVyZSBkYXRhIGZyb20gdGhlIHZhdWx0J3MgZmlsZXMgYW5kIGZvbGRlcnMuXHJcbiAgICAgKiBAcmV0dXJucyBUaGUgcm9vdCBub2RlIG9mIHRoZSB0cmVlIHN0cnVjdHVyZS5cclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBidWlsZFRyZWVEYXRhKCk6IFRyZWVOb2RlIHtcclxuICAgICAgICAvLyBDcmVhdGUgYSB2aXJ0dWFsIHJvb3Qgbm9kZSByZXByZXNlbnRpbmcgdGhlIHZhdWx0XHJcbiAgICAgICAgY29uc3QgdmF1bHRSb290Tm9kZTogVHJlZU5vZGUgPSB7XHJcbiAgICAgICAgICAgICBwYXRoOiAnLycsXHJcbiAgICAgICAgICAgICBuYW1lOiB0aGlzLmFwcC52YXVsdC5nZXROYW1lKCkgfHwgJ1ZhdWx0JywgLy8gVXNlIHZhdWx0IG5hbWUgb3IgZGVmYXVsdFxyXG4gICAgICAgICAgICAgdHlwZTogJ2ZvbGRlcicsXHJcbiAgICAgICAgICAgICBjaGlsZHJlbjogW10sXHJcbiAgICAgICAgICAgICAvLyBQbGFjZWhvbGRlciBlbGVtZW50cywgd2lsbCBiZSBhc3NpZ25lZCBkdXJpbmcgcmVuZGVyaW5nIGlmIHJvb3QgaXMgcmVuZGVyZWRcclxuICAgICAgICAgICAgIGVsZW1lbnQ6IG51bGwhLCBjaGVja2JveDogbnVsbCEsIGxhYmVsOiBudWxsISwgY29udGFpbmVyOiBudWxsIVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3QgZm9sZGVyTm9kZXMgPSBuZXcgTWFwPHN0cmluZywgVHJlZU5vZGU+KCk7XHJcbiAgICAgICAgZm9sZGVyTm9kZXMuc2V0KCcvJywgdmF1bHRSb290Tm9kZSk7IC8vIEFkZCByb290IHRvIHRoZSBtYXBcclxuXHJcbiAgICAgICAgLy8gVXNlIGdldEZpbGVzKCkgdG8gcmV0cmlldmUgYWxsIFRGaWxlIG9iamVjdHMgKE1hcmtkb3duLCBpbWFnZXMsIHBkZiwgZXRjLilcclxuICAgICAgICBjb25zdCBhbGxGaWxlcyA9IHRoaXMuYXBwLnZhdWx0LmdldEZpbGVzKCk7XHJcblxyXG4gICAgICAgIC8vIC0tLSBTdGVwIDE6IENyZWF0ZSBhbGwgZm9sZGVyIG5vZGVzIGJhc2VkIG9uIGZpbGUgcGFyZW50IHBhdGhzIC0tLVxyXG4gICAgICAgIGFsbEZpbGVzLmZvckVhY2goZmlsZSA9PiB7XHJcbiAgICAgICAgICAgIC8vIEdldCB0aGUgcGFyZW50IGZvbGRlciBvYmplY3QgZm9yIHRoZSBmaWxlXHJcbiAgICAgICAgICAgIGNvbnN0IHBhcmVudEZvbGRlciA9IGZpbGUucGFyZW50O1xyXG4gICAgICAgICAgICAvLyBFbnN1cmUgcGFyZW50Rm9sZGVyIGV4aXN0cyBiZWZvcmUgcHJvY2VlZGluZyAoU2FmZXR5IGNoZWNrKVxyXG4gICAgICAgICAgICBpZiAoIXBhcmVudEZvbGRlcikgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgbGV0IGN1cnJlbnRQYXRoID0gJyc7XHJcbiAgICAgICAgICAgIC8vIFNwbGl0IHBhdGgsIGZpbHRlciBlbXB0eSBzdHJpbmdzIChoYW5kbGVzIHJvb3QgJy8nKVxyXG4gICAgICAgICAgICBjb25zdCBwYXRoUGFydHMgPSBwYXJlbnRGb2xkZXIucGF0aC5zcGxpdCgnLycpLmZpbHRlcihwID0+IHAubGVuZ3RoID4gMCk7XHJcblxyXG4gICAgICAgICAgICBsZXQgcGFyZW50Tm9kZSA9IHZhdWx0Um9vdE5vZGU7IC8vIFN0YXJ0IGZyb20gdmF1bHQgcm9vdFxyXG4gICAgICAgICAgICBwYXRoUGFydHMuZm9yRWFjaChwYXJ0ID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIENvbnN0cnVjdCB0aGUgZnVsbCBwYXRoIGZvciB0aGUgY3VycmVudCBwYXJ0XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50UGF0aCA9IGN1cnJlbnRQYXRoID09PSAnLycgPyBwYXJ0IDogYCR7Y3VycmVudFBhdGh9LyR7cGFydH1gO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFmb2xkZXJOb2Rlcy5oYXMoY3VycmVudFBhdGgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIG5ldyBmb2xkZXIgbm9kZSBpZiBpdCBkb2Vzbid0IGV4aXN0XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3Rm9sZGVyTm9kZTogVHJlZU5vZGUgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiBjdXJyZW50UGF0aCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHBhcnQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZm9sZGVyJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuOiBbXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFBsYWNlaG9sZGVycywgYXNzaWduZWQgZHVyaW5nIHJlbmRlcmluZ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogbnVsbCEsIGNoZWNrYm94OiBudWxsISwgbGFiZWw6IG51bGwhLCBjb250YWluZXI6IG51bGwhXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICBmb2xkZXJOb2Rlcy5zZXQoY3VycmVudFBhdGgsIG5ld0ZvbGRlck5vZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIEVuc3VyZSBwYXJlbnROb2RlIGhhcyBjaGlsZHJlbiBhcnJheSBpbml0aWFsaXplZFxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghcGFyZW50Tm9kZS5jaGlsZHJlbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnROb2RlLmNoaWxkcmVuID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHBhcmVudE5vZGUuY2hpbGRyZW4hLnB1c2gobmV3Rm9sZGVyTm9kZSk7IC8vIEFkZCB0byBwYXJlbnQncyBjaGlsZHJlblxyXG4gICAgICAgICAgICAgICAgICAgIHBhcmVudE5vZGUgPSBuZXdGb2xkZXJOb2RlOyAvLyBNb3ZlIGRvd24gdGhlIHRyZWVcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gRm9sZGVyIG5vZGUgYWxyZWFkeSBleGlzdHMsIGp1c3QgbW92ZSBkb3duXHJcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50Tm9kZSA9IGZvbGRlck5vZGVzLmdldChjdXJyZW50UGF0aCkhO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gLS0tIFN0ZXAgMjogQWRkIGZpbGUgbm9kZXMgaWYgJ3Nob3dGaWxlcycgaXMgZW5hYmxlZCAtLS1cclxuICAgICAgICBpZiAodGhpcy5zaG93RmlsZXMpIHtcclxuICAgICAgICAgICAgIGFsbEZpbGVzLmZvckVhY2goZmlsZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgLy8gR2V0IHBhcmVudCBmb2xkZXIgYW5kIGFkZCBzYWZldHkgY2hlY2sgZm9yIG51bGxcclxuICAgICAgICAgICAgICAgICBjb25zdCBwYXJlbnRGb2xkZXIgPSBmaWxlLnBhcmVudDtcclxuICAgICAgICAgICAgICAgICBpZiAoIXBhcmVudEZvbGRlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLndhcm4oYEZpbGUgXCIke2ZpbGUucGF0aH1cIiBzZWVtcyB0byBoYXZlIG5vIHBhcmVudCBmb2xkZXIuIFNraXBwaW5nLmApOyAvLyBPcHRpb25hbCB3YXJuaW5nXHJcbiAgICAgICAgICAgICAgICAgICAgIHJldHVybjsgLy8gU2tpcCB0aGlzIGZpbGUgaWYgaXQgaGFzIG5vIHBhcmVudFxyXG4gICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICBjb25zdCBwYXJlbnRQYXRoID0gXCIvXCIrcGFyZW50Rm9sZGVyLnBhdGg7IC8vIE5vdyBzYWZlIHRvIGFjY2VzcyAucGF0aFxyXG4gICAgICAgICAgICAgICAgIGNvbnN0IHBhcmVudE5vZGUgPSBmb2xkZXJOb2Rlcy5nZXQocGFyZW50UGF0aCk7XHJcblxyXG4gICAgICAgICAgICAgICAgIC8vIENyZWF0ZSB0aGUgZmlsZSBub2RlXHJcbiAgICAgICAgICAgICAgICAgY29uc3QgZmlsZU5vZGU6IFRyZWVOb2RlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICBwYXRoOiBmaWxlLnBhdGgsXHJcbiAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGZpbGUubmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2ZpbGUnLFxyXG4gICAgICAgICAgICAgICAgICAgICAvLyBGaWxlcyBkb24ndCBoYXZlIGNoaWxkcmVuXHJcbiAgICAgICAgICAgICAgICAgICAgIC8vIFBsYWNlaG9sZGVycywgYXNzaWduZWQgZHVyaW5nIHJlbmRlcmluZ1xyXG4gICAgICAgICAgICAgICAgICAgICBlbGVtZW50OiBudWxsISwgY2hlY2tib3g6IG51bGwhLCBsYWJlbDogbnVsbCEsIGNvbnRhaW5lcjogbnVsbCFcclxuICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICBpZiAocGFyZW50Tm9kZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAvLyBFbnN1cmUgY2hpbGRyZW4gYXJyYXkgZXhpc3RzXHJcbiAgICAgICAgICAgICAgICAgICAgIGlmICghcGFyZW50Tm9kZS5jaGlsZHJlbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnROb2RlLmNoaWxkcmVuID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgLy8gQWRkIGZpbGUgdG8gaXRzIHBhcmVudCBmb2xkZXIncyBjaGlsZHJlblxyXG4gICAgICAgICAgICAgICAgICAgICBwYXJlbnROb2RlLmNoaWxkcmVuIS5wdXNoKGZpbGVOb2RlKTtcclxuICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGNhc2Ugc2hvdWxkIGlkZWFsbHkgbm90IGhhcHBlbiBpZiBTdGVwIDEgd29ya2VkIGNvcnJlY3RseSBmb3IgYWxsIGZvbGRlcnNcclxuICAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS53YXJuKGBDb3VsZCBub3QgZmluZCBwYXJlbnQgbm9kZSBmb3IgcGF0aCBcIiR7cGFyZW50UGF0aH1cIiB3aGlsZSBhZGRpbmcgZmlsZSBcIiR7ZmlsZS5wYXRofVwiLmApOyAvLyBPcHRpb25hbCB3YXJuaW5nXHJcbiAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyAtLS0gU3RlcCAzOiBTb3J0IGNoaWxkcmVuIGFscGhhYmV0aWNhbGx5IChmb2xkZXJzIGZpcnN0LCB0aGVuIGZpbGVzKSAtLS1cclxuICAgICAgICBjb25zdCBzb3J0Tm9kZXMgPSAoYTogVHJlZU5vZGUsIGI6IFRyZWVOb2RlKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChhLnR5cGUgPT09ICdmb2xkZXInICYmIGIudHlwZSA9PT0gJ2ZpbGUnKSByZXR1cm4gLTE7IC8vIEZvbGRlcnMgY29tZSBmaXJzdFxyXG4gICAgICAgICAgICBpZiAoYS50eXBlID09PSAnZmlsZScgJiYgYi50eXBlID09PSAnZm9sZGVyJykgcmV0dXJuIDE7ICAvLyBGaWxlcyBjb21lIGFmdGVyXHJcbiAgICAgICAgICAgIHJldHVybiBhLm5hbWUubG9jYWxlQ29tcGFyZShiLm5hbWUpOyAvLyBTb3J0IGFscGhhYmV0aWNhbGx5IGJ5IG5hbWVcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBTb3J0IGNoaWxkcmVuIG9mIGV2ZXJ5IGZvbGRlciBub2RlXHJcbiAgICAgICAgZm9sZGVyTm9kZXMuZm9yRWFjaChub2RlID0+IG5vZGUuY2hpbGRyZW4/LnNvcnQoc29ydE5vZGVzKSk7XHJcblxyXG4gICAgICAgIHJldHVybiB2YXVsdFJvb3ROb2RlOyAvLyBSZXR1cm4gdGhlIHBvcHVsYXRlZCByb290IG5vZGVcclxuICAgIH1cclxuXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZW5kZXJzIHRoZSBlbnRpcmUgdHJlZSBzdHJ1Y3R1cmUgaW4gdGhlIERPTSBiYXNlZCBvbiB0aGUgdHJlZSBkYXRhLlxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHJlbmRlclRyZWUoKSB7XHJcbiAgICAgICAgIHRoaXMudHJlZVJvb3RFbGVtZW50LmVtcHR5KCk7IC8vIENsZWFyIGV4aXN0aW5nIERPTSBlbGVtZW50c1xyXG4gICAgICAgICB0aGlzLnRyZWVOb2Rlcy5jbGVhcigpOyAvLyBDbGVhciB0aGUgbm9kZSBtYXBcclxuXHJcbiAgICAgICAgIGNvbnN0IHRyZWVEYXRhID0gdGhpcy5idWlsZFRyZWVEYXRhKCk7IC8vIEdldCB0aGUgc3RydWN0dXJlZCBkYXRhXHJcblxyXG4gICAgICAgICAvLyBDcmVhdGUgdGhlIHRvcC1sZXZlbCBsaXN0IGZvciB0aGUgdmF1bHQgY29udGVudHNcclxuICAgICAgICAgY29uc3Qgcm9vdFVsID0gdGhpcy50cmVlUm9vdEVsZW1lbnQuY3JlYXRlRWwoJ3VsJyk7XHJcbiAgICAgICAgIHJvb3RVbC5hZGRDbGFzcygndHJlZS1yb290LXVsJyk7XHJcbiAgICAgICAgIHJvb3RVbC5zdHlsZS5saXN0U3R5bGUgPSAnbm9uZSc7XHJcbiAgICAgICAgIHJvb3RVbC5zdHlsZS5wYWRkaW5nTGVmdCA9ICcwJzsgLy8gUmVtb3ZlIGRlZmF1bHQgbGlzdCBpbmRlbnRhdGlvblxyXG5cclxuICAgICAgICAgLy8gUmVuZGVyIGNoaWxkcmVuIG9mIHRoZSB2aXJ0dWFsIHZhdWx0IHJvb3Qgbm9kZVxyXG4gICAgICAgICB0cmVlRGF0YS5jaGlsZHJlbj8uZm9yRWFjaChjaGlsZE5vZGUgPT4ge1xyXG4gICAgICAgICAgICAgdGhpcy5yZW5kZXJUcmVlTm9kZShjaGlsZE5vZGUsIHJvb3RVbCwgMCk7IC8vIFN0YXJ0IHJlbmRlcmluZyBhdCBsZXZlbCAwXHJcbiAgICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmVjdXJzaXZlbHkgcmVuZGVycyBhIHNpbmdsZSB0cmVlIG5vZGUgYW5kIGl0cyBjaGlsZHJlbiBpbiB0aGUgRE9NLlxyXG4gICAgICogQHBhcmFtIG5vZGUgLSBUaGUgVHJlZU5vZGUgZGF0YSB0byByZW5kZXIuXHJcbiAgICAgKiBAcGFyYW0gcGFyZW50RWxlbWVudCAtIFRoZSBIVE1MIGB1bGAgZWxlbWVudCB0byBhcHBlbmQgdGhpcyBub2RlJ3MgYGxpYCB0by5cclxuICAgICAqIEBwYXJhbSBsZXZlbCAtIFRoZSBjdXJyZW50IGluZGVudGF0aW9uIGxldmVsLlxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHJlbmRlclRyZWVOb2RlKG5vZGU6IFRyZWVOb2RlLCBwYXJlbnRFbGVtZW50OiBIVE1MRWxlbWVudCwgbGV2ZWw6IG51bWJlcikge1xyXG4gICAgICAgIGNvbnN0IGxpID0gcGFyZW50RWxlbWVudC5jcmVhdGVFbCgnbGknKTtcclxuICAgICAgICBsaS5zdHlsZS5tYXJnaW5MZWZ0ID0gYCR7bGV2ZWwgKiAyMH1weGA7IC8vIEFwcGx5IGluZGVudGF0aW9uIGJhc2VkIG9uIGxldmVsXHJcbiAgICAgICAgbGkuYWRkQ2xhc3MoYHRyZWUtbm9kZS0ke25vZGUudHlwZX1gKTsgLy8gQWRkIGNsYXNzIGZvciB0eXBlIChmb2xkZXIvZmlsZSlcclxuXHJcbiAgICAgICAgY29uc3QgY29udGFpbmVyID0gbGkuY3JlYXRlRGl2KHsgY2xzOiAndHJlZS1ub2RlLWNvbnRhaW5lcicgfSk7XHJcbiAgICAgICAgY29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7XHJcbiAgICAgICAgY29udGFpbmVyLnN0eWxlLmFsaWduSXRlbXMgPSAnY2VudGVyJztcclxuICAgICAgICBjb250YWluZXIuc3R5bGUucGFkZGluZyA9ICcycHggMCc7IC8vIEFkZCBzb21lIHZlcnRpY2FsIHBhZGRpbmdcclxuXHJcbiAgICAgICAgLy8gLS0tIENoZWNrYm94IC0tLVxyXG4gICAgICAgIGNvbnN0IGNoZWNrYm94ID0gY29udGFpbmVyLmNyZWF0ZUVsKCdpbnB1dCcsIHsgdHlwZTogJ2NoZWNrYm94JyB9KTtcclxuICAgICAgICBjaGVja2JveC5pZCA9IGB0cmVlLWNiLSR7bm9kZS5wYXRoLnJlcGxhY2UoL1teYS16QS1aMC05XS9nLCAnLScpfWA7IC8vIENyZWF0ZSBhIHNhZmUgSURcclxuICAgICAgICBjaGVja2JveC5kYXRhc2V0LnBhdGggPSBub2RlLnBhdGg7IC8vIFN0b3JlIHBhdGggaW4gZGF0YSBhdHRyaWJ1dGVcclxuICAgICAgICBjaGVja2JveC5kYXRhc2V0LnR5cGUgPSBub2RlLnR5cGU7IC8vIFN0b3JlIHR5cGVcclxuXHJcbiAgICAgICAgLy8gLS0tIExhYmVsIC0tLVxyXG4gICAgICAgIGNvbnN0IGxhYmVsID0gY29udGFpbmVyLmNyZWF0ZUVsKCdsYWJlbCcpO1xyXG4gICAgICAgIC8vIEFkZCBpY29ucyBmb3IgdmlzdWFsIGRpc3RpbmN0aW9uIChvcHRpb25hbClcclxuICAgICAgICBsYWJlbC50ZXh0Q29udGVudCA9IGAke25vZGUudHlwZSA9PT0gJ2ZvbGRlcicgPyAnXHVEODNEXHVEQ0MxJyA6ICdcdUQ4M0RcdURDQzQnfSAke25vZGUubmFtZX1gO1xyXG4gICAgICAgIGxhYmVsLmh0bWxGb3IgPSBjaGVja2JveC5pZDsgLy8gTGluayBsYWJlbCB0byBjaGVja2JveFxyXG4gICAgICAgIGxhYmVsLnN0eWxlLm1hcmdpbkxlZnQgPSAnNXB4JztcclxuICAgICAgICBsYWJlbC5zdHlsZS5jdXJzb3IgPSAncG9pbnRlcic7XHJcbiAgICAgICAgbGFiZWwudGl0bGUgPSBub2RlLnBhdGg7IC8vIFNob3cgZnVsbCBwYXRoIG9uIGhvdmVyXHJcblxyXG4gICAgICAgIC8vIC0tLSBTdG9yZSByZWZlcmVuY2VzIGluIHRoZSBub2RlIG9iamVjdCBhbmQgbWFwIC0tLVxyXG4gICAgICAgIG5vZGUuZWxlbWVudCA9IGxpO1xyXG4gICAgICAgIG5vZGUuY2hlY2tib3ggPSBjaGVja2JveDtcclxuICAgICAgICBub2RlLmxhYmVsID0gbGFiZWw7XHJcbiAgICAgICAgbm9kZS5jb250YWluZXIgPSBjb250YWluZXI7IC8vIFN0b3JlIGNvbnRhaW5lciByZWZlcmVuY2VcclxuICAgICAgICB0aGlzLnRyZWVOb2Rlcy5zZXQobm9kZS5wYXRoLCBub2RlKTtcclxuXHJcbiAgICAgICAgLy8gLS0tIFNldCBpbml0aWFsIGNoZWNrZWQgc3RhdGUgYmFzZWQgb24gY3VycmVudCBzZWxlY3Rpb24gLS0tXHJcbiAgICAgICAgaWYgKG5vZGUudHlwZSA9PT0gJ2ZvbGRlcicpIHtcclxuICAgICAgICAgICAgY2hlY2tib3guY2hlY2tlZCA9IHRoaXMuY3VycmVudEZvbGRlcnMuaGFzKG5vZGUucGF0aCk7XHJcbiAgICAgICAgfSBlbHNlIHsgLy8gZmlsZVxyXG4gICAgICAgICAgICBjaGVja2JveC5jaGVja2VkID0gdGhpcy5jdXJyZW50RmlsZXMuaGFzKG5vZGUucGF0aCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyAtLS0gQWRkIGV2ZW50IGxpc3RlbmVyIGZvciBjaGVja2JveCBjaGFuZ2VzIC0tLVxyXG4gICAgICAgIGNoZWNrYm94Lm9uY2hhbmdlID0gKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IGV2ZW50LnRhcmdldCBhcyBIVE1MSW5wdXRFbGVtZW50O1xyXG4gICAgICAgICAgICBjb25zdCBwYXRoID0gdGFyZ2V0LmRhdGFzZXQucGF0aCE7XHJcbiAgICAgICAgICAgIGNvbnN0IHR5cGUgPSB0YXJnZXQuZGF0YXNldC50eXBlIGFzICdmb2xkZXInIHwgJ2ZpbGUnO1xyXG5cclxuICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBjdXJyZW50IHNlbGVjdGlvbiBzZXRzXHJcbiAgICAgICAgICAgIGlmICh0YXJnZXQuY2hlY2tlZCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdmb2xkZXInKSB0aGlzLmN1cnJlbnRGb2xkZXJzLmFkZChwYXRoKTtcclxuICAgICAgICAgICAgICAgIGVsc2UgdGhpcy5jdXJyZW50RmlsZXMuYWRkKHBhdGgpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSAnZm9sZGVyJykgdGhpcy5jdXJyZW50Rm9sZGVycy5kZWxldGUocGF0aCk7XHJcbiAgICAgICAgICAgICAgICAgZWxzZSB0aGlzLmN1cnJlbnRGaWxlcy5kZWxldGUocGF0aCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSB2aXN1YWwgc3RhdGUgb2YgdGhlIGVudGlyZSB0cmVlIGFmdGVyIGEgY2hhbmdlXHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlVHJlZUFwcGVhcmFuY2UoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyAtLS0gUmVuZGVyIGNoaWxkcmVuIHJlY3Vyc2l2ZWx5IGlmIGl0J3MgYSBmb2xkZXIgLS0tXHJcbiAgICAgICAgaWYgKG5vZGUudHlwZSA9PT0gJ2ZvbGRlcicgJiYgbm9kZS5jaGlsZHJlbiAmJiBub2RlLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgY29uc3QgY2hpbGRyZW5VbCA9IGxpLmNyZWF0ZUVsKCd1bCcpO1xyXG4gICAgICAgICAgICBjaGlsZHJlblVsLnN0eWxlLmxpc3RTdHlsZSA9ICdub25lJztcclxuICAgICAgICAgICAgY2hpbGRyZW5VbC5zdHlsZS5wYWRkaW5nTGVmdCA9ICcwJzsgLy8gUmVzZXQgcGFkZGluZyBmb3IgbmVzdGVkIGxpc3RcclxuICAgICAgICAgICAgY2hpbGRyZW5VbC5zdHlsZS5tYXJnaW5MZWZ0ID0gJzAnOyAvLyBQcmV2ZW50IGRvdWJsZSBpbmRlbnRhdGlvbiBmcm9tIGRlZmF1bHQgVUwgc3R5bGVzXHJcbiAgICAgICAgICAgIG5vZGUuY2hpbGRyZW4uZm9yRWFjaChjaGlsZCA9PiB0aGlzLnJlbmRlclRyZWVOb2RlKGNoaWxkLCBjaGlsZHJlblVsLCBsZXZlbCArIDEpKTsgLy8gSW5jcmVhc2UgbGV2ZWwgZm9yIGNoaWxkcmVuXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvKipcclxuICAgICAqIFVwZGF0ZXMgdGhlIHZpc3VhbCBhcHBlYXJhbmNlIChlbmFibGVkL2Rpc2FibGVkL3N0eWxpbmcpIG9mIGFsbCBub2Rlc1xyXG4gICAgICogaW4gdGhlIHRyZWUgYmFzZWQgb24gdGhlIGN1cnJlbnQgbW9kZSBhbmQgc2VsZWN0aW9ucy5cclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSB1cGRhdGVUcmVlQXBwZWFyYW5jZSgpIHtcclxuICAgICAgICB0aGlzLnRyZWVOb2Rlcy5mb3JFYWNoKChub2RlKSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBpc0Rpc2FibGVkID0gZmFsc2U7IC8vIFNob3VsZCB0aGUgbm9kZSBhcHBlYXIgZGlzYWJsZWQgKGdyZXllZCBvdXQpP1xyXG4gICAgICAgICAgICBsZXQgaXNFZmZlY3RpdmVseUluY2x1ZGVkID0gZmFsc2U7IC8vIElzIHRoZSBub2RlIHBhcnQgb2YgdGhlICdhY3RpdmUnIHNldCBpbiBpbmNsdWRlIG1vZGU/XHJcbiAgICAgICAgICAgIGxldCBpc0VmZmVjdGl2ZWx5RXhjbHVkZWQgPSBmYWxzZTsgLy8gSXMgdGhlIG5vZGUgcGFydCBvZiB0aGUgJ2luYWN0aXZlJyBzZXQgaW4gZXhjbHVkZSBtb2RlP1xyXG5cclxuICAgICAgICAgICAgLy8gRGV0ZXJtaW5lIGlmIGFuIGFuY2VzdG9yIEZPTERFUiBvZiB0aGlzIG5vZGUgaXMgc2VsZWN0ZWRcclxuICAgICAgICAgICAgbGV0IGFuY2VzdG9yRm9sZGVyU2VsZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgbGV0IGN1cnJlbnRQYXRoID0gbm9kZS5wYXRoO1xyXG4gICAgICAgICAgICB3aGlsZSAoY3VycmVudFBhdGggIT09ICcvJykge1xyXG4gICAgICAgICAgICAgICAgIGNvbnN0IHBhcmVudFBhdGggPSBjdXJyZW50UGF0aC5zdWJzdHJpbmcoMCwgY3VycmVudFBhdGgubGFzdEluZGV4T2YoJy8nKSkgfHwgJy8nO1xyXG4gICAgICAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRGb2xkZXJzLmhhcyhwYXJlbnRQYXRoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICBhbmNlc3RvckZvbGRlclNlbGVjdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgIGlmIChwYXJlbnRQYXRoID09PSBjdXJyZW50UGF0aCkgYnJlYWs7IC8vIFNhZmV0eSBicmVhayBhdCByb290XHJcbiAgICAgICAgICAgICAgICAgY3VycmVudFBhdGggPSBwYXJlbnRQYXRoO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgbm9kZSBpdHNlbGYgaXMgc2VsZWN0ZWRcclxuICAgICAgICAgICAgY29uc3Qgbm9kZVNlbGVjdGVkID0gbm9kZS50eXBlID09PSAnZm9sZGVyJ1xyXG4gICAgICAgICAgICAgICAgPyB0aGlzLmN1cnJlbnRGb2xkZXJzLmhhcyhub2RlLnBhdGgpXHJcbiAgICAgICAgICAgICAgICA6IHRoaXMuY3VycmVudEZpbGVzLmhhcyhub2RlLnBhdGgpO1xyXG5cclxuICAgICAgICAgICAgLy8gLS0tIEFwcGx5IExvZ2ljIEJhc2VkIG9uIE1vZGUgLS0tXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRNb2RlID09PSAnZXhjbHVkZScpIHtcclxuICAgICAgICAgICAgICAgIC8vIEVYQ0xVREUgTW9kZTogQSBub2RlIGlzIGNvbnNpZGVyZWQgZXhjbHVkZWQgaWYgaXQgT1IgYW4gYW5jZXN0b3IgRk9MREVSIGlzIHNlbGVjdGVkLlxyXG4gICAgICAgICAgICAgICAgLy8gVmlzdWFsbHkgZGlzYWJsZSAoZ3JleSBvdXQpIG5vZGVzIHRoYXQgYXJlIGV4Y2x1ZGVkLlxyXG4gICAgICAgICAgICAgICAgaXNFZmZlY3RpdmVseUV4Y2x1ZGVkID0gbm9kZVNlbGVjdGVkIHx8IGFuY2VzdG9yRm9sZGVyU2VsZWN0ZWQ7XHJcbiAgICAgICAgICAgICAgICBpc0Rpc2FibGVkID0gaXNFZmZlY3RpdmVseUV4Y2x1ZGVkO1xyXG4gICAgICAgICAgICB9IGVsc2UgeyAvLyBJTkNMVURFIE1vZGVcclxuICAgICAgICAgICAgICAgIC8vIElOQ0xVREUgTW9kZTogQSBub2RlIGlzIGNvbnNpZGVyZWQgaW5jbHVkZWQgaWYgaXQgT1IgYW4gYW5jZXN0b3IgRk9MREVSIGlzIHNlbGVjdGVkLlxyXG4gICAgICAgICAgICAgICAgLy8gVmlzdWFsbHkgZGlzYWJsZSAoZ3JleSBvdXQpIG5vZGVzIHRoYXQgYXJlIE5PVCBpbmNsdWRlZC5cclxuICAgICAgICAgICAgICAgIGlmIChub2RlLnR5cGUgPT09ICdmb2xkZXInKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXNFZmZlY3RpdmVseUluY2x1ZGVkID0gbm9kZVNlbGVjdGVkIHx8IGFuY2VzdG9yRm9sZGVyU2VsZWN0ZWQ7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgeyAvLyBmaWxlXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gRmlsZSBpbmNsdWRlZCBpZiBzZWxlY3RlZCBPUiBwYXJlbnQgcGF0aCBpcyBpbmNsdWRlZFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcmVudFBhdGggPSBub2RlLnBhdGguc3Vic3RyaW5nKDAsIG5vZGUucGF0aC5sYXN0SW5kZXhPZignLycpKSB8fCAnLyc7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFyZW50RWZmZWN0aXZlbHlJbmNsdWRlZCA9IHRoaXMuaXNQYXRoRWZmZWN0aXZlbHlJbmNsdWRlZChwYXJlbnRQYXRoKTsgLy8gQ2hlY2sgcGFyZW50IGZvbGRlciBzdGF0dXNcclxuICAgICAgICAgICAgICAgICAgICBpc0VmZmVjdGl2ZWx5SW5jbHVkZWQgPSBub2RlU2VsZWN0ZWQgfHwgcGFyZW50RWZmZWN0aXZlbHlJbmNsdWRlZDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlzRGlzYWJsZWQgPSAhaXNFZmZlY3RpdmVseUluY2x1ZGVkO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyAtLS0gQXBwbHkgVmlzdWFsIFN0eWxlcyAtLS1cclxuICAgICAgICAgICAgLy8gQ2hlY2tib3ggaXRzZWxmIHNob3VsZCBhbHdheXMgYmUgY2xpY2thYmxlIHRvIGNoYW5nZSBzZWxlY3Rpb24gc3RhdGVcclxuICAgICAgICAgICAgbm9kZS5jaGVja2JveC5kaXNhYmxlZCA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgLy8gQXBwbHkgc3R5bGluZyB0byB0aGUgY29udGFpbmVyIChsYWJlbCwgaWNvbikgYmFzZWQgb24gZGlzYWJsZWQgc3RhdGVcclxuICAgICAgICAgICAgaWYgKGlzRGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgICAgIG5vZGUuY29udGFpbmVyLnN0eWxlLm9wYWNpdHkgPSAnMC41JztcclxuICAgICAgICAgICAgICAgIG5vZGUubGFiZWwuc3R5bGUudGV4dERlY29yYXRpb24gPSAnbGluZS10aHJvdWdoJzsgLy8gTW9yZSBwcm9taW5lbnQgZGlzYWJsZWQgbG9va1xyXG4gICAgICAgICAgICAgICAgbm9kZS5lbGVtZW50LmFkZENsYXNzKCdpcy1kaXNhYmxlZCcpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbm9kZS5jb250YWluZXIuc3R5bGUub3BhY2l0eSA9ICcxJztcclxuICAgICAgICAgICAgICAgIG5vZGUubGFiZWwuc3R5bGUudGV4dERlY29yYXRpb24gPSAnbm9uZSc7XHJcbiAgICAgICAgICAgICAgICBub2RlLmVsZW1lbnQucmVtb3ZlQ2xhc3MoJ2lzLWRpc2FibGVkJyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIC0tLSBGSVggZm9yIEludmFsaWRDaGFyYWN0ZXJFcnJvciAtLS1cclxuICAgICAgICAgICAgLy8gUmVtb3ZlIGNsYXNzZXMgaW5kaXZpZHVhbGx5XHJcbiAgICAgICAgICAgIG5vZGUuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdpcy1pbmNsdWRlZCcsICdpcy1leGNsdWRlZCcpO1xyXG5cclxuICAgICAgICAgICAgLy8gQWRkIHNwZWNpZmljIGNsYXNzZXMgZm9yIHN0eWxpbmcgaW5jbHVkZWQvZXhjbHVkZWQgc3RhdGVzXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRNb2RlID09PSAnaW5jbHVkZScgJiYgaXNFZmZlY3RpdmVseUluY2x1ZGVkKSB7XHJcbiAgICAgICAgICAgICAgICBub2RlLmVsZW1lbnQuYWRkQ2xhc3MoJ2lzLWluY2x1ZGVkJyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5jdXJyZW50TW9kZSA9PT0gJ2V4Y2x1ZGUnICYmIGlzRWZmZWN0aXZlbHlFeGNsdWRlZCkge1xyXG4gICAgICAgICAgICAgICAgIC8vIEFwcGx5IGV4Y2x1ZGVkIGNsYXNzIGV2ZW4gaWYgaXQncyBqdXN0IHZpc3VhbGx5IGRpc2FibGVkXHJcbiAgICAgICAgICAgICAgICAgLy8gVGhpcyBhbGxvd3Mgc3BlY2lmaWMgc3R5bGluZyBmb3IgZXhjbHVkZWQgaXRlbXMgYmV5b25kIGp1c3QgZ3JleWVkIG91dFxyXG4gICAgICAgICAgICAgICAgbm9kZS5lbGVtZW50LmFkZENsYXNzKCdpcy1leGNsdWRlZCcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBIZWxwZXIgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIGlmIGEgZ2l2ZW4gcGF0aCBpcyBlZmZlY3RpdmVseSBpbmNsdWRlZFxyXG4gICAgICogaW4gdGhlIGN1cnJlbnQgc2VsZWN0aW9uIHVuZGVyICdpbmNsdWRlJyBtb2RlLlxyXG4gICAgICogQSBwYXRoIGlzIGluY2x1ZGVkIGlmIGl0IChmaWxlIG9yIGZvbGRlcikgaXMgc2VsZWN0ZWQsIG9yIGlmIGFueSBvZiBpdHMgYW5jZXN0b3IgRk9MREVSUyBhcmUgc2VsZWN0ZWQuXHJcbiAgICAgKiBAcGFyYW0gcGF0aCAtIFRoZSBmb2xkZXIgb3IgZmlsZSBwYXRoIHRvIGNoZWNrLlxyXG4gICAgICogQHJldHVybnMgVHJ1ZSBpZiB0aGUgcGF0aCBzaG91bGQgYmUgY29uc2lkZXJlZCBpbmNsdWRlZCwgZmFsc2Ugb3RoZXJ3aXNlLlxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGlzUGF0aEVmZmVjdGl2ZWx5SW5jbHVkZWQocGF0aDogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICAgICAgLy8gVGhpcyBjaGVjayBpcyBwcmltYXJpbHkgZm9yICdpbmNsdWRlJyBtb2RlIGxvZ2ljLlxyXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRNb2RlICE9PSAnaW5jbHVkZScpIHtcclxuICAgICAgICAgICAgIC8vIEluICdleGNsdWRlJyBtb2RlLCBjb25jZXB0dWFsbHkgZXZlcnl0aGluZyBpcyBpbmNsdWRlZCB1bmxlc3MgZXhjbHVkZWQuXHJcbiAgICAgICAgICAgICAvLyBGb3IgaW50ZXJuYWwgY2hlY2tzLCB3ZSBtaWdodCBuZWVkIHRoZSBpbnZlcnNlIG9mIGV4Y2x1c2lvbi5cclxuICAgICAgICAgICAgIHJldHVybiAhdGhpcy5pc1BhdGhFZmZlY3RpdmVseUV4Y2x1ZGVkKHBhdGgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIHBhdGggaXRzZWxmIGlzIHNlbGVjdGVkIChhcHBsaWVzIHRvIGJvdGggZmlsZXMgYW5kIGZvbGRlcnMpXHJcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudEZpbGVzLmhhcyhwYXRoKSB8fCB0aGlzLmN1cnJlbnRGb2xkZXJzLmhhcyhwYXRoKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIENoZWNrIGlmIGFueSBhbmNlc3RvciBGT0xERVIgaXMgc2VsZWN0ZWRcclxuICAgICAgICBsZXQgY3VycmVudCA9IHBhdGg7XHJcbiAgICAgICAgd2hpbGUgKGN1cnJlbnQgIT09ICcvJykge1xyXG4gICAgICAgICAgICBjb25zdCBwYXJlbnRQYXRoID0gY3VycmVudC5zdWJzdHJpbmcoMCwgY3VycmVudC5sYXN0SW5kZXhPZignLycpKSB8fCAnLyc7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRGb2xkZXJzLmhhcyhwYXJlbnRQYXRoKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7IC8vIEFuIGFuY2VzdG9yIGZvbGRlciBpcyBzZWxlY3RlZFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChwYXJlbnRQYXRoID09PSBjdXJyZW50KSBicmVhazsgLy8gUmVhY2hlZCByb290IG9yIGVycm9yXHJcbiAgICAgICAgICAgIGN1cnJlbnQgPSBwYXJlbnRQYXRoO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGZhbHNlOyAvLyBOZWl0aGVyIHRoZSBwYXRoIG5vciBhbnkgYW5jZXN0b3IgZm9sZGVyIGlzIHNlbGVjdGVkXHJcbiAgICB9XHJcblxyXG4gICAgIC8qKlxyXG4gICAgICogSGVscGVyIGZ1bmN0aW9uIHRvIGRldGVybWluZSBpZiBhIGdpdmVuIHBhdGggaXMgZWZmZWN0aXZlbHkgZXhjbHVkZWRcclxuICAgICAqIGluIHRoZSBjdXJyZW50IHNlbGVjdGlvbiB1bmRlciAnZXhjbHVkZScgbW9kZS5cclxuICAgICAqIEEgcGF0aCBpcyBleGNsdWRlZCBpZiBpdCAoZmlsZSBvciBmb2xkZXIpIGlzIHNlbGVjdGVkLCBvciBpZiBhbnkgb2YgaXRzIGFuY2VzdG9yIEZPTERFUlMgYXJlIHNlbGVjdGVkLlxyXG4gICAgICogQHBhcmFtIHBhdGggLSBUaGUgZm9sZGVyIG9yIGZpbGUgcGF0aCB0byBjaGVjay5cclxuICAgICAqIEByZXR1cm5zIFRydWUgaWYgdGhlIHBhdGggc2hvdWxkIGJlIGNvbnNpZGVyZWQgZXhjbHVkZWQsIGZhbHNlIG90aGVyd2lzZS5cclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBpc1BhdGhFZmZlY3RpdmVseUV4Y2x1ZGVkKHBhdGg6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgICAgICAvLyBUaGlzIGNoZWNrIGlzIHByaW1hcmlseSBmb3IgJ2V4Y2x1ZGUnIG1vZGUgbG9naWMuXHJcbiAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRNb2RlICE9PSAnZXhjbHVkZScpIHtcclxuICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgfVxyXG5cclxuICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIHBhdGggaXRzZWxmIGlzIHNlbGVjdGVkXHJcbiAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRGaWxlcy5oYXMocGF0aCkgfHwgdGhpcy5jdXJyZW50Rm9sZGVycy5oYXMocGF0aCkpIHtcclxuICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICB9XHJcblxyXG4gICAgICAgICAvLyBDaGVjayBpZiBhbnkgYW5jZXN0b3IgRk9MREVSIGlzIHNlbGVjdGVkXHJcbiAgICAgICAgIGxldCBjdXJyZW50ID0gcGF0aDtcclxuICAgICAgICAgd2hpbGUgKGN1cnJlbnQgIT09ICcvJykge1xyXG4gICAgICAgICAgICAgY29uc3QgcGFyZW50UGF0aCA9IGN1cnJlbnQuc3Vic3RyaW5nKDAsIGN1cnJlbnQubGFzdEluZGV4T2YoJy8nKSkgfHwgJy8nO1xyXG4gICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudEZvbGRlcnMuaGFzKHBhcmVudFBhdGgpKSB7XHJcbiAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7IC8vIEFuIGFuY2VzdG9yIGZvbGRlciBpcyBzZWxlY3RlZFxyXG4gICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgaWYgKHBhcmVudFBhdGggPT09IGN1cnJlbnQpIGJyZWFrOyAvLyBSZWFjaGVkIHJvb3Qgb3IgZXJyb3JcclxuICAgICAgICAgICAgIGN1cnJlbnQgPSBwYXJlbnRQYXRoO1xyXG4gICAgICAgICB9XHJcblxyXG4gICAgICAgICByZXR1cm4gZmFsc2U7IC8vIE5laXRoZXIgdGhlIHBhdGggbm9yIGFueSBhbmNlc3RvciBmb2xkZXIgaXMgc2VsZWN0ZWQgZm9yIGV4Y2x1c2lvblxyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvKipcclxuICAgICAqIENvbWJpbmVzIGJ1aWxkaW5nIHRoZSB0cmVlIGRhdGEsIHJlbmRlcmluZyB0aGUgRE9NLCBhbmQgYXBwbHlpbmcgaW5pdGlhbCBhcHBlYXJhbmNlLlxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGJ1aWxkQW5kUmVuZGVyVHJlZSgpIHtcclxuICAgICAgICB0aGlzLnJlbmRlclRyZWUoKTsgLy8gQnVpbGQgZGF0YSBhbmQgcmVuZGVyIERPTSBlbGVtZW50c1xyXG4gICAgICAgIHRoaXMudXBkYXRlVHJlZUFwcGVhcmFuY2UoKTsgLy8gQXBwbHkgc3R5bGVzIGJhc2VkIG9uIGN1cnJlbnQgbW9kZS9zZWxlY3Rpb25cclxuICAgIH1cclxuXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDYWxsZWQgd2hlbiB0aGUgbW9kYWwgaXMgY2xvc2VkLiBDbGVhbnMgdXAgcmVzb3VyY2VzLlxyXG4gICAgICovXHJcbiAgICBvbkNsb3NlKCkge1xyXG4gICAgICAgIC8vIEdhdGhlciB0aGUgZmluYWwgc3RhdGUgT05MWSB3aGVuIE9LIGlzIGNsaWNrZWRcclxuICAgICAgICBjb25zdCByZXN1bHQ6IERpcmVjdG9yeVNlbGVjdGlvblJlc3VsdCA9IHtcclxuICAgICAgICAgICAgZm9sZGVyczogQXJyYXkuZnJvbSh0aGlzLmN1cnJlbnRGb2xkZXJzKSxcclxuICAgICAgICAgICAgZmlsZXM6IEFycmF5LmZyb20odGhpcy5jdXJyZW50RmlsZXMpLFxyXG4gICAgICAgICAgICBtb2RlOiB0aGlzLmN1cnJlbnRNb2RlLFxyXG4gICAgICAgICAgICBkaXNwbGF5OiB0aGlzLmN1cnJlbnREaXNwbGF5LFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJPSyBDbGlja2VkIC0gUmV0dXJuaW5nIFJlc3VsdDpcIiwgcmVzdWx0KTsgLy8gRGVidWcgbG9nXHJcbiAgICAgICAgdGhpcy5va0NhbGxiYWNrKHJlc3VsdCk7IC8vIFBhc3MgdGhlIGZpbmFsIHNlbGVjdGlvbiBiYWNrXHJcbiAgICAgICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XHJcbiAgICAgICAgY29udGVudEVsLmVtcHR5KCk7IC8vIENsZWFyIHRoZSBtb2RhbCdzIGNvbnRlbnRcclxuICAgICAgICB0aGlzLnRyZWVOb2Rlcy5jbGVhcigpOyAvLyBDbGVhciB0aGUgbm9kZSBtYXAgdG8gZnJlZSBtZW1vcnlcclxuICAgICAgICB0aGlzLm1vZGVEcm9wZG93biA9IG51bGw7IC8vIENsZWFyIHJlZmVyZW5jZVxyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogSGVscGVyIGZ1bmN0aW9uIHRvIGVhc2lseSBvcGVuIHRoZSBEaXJlY3RvcnkgU2VsZWN0aW9uIE1vZGFsLlxyXG4gKlxyXG4gKiBAcGFyYW0gYXBwIC0gVGhlIE9ic2lkaWFuIEFwcCBpbnN0YW5jZS5cclxuICogQHBhcmFtIGluaXRpYWxGb2xkZXJzIC0gQXJyYXkgb2YgaW5pdGlhbGx5IHNlbGVjdGVkIGZvbGRlciBwYXRocy5cclxuICogQHBhcmFtIGluaXRpYWxGaWxlcyAtIEFycmF5IG9mIGluaXRpYWxseSBzZWxlY3RlZCBmaWxlIHBhdGhzLlxyXG4gKiBAcGFyYW0gaW5pdGlhbE1vZGUgLSBUaGUgaW5pdGlhbCBzZWxlY3Rpb24gbW9kZSAoJ2luY2x1ZGUnIG9yICdleGNsdWRlJykuXHJcbiAqIEBwYXJhbSBva0NhbGxiYWNrIC0gRnVuY3Rpb24gdG8gY2FsbCB3aGVuIHRoZSB1c2VyIGNsaWNrcyBcIk9LXCIuIFJlY2VpdmVzIHRoZSBzZWxlY3Rpb24gcmVzdWx0LlxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIG9wZW5EaXJlY3RvcnlTZWxlY3Rpb25Nb2RhbChcclxuICAgIGFwcDogQXBwLFxyXG4gICAgaW5pdGlhbEZvbGRlcnM6IHN0cmluZ1tdLFxyXG4gICAgaW5pdGlhbEZpbGVzOiBzdHJpbmdbXSxcclxuICAgIGluaXRpYWxNb2RlOiAnaW5jbHVkZScgfCAnZXhjbHVkZScsXHJcbiAgICBpbml0aWFsRGlzcGxheTogJ2ZvbGRlcnMnIHwgJ2ZpbGVzJyxcclxuICAgIGluY2x1ZGVFeGNsdWRlU2VsZWN0YWJsZTogYm9vbGVhbixcclxuICAgIG9rQ2FsbGJhY2s6IChyZXN1bHQ6IERpcmVjdG9yeVNlbGVjdGlvblJlc3VsdCB8IG51bGwpID0+IHZvaWRcclxuKTogdm9pZCB7XHJcbiAgICAvLyBDcmVhdGUgYW5kIG9wZW4gdGhlIG1vZGFsIGluc3RhbmNlXHJcbiAgICBuZXcgRGlyZWN0b3J5U2VsZWN0aW9uTW9kYWwoXHJcbiAgICAgICAgYXBwLFxyXG4gICAgICAgIGluaXRpYWxGb2xkZXJzLFxyXG4gICAgICAgIGluaXRpYWxGaWxlcyxcclxuICAgICAgICBpbml0aWFsTW9kZSxcclxuICAgICAgICBpbml0aWFsRGlzcGxheSxcclxuICAgICAgICBpbmNsdWRlRXhjbHVkZVNlbGVjdGFibGUsXHJcbiAgICAgICAgb2tDYWxsYmFja1xyXG4gICAgKS5vcGVuKCk7XHJcbn1cclxuXHJcbi8qXHJcbi8vIC0tLSBFeGFtcGxlIFVzYWdlIGluIHlvdXIgUGx1Z2luJ3MgU2V0dGluZ3MgVGFiIC0tLVxyXG4vLyAoUGxhY2UgdGhpcyBpbiB5b3VyIHNldHRpbmdzIHRhYiBmaWxlLCBlLmcuLCBzZXR0aW5ncy50cylcclxuXHJcbmltcG9ydCB7IEFwcCwgUGx1Z2luU2V0dGluZ1RhYiwgU2V0dGluZyB9IGZyb20gJ29ic2lkaWFuJztcclxuaW1wb3J0IHsgb3BlbkRpcmVjdG9yeVNlbGVjdGlvbk1vZGFsLCBEaXJlY3RvcnlTZWxlY3Rpb25SZXN1bHQgfSBmcm9tICcuL0RpcmVjdG9yeVNlbGVjdGlvbk1vZGFsJzsgLy8gQWRqdXN0IHBhdGggYXMgbmVlZGVkXHJcbmltcG9ydCBZb3VyUGx1Z2luIGZyb20gJy4vbWFpbic7IC8vIEFkanVzdCBwYXRoIHRvIHlvdXIgbWFpbiBwbHVnaW4gZmlsZVxyXG5cclxuLy8gLS0tIEV4YW1wbGUgUGx1Z2luIFNldHRpbmdzIEludGVyZmFjZSAoaW4geW91ciBtYWluLnRzIG9yIHNldHRpbmdzIGZpbGUpIC0tLVxyXG5leHBvcnQgaW50ZXJmYWNlIFlvdXJQbHVnaW5TZXR0aW5ncyB7XHJcbiAgICBzZWxlY3RlZEZvbGRlcnM6IHN0cmluZ1tdO1xyXG4gICAgc2VsZWN0ZWRGaWxlczogc3RyaW5nW107XHJcbiAgICBzZWxlY3Rpb25Nb2RlOiAnaW5jbHVkZScgfCAnZXhjbHVkZSc7XHJcbiAgICAvLyAuLi4gb3RoZXIgc2V0dGluZ3MgZm9yIHlvdXIgcGx1Z2luXHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBERUZBVUxUX1NFVFRJTkdTOiBZb3VyUGx1Z2luU2V0dGluZ3MgPSB7XHJcbiAgICBzZWxlY3RlZEZvbGRlcnM6IFtdLFxyXG4gICAgc2VsZWN0ZWRGaWxlczogW10sXHJcbiAgICBzZWxlY3Rpb25Nb2RlOiAnZXhjbHVkZScsIC8vIERlZmF1bHQgbW9kZSBpcyBvZnRlbiAnZXhjbHVkZSdcclxuICAgIC8vIC4uLiBvdGhlciBkZWZhdWx0IHNldHRpbmdzXHJcbn1cclxuXHJcblxyXG5leHBvcnQgY2xhc3MgWW91clBsdWdpblNldHRpbmdzVGFiIGV4dGVuZHMgUGx1Z2luU2V0dGluZ1RhYiB7XHJcbiAgICBwbHVnaW46IFlvdXJQbHVnaW47XHJcblxyXG4gICAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogWW91clBsdWdpbikge1xyXG4gICAgICAgIHN1cGVyKGFwcCwgcGx1Z2luKTtcclxuICAgICAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcclxuICAgIH1cclxuXHJcbiAgICBkaXNwbGF5KCk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IHsgY29udGFpbmVyRWwgfSA9IHRoaXM7XHJcbiAgICAgICAgY29udGFpbmVyRWwuZW1wdHkoKTtcclxuXHJcbiAgICAgICAgY29udGFpbmVyRWwuY3JlYXRlRWwoJ2gyJywgeyB0ZXh0OiAnRWluc3RlbGx1bmdlbiBmXHUwMEZDciBNZWluIFBsdWdpbicgfSk7IC8vIFNldHRpbmdzIFRpdGxlIGluIEdlcm1hblxyXG5cclxuICAgICAgICAvLyAtLS0gQnV0dG9uIHRvIE9wZW4gdGhlIE1vZGFsIC0tLVxyXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxyXG4gICAgICAgICAgICAuc2V0TmFtZSgnVmVyemVpY2huaXNzZS9EYXRlaWVuIGtvbmZpZ3VyaWVyZW4nKSAvLyBTZXR0aW5nIE5hbWUgaW4gR2VybWFuXHJcbiAgICAgICAgICAgIC5zZXREZXNjKCdLbGlja2UgYXVmIGRlbiBCdXR0b24sIHVtIGRpZSBBdXN3YWhsIHp1IGJlYXJiZWl0ZW4uJykgLy8gU2V0dGluZyBEZXNjcmlwdGlvbiBpbiBHZXJtYW5cclxuICAgICAgICAgICAgLmFkZEJ1dHRvbihidXR0b24gPT4ge1xyXG4gICAgICAgICAgICAgICAgYnV0dG9uXHJcbiAgICAgICAgICAgICAgICAgICAgLnNldEJ1dHRvblRleHQoJ0F1c3dhaGwgXHUwMEY2ZmZuZW4nKSAvLyBCdXR0b24gVGV4dCBpbiBHZXJtYW5cclxuICAgICAgICAgICAgICAgICAgICAuc2V0Q3RhKCkgLy8gTWFrZXMgdGhlIGJ1dHRvbiBtb3JlIHByb21pbmVudFxyXG4gICAgICAgICAgICAgICAgICAgIC5vbkNsaWNrKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmV0cmlldmUgY3VycmVudCBzZXR0aW5ncyB0byBwcmUtcG9wdWxhdGUgdGhlIG1vZGFsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRGb2xkZXJzID0gdGhpcy5wbHVnaW4uc2V0dGluZ3Muc2VsZWN0ZWRGb2xkZXJzIHx8IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50RmlsZXMgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zZWxlY3RlZEZpbGVzIHx8IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50TW9kZSA9IHRoaXMucGx1Z2luLnNldHRpbmdzLnNlbGVjdGlvbk1vZGUgfHwgJ2V4Y2x1ZGUnOyAvLyBVc2UgZGVmYXVsdCBpZiBub3Qgc2V0XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBPcGVuIHRoZSBtb2RhbFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcGVuRGlyZWN0b3J5U2VsZWN0aW9uTW9kYWwoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRGb2xkZXJzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudEZpbGVzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudE1vZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIHRoZSBva0NhbGxiYWNrIGZ1bmN0aW9uOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKHJlc3VsdDogRGlyZWN0b3J5U2VsZWN0aW9uUmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0F1c3dhaGwgYmVzdFx1MDBFNHRpZ3Q6JywgcmVzdWx0KTsgLy8gTG9nIHJlc3VsdCBpbiBHZXJtYW4gY29uc29sZVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0gSU1QT1JUQU5UOiBTYXZlIHRoZSByZXN1bHRzIGJhY2sgdG8geW91ciBwbHVnaW4gc2V0dGluZ3MgLS0tXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Muc2VsZWN0ZWRGb2xkZXJzID0gcmVzdWx0LmZvbGRlcnM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Muc2VsZWN0ZWRGaWxlcyA9IHJlc3VsdC5maWxlcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zZWxlY3Rpb25Nb2RlID0gcmVzdWx0Lm1vZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7IC8vIFBlcnNpc3QgdGhlIGNoYW5nZXNcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gT3B0aW9uYWxseSwgcmUtcmVuZGVyIHRoZSBzZXR0aW5ncyB0YWIgdG8gc2hvdyB0aGUgdXBkYXRlZCBzZWxlY3Rpb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc3BsYXkoKTsgLy8gUmUtcmVuZGVyIHNldHRpbmdzIHRhYlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgIC8vIC0tLSBEaXNwbGF5IEN1cnJlbnQgU2VsZWN0aW9uIChSZWFkLW9ubHkpIC0tLVxyXG4gICAgICAgICBjb25zdCBzZWxlY3Rpb25JbmZvRWwgPSBjb250YWluZXJFbC5jcmVhdGVEaXYoeyBjbHM6ICdzZXR0aW5ncy1zZWxlY3Rpb24taW5mbycgfSk7XHJcbiAgICAgICAgIHNlbGVjdGlvbkluZm9FbC5jcmVhdGVFbCgnaDQnLCB7IHRleHQ6ICdBa3R1ZWxsZSBBdXN3YWhsOicgfSk7IC8vIFNlY3Rpb24gVGl0bGUgaW4gR2VybWFuXHJcbiAgICAgICAgIGNvbnN0IG1vZGVUZXh0ID0gYE1vZHVzOiAke3RoaXMucGx1Z2luLnNldHRpbmdzLnNlbGVjdGlvbk1vZGUgfHwgJ05pY2h0IGZlc3RnZWxlZ3QnfWA7IC8vIFRleHQgaW4gR2VybWFuXHJcbiAgICAgICAgIC8vIFRydW5jYXRlIGxvbmcgbGlzdHMgZm9yIGRpc3BsYXkgaWYgbmVjZXNzYXJ5XHJcbiAgICAgICAgIGNvbnN0IGZvbGRlclRleHQgPSBgQXVzZ2V3XHUwMEU0aGx0ZSBPcmRuZXI6ICR7KHRoaXMucGx1Z2luLnNldHRpbmdzLnNlbGVjdGVkRm9sZGVycz8ubGVuZ3RoIHx8IDApfSBTdFx1MDBGQ2NrYDsgLy8gVGV4dCBpbiBHZXJtYW5cclxuICAgICAgICAgY29uc3QgZmlsZVRleHQgPSBgQXVzZ2V3XHUwMEU0aGx0ZSBEYXRlaWVuOiAkeyh0aGlzLnBsdWdpbi5zZXR0aW5ncy5zZWxlY3RlZEZpbGVzPy5sZW5ndGggfHwgMCl9IFN0XHUwMEZDY2tgOyAvLyBUZXh0IGluIEdlcm1hblxyXG5cclxuICAgICAgICAgc2VsZWN0aW9uSW5mb0VsLmNyZWF0ZUVsKCdwJywgeyB0ZXh0OiBtb2RlVGV4dCB9KTtcclxuICAgICAgICAgc2VsZWN0aW9uSW5mb0VsLmNyZWF0ZUVsKCdwJywgeyB0ZXh0OiBmb2xkZXJUZXh0IH0pO1xyXG4gICAgICAgICBzZWxlY3Rpb25JbmZvRWwuY3JlYXRlRWwoJ3AnLCB7IHRleHQ6IGZpbGVUZXh0IH0pO1xyXG4gICAgICAgICAvLyBZb3UgY291bGQgYWRkIGEgc21hbGwgYnV0dG9uL2xpbmsgaGVyZSB0byB2aWV3IHRoZSBmdWxsIGxpc3QgaWYgaXQncyBsb25nXHJcbiAgICB9XHJcbn1cclxuKi9cclxuIiwgImltcG9ydCB7IEFwcCwgUGx1Z2luLCBQbHVnaW5TZXR0aW5nVGFiLCBTZXR0aW5nLCBEcm9wZG93bkNvbXBvbmVudCwgVGV4dENvbXBvbmVudCwgQnV0dG9uQ29tcG9uZW50LCBUb2dnbGVDb21wb25lbnQsIHNldEljb24sIGFwaVZlcnNpb24gfSBmcm9tICdvYnNpZGlhbic7XHJcbmltcG9ydCB7IG9wZW5EaXJlY3RvcnlTZWxlY3Rpb25Nb2RhbCwgRGlyZWN0b3J5U2VsZWN0aW9uUmVzdWx0IH0gZnJvbSAnLi9kaXJlY3RvcnlTZWxlY3Rpb25Nb2RhbCc7XHJcbmltcG9ydCB7IHZlcnNpb25TdHJpbmcsIEZvbGRlclRhZ1J1bGVEZWZpbml0aW9uLCBERUZBVUxUX1JVTEVfREVGSU5JVElPTiwgUHJvcGVydHlUeXBlSW5mbywgREVGQVVMVF9GSUxURVJfRklMRVNfQU5EX0ZPTERFUlN9IGZyb20gJy4vdHlwZXMnO1xyXG5pbXBvcnQgeyBnZXRSdWxlRnVuY3Rpb25CeUlkLCBydWxlRnVuY3Rpb25zLCBSdWxlRnVuY3Rpb24sIGV4ZWN1dGVSdWxlIH0gZnJvbSAnLi9ydWxlcyc7XHJcbmltcG9ydCB7IEFsZXJ0TW9kYWwgfSBmcm9tICcuL2FsZXJ0Qm94JztcclxuaW1wb3J0IHsgcmFuZG9tVVVJRCB9IGZyb20gJ2NyeXB0byc7XHJcblxyXG5leHBvcnQgdHlwZSBQcm9wZXJ0eUluZm8gPSB7XHJcbiAgICBuYW1lOiBzdHJpbmc7XHJcbiAgICB0eXBlOiBzdHJpbmc7XHJcbiAgICBjb3VudD86IG51bWJlcjtcclxufTtcclxuXHJcbmV4cG9ydCBjbGFzcyBSdWxlc1RhYmxlIGV4dGVuZHMgUGx1Z2luU2V0dGluZ1RhYiB7XHJcbiAgICBwbHVnaW46IGFueTtcclxuICAgIGtub3duUHJvcGVydGllczogUmVjb3JkPHN0cmluZywgUHJvcGVydHlJbmZvPiA9IHt9OyAvLyBDYWNoZSBmXHUwMEZDciBnZWZ1bmRlbmUgUHJvcGVydGllc1xyXG4gICAgY29udGFpbmVyOiBIVE1MRGl2RWxlbWVudDtcclxuICAgIHNldHRpbmdzUGFyYW1ldGVyOiBzdHJpbmc7XHJcblxyXG4gICAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogYW55LCBjb250YWluZXI6IEhUTUxEaXZFbGVtZW50LCBzZXR0aW5nc1BhcmFtZXRlcjogc3RyaW5nKSB7XHJcbiAgICAgICAgc3VwZXIoYXBwLCBwbHVnaW4pO1xyXG4gICAgICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyID0gY29udGFpbmVyO1xyXG4gICAgICAgIHRoaXMuc2V0dGluZ3NQYXJhbWV0ZXIgPSBzZXR0aW5nc1BhcmFtZXRlcjtcclxuICAgIH1cclxuXHJcbiAgICAvLyBGdW5rdGlvbiB6dW0gQWJydWZlbiB1bmQgU3BlaWNoZXJuIGRlciBiZWthbm50ZW4gUHJvcGVydGllcyAoYXN5bmMpXHJcbiAgICBhc3luYyBmZXRjaEtub3duUHJvcGVydGllcygpIHtcclxuICAgICAgICB0aGlzLmtub3duUHJvcGVydGllcyA9IGF3YWl0IHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0QWxsUHJvcGVydHlJbmZvcygpO1xyXG4gICAgICAgIHRoaXMua25vd25Qcm9wZXJ0aWVzID0gT2JqZWN0LmZyb21FbnRyaWVzKFxyXG4gICAgICAgICAgICBPYmplY3QuZW50cmllcyh0aGlzLmtub3duUHJvcGVydGllcykuc29ydCgoW2tleUFdLCBba2V5Ql0pID0+IGtleUEubG9jYWxlQ29tcGFyZShrZXlCKSlcclxuICAgICAgICApO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMua25vd25Qcm9wZXJ0aWVzKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBIZWxwZXIgenVtIFJlbmRlcm4gRUlORVIgRWlnZW5zY2hhZnRzemVpbGVcclxuICAgIHJlbmRlclByb3BlcnR5Um93KGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudCwgcnVsZTogRm9sZGVyVGFnUnVsZURlZmluaXRpb24sIGluZGV4OiBudW1iZXIpIHtcclxuICAgICAgICBcclxuICAgICAgICBjb25zdCBhY3RpdmVGaWxlID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZUZpbGUoKTtcclxuXHJcbiAgICAgICAgLy8gVmVyd2VuZGUgY3JlYXRlRGl2IHN0YXR0IFNldHRpbmcgZlx1MDBGQ3Igdm9sbGUgTGF5b3V0LUtvbnRyb2xsZSB1bmQga29tcGFrdGVyZXMgQXVzc2VoZW5cclxuICAgICAgICBjb25zdCByb3dFbCA9IGNvbnRhaW5lckVsLmNyZWF0ZURpdih7IGNsczogJ3Byb3BlcnR5LXNldHRpbmctcm93IHNldHRpbmctaXRlbScgfSk7IC8vIEZcdTAwRkNnZSAnc2V0dGluZy1pdGVtJyBmXHUwMEZDciBTdGFuZGFyZC1TdHlsaW5nIGhpbnp1XHJcbiAgICAgICAgY29uc3QgY29udHJvbEVsID0gcm93RWwuY3JlYXRlRGl2KHsgY2xzOiAnc2V0dGluZy1pdGVtLWNvbnRyb2wnIH0pOyAvLyBDb250YWluZXIgZlx1MDBGQ3IgYWxsZSBDb250cm9sc1xyXG4gICAgICAgIGNvbnRyb2xFbC5zdHlsZS5nYXAgPSAnMHB4JztcclxuICAgICAgICAvLyAtLS0gTGlua2VyIFRlaWw6IEljb24gJiBEdXJjaHN1Y2hiYXJlIEVpZ2Vuc2NoYWZ0c2F1c3dhaGwgLS0tXHJcbiAgICAgICAgY29uc3QgbGVmdENvbnRhaW5lciA9IGNvbnRyb2xFbC5jcmVhdGVEaXYoeyBjbHM6ICdwcm9wZXJ0eS1sZWZ0LWNvbnRhaW5lcicgfSk7XHJcbiAgICAgICAgY29uc3QgaWNvbkVsID0gbGVmdENvbnRhaW5lci5jcmVhdGVTcGFuKHsgY2xzOiAncHJvcGVydHktaWNvbiBzZXR0aW5nLWl0ZW0taWNvbicgfSk7IC8vIFN0YW5kYXJkLUljb24tS2xhc3NlXHJcbiAgICAgICAgc2V0SWNvbihpY29uRWwsICdoYXNoJyk7IC8vIFN0YW5kYXJkLUljb25cclxuXHJcbiAgICAgICAgLy8gQ29udGFpbmVyIGZcdTAwRkNyIGRhcyBTdWNoZmVsZCB1bmQgZGllIEVyZ2VibmlzbGlzdGVcclxuICAgICAgICBjb25zdCBzZWFyY2hDb250YWluZXIgPSBsZWZ0Q29udGFpbmVyLmNyZWF0ZURpdih7IGNsczogJ3Byb3BlcnR5LXNlYXJjaC1jb250YWluZXInIH0pO1xyXG5cclxuICAgICAgICAvLyBUZXh0ZmVsZCBmXHUwMEZDciBkaWUgU3VjaGUvQW56ZWlnZSBkZXMgYWt0dWVsbGVuIE5hbWVuc1xyXG4gICAgICAgIGNvbnN0IG5hbWVJbnB1dCA9IG5ldyBUZXh0Q29tcG9uZW50KHNlYXJjaENvbnRhaW5lcilcclxuICAgICAgICAgICAgLnNldFBsYWNlaG9sZGVyKCdTZWxlY3QgcHJvcGVydHkuLi4nKVxyXG4gICAgICAgICAgICAuc2V0VmFsdWUocnVsZS5wcm9wZXJ0eSB8fCAnJylcclxuICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy8gRGlyZWt0ZSBcdTAwQzRuZGVydW5nIGhpZXIgbmljaHQgc3BlaWNoZXJuLCBBdXN3YWhsIGVyZm9sZ3QgXHUwMEZDYmVyIEVyZ2VibmlzbGlzdGVcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyU2VhcmNoUmVzdWx0cyhzZWFyY2hDb250YWluZXIsIHZhbHVlLCBpbmRleCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBFdmVudCBMaXN0ZW5lciBmXHUwMEZDciBGb2t1cyB1bmQgSW5wdXQsIHVtIEVyZ2Vibmlzc2UgYW56dXplaWdlbi9maWx0ZXJuXHJcbiAgICAgICAgbmFtZUlucHV0LmlucHV0RWwuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyU2VhcmNoUmVzdWx0cyhzZWFyY2hDb250YWluZXIsIG5hbWVJbnB1dC5nZXRWYWx1ZSgpLCBpbmRleCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgbmFtZUlucHV0LmlucHV0RWwuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyU2VhcmNoUmVzdWx0cyhzZWFyY2hDb250YWluZXIsIG5hbWVJbnB1dC5nZXRWYWx1ZSgpLCBpbmRleCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy8gU2NobGllXHUwMERGZSBkaWUgRXJnZWJuaXNsaXN0ZSBiZWkgS2xpY2sgYXVcdTAwREZlcmhhbGIgKHZlcmVpbmZhY2h0KVxyXG4gICAgICAgICBuYW1lSW5wdXQuaW5wdXRFbC5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAvLyBLbGVpbmUgVmVyelx1MDBGNmdlcnVuZywgZGFtaXQgS2xpY2sgYXVmIEVyZ2VibmlzbGlzdGUgbm9jaCBmdW5rdGlvbmllcnRcclxuICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy8gUHJcdTAwRkNmZW4gb2IgZGFzIG5ldWUgRm9rdXMtRWxlbWVudCBUZWlsIGRlciBFcmdlYm5pc2xpc3RlIGlzdFxyXG4gICAgICAgICAgICAgICAgIGNvbnN0IHJlbGF0ZWRUYXJnZXQgPSBldmVudC5yZWxhdGVkVGFyZ2V0IGFzIE5vZGU7XHJcbiAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0c0VsID0gc2VhcmNoQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5wcm9wZXJ0eS1zZWFyY2gtcmVzdWx0cycpO1xyXG4gICAgICAgICAgICAgICAgIGlmICghcmVzdWx0c0VsIHx8ICFyZXN1bHRzRWwuY29udGFpbnMocmVsYXRlZFRhcmdldCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGVhclNlYXJjaFJlc3VsdHMoc2VhcmNoQ29udGFpbmVyKTtcclxuICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICB9LCAxMDApO1xyXG4gICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgIC8vIFNldHplIGluaXRpYWxlcyBJY29uIGJhc2llcmVuZCBhdWYgZ2VzcGVpY2hlcnRlbSBOYW1lblxyXG4gICAgICAgIGNvbnN0IGN1cnJlbnRQcm9wZXJ0eUluZm8gPSB0aGlzLmtub3duUHJvcGVydGllc1tydWxlLnByb3BlcnR5XTtcclxuICAgICAgICBpZiAoY3VycmVudFByb3BlcnR5SW5mbykge1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVByb3BlcnR5SWNvbihpY29uRWwsIGN1cnJlbnRQcm9wZXJ0eUluZm8udHlwZSk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChydWxlLnByb3BlcnR5KSB7XHJcbiAgICAgICAgICAgIHNldEljb24oaWNvbkVsLCAnYWxlcnQtY2lyY2xlJyk7IC8vIFdhcm4tSWNvbiwgZmFsbHMgTmFtZSB1bmdcdTAwRkNsdGlnXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyAtLS0gTWl0dGxlcmVyIFRlaWw6IFdlcnRlLUVpbmdhYmVmZWxkIC0tLVxyXG4gICAgICAgIGNvbnN0IG1pZGRsZUNvbnRhaW5lciA9IGNvbnRyb2xFbC5jcmVhdGVEaXYoeyBjbHM6ICdwcm9wZXJ0eS1taWRkbGUtY29udGFpbmVyJyB9KTtcclxuICAgICAgICBjb25zdCB2YWx1ZUNvbnRhaW5lciA9IG1pZGRsZUNvbnRhaW5lci5jcmVhdGVEaXYoeyBjbHM6ICdwcm9wZXJ0eS12YWx1ZS1jb250YWluZXInIH0pO1xyXG4gICAgICAgIGlmIChhY3RpdmVGaWxlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYXBwLmZpbGVNYW5hZ2VyLnByb2Nlc3NGcm9udE1hdHRlcihhY3RpdmVGaWxlLCAoZnJvbnRtYXR0ZXIpID0+IHtcclxuICAgICAgICAgICAgICAgIHJ1bGUudmFsdWUgPSBleGVjdXRlUnVsZSh0aGlzLmFwcCwgdGhpcy5wbHVnaW4uc2V0dGluZ3MsIGFjdGl2ZUZpbGUsICcnLCBydWxlLCBmcm9udG1hdHRlcik7XHJcbiAgICAgICAgICAgIH0seydtdGltZSc6YWN0aXZlRmlsZS5zdGF0Lm10aW1lfSk7IC8vIGRvIG5vdCBjaGFuZ2UgdGhlIG1vZGlmeSB0aW1lLlxyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgcHJldmlld0NvbXBvbmVudCA9IHRoaXMucmVuZGVyVmFsdWVJbnB1dCh2YWx1ZUNvbnRhaW5lciwgY3VycmVudFByb3BlcnR5SW5mbywgcnVsZS52YWx1ZSwgaW5kZXgpO1xyXG5cclxuICAgICAgICBjb25zdCBwcm9wZXJ0eURldkRyb3Bkb3duID0gIG5ldyBEcm9wZG93bkNvbXBvbmVudChtaWRkbGVDb250YWluZXIpO1xyXG4gICAgICAgICAgICBwcm9wZXJ0eURldkRyb3Bkb3duLnNlbGVjdEVsLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCd3aWR0aDo1MCUnKTtcclxuICAgICAgICAgICAgcHJvcGVydHlEZXZEcm9wZG93bi5hZGRPcHRpb24oXCJcIiwgXCJTZWxlY3QgYSBjb250ZW50XCIpO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBydWxlRnVuY3Rpb24gb2YgcnVsZUZ1bmN0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocnVsZS50eXBlKTtcclxuICAgICAgICAgICAgICAgIGlmIChydWxlRnVuY3Rpb24udHlwZS5jb250YWlucyhydWxlLnR5cGUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlEZXZEcm9wZG93bi5hZGRPcHRpb24ocnVsZUZ1bmN0aW9uLmlkLCBydWxlRnVuY3Rpb24uZGVzY3JpcHRpb24pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHByb3BlcnR5RGV2RHJvcGRvd24uYWRkT3B0aW9uKFwic2NyaXB0XCIsIFwiSmF2YVNjcmlwdCBzY3JpcHRcIik7XHJcbiAgICAgICAgICAgIHByb3BlcnR5RGV2RHJvcGRvd24uc2V0VmFsdWUocnVsZS5jb250ZW50KTtcclxuICAgICAgICAgICAgcHJvcGVydHlEZXZEcm9wZG93bi5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCBqc0NvZGUgPSAnJztcclxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICdzY3JpcHQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBvbGRPcmlnaW5hbENvZGUgPSBnZXRSdWxlRnVuY3Rpb25CeUlkKHJ1bGUuY29udGVudCk/LnNvdXJjZSB8fCBydWxlRnVuY3Rpb25zWzBdLnNvdXJjZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChydWxlLmJ1aWxkSW5Db2RlICE9PSAnJykgJiYgKHJ1bGUuYnVpbGRJbkNvZGUgIT09IG9sZE9yaWdpbmFsQ29kZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNob3VsZFByb2NlZWQgPSBhd2FpdCBuZXcgQWxlcnRNb2RhbChcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdPdmVyd3JpdGUgZXhpc3RpbmcgY29kZT8nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnSSBzZWVzIGxpa2UgeW91IGhhdmUgY3VzdG9tIGNvZGUgZm9yIHRoaXMgcnVsZSEgU2hvdWxkIHRoaXMgYmUgb3ZlcndyaXR0ZW4gYnkgZGVmYXVsdCBjb2RlIGZvciB0aGlzIHBhcmFtZXRlcj8nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnWWVzJywgJ05vJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkub3BlbkFuZEdldFZhbHVlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2hvdWxkUHJvY2VlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpzQ29kZSA9IHJ1bGUuYnVpbGRJbkNvZGUgPSBnZXRSdWxlRnVuY3Rpb25CeUlkKHZhbHVlKT8uc291cmNlIHx8IHJ1bGVGdW5jdGlvbnNbMF0uc291cmNlOyAvLyBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAganNDb2RlID0gcnVsZS5idWlsZEluQ29kZTsgLy8ga2VlcCB0aGUgZXhpc3RpbmcgY29kZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9jbUVkaXRvcj8uc2V0VmFsdWUoanNDb2RlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAganNDb2RlID0gcnVsZS5idWlsZEluQ29kZSA9IGdldFJ1bGVGdW5jdGlvbkJ5SWQodmFsdWUpPy5zb3VyY2UgfHwgcnVsZUZ1bmN0aW9uc1swXS5zb3VyY2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2NtRWRpdG9yPy5zZXRWYWx1ZShqc0NvZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2NtRWRpdG9yPy5zZXRWYWx1ZShydWxlLmpzQ29kZSE9PScnID8gcnVsZS5qc0NvZGUgOiBydWxlRnVuY3Rpb25zWzBdLnNvdXJjZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJ1bGUuY29udGVudCA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vcnVsZU9wdGlvbnNEaXYuc3R5bGUuZGlzcGxheSA9IGAkeyhydWxlLmNvbnRlbnQgPT09ICdzY3JpcHQnKSA/ICdmbGV4JyA6ICdub25lJ31gO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vc2hvd0pzRnVuY3Rpb25CdXR0b24ocnVsZS5jb250ZW50KTtcclxuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVByZXZpZXcoYWN0aXZlRmlsZSwgcnVsZSwgcHJldmlld0NvbXBvbmVudC5pbnB1dEVsKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIC8vcnVsZU9wdGlvbnNEaXYuc3R5bGUuZGlzcGxheSA9IGAkeyhydWxlLmNvbnRlbnQgPT09ICdzY3JpcHQnKSAmJiAocnVsZS5zaG93Q29udGVudCkgPyAnZmxleCcgOiAnbm9uZSd9YDtcclxuXHJcbiAgICAgICAgbmV3IEJ1dHRvbkNvbXBvbmVudChtaWRkbGVDb250YWluZXIpXHJcbiAgICAgICAgLnNldEljb24oJ2dlYXInKVxyXG4gICAgICAgIC5zZXRUb29sdGlwKCdzZXR0aW5ncycpXHJcbiAgICAgICAgLnNldENsYXNzKCdwcm9wZXJ0eS1pY29uLWJ1dHRvbicpXHJcbiAgICAgICAgLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgc2V0dGluZ3NDb250YWluZXJzID0gY29udGFpbmVyRWwuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgncHJvcGVydHktb3B0aW9ucy1jb250YWluZXInKTtcclxuICAgICAgICAgICAgZm9yIChsZXQgY29udGFpbmVyIG9mIHNldHRpbmdzQ29udGFpbmVycykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGNvbnRhaW5lci5nZXRBdHRyaWJ1dGUoJ2lkJykgIT09IHJ1bGUuaWQpIGNvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywnZGlzcGxheTogbm9uZTsnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBvcHRpb25FTC5zdHlsZS5kaXNwbGF5ID0gb3B0aW9uRUwuc3R5bGUuZGlzcGxheSA9PT0gJ2Jsb2NrJyA/ICdub25lJyA6ICdibG9jayc7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIC0tLSByaWdodCBwYXJ0OiBlcmFzZSBydWxlIC0tLVxyXG4gICAgICAgIGNvbnN0IGRlbGV0ZUJ1dHRvbkNvbnRhaW5lciA9IGNvbnRyb2xFbC5jcmVhdGVEaXYoeyBjbHM6ICdwcm9wZXJ0eS1kZWxldGUtYnV0dG9uLWNvbnRhaW5lcicgfSk7XHJcbiAgICAgICAgbmV3IEJ1dHRvbkNvbXBvbmVudChkZWxldGVCdXR0b25Db250YWluZXIpXHJcbiAgICAgICAgICAgIC5zZXRJY29uKCd0cmFzaC0yJylcclxuICAgICAgICAgICAgLnNldFRvb2x0aXAoJ3JlbW92ZSB0aGlzIHJ1bGUnKVxyXG4gICAgICAgICAgICAuc2V0Q2xhc3MoJ21vZC1zdWJ0bGUnKVxyXG4gICAgICAgICAgICAub25DbGljayhhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5nc1t0aGlzLnNldHRpbmdzUGFyYW1ldGVyXS5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRpc3BsYXkoKTsgLy8gUmUtcmVuZGVyIHRoZSBzZXR0aW5ncyB0YWJcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGNvbnRyb2xFbC5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnO1xyXG4gICAgICAgIGNvbnRyb2xFbC5zdHlsZS5hbGlnbkl0ZW1zID0gJ2NlbnRlcic7XHJcbiAgICAgICAgY29udHJvbEVsLnN0eWxlLmp1c3RpZnlDb250ZW50ID0gJ3NwYWNlLWJldHdlZW4nO1xyXG4gICAgICAgIGNvbnRyb2xFbC5zdHlsZS53aWR0aCA9ICcxMDAlJztcclxuXHJcbiAgICAgICAgbGVmdENvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnO1xyXG4gICAgICAgIGxlZnRDb250YWluZXIuc3R5bGUuYWxpZ25JdGVtcyA9ICdjZW50ZXInO1xyXG4gICAgICAgIGxlZnRDb250YWluZXIuc3R5bGUubWluV2lkdGggPSAnMjAwcHgnOyBcclxuICAgICAgICBpY29uRWwuc3R5bGUubWFyZ2luUmlnaHQgPSAnOHB4JztcclxuXHJcbiAgICAgICAgc2VhcmNoQ29udGFpbmVyLnN0eWxlLnBvc2l0aW9uID0gJ3JlbGF0aXZlJzsgXHJcbiAgICAgICAgc2VhcmNoQ29udGFpbmVyLnN0eWxlLmZsZXhHcm93ID0gJzEnO1xyXG5cclxuICAgICAgICB2YWx1ZUNvbnRhaW5lci5zdHlsZS5mbGV4R3JvdyA9ICcyJzsgXHJcblxyXG4gICAgICAgIGRlbGV0ZUJ1dHRvbkNvbnRhaW5lci5zdHlsZS5tYXJnaW5MZWZ0ID0gJ2F1dG8nOyBcclxuXHJcbiAgICAgICAgY29uc3Qgb3B0aW9uRUwgPSBjb250YWluZXJFbC5jcmVhdGVEaXYoeyBjbHM6ICdwcm9wZXJ0eS1vcHRpb25zLWNvbnRhaW5lcicgfSk7IC8vIG9wdGlvbnMgY29udGFpbmVyXHJcbiAgICAgICAgb3B0aW9uRUwuaWQgPSBydWxlLmlkO1xyXG4gICAgICAgIG9wdGlvbkVMLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcblxyXG4gICAgICAgIGNvbnN0IHJlbW92ZUNvbnRlbnRCdXR0b24gPSBuZXcgU2V0dGluZyhvcHRpb25FTClcclxuICAgICAgICAgICAgLnNldE5hbWUoJ1JlbW92ZSBjb250ZW50JylcclxuICAgICAgICAgICAgLnNldERlc2MoYEJlZm9yZSBtYWtpbmcgY2hhbmdlcyB5b3UgbWlnaHQgY29uc2lkZXIgdG8gcmVtb3ZlIGNvbnRlbnQgZ2VuZXJhdGVkIGJ5IHRoaXMgcnVsZWApXHJcbiAgICAgICAgICAgIC5hZGRCdXR0b24oYnV0dG9uID0+IHtcclxuICAgICAgICAgICAgICAgIGJ1dHRvblxyXG4gICAgICAgICAgICAgICAgICAgIC5zZXRXYXJuaW5nKClcclxuICAgICAgICAgICAgICAgICAgICAuc2V0QnV0dG9uVGV4dCgnUmVtb3ZlIENvbnRlbnQnKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zZXRDdGEoKSAvLyBNYWtlcyB0aGUgYnV0dG9uIG1vcmUgcHJvbWluZW50XHJcbiAgICAgICAgICAgICAgICAgICAgLm9uQ2xpY2soKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgY291bnQgPSB0aGlzLnBsdWdpbi5yZW1vdmVGcm9udG1hdHRlclBhcmFtc0Zyb21BbGxGaWxlcyhydWxlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uLnJlbW92ZUN0YSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBidXR0b24uc2V0RGlzYWJsZWQodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZUNvbnRlbnRCdXR0b24uc2V0RGVzYyhgUmVtb3ZlZCB0aGlzIHJ1bGUgZnJvbSAke2NvdW50LmZpbGVzfSBmaWxlcy5gKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApO1xyXG5cclxuICAgICAgICBuZXcgU2V0dGluZyhvcHRpb25FTClcclxuICAgICAgICAgICAgLnNldE5hbWUoJ1J1bGUgYWN0aXZlJylcclxuICAgICAgICAgICAgLnNldERlc2MoJ0lmIGVuYWJsZWQsIHRoZSBydWxlIHdpbGwgYmUgZXhlY3V0ZWQnKVxyXG4gICAgICAgICAgICAuYWRkVG9nZ2xlKHRvZ2dsZSA9PiB0b2dnbGVcclxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZShydWxlLmFjdGl2ZSlcclxuICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBydWxlLmFjdGl2ZSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgaWYgKHJ1bGUudHlwZSA9PT0gJ3RleHQnIHx8IHJ1bGUudHlwZSA9PT0gJ211bHRpdGV4dCcgfHwgcnVsZS50eXBlID09PSAndGFncycgfHwgcnVsZS50eXBlID09PSAnYWxpYXNlcycpIHtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHJ1bGVGdW5jdGlvbiA9IHJ1bGVGdW5jdGlvbnMuZmluZChpdGVtID0+IGl0ZW0uaWQgPT09IHJ1bGUuY29udGVudClcclxuICAgICAgICAgICAgaWYgKHJ1bGVGdW5jdGlvbiAmJiBydWxlRnVuY3Rpb24uaW5wdXRQcm9wZXJ0eSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgaW5wdXRQcm9wZXJ0aWVzRHJvcGRvd247XHJcbiAgICAgICAgICAgICAgICBuZXcgU2V0dGluZyhvcHRpb25FTClcclxuICAgICAgICAgICAgICAgICAgICAuc2V0TmFtZSgnSW5wdXQgUHJvcGVydHknKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zZXREZXNjKCdTZWxlY3QgYSBwcm9wZXJ0eSBhcyBpbnB1dCcpXHJcbiAgICAgICAgICAgICAgICAgICAgLmFkZERyb3Bkb3duKGRyb3Bkb3duID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRQcm9wZXJ0aWVzRHJvcGRvd24gPSBkcm9wZG93bjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZHJvcGRvd25cclxuICAgICAgICAgICAgICAgICAgICAgICAgLnNldFZhbHVlKHJ1bGUuYWRkQ29udGVudClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJ1bGUuaW5wdXRQcm9wZXJ0eSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlUHJldmlldyhhY3RpdmVGaWxlLCBydWxlLCBwcmV2aWV3Q29tcG9uZW50LmlucHV0RWwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgT2JqZWN0LmVudHJpZXModGhpcy5rbm93blByb3BlcnRpZXMpLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5wdXRQcm9wZXJ0aWVzRHJvcGRvd24uYWRkT3B0aW9uKGl0ZW1bMV0ubmFtZSxpdGVtWzFdLm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIGlucHV0UHJvcGVydGllc0Ryb3Bkb3duLnNldFZhbHVlKHJ1bGUuaW5wdXRQcm9wZXJ0eSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChydWxlLnR5cGUgPT09ICd0YWdzJyB8fCBydWxlLnR5cGUgPT09ICdhbGlhc2VzJykge1xyXG4gICAgICAgICAgICAgICAgbmV3IFNldHRpbmcob3B0aW9uRUwpXHJcbiAgICAgICAgICAgICAgICAuc2V0TmFtZSgnUHJlZml4JylcclxuICAgICAgICAgICAgICAgIC5zZXREZXNjKCdPcHRpb25hbCBwcmVmaXggdG8gYWRkIGJlZm9yZSB0aGUgY29udGVudCcpXHJcbiAgICAgICAgICAgICAgICAuYWRkVGV4dCh0ZXh0ID0+IHRleHRcclxuICAgICAgICAgICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJ3ByZWZpeC8nKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zZXRWYWx1ZShydWxlLnByZWZpeClcclxuICAgICAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJ1bGUucHJlZml4ID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVByZXZpZXcoYWN0aXZlRmlsZSwgcnVsZSwgcHJldmlld0NvbXBvbmVudC5pbnB1dEVsKTtcclxuICAgICAgICAgICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBuZXcgU2V0dGluZyhvcHRpb25FTClcclxuICAgICAgICAgICAgLnNldE5hbWUoJ1NwYWNlIHJlcGxhY2VtZW50JylcclxuICAgICAgICAgICAgLnNldERlc2MoJ0NoYXJhY3RlciB0byByZXBsYWNlIHNwYWNlcyBpbiBmb2xkZXIgbmFtZXMgKHN1Z2dlc3RlZDogXCJfXCIpJylcclxuICAgICAgICAgICAgLmFkZFRleHQodGV4dCA9PiB0ZXh0XHJcbiAgICAgICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJ18nKVxyXG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHJ1bGUuc3BhY2VSZXBsYWNlbWVudClcclxuICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBydWxlLnNwYWNlUmVwbGFjZW1lbnQgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVByZXZpZXcoYWN0aXZlRmlsZSwgcnVsZSwgcHJldmlld0NvbXBvbmVudC5pbnB1dEVsKTtcclxuICAgICAgICAgICAgICAgIH0pKTtcclxuXHJcbiAgICAgICAgICAgIG5ldyBTZXR0aW5nKG9wdGlvbkVMKVxyXG4gICAgICAgICAgICAgICAgLnNldE5hbWUoJ1NwZWNpYWwgY2hhcmFjdGVyIHJlcGxhY2VtZW50JylcclxuICAgICAgICAgICAgICAgIC5zZXREZXNjKCdDaGFyYWN0ZXIgdG8gcmVwbGFjZSBzcGVjaWFsIGNoYXJhY3RlcnMgKHN1Z2dlc3RlZDogXCItXCIpIC0gcHJlc2VydmVzIGxldHRlcnMgd2l0aCBkaWFjcml0aWNzJylcclxuICAgICAgICAgICAgICAgIC5hZGRUZXh0KHRleHQgPT4gdGV4dFxyXG4gICAgICAgICAgICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcignLScpXHJcbiAgICAgICAgICAgICAgICAgICAgLnNldFZhbHVlKHJ1bGUuc3BlY2lhbENoYXJSZXBsYWNlbWVudClcclxuICAgICAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJ1bGUuc3BlY2lhbENoYXJSZXBsYWNlbWVudCA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVQcmV2aWV3KGFjdGl2ZUZpbGUsIHJ1bGUsIHByZXZpZXdDb21wb25lbnQuaW5wdXRFbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSkpO1xyXG5cclxuICAgICAgICAgICAgbmV3IFNldHRpbmcob3B0aW9uRUwpXHJcbiAgICAgICAgICAgICAgICAuc2V0TmFtZSgnQ29udmVydCB0byBsb3dlcmNhc2UnKVxyXG4gICAgICAgICAgICAgICAgLnNldERlc2MoJ0NvbnZlcnQgdmFsdWVzIHRvIGxvd2VyY2FzZScpXHJcbiAgICAgICAgICAgICAgICAuYWRkVG9nZ2xlKHRvZ2dsZSA9PiB0b2dnbGVcclxuICAgICAgICAgICAgICAgICAgICAuc2V0VmFsdWUocnVsZS5sb3dlcmNhc2VUYWdzKVxyXG4gICAgICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcnVsZS5sb3dlcmNhc2VUYWdzID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVByZXZpZXcoYWN0aXZlRmlsZSwgcnVsZSwgcHJldmlld0NvbXBvbmVudC5pbnB1dEVsKTtcclxuICAgICAgICAgICAgICAgICAgICB9KSk7XHJcblxyXG4gICAgICAgICAgICBuZXcgU2V0dGluZyhvcHRpb25FTClcclxuICAgICAgICAgICAgICAgIC5zZXROYW1lKCdSZXN1bHQgYXMgTGluaycpXHJcbiAgICAgICAgICAgICAgICAuc2V0RGVzYygnRm9ybWF0IFJlc3VsdCBhcyBMaW5rJylcclxuICAgICAgICAgICAgICAgIC5hZGRUb2dnbGUodG9nZ2xlID0+IHRvZ2dsZVxyXG4gICAgICAgICAgICAgICAgICAgIC5zZXRWYWx1ZShydWxlLmFzTGluaylcclxuICAgICAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJ1bGUuYXNMaW5rID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVByZXZpZXcoYWN0aXZlRmlsZSwgcnVsZSwgcHJldmlld0NvbXBvbmVudC5pbnB1dEVsKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHJ1bGUudHlwZSA9PT0gJ3RleHQnIHx8IHJ1bGUudHlwZSA9PT0gJ211bHRpdGV4dCcgfHwgcnVsZS50eXBlID09PSAndGFncycgfHwgcnVsZS50eXBlID09PSAnYWxpYXNlcycpIHtcclxuICAgICAgICAgICAgbmV3IFNldHRpbmcob3B0aW9uRUwpXHJcbiAgICAgICAgICAgICAgICAuc2V0TmFtZSgnQWRkIGNvbnRlbnQnKVxyXG4gICAgICAgICAgICAgICAgLnNldERlc2MoJ3NlbGVjdCBob3cgdGhlIGNvbnRlbnQgc2hvdWxkIGJlIHN0b3JlZCcpXHJcbiAgICAgICAgICAgICAgICAuYWRkRHJvcGRvd24oZHJvcGRvd24gPT4gZHJvcGRvd25cclxuICAgICAgICAgICAgICAgICAgICAuYWRkT3B0aW9uKFwib3ZlcndyaXRlXCIsIFwicmVwbGFjZSBjb250ZW50XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmFkZE9wdGlvbihcInN0YXJ0XCIsIFwicGxhY2Ugb24gc3RhcnRcIilcclxuICAgICAgICAgICAgICAgICAgICAuYWRkT3B0aW9uKFwiZW5kXCIsIFwicGxhY2Ugb24gZW5kXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLnNldFZhbHVlKHJ1bGUuYWRkQ29udGVudClcclxuICAgICAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJ1bGUuYWRkQ29udGVudCA9IHZhbHVlID09PSAnb3ZlcndyaXRlJyA/ICdvdmVyd3JpdGUnIDogdmFsdWUgPT09ICdzdGFydCcgPyAnc3RhcnQnIDogJ2VuZCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlUHJldmlldyhhY3RpdmVGaWxlLCBydWxlLCBwcmV2aWV3Q29tcG9uZW50LmlucHV0RWwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG5ldyBTZXR0aW5nKG9wdGlvbkVMKVxyXG4gICAgICAgIC5zZXROYW1lKCdFeGNsdWRlIEZpbGVzIGFuZCBGb2xkZXJzIGZyb20gdGhpcyBydWxlJylcclxuICAgICAgICAuc2V0RGVzYyhgQ3VycmVudGx5ICR7dGhpcy5wbHVnaW4uc2V0dGluZ3MuZXhjbHVkZS5zZWxlY3RlZEZvbGRlcnMubGVuZ3RofSBmb2xkZXJzIGFuZCAke3RoaXMucGx1Z2luLnNldHRpbmdzLmV4Y2x1ZGUuc2VsZWN0ZWRGaWxlcy5sZW5ndGh9IGZpbGVzIHdpbGwgYmUgJHt0aGlzLnBsdWdpbi5zZXR0aW5ncy5leGNsdWRlLm1vZGV9ZC5gKVxyXG4gICAgICAgIC5hZGRCdXR0b24oYnV0dG9uID0+IHtcclxuICAgICAgICAgICAgYnV0dG9uXHJcbiAgICAgICAgICAgICAgICAuc2V0SWNvbignZm9sZGVyLXgnKVxyXG4gICAgICAgICAgICAgICAgLnNldEJ1dHRvblRleHQoJ0V4Y2x1ZGUnKVxyXG4gICAgICAgICAgICAgICAgLnNldEN0YSgpIC8vIE1ha2VzIHRoZSBidXR0b24gbW9yZSBwcm9taW5lbnRcclxuICAgICAgICAgICAgICAgIC5vbkNsaWNrKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBvcGVuRGlyZWN0b3J5U2VsZWN0aW9uTW9kYWwoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBydWxlLmV4Y2x1ZGU/LnNlbGVjdGVkRm9sZGVycyB8fCBbXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcnVsZS5leGNsdWRlPy5zZWxlY3RlZEZpbGVzIHx8IFtdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnZXhjbHVkZScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJ1bGUuZXhjbHVkZT8uZGlzcGxheSB8fCAnZm9sZGVycycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlLCAvLyBpbmNsdWRlLCBleGNsdWRlIG9wdGlvbiBoaWRkZW5cclxuICAgICAgICAgICAgICAgICAgICAgICAgKHJlc3VsdDogRGlyZWN0b3J5U2VsZWN0aW9uUmVzdWx0IHwgbnVsbCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXN1bHQpIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcnVsZS5leGNsdWRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcnVsZS5leGNsdWRlPU9iamVjdC5hc3NpZ24oe30sIERFRkFVTFRfRklMVEVSX0ZJTEVTX0FORF9GT0xERVJTLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGUgOiAnaW5jbHVkZScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcnVsZS5leGNsdWRlLnNlbGVjdGVkRm9sZGVycyA9IHJlc3VsdC5mb2xkZXJzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcnVsZS5leGNsdWRlLnNlbGVjdGVkRmlsZXMgPSByZXN1bHQuZmlsZXM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBydWxlLmV4Y2x1ZGUuZGlzcGxheSA9IHJlc3VsdC5kaXNwbGF5O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy90aGlzLmRpc3BsYXkoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTsgICAgICAgICAgXHJcblxyXG4gICAgICAgIG5ldyBTZXR0aW5nKG9wdGlvbkVMKVxyXG4gICAgICAgIC5zZXROYW1lKCdJbmNsdWRlIEZpbGVzIGFuZCBGb2xkZXJzIGZvciB0aGlzIHJ1bGUgJylcclxuICAgICAgICAuc2V0RGVzYyhgQ3VycmVudGx5ICR7dGhpcy5wbHVnaW4uc2V0dGluZ3MuaW5jbHVkZS5zZWxlY3RlZEZvbGRlcnMubGVuZ3RofSBmb2xkZXJzIGFuZCAke3RoaXMucGx1Z2luLnNldHRpbmdzLmluY2x1ZGUuc2VsZWN0ZWRGaWxlcy5sZW5ndGh9IGZpbGVzIHdpbGwgYmUgJHt0aGlzLnBsdWdpbi5zZXR0aW5ncy5pbmNsdWRlLm1vZGV9ZCBldmVuIHdoZW4gaW4gZXhjbHVkZWQgRm9sZGVycy5gKVxyXG4gICAgICAgIC5hZGRCdXR0b24oYnV0dG9uID0+IHtcclxuICAgICAgICAgICAgYnV0dG9uXHJcbiAgICAgICAgICAgICAgICAuc2V0SWNvbignZm9sZGVyLWNoZWNrJylcclxuICAgICAgICAgICAgICAgIC5zZXRCdXR0b25UZXh0KCdJbmNsdWRlJylcclxuICAgICAgICAgICAgICAgIC5zZXRDdGEoKSAvLyBNYWtlcyB0aGUgYnV0dG9uIG1vcmUgcHJvbWluZW50XHJcbiAgICAgICAgICAgICAgICAub25DbGljaygoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgb3BlbkRpcmVjdG9yeVNlbGVjdGlvbk1vZGFsKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcnVsZS5pbmNsdWRlPy5zZWxlY3RlZEZvbGRlcnMgfHwgW10sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJ1bGUuaW5jbHVkZT8uc2VsZWN0ZWRGaWxlcyB8fCBbXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ2luY2x1ZGUnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBydWxlLmluY2x1ZGU/LmRpc3BsYXkgfHwgJ2ZvbGRlcnMnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSwgLy8gaW5jbHVkZSwgaW5jbHVkZSBvcHRpb24gaGlkZGVuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIChyZXN1bHQ6IERpcmVjdG9yeVNlbGVjdGlvblJlc3VsdCB8IG51bGwpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzdWx0KSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJ1bGUuaW5jbHVkZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJ1bGUuaW5jbHVkZSA9IE9iamVjdC5hc3NpZ24oe30sIERFRkFVTFRfRklMVEVSX0ZJTEVTX0FORF9GT0xERVJTLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGUgOiAnaW5jbHVkZScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcnVsZS5pbmNsdWRlLnNlbGVjdGVkRm9sZGVycyA9IHJlc3VsdC5mb2xkZXJzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcnVsZS5pbmNsdWRlLnNlbGVjdGVkRmlsZXMgPSByZXN1bHQuZmlsZXM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBydWxlLmluY2x1ZGUuZGlzcGxheSA9IHJlc3VsdC5kaXNwbGF5O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy90aGlzLmRpc3BsYXkoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBuZXcgU2V0dGluZyhvcHRpb25FTClcclxuICAgICAgICAgICAgLnNldE5hbWUoJ1NjcmlwdCcpXHJcbiAgICAgICAgICAgIC5zZXREZXNjKCdlZGl0IHRoZSBzY3JpcHQgZm9yIG93biBtb2RpZmljYXRpb25zJylcclxuICAgICAgICAgICAgLmFkZEJ1dHRvbihidXR0b24gPT4gYnV0dG9uXHJcbiAgICAgICAgICAgICAgICAuc2V0QnV0dG9uVGV4dCgnSlMgRWRpdG9yJylcclxuICAgICAgICAgICAgICAgIC5vbkNsaWNrKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIClcclxuICAgIH1cclxuXHJcbiAgICByZW5kZXJTZWFyY2hSZXN1bHRzKHNlYXJjaENvbnRhaW5lckVsOiBIVE1MRWxlbWVudCwgc2VhcmNoVGVybTogc3RyaW5nLCByb3dJbmRleDogbnVtYmVyKSB7XHJcbiAgICAgICAgdGhpcy5jbGVhclNlYXJjaFJlc3VsdHMoc2VhcmNoQ29udGFpbmVyRWwpO1xyXG5cclxuICAgICAgICBjb25zdCBmaWx0ZXJlZFByb3BlcnRpZXMgPSBPYmplY3QuZW50cmllcyh0aGlzLmtub3duUHJvcGVydGllcylcclxuICAgICAgICAgICAgLmZpbHRlcigoW25hbWVdKSA9PiBuYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoc2VhcmNoVGVybS50b0xvd2VyQ2FzZSgpKSk7XHJcblxyXG4gICAgICAgIGlmIChmaWx0ZXJlZFByb3BlcnRpZXMubGVuZ3RoID09PSAwICYmIHNlYXJjaFRlcm0pIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZmlsdGVyZWRQcm9wZXJ0aWVzLmxlbmd0aCA9PT0gMCAmJiAhc2VhcmNoVGVybSkge1xyXG4gICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGNvbnN0IHJlc3VsdHNFbCA9IHNlYXJjaENvbnRhaW5lckVsLmNyZWF0ZURpdih7IGNsczogJ3Byb3BlcnR5LXNlYXJjaC1yZXN1bHRzIG1lbnUnIH0pO1xyXG4gICAgICAgIHJlc3VsdHNFbC5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7XHJcbiAgICAgICAgcmVzdWx0c0VsLnN0eWxlLnRvcCA9ICcxMDAlJztcclxuICAgICAgICByZXN1bHRzRWwuc3R5bGUubGVmdCA9ICcwJztcclxuICAgICAgICByZXN1bHRzRWwuc3R5bGUud2lkdGggPSAnY2FsYygxMDAlICsgMjBweCknO1xyXG4gICAgICAgIHJlc3VsdHNFbC5zdHlsZS56SW5kZXggPSAnMTAnO1xyXG4gICAgICAgIHJlc3VsdHNFbC5zdHlsZS5tYXhIZWlnaHQgPSAnMjAwcHgnO1xyXG4gICAgICAgIHJlc3VsdHNFbC5zdHlsZS5vdmVyZmxvd1kgPSAnYXV0byc7XHJcblxyXG4gICAgICAgIGZpbHRlcmVkUHJvcGVydGllcy5mb3JFYWNoKChbbmFtZSwgaW5mb10pID0+IHtcclxuICAgICAgICAgICAgY29uc3QgaXRlbUVsID0gcmVzdWx0c0VsLmNyZWF0ZURpdih7IGNsczogJ21lbnUtaXRlbScgfSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGl0ZW1JY29uID0gaXRlbUVsLmNyZWF0ZVNwYW4oeyBjbHM6ICdtZW51LWl0ZW0taWNvbicgfSk7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlUHJvcGVydHlJY29uKGl0ZW1JY29uLCBpbmZvLnR5cGUpO1xyXG4gICAgICAgICAgICBpdGVtRWwuY3JlYXRlU3Bhbih7IHRleHQ6IG5hbWUgfSk7XHJcblxyXG4gICAgICAgICAgICBpdGVtRWwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgYXN5bmMgKGUpID0+IHtcclxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsgXHJcbiAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5nc1t0aGlzLnNldHRpbmdzUGFyYW1ldGVyXVtyb3dJbmRleF0ucHJvcGVydHkgPSBuYW1lO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3NbdGhpcy5zZXR0aW5nc1BhcmFtZXRlcl1bcm93SW5kZXhdLnR5cGUgPSBpbmZvLnR5cGU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5nc1t0aGlzLnNldHRpbmdzUGFyYW1ldGVyXVtyb3dJbmRleF0udmFsdWUgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xlYXJTZWFyY2hSZXN1bHRzKHNlYXJjaENvbnRhaW5lckVsKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGlzcGxheSgpOyAvLyBOZXUgcmVuZGVyblxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjbGVhclNlYXJjaFJlc3VsdHMoc2VhcmNoQ29udGFpbmVyRWw6IEhUTUxFbGVtZW50KSB7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0c0VsID0gc2VhcmNoQ29udGFpbmVyRWwucXVlcnlTZWxlY3RvcignLnByb3BlcnR5LXNlYXJjaC1yZXN1bHRzJyk7XHJcbiAgICAgICAgaWYgKHJlc3VsdHNFbCkge1xyXG4gICAgICAgICAgICByZXN1bHRzRWwucmVtb3ZlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJlbmRlclZhbHVlSW5wdXQoY29udGFpbmVyRWw6IEhUTUxFbGVtZW50LCBwcm9wZXJ0eUluZm86IFByb3BlcnR5SW5mbyB8IHVuZGVmaW5lZCwgY3VycmVudFZhbHVlOiBhbnksIGluZGV4OiBudW1iZXIpIHtcclxuICAgICAgICBsZXQgcmV0dXJuQ29tcG9uZW50O1xyXG4gICAgICAgIGNvbnRhaW5lckVsLmVtcHR5KCk7IFxyXG5cclxuICAgICAgICBpZiAoIXByb3BlcnR5SW5mbykge1xyXG4gICAgICAgICAgICAgY29udGFpbmVyRWwuc2V0VGV4dCgnJyk7XHJcbiAgICAgICAgICAgICBjb250YWluZXJFbC5hZGRDbGFzcygndGV4dC1tdXRlZCcpO1xyXG4gICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgdHlwZSA9IHByb3BlcnR5SW5mby50eXBlO1xyXG5cclxuICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcclxuICAgICAgICAgICAgICAgIHJldHVybkNvbXBvbmVudCA9IG5ldyBUZXh0Q29tcG9uZW50KGNvbnRhaW5lckVsKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcignWmFobGVud2VydCcpXHJcbiAgICAgICAgICAgICAgICAgICAgLnNldFZhbHVlKGN1cnJlbnRWYWx1ZSAhPT0gdW5kZWZpbmVkICYmIGN1cnJlbnRWYWx1ZSAhPT0gbnVsbCA/IFN0cmluZyhjdXJyZW50VmFsdWUpIDogJycpXHJcbiAgICAgICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBudW1WYWx1ZSA9IHZhbHVlID09PSAnJyA/IHVuZGVmaW5lZCA6IHBhcnNlRmxvYXQodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5nc1t0aGlzLnNldHRpbmdzUGFyYW1ldGVyXVtpbmRleF0udmFsdWUgPSBpc05hTihudW1WYWx1ZSBhcyBudW1iZXIpID8gdW5kZWZpbmVkIDogbnVtVmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuQ29tcG9uZW50LmlucHV0RWwudHlwZSA9ICdudW1iZXInO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2NoZWNrYm94JzpcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNoZWNrYm94RWwgPSBjb250YWluZXJFbC5jcmVhdGVEaXYoeyBjbHM6ICd0cmktc3RhdGUtY2hlY2tib3ggY2xpY2thYmxlLWljb24nIH0pO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuQ29tcG9uZW50ID0gY2hlY2tib3hFbDtcclxuICAgICAgICAgICAgICAgIGNoZWNrYm94RWwuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgJ0NoZWNrYm94IFN0YXR1cyBcdTAwRTRuZGVybicpO1xyXG4gICAgICAgICAgICAgICAgY2hlY2tib3hFbC5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnY2hlY2tib3gnKTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCB1cGRhdGVDaGVja2JveFZpc3VhbCA9IChzdGF0ZTogYm9vbGVhbiB8IHVuZGVmaW5lZCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBpY29uTmFtZTogc3RyaW5nO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBhcmlhU3RhdGU6ICd0cnVlJyB8ICdmYWxzZScgfCAnbWl4ZWQnO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpY29uTmFtZSA9ICdjaGVjay1zcXVhcmUnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcmlhU3RhdGUgPSAndHJ1ZSc7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0ZSA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWNvbk5hbWUgPSAnc3F1YXJlJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJpYVN0YXRlID0gJ2ZhbHNlJztcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgeyAvLyB1bmRlZmluZWQgb3IgbnVsbFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpY29uTmFtZSA9ICdtaW51cy1zcXVhcmUnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcmlhU3RhdGUgPSAnbWl4ZWQnO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBzZXRJY29uKGNoZWNrYm94RWwsIGljb25OYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICBjaGVja2JveEVsLnNldEF0dHJpYnV0ZSgnYXJpYS1jaGVja2VkJywgYXJpYVN0YXRlKTtcclxuICAgICAgICAgICAgICAgICAgICBjaGVja2JveEVsLmRhdGFzZXQuc3RhdGUgPSBTdHJpbmcoc3RhdGUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICB1cGRhdGVDaGVja2JveFZpc3VhbChjdXJyZW50VmFsdWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIGNoZWNrYm94RWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGN1cnJlbnRTdGF0ZSA9IGNoZWNrYm94RWwuZGF0YXNldC5zdGF0ZTtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgbmV4dFN0YXRlOiBib29sZWFuIHwgdW5kZWZpbmVkO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFN0YXRlID09PSAnZmFsc2UnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRTdGF0ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjdXJyZW50U3RhdGUgPT09ICd0cnVlJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXh0U3RhdGUgPSB1bmRlZmluZWQ7IFxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXh0U3RhdGUgPSBmYWxzZTsgXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5nc1t0aGlzLnNldHRpbmdzUGFyYW1ldGVyXVtpbmRleF0udmFsdWUgPSBuZXh0U3RhdGU7XHJcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZUNoZWNrYm94VmlzdWFsKG5leHRTdGF0ZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnZGF0ZSc6XHJcbiAgICAgICAgICAgICAgICByZXR1cm5Db21wb25lbnQgPSBuZXcgVGV4dENvbXBvbmVudChjb250YWluZXJFbClcclxuICAgICAgICAgICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJ1lZWVktTU0tREQnKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zZXRWYWx1ZShjdXJyZW50VmFsdWUgfHwgJycpXHJcbiAgICAgICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5nc1t0aGlzLnNldHRpbmdzUGFyYW1ldGVyXVtpbmRleF0udmFsdWUgPSB2YWx1ZSB8fCB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuQ29tcG9uZW50LmlucHV0RWwudHlwZSA9ICdkYXRlJztcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdkYXRldGltZSc6XHJcbiAgICAgICAgICAgICAgICByZXR1cm5Db21wb25lbnQgPSBuZXcgVGV4dENvbXBvbmVudChjb250YWluZXJFbClcclxuICAgICAgICAgICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJ1lZWVktTU0tRERUSEg6bW0nKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zZXRWYWx1ZShjdXJyZW50VmFsdWUgfHwgJycpXHJcbiAgICAgICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5nc1t0aGlzLnNldHRpbmdzUGFyYW1ldGVyXVtpbmRleF0udmFsdWUgPSB2YWx1ZSB8fCB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuQ29tcG9uZW50LmlucHV0RWwudHlwZSA9ICdkYXRldGltZS1sb2NhbCc7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAndGFncyc6XHJcbiAgICAgICAgICAgIGNhc2UgJ211bHRpdGV4dCc6XHJcbiAgICAgICAgICAgICAgICByZXR1cm5Db21wb25lbnQgPSBuZXcgVGV4dENvbXBvbmVudChjb250YWluZXJFbClcclxuICAgICAgICAgICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJ1dlcnRlIChrb21tYWdldHJlbm50KScpXHJcbiAgICAgICAgICAgICAgICAgICAgLnNldFZhbHVlKEFycmF5LmlzQXJyYXkoY3VycmVudFZhbHVlKSA/IGN1cnJlbnRWYWx1ZS5qb2luKCcsICcpIDogKGN1cnJlbnRWYWx1ZSB8fCAnJykpXHJcbiAgICAgICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhcnJheVZhbHVlID0gdmFsdWUuc3BsaXQoJywnKS5tYXAocyA9PiBzLnRyaW0oKSkuZmlsdGVyKHMgPT4gcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzW3RoaXMuc2V0dGluZ3NQYXJhbWV0ZXJdW2luZGV4XS52YWx1ZSA9IGFycmF5VmFsdWUubGVuZ3RoID4gMCA/IGFycmF5VmFsdWUgOiB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ3RleHQnOlxyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuQ29tcG9uZW50ID0gbmV3IFRleHRDb21wb25lbnQoY29udGFpbmVyRWwpXHJcbiAgICAgICAgICAgICAgICAgICAgLnNldFBsYWNlaG9sZGVyKCdXZXJ0JylcclxuICAgICAgICAgICAgICAgICAgICAuc2V0VmFsdWUoY3VycmVudFZhbHVlIHx8ICcnKVxyXG4gICAgICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3NbdGhpcy5zZXR0aW5nc1BhcmFtZXRlcl1baW5kZXhdLnZhbHVlID0gdmFsdWUgfHwgdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmV0dXJuQ29tcG9uZW50O1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZVByb3BlcnR5SWNvbihpY29uRWw6IEhUTUxFbGVtZW50LCB0eXBlOiBzdHJpbmcgfCB1bmRlZmluZWQpIHtcclxuICAgICAgICBsZXQgaWNvbk5hbWUgPSAnaGFzaCc7XHJcbiAgICAgICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgJ3RleHQnOiBpY29uTmFtZSA9ICdhbGlnbi1sZWZ0JzsgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ251bWJlcic6IGljb25OYW1lID0gJ2JpbmFyeSc7IGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdtdWx0aXRleHQnOiBpY29uTmFtZSA9ICdsaXN0JzsgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2RhdGUnOiBpY29uTmFtZSA9ICdjYWxlbmRhcic7IGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdkYXRldGltZSc6IGljb25OYW1lID0gJ2Nsb2NrJzsgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2NoZWNrYm94JzogaWNvbk5hbWUgPSAnY2hlY2stc3F1YXJlJzsgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ3RhZ3MnOiBpY29uTmFtZSA9ICd0YWdzJzsgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2FsaWFzZXMnOiBpY29uTmFtZSA9ICdmb3J3YXJkJzsgYnJlYWs7XHJcbiAgICAgXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IGljb25OYW1lID0gJ2hlbHAtY2lyY2xlJztcclxuICAgICAgICB9XHJcbiAgICAgICAgc2V0SWNvbihpY29uRWwsIGljb25OYW1lKTtcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyB1cGRhdGVQcmV2aWV3KGFjdGl2ZUZpbGUsIHJ1bGUsIGNvbXBvbmVudEVsKSB7XHJcbiAgICAgICAgaWYgKGFjdGl2ZUZpbGUpIHtcclxuICAgICAgICAgICAgbGV0IHJ1bGVSZXN1bHQ7XHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuYXBwLmZpbGVNYW5hZ2VyLnByb2Nlc3NGcm9udE1hdHRlcihhY3RpdmVGaWxlLCAoZnJvbnRtYXR0ZXIpID0+IHtcclxuICAgICAgICAgICAgICAgIHJ1bGVSZXN1bHQgPSBleGVjdXRlUnVsZSh0aGlzLmFwcCwgdGhpcy5wbHVnaW4uc2V0dGluZ3MsIGFjdGl2ZUZpbGUsICcnLCBydWxlLCBmcm9udG1hdHRlcik7XHJcbiAgICAgICAgICAgIH0seydtdGltZSc6YWN0aXZlRmlsZS5zdGF0Lm10aW1lfSk7ICBcclxuXHJcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIHJ1bGVSZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkocnVsZVJlc3VsdCkpIGNvbXBvbmVudEVsLnZhbHVlID0gcnVsZVJlc3VsdC50b1N0cmluZygpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBjb21wb25lbnRFbC52YWx1ZSA9IHJ1bGVSZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIGNvbXBvbmVudEVsLnNldFRvb2x0aXAoY29tcG9uZW50RWwudmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBhc3luYyBkaXNwbGF5KCk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgICAgIGNvbnN0IGNvbnRhaW5lckVsID0gdGhpcy5jb250YWluZXI7XHJcbiAgICAgICAgY29udGFpbmVyRWwuZW1wdHkoKTtcclxuXHJcbiAgICAgICAgYXdhaXQgdGhpcy5mZXRjaEtub3duUHJvcGVydGllcygpO1xyXG5cclxuICAgICAgICBjb25zdCBwcm9wZXJ0aWVzTGlzdEVsID0gY29udGFpbmVyRWwuY3JlYXRlRGl2KCdwcm9wZXJ0aWVzLWxpc3QnKTtcclxuXHJcbiAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MucnVsZXMuZm9yRWFjaCgocHJvcENvbmZpZywgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJQcm9wZXJ0eVJvdyhwcm9wZXJ0aWVzTGlzdEVsLCBwcm9wQ29uZmlnLCBpbmRleCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGNvbnN0IGFkZEJ0bkNvbnRhaW5lciA9IGNvbnRhaW5lckVsLmNyZWF0ZURpdih7IGNsczogJ3NldHRpbmctaXRlbS1jb250cm9sJyB9KTtcclxuICAgICAgICBhZGRCdG5Db250YWluZXIuc3R5bGUuanVzdGlmeUNvbnRlbnQgPSAncmlnaHQnO1xyXG4gICAgICAgIG5ldyBCdXR0b25Db21wb25lbnQoYWRkQnRuQ29udGFpbmVyKVxyXG4gICAgICAgICAgICAuc2V0QnV0dG9uVGV4dCgnRWlnZW5zY2hhZnQgaGluenVmXHUwMEZDZ2VuJylcclxuICAgICAgICAgICAgLnNldEljb24oJ3BsdXMtY2lyY2xlJylcclxuICAgICAgICAgICAgLnNldEN0YSgpXHJcbiAgICAgICAgICAgIC5vbkNsaWNrKGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGRlZmF1bHROYW1lID0gJyc7IC8vT2JqZWN0LmtleXModGhpcy5rbm93blByb3BlcnRpZXMpWzBdIHx8ICcnO1xyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5wbHVnaW4uc2V0dGluZ3NbdGhpcy5zZXR0aW5nc1BhcmFtZXRlcl0ucHVzaCh7IG5hbWU6IGRlZmF1bHROYW1lLCB2YWx1ZTogdW5kZWZpbmVkIH0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3NbdGhpcy5zZXR0aW5nc1BhcmFtZXRlcl0ucHVzaChPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1JVTEVfREVGSU5JVElPTiwge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkOiByYW5kb21VVUlEKCkudG9TdHJpbmcoKSxcclxuICAgICAgICAgICAgICAgIH0pKTtcclxuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kaXNwbGF5KCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5idXR0b25FbC5jbGFzc05hbWU9J3Byb3BlcnR5LXBsdXMtYnV0dG9uJztcclxuICAgIH1cclxufSJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxJQUFBQSxtQkFBOEc7OztBQ0E5RyxJQUFBQyxtQkFBa0c7OztBQ0FsRyxzQkFBaUQ7QUEwQzFDLFNBQVMsaUNBQWlDLEtBQThC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QUMxQyxtQkFBYSxLQUFLLE1BQU07QUFBQSxJQUM1QjtBQUdBLFFBQUksaUJBQXNCLENBQUM7QUFDM0IsUUFBSSxhQUFhO0FBQ2IsdUJBQWlCLEVBQUMsR0FBRyxZQUFXO0FBRWhDLGFBQU8sZUFBZSxLQUFLLFNBQVMsZ0JBQWdCO0FBQUEsSUFDeEQ7QUFHQSxRQUFJLGFBQWE7QUFDakIsUUFBSSxRQUFRLFdBQVcsS0FBSyxHQUFHO0FBRTNCLFlBQU0saUJBQWlCLFFBQVEsUUFBUSxPQUFPLENBQUMsSUFBSTtBQUNuRCxZQUFNLGNBQWMsUUFBUSxNQUFNLGNBQWM7QUFHaEQsVUFBSSxxQkFBcUIsT0FBTyxRQUFRLGNBQWMsRUFDakQsSUFBSSxDQUFDLENBQUMsS0FBSyxLQUFLLE1BQU0sR0FBRyxRQUFRLE9BQU8sRUFDeEMsS0FBSyxJQUFJO0FBR2QsVUFBSSxhQUFhLFNBQVMsR0FBRztBQUN6Qiw4QkFBc0I7QUFBQSxFQUFLLEtBQUssU0FBUztBQUFBLElBQ3JDLGFBQWEsSUFBSSxTQUFPLE9BQU8sS0FBSyxFQUFFLEtBQUssSUFBSTtBQUFBLE1BQ3ZEO0FBRUEsbUJBQWE7QUFBQSxFQUFRO0FBQUEsS0FBMEI7QUFBQSxJQUNuRCxPQUFPO0FBRUgsVUFBSSxhQUFhLFNBQVMsR0FBRztBQUN6QixxQkFBYTtBQUFBLEVBQVEsS0FBSyxTQUFTO0FBQUEsSUFDL0IsYUFBYSxJQUFJLFNBQU8sT0FBTyxLQUFLLEVBQUUsS0FBSyxJQUFJLElBQy9DO0FBQUE7QUFBQTtBQUFBLEVBQVk7QUFBQSxNQUNwQixPQUFPO0FBRUg7QUFBQSxNQUNKO0FBQUEsSUFDSjtBQUVBLFVBQU0sS0FBSyxJQUFJLE1BQU0sT0FBTyxNQUFNLFVBQVU7QUFBQSxFQUNoRDtBQUNKOyIsCiAgIm5hbWVzIjogWyJpbXBvcnRfb2JzaWRpYW4iLCAiaW1wb3J0X29ic2lkaWFuIiwgImpzQ29kZSIsICJ0ZXh0IiwgInZhbHVlIiwgImltcG9ydF9vYnNpZGlhbiIsICJpbXBvcnRfb2JzaWRpYW4iLCAiaW1wb3J0X2NyeXB0byIsICJpbXBvcnRfb2JzaWRpYW4iLCAicnVsZSIsICJjbUVkaXRvciIsICJqc0NvZGUiLCAiX2EiXQp9Cg==
